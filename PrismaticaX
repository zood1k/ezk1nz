local Services = {}
Services.Players = game:GetService("Players")
Services.UIS = game:GetService("UserInputService")
Services.TweenService = game:GetService("TweenService")
Services.SoundService = game:GetService("SoundService")
Services.TeleportService = game:GetService("TeleportService")
Services.HttpService = game:GetService("HttpService")
Services.Lighting = game:GetService("Lighting")
Services.RunService = game:GetService("RunService")
Services.ContentProvider = game:GetService("ContentProvider")

local Player = Services.Players.LocalPlayer

local Settings = {
    SEARCH_RESTORE_ON_OPEN = false,
    SEARCH_RESTORE_ON_MINIMIZE = false,
    IS_MOBILE = Services.UIS.TouchEnabled and not Services.UIS.KeyboardEnabled,
    GUI_WIDTH = 620,
    ORIGINAL_HEIGHT = 520,
    HEADER_HEIGHT = 52,
    SIDEBAR_WIDTH = 160,
    CORNER_RADIUS = 18,
    PROFILE_HEIGHT = 66,
    BOTTOM_RESERVED = 76,
    GUI_OPEN = true,
    WINDOW_MINIMIZED = false,
    GUI_OPACITY = 0,
    CURRENT_BIND = Enum.KeyCode.RightControl,
    IS_BINDING = false,
    CURRENT_THEME = "Default Blue",
    IS_ANIMATING = false,
    SAVE_FILE = "PrismaticaXSettings.json"
}
_G.CurrentlyDragging = nil
if Settings.IS_MOBILE then
    Settings.GUI_WIDTH = 360
    Settings.ORIGINAL_HEIGHT = 420
    Settings.HEADER_HEIGHT = 46
    Settings.SIDEBAR_WIDTH = 120
    Settings.CORNER_RADIUS = 14
    Settings.PROFILE_HEIGHT = 56
    Settings.BOTTOM_RESERVED = 66
end

local Colors = {
    Base = Color3.fromRGB(18,28,48),
    Header = Color3.fromRGB(22,34,58),
    Sidebar = Color3.fromRGB(16,24,44),
    Content = Color3.fromRGB(20,30,52),
    Card = Color3.fromRGB(26,38,64),
    Interactive = Color3.fromRGB(60,90,150),
    InteractiveHover = Color3.fromRGB(80,120,190),
    InteractiveActive = Color3.fromRGB(100,150,230),
    ToggleOn = Color3.fromRGB(120,180,255),
    ToggleOff = Color3.fromRGB(60,70,85),
    TextMain = Color3.fromRGB(255,255,255),
    TextSub = Color3.fromRGB(180,200,255),
    Border = Color3.fromRGB(90,140,220),
    Accent = Color3.fromRGB(120,180,255),
    Section = Color3.fromRGB(22,32,55),
    Success = Color3.fromRGB(50,180,100),
    Error = Color3.fromRGB(220,60,60),
    Warning = Color3.fromRGB(230,180,50)
}

local TAB_HUE_OFFSETS = {
    Effects = 0.00,
    Music = 0.10,
    Fun = 0.20,
    Utility = 0.30,
    Settings = 0.40,
}

local UI = {}
local Data = {}
Data.AllModules = {}
Data.AllToggles = {}
Data.AllSliders = {}
Data.AllKeybinds = {}
Data.Pages = {}
Data.Tabs = {}
Data.ActiveTab = nil

local MT = {}
MT.__index = function(t, k)
    return rawget(t, k) or function(...)
        local fn = rawget(t, "_"..k)
        if fn then return fn(...) end
    end
end

local Core = setmetatable({}, MT)
Core._getGui = function()
    local success, result = pcall(function()
        return gethui() or game:GetService("CoreGui")
    end)
    if success and result then return result end
    return Player:WaitForChild("PlayerGui")
end

Core._saveSettings = function()
    local settings = {
        theme = Settings.CURRENT_THEME,
        guiOpacity = Settings.GUI_OPACITY,
        keybind = Settings.CURRENT_BIND.Name,
        guiWidth = Settings.GUI_WIDTH,
        guiHeight = Settings.ORIGINAL_HEIGHT
    }
    pcall(function()
        if writefile then
            writefile(Settings.SAVE_FILE, Services.HttpService:JSONEncode(settings))
        end
    end)
end

Core._loadSettings = function()
    local success, result = pcall(function()
        if readfile and isfile and isfile(Settings.SAVE_FILE) then
            return Services.HttpService:JSONDecode(readfile(Settings.SAVE_FILE))
        end
        return nil
    end)
    if success and result then return result end
    return nil
end

Core._getTabAccent = function(tabName)
    local h, s, v = Colors.Accent:ToHSV()
    local off = TAB_HUE_OFFSETS[tabName] or 0
    return Color3.fromHSV((h + off) % 1, math.clamp(s, 0.6, 1), v)
end

Core._makeScrollBarInvisible = function(sf)
    sf.ScrollBarThickness = 0
    sf.ScrollBarImageTransparency = 1
    sf.VerticalScrollBarInset = Enum.ScrollBarInset.None
end

Core._makeScrollBarVisible = function(sf)
    sf.ScrollBarThickness = 4
    sf.ScrollBarImageColor3 = Colors.Interactive
    sf.ScrollBarImageTransparency = 0.3
    sf.VerticalScrollBarInset = Enum.ScrollBarInset.None
end

Core._updateGuiOpacity = function(opacity)
    _G.guiOpacityTrans = math.clamp(opacity / 100, 0, 1)
    _G.guiOpacityTransLimited = math.min(_G.guiOpacityTrans, 0.7)
    
    if UI.Main then UI.Main.BackgroundTransparency = _G.guiOpacityTrans end
    
    if UI.SearchModal then UI.SearchModal.BackgroundTransparency = _G.guiOpacityTransLimited end
    if UI.ModalShadow then UI.ModalShadow.ImageTransparency = 0.75 + 0.15 * _G.guiOpacityTransLimited end    if UI.ModalStroke then UI.ModalStroke.Transparency = 0.3 + 0.3 * _G.guiOpacityTransLimited end
    if UI.ResultsContainer then UI.ResultsContainer.BackgroundTransparency = _G.guiOpacityTransLimited end
    if UI.CloseSearchBtn then UI.CloseSearchBtn.BackgroundTransparency = 0.2 + 0.3 * _G.guiOpacityTransLimited end
    if UI.ResStroke then UI.ResStroke.Transparency = 0.3 + 0.3 * _G.guiOpacityTransLimited end
end

Core._updateHeaderFillVisibility = function(minimized)
    if UI.HeaderLine then UI.HeaderLine.Visible = not minimized end
end

Core._registerModule = function(name, highlightTarget, parent, tabName, moduleType, extraData)
    tabName = tabName or "Unknown"
    moduleType = moduleType or "module"
    local page = parent
    if parent and not page:IsA("ScrollingFrame") then
        page = parent:FindFirstAncestorOfClass("ScrollingFrame")
    end
    if highlightTarget and highlightTarget.Parent == UI.Sidebar then
        page = nil
    end
    table.insert(Data.AllModules, {
        name = name,
        highlightTarget = highlightTarget,
        page = page,
        tabName = tabName,
        moduleType = moduleType,
        extraData = extraData or {}
    })
end

Core._switchTab = function(name)
    if Data.ActiveTab == name then return end
    for n, p in pairs(Data.Pages) do
        p.Visible = (n == name)
    end
    Data.ActiveTab = name
    for tabName, tabFrame in pairs(Data.Tabs) do
        local stroke = tabFrame:FindFirstChild("TabStroke")
        if tabName == name then
            tabFrame.BackgroundColor3 = Colors.Interactive
            tabFrame.BackgroundTransparency = 0.3
            if stroke then
                stroke.Color = Colors.Accent
                stroke.Transparency = 0.4
            end
        else
            tabFrame.BackgroundColor3 = Colors.Card
            tabFrame.BackgroundTransparency = 0.3
            if stroke then
                stroke.Color = Colors.Border
                stroke.Transparency = 0.7
            end
        end
    end
end

local guiParent = Core.getGui()
UI.Gui = Instance.new("ScreenGui", guiParent)
UI.Gui.Name = "PrismaticaX_Main"
UI.Gui.ResetOnSpawn = false
UI.Gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
UI.Gui.DisplayOrder = 2147483647
UI.Gui.IgnoreGuiInset = true

pcall(function()
    if syn and syn.protect_gui then
        syn.protect_gui(UI.Gui)
    end
    UI.Gui.OnTopOfCoreBlur = true
end)

UI.Shadow = Instance.new("ImageLabel", UI.Gui)
UI.Shadow.Name = "Shadow"
UI.Shadow.BackgroundTransparency = 1
UI.Shadow.Size = UDim2.fromOffset(Settings.GUI_WIDTH + 12, Settings.ORIGINAL_HEIGHT + 12)
UI.Shadow.Position = UDim2.fromScale(0.5, 0.5)
UI.Shadow.AnchorPoint = Vector2.new(0.5, 0.5)
UI.Shadow.Image = "rbxassetid://6014261993"
UI.Shadow.ImageColor3 = Color3.new(0, 0, 0)
UI.Shadow.ImageTransparency = 0.75
UI.Shadow.ScaleType = Enum.ScaleType.Slice
UI.Shadow.SliceCenter = Rect.new(49, 49, 450, 450)
UI.Shadow.ZIndex = 0
UI.Shadow.Visible = false

UI.Main = Instance.new("Frame", UI.Gui)
UI.Main.Name = "MainFrame"
UI.Main.Size = UDim2.fromOffset(0, 0)
UI.Main.Position = UDim2.fromScale(0.5, 0.5)
UI.Main.AnchorPoint = Vector2.new(0.5, 0.5)
UI.Main.BackgroundColor3 = Colors.Base
UI.Main.ClipsDescendants = true
UI.Main.BorderSizePixel = 0
UI.Main.BackgroundTransparency = 0
UI.Main.ZIndex = 1
UI.Main.Visible = false

UI.MainCorner = Instance.new("UICorner", UI.Main)
UI.MainCorner.CornerRadius = UDim.new(0, Settings.CORNER_RADIUS)

UI.MainStroke = Instance.new("UIStroke", UI.Main)
UI.MainStroke.Color = Colors.Border
UI.MainStroke.Transparency = 0.7
UI.MainStroke.Thickness = 1.5

UI.Header = Instance.new("Frame", UI.Main)
UI.Header.Name = "Header"
UI.Header.Size = UDim2.new(1, 0, 0, Settings.HEADER_HEIGHT)
UI.Header.BackgroundTransparency = 1
UI.Header.BorderSizePixel = 0
UI.Header.ZIndex = 2

UI.HeaderLine = Instance.new("Frame", UI.Header)
UI.HeaderLine.Name = "HeaderLine"
UI.HeaderLine.Size = UDim2.new(1, -20, 0, 1)
UI.HeaderLine.Position = UDim2.new(0, 10, 1, -1)
UI.HeaderLine.BackgroundColor3 = Colors.Border
UI.HeaderLine.BackgroundTransparency = 0.7
UI.HeaderLine.BorderSizePixel = 0
UI.HeaderLine.ZIndex = 3

UI.LogoContainer = Instance.new("Frame", UI.Header)
UI.LogoContainer.Size = UDim2.fromOffset(Settings.IS_MOBILE and 32 or 40, Settings.IS_MOBILE and 32 or 40)
UI.LogoContainer.Position = UDim2.fromOffset(12, Settings.IS_MOBILE and 7 or 6)
UI.LogoContainer.BackgroundColor3 = Colors.Card
UI.LogoContainer.BackgroundTransparency = 0.5
UI.LogoContainer.BorderSizePixel = 0
UI.LogoContainer.ZIndex = 3

UI.LogoContainerCorner = Instance.new("UICorner", UI.LogoContainer)
UI.LogoContainerCorner.CornerRadius = UDim.new(0, 10)

UI.LogoStroke = Instance.new("UIStroke", UI.LogoContainer)
UI.LogoStroke.Color = Colors.Border
UI.LogoStroke.Transparency = 0.5
UI.LogoStroke.Thickness = 1

UI.LogoIcon = Instance.new("ImageLabel", UI.LogoContainer)
UI.LogoIcon.Size = UDim2.fromOffset(Settings.IS_MOBILE and 24 or 32, Settings.IS_MOBILE and 24 or 32)
UI.LogoIcon.Position = UDim2.fromOffset(Settings.IS_MOBILE and 4 or 4, Settings.IS_MOBILE and 4 or 4)
UI.LogoIcon.BackgroundTransparency = 1
UI.LogoIcon.Image = "rbxassetid://72998769206857"
UI.LogoIcon.ScaleType = Enum.ScaleType.Fit
UI.LogoIcon.ZIndex = 4

UI.Title = Instance.new("TextLabel", UI.Header)
UI.Title.Position = UDim2.fromOffset(Settings.IS_MOBILE and 50 or 60, Settings.IS_MOBILE and 8 or 10)
UI.Title.Size = UDim2.new(0, Settings.IS_MOBILE and 50 or 60, 0, 20)
UI.Title.Text = Settings.IS_MOBILE and "PrismaticaX" or "PrismaticaX"
UI.Title.Font = Enum.Font.FredokaOne
UI.Title.TextSize = Settings.IS_MOBILE and 15 or 18
UI.Title.TextXAlignment = Enum.TextXAlignment.Left
UI.Title.BackgroundTransparency = 1
UI.Title.TextColor3 = Colors.TextMain
UI.Title.ZIndex = 3

UI.TimeContainer = Instance.new("Frame", UI.Header)
UI.TimeContainer.Name = "TimeContainer"
UI.TimeContainer.Size = UDim2.fromOffset(Settings.IS_MOBILE and 52 or 60, Settings.IS_MOBILE and 26 or 30)
UI.TimeContainer.Position = UDim2.fromOffset(Settings.IS_MOBILE and 157 or 157, Settings.IS_MOBILE and 10 or 11)
UI.TimeContainer.BackgroundColor3 = Colors.Interactive
UI.TimeContainer.BackgroundTransparency = 0.5
UI.TimeContainer.ZIndex = 5
UI.TimeContainer.Visible = not Settings.IS_MOBILE

UI.TimeCorner = Instance.new("UICorner", UI.TimeContainer)
UI.TimeCorner.CornerRadius = UDim.new(0, 8)

UI.TimeLabel = Instance.new("TextLabel", UI.TimeContainer)
UI.TimeLabel.Name = "TimeLabel"
UI.TimeLabel.Size = UDim2.fromScale(1, 1)
UI.TimeLabel.Position = UDim2.fromScale(0, 0)
UI.TimeLabel.BackgroundTransparency = 1
UI.TimeLabel.Text = "00:00:00"
UI.TimeLabel.Font = Enum.Font.FredokaOne
UI.TimeLabel.TextSize = Settings.IS_MOBILE and 10 or 12
UI.TimeLabel.TextColor3 = Color3.new(1, 1, 1)
UI.TimeLabel.TextXAlignment = Enum.TextXAlignment.Center
UI.TimeLabel.TextYAlignment = Enum.TextYAlignment.Center
UI.TimeLabel.ZIndex = 6

UI.Author = Instance.new("TextLabel", UI.Header)
UI.Author.Name = "Author"
UI.Author.Position = UDim2.fromOffset(Settings.IS_MOBILE and 50 or 60, Settings.IS_MOBILE and 26 or 30)
UI.Author.Size = UDim2.new(1, -120, 0, 14)
UI.Author.Text = "by @zood3llotgk"
UI.Author.Font = Enum.Font.FredokaOne
UI.Author.TextSize = Settings.IS_MOBILE and 10 or 12
UI.Author.TextXAlignment = Enum.TextXAlignment.Left
UI.Author.BackgroundTransparency = 1
UI.Author.TextColor3 = Color3.new(1, 1, 1)
UI.Author.ZIndex = 3

UI.Controls = Instance.new("Frame", UI.Header)
UI.Controls.Name = "Controls"
UI.Controls.Size = UDim2.fromOffset(Settings.IS_MOBILE and 65 or 75, Settings.IS_MOBILE and 26 or 30)
UI.Controls.Position = UDim2.new(1, Settings.IS_MOBILE and -75 or -88, 0.5, Settings.IS_MOBILE and -13 or -15)
UI.Controls.BackgroundTransparency = 1
UI.Controls.ZIndex = 3

UI.ContentHolder = Instance.new("Frame", UI.Main)
UI.ContentHolder.Name = "ContentHolder"
UI.ContentHolder.Position = UDim2.fromOffset(0, Settings.HEADER_HEIGHT)
UI.ContentHolder.Size = UDim2.new(1, 0, 1, -Settings.HEADER_HEIGHT)
UI.ContentHolder.BackgroundTransparency = 1
UI.ContentHolder.ClipsDescendants = true
UI.ContentHolder.BorderSizePixel = 0

UI.Sidebar = Instance.new("ScrollingFrame", UI.ContentHolder)
UI.Sidebar.Name = "Sidebar"
UI.Sidebar.Position = UDim2.fromOffset(0, 0)
UI.Sidebar.Size = UDim2.new(0, Settings.SIDEBAR_WIDTH, 1, -Settings.BOTTOM_RESERVED)
UI.Sidebar.BackgroundTransparency = 1
UI.Sidebar.BorderSizePixel = 0
UI.Sidebar.ZIndex = 2
UI.Sidebar.CanvasSize = UDim2.new(0, 0, 0, 0)
UI.Sidebar.AutomaticCanvasSize = Enum.AutomaticSize.Y
UI.Sidebar.ScrollingDirection = Enum.ScrollingDirection.Y
UI.Sidebar.ElasticBehavior = Enum.ElasticBehavior.Always
Core.makeScrollBarVisible(UI.Sidebar)

UI.SidebarPadding = Instance.new("UIPadding", UI.Sidebar)
UI.SidebarPadding.PaddingTop = UDim.new(0, 8)
UI.SidebarPadding.PaddingBottom = UDim.new(0, 10)
UI.SidebarPadding.PaddingLeft = UDim.new(0, 10)
UI.SidebarPadding.PaddingRight = UDim.new(0, 10)

UI.SidebarLayout = Instance.new("UIListLayout", UI.Sidebar)
UI.SidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
UI.SidebarLayout.Padding = UDim.new(0, Settings.IS_MOBILE and 6 or 8)
UI.SidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

UI.SidebarLine = Instance.new("Frame", UI.ContentHolder)
UI.SidebarLine.Name = "SidebarLine"
UI.SidebarLine.Size = UDim2.new(0, 1, 1, -20)
UI.SidebarLine.Position = UDim2.fromOffset(Settings.SIDEBAR_WIDTH, 10)
UI.SidebarLine.BackgroundColor3 = Colors.Border
UI.SidebarLine.BackgroundTransparency = 0.7
UI.SidebarLine.BorderSizePixel = 0
UI.SidebarLine.ZIndex = 3

UI.Content = Instance.new("Frame", UI.ContentHolder)
UI.Content.Name = "Content"
UI.Content.Position = UDim2.fromOffset(Settings.SIDEBAR_WIDTH + 1, 0)
UI.Content.Size = UDim2.new(1, -Settings.SIDEBAR_WIDTH - 1, 1, 0)
UI.Content.BackgroundTransparency = 1
UI.Content.BorderSizePixel = 0
UI.Content.ZIndex = 2

UI.SearchButton = Instance.new("Frame", UI.Header)
UI.SearchButton.Name = "SearchButton"
UI.SearchButton.Size = UDim2.fromOffset(Settings.IS_MOBILE and 75 or 95, Settings.IS_MOBILE and 26 or 30)
UI.SearchButton.Position = UDim2.new(1, Settings.IS_MOBILE and -155 or -190, 0.5, Settings.IS_MOBILE and -13 or -15)
UI.SearchButton.BackgroundColor3 = Colors.Interactive
UI.SearchButton.BackgroundTransparency = 0.5
UI.SearchButton.ZIndex = 5

UI.SearchButtonCorner = Instance.new("UICorner", UI.SearchButton)
UI.SearchButtonCorner.CornerRadius = UDim.new(0, 8)

UI.SearchIcon = Instance.new("ImageLabel", UI.SearchButton)
UI.SearchIcon.Name = "Icon"
UI.SearchIcon.Size = UDim2.fromOffset(Settings.IS_MOBILE and 14 or 16, Settings.IS_MOBILE and 14 or 16)
UI.SearchIcon.Position = UDim2.fromOffset(Settings.IS_MOBILE and 8 or 10, Settings.IS_MOBILE and 6 or 7)
UI.SearchIcon.BackgroundTransparency = 1
UI.SearchIcon.Image = "rbxassetid://6031154871"
UI.SearchIcon.ImageColor3 = Colors.TextMain
UI.SearchIcon.ZIndex = 6

UI.SearchLabel = Instance.new("TextLabel", UI.SearchButton)
UI.SearchLabel.Size = UDim2.new(1, -30, 1, 0)
UI.SearchLabel.Position = UDim2.fromOffset(Settings.IS_MOBILE and 24 or 28, 0)
UI.SearchLabel.BackgroundTransparency = 1
UI.SearchLabel.Text = "Search"
UI.SearchLabel.Font = Enum.Font.FredokaOne
UI.SearchLabel.TextSize = Settings.IS_MOBILE and 10 or 12
UI.SearchLabel.TextColor3 = Colors.TextMain
UI.SearchLabel.TextXAlignment = Enum.TextXAlignment.Left
UI.SearchLabel.ZIndex = 6

UI.SearchClickBtn = Instance.new("TextButton", UI.SearchButton)
UI.SearchClickBtn.Size = UDim2.fromScale(1, 1)
UI.SearchClickBtn.BackgroundTransparency = 1
UI.SearchClickBtn.Text = ""
UI.SearchClickBtn.ZIndex = 7

UI.SearchOverlay = Instance.new("Frame", UI.Gui)
UI.SearchOverlay.Name = "SearchOverlay"
UI.SearchOverlay.Size = UDim2.fromScale(1, 1)
UI.SearchOverlay.BackgroundTransparency = 1
UI.SearchOverlay.ZIndex = 2147483000
UI.SearchOverlay.Active = false

UI.SearchModal = Instance.new("Frame", UI.SearchOverlay)
UI.SearchModal.Name = "SearchModal"
UI.SearchModal.Size = UDim2.fromOffset(Settings.IS_MOBILE and 280 or 380, Settings.IS_MOBILE and 50 or 56)
UI.SearchModal.AnchorPoint = Vector2.new(0.5, 1)
UI.SearchModal.BackgroundColor3 = Colors.Base
UI.SearchModal.BackgroundTransparency = math.min(Settings.GUI_OPACITY / 100, 0.7)
UI.SearchModal.ClipsDescendants = false
UI.SearchModal.Visible = false

UI.SearchModalCorner = Instance.new("UICorner", UI.SearchModal)
UI.SearchModalCorner.CornerRadius = UDim.new(0, 12)

UI.ModalStroke = Instance.new("UIStroke", UI.SearchModal)
UI.ModalStroke.Color = Colors.Border
UI.ModalStroke.Transparency = 0.3
UI.ModalStroke.Thickness = 1.5

UI.ModalShadow = Instance.new("ImageLabel", UI.SearchModal)
UI.ModalShadow.Name = "Shadow"
UI.ModalShadow.Size = UDim2.new(1, 12, 1, 12)
UI.ModalShadow.Position = UDim2.fromOffset(-6, -6)
UI.ModalShadow.BackgroundTransparency = 1
UI.ModalShadow.Image = "rbxassetid://6014261993"
UI.ModalShadow.ImageColor3 = Color3.new(0, 0, 0)
UI.ModalShadow.ImageTransparency = 0.75
UI.ModalShadow.ScaleType = Enum.ScaleType.Slice
UI.ModalShadow.SliceCenter = Rect.new(49, 49, 450, 450)
UI.ModalShadow.ZIndex = 9000

UI.ModalIcon = Instance.new("ImageLabel", UI.SearchModal)
UI.ModalIcon.Size = UDim2.fromOffset(Settings.IS_MOBILE and 18 or 22, Settings.IS_MOBILE and 18 or 22)
UI.ModalIcon.Position = UDim2.fromOffset(Settings.IS_MOBILE and 14 or 18, Settings.IS_MOBILE and 16 or 17)
UI.ModalIcon.BackgroundTransparency = 1
UI.ModalIcon.Image = "rbxassetid://6031154871"
UI.ModalIcon.ImageColor3 = Colors.TextSub
UI.ModalIcon.ZIndex = 9002

UI.SearchInput = Instance.new("TextBox", UI.SearchModal)
UI.SearchInput.Size = UDim2.new(1, Settings.IS_MOBILE and -80 or -100, 1, -16)
UI.SearchInput.Position = UDim2.fromOffset(Settings.IS_MOBILE and 38 or 48, 8)
UI.SearchInput.BackgroundTransparency = 1
UI.SearchInput.Text = ""
UI.SearchInput.PlaceholderText = "Search modules..."
UI.SearchInput.PlaceholderColor3 = Colors.TextSub
UI.SearchInput.Font = Enum.Font.FredokaOne
UI.SearchInput.TextSize = Settings.IS_MOBILE and 14 or 16
UI.SearchInput.TextColor3 = Colors.TextMain
UI.SearchInput.TextXAlignment = Enum.TextXAlignment.Left
UI.SearchInput.ClearTextOnFocus = false
UI.SearchInput.ZIndex = 9002

UI.CloseSearchBtn = Instance.new("TextButton", UI.SearchModal)
UI.CloseSearchBtn.Size = UDim2.fromOffset(Settings.IS_MOBILE and 28 or 32, Settings.IS_MOBILE and 28 or 32)
UI.CloseSearchBtn.Position = UDim2.new(1, Settings.IS_MOBILE and -38 or -44, 0.5, Settings.IS_MOBILE and -14 or -16)
UI.CloseSearchBtn.BackgroundColor3 = Colors.Interactive
UI.CloseSearchBtn.BackgroundTransparency = 0.3 + 0.4 * (Settings.GUI_OPACITY / 100)
UI.CloseSearchBtn.Text = "Ã—"
UI.CloseSearchBtn.Font = Enum.Font.FredokaOne
UI.CloseSearchBtn.TextSize = Settings.IS_MOBILE and 16 or 18
UI.CloseSearchBtn.TextColor3 = Colors.TextMain
UI.CloseSearchBtn.AutoButtonColor = false
UI.CloseSearchBtn.ZIndex = 9002

UI.CloseSearchBtnCorner = Instance.new("UICorner", UI.CloseSearchBtn)
UI.CloseSearchBtnCorner.CornerRadius = UDim.new(0, 6)

UI.ResultsContainer = Instance.new("ScrollingFrame", UI.SearchModal)
UI.ResultsContainer.Name = "Results"
UI.ResultsContainer.Size = UDim2.new(1, 0, 0, 0)
UI.ResultsContainer.Position = UDim2.new(0, 0, 1, 8)
UI.ResultsContainer.BackgroundColor3 = Colors.Base
UI.ResultsContainer.BackgroundTransparency = Settings.GUI_OPACITY / 100
UI.ResultsContainer.Visible = false
UI.ResultsContainer.ZIndex = 9001
UI.ResultsContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
UI.ResultsContainer.ScrollBarThickness = 3
UI.ResultsContainer.ScrollBarImageColor3 = Colors.Interactive
UI.ResultsContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
UI.ResultsContainer.ClipsDescendants = true

UI.ResultsContainerCorner = Instance.new("UICorner", UI.ResultsContainer)
UI.ResultsContainerCorner.CornerRadius = UDim.new(0, 10)

UI.ResStroke = Instance.new("UIStroke", UI.ResultsContainer)
UI.ResStroke.Color = Colors.Border
UI.ResStroke.Transparency = 0.5

UI.ResLayout = Instance.new("UIListLayout", UI.ResultsContainer)
UI.ResLayout.Padding = UDim.new(0, 4)

UI.ResPad = Instance.new("UIPadding", UI.ResultsContainer)
UI.ResPad.PaddingTop = UDim.new(0, 6)
UI.ResPad.PaddingBottom = UDim.new(0, 6)
UI.ResPad.PaddingLeft = UDim.new(0, 6)
UI.ResPad.PaddingRight = UDim.new(0, 6)

local searchDragging = false
local searchDragStart, searchStartPos
local searchCurrentTween = nil
local SEARCH_OPEN = false
local LastSearchPosition = nil
local SearchModalTween = nil
UI.SearchModal.InputBegan:Connect(function(input)
    if _G.CurrentlyDragging then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        _G.CurrentlyDragging = "Search"
        searchDragging = true
        searchDragStart = input.Position
        searchStartPos = UI.SearchModal.Position
       
        if searchCurrentTween then
            searchCurrentTween:Cancel()
        end
    end
end)
Services.UIS.InputChanged:Connect(function(input)
    if searchDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - searchDragStart
        local targetPos = UDim2.new(
            searchStartPos.X.Scale, searchStartPos.X.Offset + delta.X,
            searchStartPos.Y.Scale, searchStartPos.Y.Offset + delta.Y
        )
        if searchCurrentTween then
            searchCurrentTween:Cancel()
        end
        searchCurrentTween = Services.TweenService:Create(UI.SearchModal, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = targetPos
        })
        searchCurrentTween:Play()
    end
end)
Services.UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        searchDragging = false
        _G.CurrentlyDragging = nil
    end
end)

OpenSearch = function()
    if SEARCH_OPEN then return end
    SEARCH_OPEN = true
    if SearchModalTween then
        SearchModalTween:Cancel()
    end
    UI.SearchModal.Visible = true
    UI.ResultsContainer.Visible = false
    UI.SearchModal.Size = UDim2.fromOffset(0, 0)
    UI.SearchModal.BackgroundTransparency = 1
    if UI.ModalShadow then
        UI.ModalShadow.ImageTransparency = 1
    end
    if UI.ModalStroke then
        UI.ModalStroke.Transparency = 1
    end
    _G.SearchTargetPos = nil
    if LastSearchPosition then
        _G.SearchTargetPos = LastSearchPosition
        UI.SearchModal.Position = _G.SearchTargetPos
    else
        _G.SearchMainAbsPos = UI.Main.AbsolutePosition
        _G.SearchMainAbsSize = UI.Main.AbsoluteSize
        _G.SearchY = _G.SearchMainAbsPos.Y - (Settings.IS_MOBILE and 56 or 56) + 100
        _G.SearchX = _G.SearchMainAbsPos.X + _G.SearchMainAbsSize.X / 2
        _G.SearchTargetPos = UDim2.fromOffset(_G.SearchX, _G.SearchY)
        UI.SearchModal.Position = _G.SearchTargetPos
    end
    UI.SearchModal.AnchorPoint = Vector2.new(0.5, 1)
    SearchModalTween = Services.TweenService:Create(UI.SearchModal, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(Settings.IS_MOBILE and 300 or 400, Settings.IS_MOBILE and 50 or 56),
        BackgroundTransparency = math.min(Settings.GUI_OPACITY / 100, 0.7)
    })
    SearchModalTween:Play()
    if UI.ModalShadow then
        Services.TweenService:Create(UI.ModalShadow, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            ImageTransparency = 0.75
        }):Play()
    end
    if UI.ModalStroke then
        Services.TweenService:Create(UI.ModalStroke, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Transparency = 0.3
        }):Play()
    end
    task.wait(0.15)
    UI.SearchInput:CaptureFocus()
end

CloseSearch = function(instant)
    if not SEARCH_OPEN then return end
    SEARCH_OPEN = false
    LastSearchPosition = UI.SearchModal.Position
    if SearchModalTween then
        SearchModalTween:Cancel()
    end
    if instant then
        UI.SearchModal.Visible = false
        UI.ResultsContainer.Visible = false
        UI.SearchInput.Text = ""
        UI.SearchOverlay.Active = false
        return
    end
    SearchModalTween = Services.TweenService:Create(UI.SearchModal, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(0, 0),
        BackgroundTransparency = 1
    })
    SearchModalTween:Play()
    if UI.ModalShadow then
        Services.TweenService:Create(UI.ModalShadow, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            ImageTransparency = 1
        }):Play()
    end
    if UI.ModalStroke then
        Services.TweenService:Create(UI.ModalStroke, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Transparency = 1
        }):Play()
    end
    Services.TweenService:Create(UI.ResultsContainer, TweenInfo.new(0.15, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, 0)}):Play()
    task.delay(0.3, function()
        UI.SearchModal.Visible = false
        UI.ResultsContainer.Visible = false
        UI.SearchInput.Text = ""
        UI.SearchOverlay.Active = false
    end)
end

local function ClearResults()
    for _, c in ipairs(UI.ResultsContainer:GetChildren()) do
        if c:IsA("TextButton") or c:IsA("TextLabel") then c:Destroy() end
    end
end

local function ShowResults(query)
    ClearResults()
    if query == "" then
        Services.TweenService:Create(UI.ResultsContainer, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 0)}):Play()
        task.delay(0.15, function() UI.ResultsContainer.Visible = false end)
        return
    end
    local results = {}
    local q = string.lower(query)
    for _, m in ipairs(Data.AllModules) do
        if string.find(string.lower(m.name), q) then
            table.insert(results, m)
        end
    end
    UI.ResultsContainer.Visible = true
    if #results == 0 then
        local noRes = Instance.new("TextLabel", UI.ResultsContainer)
        noRes.Size = UDim2.new(1, 0, 0, 36)
        noRes.BackgroundTransparency = 1
        noRes.Text = "No results found"
        noRes.Font = Enum.Font.FredokaOne
        noRes.TextSize = Settings.IS_MOBILE and 12 or 14
        noRes.TextColor3 = Colors.TextSub
        noRes.ZIndex = 9003
        Services.TweenService:Create(UI.ResultsContainer, TweenInfo.new(0.2, Enum.EasingStyle.Quint), {Size = UDim2.new(1, 0, 0, 48)}):Play()
        return
    end
    local typeIcons = {
        tab = "rbxassetid://6031280882",
        section = "rbxassetid://6035047409",
        toggle = "rbxassetid://7072718362",
        slider = "rbxassetid://7072719338",
        dropdown = "rbxassetid://6031090990",
        dropdown_option = "rbxassetid://6035053248",
        keybind = "rbxassetid://6034509993",
        button = "rbxassetid://6031068420",
        module = "rbxassetid://6031229342"
    }
    local typeColors = {
        tab = Colors.Accent,
        section = Colors.Warning,
        toggle = Colors.ToggleOn,
        slider = Colors.Interactive,
        dropdown = Colors.InteractiveHover,
        dropdown_option = Colors.TextSub,
        keybind = Colors.Success,
        button = Colors.InteractiveActive,
        module = Colors.TextMain
    }
    for i, m in ipairs(results) do
        if i > 10 then break end
        local btn = Instance.new("TextButton", UI.ResultsContainer)
        btn.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 40 or 46)
        btn.BackgroundColor3 = Colors.Card
        btn.BackgroundTransparency = 0.3
        btn.AutoButtonColor = false
        btn.Text = ""
        btn.LayoutOrder = i
        btn.ZIndex = 9003
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
        local typeIcon = Instance.new("ImageLabel", btn)
        typeIcon.Size = UDim2.fromOffset(Settings.IS_MOBILE and 18 or 22, Settings.IS_MOBILE and 18 or 22)
        typeIcon.Position = UDim2.fromOffset(10, Settings.IS_MOBILE and 11 or 12)
        typeIcon.BackgroundTransparency = 1
        typeIcon.Image = typeIcons[m.moduleType] or typeIcons.module
        typeIcon.ImageColor3 = typeColors[m.moduleType] or Colors.TextMain
        typeIcon.ZIndex = 9004
        typeIcon.ScaleType = Enum.ScaleType.Fit
        local name = Instance.new("TextLabel", btn)
        name.Size = UDim2.new(1, -120, 0, 18)
        name.Position = UDim2.fromOffset(Settings.IS_MOBILE and 34 or 40, Settings.IS_MOBILE and 4 or 5)
        name.BackgroundTransparency = 1
        name.Text = m.name
        name.Font = Enum.Font.FredokaOne
        name.TextSize = Settings.IS_MOBILE and 11 or 13
        name.TextColor3 = Colors.TextMain
        name.TextXAlignment = Enum.TextXAlignment.Left
        name.TextTruncate = Enum.TextTruncate.AtEnd
        name.ZIndex = 9004
        local typeLabel = Instance.new("TextLabel", btn)
        typeLabel.Size = UDim2.new(1, -120, 0, 14)
        typeLabel.Position = UDim2.fromOffset(Settings.IS_MOBILE and 34 or 40, Settings.IS_MOBILE and 22 or 24)
        typeLabel.BackgroundTransparency = 1
        typeLabel.Text = string.upper(m.moduleType:gsub("_", " "))
        typeLabel.Font = Enum.Font.FredokaOne
        typeLabel.TextSize = Settings.IS_MOBILE and 8 or 9
        typeLabel.TextColor3 = Colors.TextSub
        typeLabel.TextXAlignment = Enum.TextXAlignment.Left
        typeLabel.ZIndex = 9004
        local tabBadge = Instance.new("Frame", btn)
        tabBadge.Size = UDim2.fromOffset(Settings.IS_MOBILE and 55 or 65, Settings.IS_MOBILE and 20 or 22)
        tabBadge.Position = UDim2.new(1, Settings.IS_MOBILE and -63 or -73, 0.5, Settings.IS_MOBILE and -10 or -11)
        tabBadge.BackgroundColor3 = typeColors[m.moduleType] or Colors.Interactive
        tabBadge.BackgroundTransparency = 0.5
        tabBadge.ZIndex = 9004
        Instance.new("UICorner", tabBadge).CornerRadius = UDim.new(0, 5)
        local tabText = Instance.new("TextLabel", tabBadge)
        tabText.Size = UDim2.fromScale(1, 1)
        tabText.BackgroundTransparency = 1
        tabText.Text = m.tabName
        tabText.Font = Enum.Font.FredokaOne
        tabText.TextSize = Settings.IS_MOBILE and 8 or 9
        tabText.TextColor3 = Colors.TextMain
        tabText.ZIndex = 9005
        btn.MouseEnter:Connect(function()
            Services.TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.1}):Play()
        end)
        btn.MouseLeave:Connect(function()
            Services.TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.3}):Play()
        end)
        btn.MouseButton1Click:Connect(function()
            LastSearchPosition = UI.SearchModal.Position
            CloseSearch()
            task.wait(0.2)
            if m.moduleType == "dropdown_option" and m.extraData and m.extraData.selectCallback then
                if m.tabName and m.tabName ~= "Unknown" and Data.Tabs[m.tabName] then
                    Core.switchTab(m.tabName)
                end
                task.wait(0.15)
                m.extraData.selectCallback()
                return
            end
            if m.moduleType == "tab" then
                local tabName = m.name:gsub(" Tab", "")
                if Data.Tabs[tabName] then
                    Core.switchTab(tabName)
                end
                return
            end
            if m.tabName and m.tabName ~= "Unknown" and Data.Tabs[m.tabName] then
                Core.switchTab(m.tabName)
            end
            task.wait(0.15)
            if m.highlightTarget and m.highlightTarget.Parent then
                local target = m.highlightTarget
                local originalColor = target.BackgroundColor3
                local originalTransparency = target.BackgroundTransparency
                local scrollFrame = m.page
                if not scrollFrame then
                    local current = target.Parent
                    while current do
                        if current:IsA("ScrollingFrame") then
                            scrollFrame = current
                            break
                        end
                        current = current.Parent
                    end
                end
                if scrollFrame and scrollFrame:IsA("ScrollingFrame") then
                    task.wait(0.1)
                    local targetPos = target.AbsolutePosition.Y - scrollFrame.AbsolutePosition.Y + scrollFrame.CanvasPosition.Y
                    local scrollTo = math.max(0, targetPos - 60)
                    Services.TweenService:Create(scrollFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quint), {
                        CanvasPosition = Vector2.new(0, scrollTo)
                    }):Play()
                end
                task.wait(0.2)
                Services.TweenService:Create(target, TweenInfo.new(0.3, Enum.EasingStyle.Quint), {
                    BackgroundColor3 = Colors.Accent,
                    BackgroundTransparency = 0.1
                }):Play()
                task.wait(0.6)
                Services.TweenService:Create(target, TweenInfo.new(0.4, Enum.EasingStyle.Quint), {
                    BackgroundColor3 = originalColor,
                    BackgroundTransparency = originalTransparency
                }):Play()
            end
        end)
    end
    local height = math.min(#results * (Settings.IS_MOBILE and 44 or 50) + 12, Settings.IS_MOBILE and 200 or 260)
    Services.TweenService:Create(UI.ResultsContainer, TweenInfo.new(0.2, Enum.EasingStyle.Quint), {Size = UDim2.new(1, 0, 0, height)}):Play()
end

UI.SearchClickBtn.MouseButton1Click:Connect(OpenSearch)
UI.CloseSearchBtn.MouseButton1Click:Connect(CloseSearch)
UI.SearchInput:GetPropertyChangedSignal("Text"):Connect(function()
    ShowResults(UI.SearchInput.Text)
end)

UI.SearchButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        Services.TweenService:Create(UI.SearchButton, TweenInfo.new(0.15), {BackgroundTransparency = 0.3}):Play()
    end
end)

UI.SearchButton.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        Services.TweenService:Create(UI.SearchButton, TweenInfo.new(0.15), {BackgroundTransparency = 0.5}):Play()
    end
end)

UI.CloseSearchBtn.MouseEnter:Connect(function()
    Services.TweenService:Create(UI.CloseSearchBtn, TweenInfo.new(0.1), {
        BackgroundColor3 = Colors.InteractiveHover, 
        BackgroundTransparency = 0.2
    }):Play()
end)

UI.CloseSearchBtn.MouseLeave:Connect(function()
    Services.TweenService:Create(UI.CloseSearchBtn, TweenInfo.new(0.1), {
        BackgroundColor3 = Colors.Interactive, 
        BackgroundTransparency = 0.3
    }):Play()
end)

Core._createControlButton = function(x, text, callback)
    local btn = Instance.new("TextButton", UI.Controls)
    btn.Size = UDim2.fromOffset(Settings.IS_MOBILE and 26 or 30, Settings.IS_MOBILE and 26 or 30)
    btn.Position = UDim2.fromOffset(x, 0)
    btn.BackgroundColor3 = Colors.Interactive
    btn.BackgroundTransparency = 0.5
    btn.Text = text
    btn.Font = Enum.Font.FredokaOne
    btn.TextSize = Settings.IS_MOBILE and 14 or 16
    btn.TextColor3 = Colors.TextMain
    btn.AutoButtonColor = false
    btn.ZIndex = 4
    local btnCorner = Instance.new("UICorner", btn)
    btnCorner.CornerRadius = UDim.new(0, 8)
    btn.MouseEnter:Connect(function()
        Services.TweenService:Create(btn, TweenInfo.new(0.15), {
            BackgroundTransparency = 0.2, 
            BackgroundColor3 = Colors.InteractiveHover
        }):Play()
    end)
    btn.MouseLeave:Connect(function()
        Services.TweenService:Create(btn, TweenInfo.new(0.15), {
            BackgroundTransparency = 0.5, 
            BackgroundColor3 = Colors.Interactive
        }):Play()
    end)
    btn.MouseButton1Click:Connect(callback)
    return btn
end

Core._createTab = function(name, index)
    local b = Instance.new("Frame", UI.Sidebar)
    b.Name = name
    b.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 32 or 38)
    b.LayoutOrder = index
    b.BackgroundColor3 = Colors.Card
    b.BackgroundTransparency = 0.3
    b.BorderSizePixel = 0
    b.ZIndex = 5
    local TabCorner = Instance.new("UICorner", b)
    TabCorner.CornerRadius = UDim.new(0, 10)
    local stroke = Instance.new("UIStroke", b)
    stroke.Name = "TabStroke"
    stroke.Color = Colors.Border
    stroke.Transparency = 0.7
    stroke.Thickness = 1
    local t = Instance.new("TextLabel", b)
    t.Name = "TabText"
    t.Size = UDim2.fromScale(1, 1)
    t.BackgroundTransparency = 1
    t.Text = name
    t.Font = Enum.Font.FredokaOne
    t.TextSize = Settings.IS_MOBILE and 11 or 13
    t.TextColor3 = Color3.new(1, 1, 1)
    t.ZIndex = 6
    local p = Instance.new("ScrollingFrame", UI.Content)
    p.Name = name .. "Page"
    p.Size = UDim2.fromScale(1, 1)
    p.Position = UDim2.fromScale(0, 0)
    p.BackgroundTransparency = 1
    p.Visible = false
    p.BorderSizePixel = 0
    p.CanvasSize = UDim2.new(0, 0, 0, 0)
    p.AutomaticCanvasSize = Enum.AutomaticSize.Y
    p.ScrollingDirection = Enum.ScrollingDirection.Y
    p.ElasticBehavior = Enum.ElasticBehavior.Always
    p.ZIndex = 5
    Core.makeScrollBarVisible(p)
    local layout = Instance.new("UIListLayout", p)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, Settings.IS_MOBILE and 6 or 8)
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    local padding = Instance.new("UIPadding", p)
    padding.PaddingTop = UDim.new(0, Settings.IS_MOBILE and 8 or 10)
    padding.PaddingBottom = UDim.new(0, Settings.IS_MOBILE and 8 or 10)
    padding.PaddingLeft = UDim.new(0, Settings.IS_MOBILE and 8 or 10)
    padding.PaddingRight = UDim.new(0, Settings.IS_MOBILE and 8 or 10)
    local tabButton = Instance.new("TextButton", b)
    tabButton.Size = UDim2.fromScale(1, 1)
    tabButton.BackgroundTransparency = 1
    tabButton.Text = ""
    tabButton.ZIndex = 10
    local function UpdateTabAppearance(active)
        if active then
            Services.TweenService:Create(b, TweenInfo.new(0.25), {
                BackgroundColor3 = Colors.Interactive,
                BackgroundTransparency = 0.3
            }):Play()
            Services.TweenService:Create(stroke, TweenInfo.new(0.25), {
                Color = Colors.Accent,
                Transparency = 0.4
            }):Play()
        else
            Services.TweenService:Create(b, TweenInfo.new(0.25), {
                BackgroundColor3 = Colors.Card,
                BackgroundTransparency = 0.3
            }):Play()
            Services.TweenService:Create(stroke, TweenInfo.new(0.25), {
                Color = Colors.Border,
                Transparency = 0.7
            }):Play()
            Services.TweenService:Create(t, TweenInfo.new(0.25), {
                TextColor3 = Color3.new(1, 1, 1)
            }):Play()
        end
    end
    tabButton.MouseButton1Click:Connect(function()
        Core.switchTab(name)
    end)
    tabButton.MouseEnter:Connect(function()
        if Data.ActiveTab ~= name then
            Services.TweenService:Create(b, TweenInfo.new(0.15), {BackgroundTransparency = 0.15}):Play()
        end
    end)
    tabButton.MouseLeave:Connect(function()
        if Data.ActiveTab ~= name then
            Services.TweenService:Create(b, TweenInfo.new(0.15), {BackgroundTransparency = 0.3}):Play()
        end
    end)
    Data.Tabs[name] = b
    Data.Pages[name] = p
    if Data.ActiveTab == nil then
        Data.ActiveTab = name
        UpdateTabAppearance(true)
        p.Visible = true
    else
        UpdateTabAppearance(false)
    end
    Core.registerModule(name .. " Tab", b, p, name, "tab")
    return p
end

Core._section = function(parent, text, layoutOrder)
    local container = Instance.new("Frame", parent)
    container.Name = "SectionContainer"
    container.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 26 or 30)
    container.BackgroundColor3 = Colors.Card
    container.BackgroundTransparency = 0.4
    container.BorderSizePixel = 0
    container.LayoutOrder = layoutOrder or 0
    container.ClipsDescendants = true
    container.AutomaticSize = Enum.AutomaticSize.Y
    local containerCorner = Instance.new("UICorner", container)
    containerCorner.CornerRadius = UDim.new(0, 12)
    local containerStroke = Instance.new("UIStroke", container)
    containerStroke.Color = Colors.Border
    containerStroke.Transparency = 0.7
    containerStroke.Thickness = 1
    local titleLabel = Instance.new("TextLabel", container)
    titleLabel.Size = UDim2.new(1, -20, 0, Settings.IS_MOBILE and 26 or 30)
    titleLabel.Position = UDim2.fromOffset(14, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = text
    titleLabel.Font = Enum.Font.FredokaOne
    titleLabel.TextSize = Settings.IS_MOBILE and 11 or 13
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    local contentFrame = Instance.new("Frame", container)
    contentFrame.Name = "SectionContent"
    contentFrame.Size = UDim2.new(1, -16, 0, 0)
    contentFrame.Position = UDim2.fromOffset(8, Settings.IS_MOBILE and 30 or 34)
    contentFrame.BackgroundTransparency = 1
    contentFrame.AutomaticSize = Enum.AutomaticSize.Y
    local contentLayout = Instance.new("UIListLayout", contentFrame)
    contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    contentLayout.Padding = UDim.new(0, Settings.IS_MOBILE and 4 or 6)
    local contentPadding = Instance.new("UIPadding", contentFrame)
    contentPadding.PaddingBottom = UDim.new(0, 8)
    local tabName = "Unknown"
    for name, page in pairs(Data.Pages) do
        if parent == page or parent:IsDescendantOf(page) then
            tabName = name
            break
        end
    end
    Core.registerModule(text, container, parent, tabName, "section")
    return contentFrame, container
end

Core._moduleCard = function(parent, layoutOrder)
    local c = Instance.new("Frame", parent)
    c.Name = "ModuleCard"
    c.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 38 or 44)
    c.BackgroundColor3 = Colors.Card
    c.BackgroundTransparency = 0.3
    c.BorderSizePixel = 0
    c.LayoutOrder = layoutOrder or 0
    local CardCorner = Instance.new("UICorner", c)
    CardCorner.CornerRadius = UDim.new(0, 10)
    local s = Instance.new("UIStroke", c)
    s.Color = Colors.Border
    s.Transparency = 0.75
    s.Thickness = 1
    return c
end

Core._toggle = function(parent, text, layoutOrder, default, cb)
    local state = default
    local card = Core.moduleCard(parent, layoutOrder)
    local lbl = Instance.new("TextLabel", card)
    lbl.Size = UDim2.new(1, -80, 1, 0)
    lbl.Position = UDim2.fromOffset(14, 0)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.Font = Enum.Font.FredokaOne
    lbl.TextSize = Settings.IS_MOBILE and 11 or 13
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.TextColor3 = Colors.TextMain
    local bg = Instance.new("Frame", card)
    bg.Name = "ToggleBg"
    bg.Size = UDim2.fromOffset(Settings.IS_MOBILE and 36 or 42, Settings.IS_MOBILE and 18 or 22)
    bg.Position = UDim2.new(1, Settings.IS_MOBILE and -46 or -54, 0.5, Settings.IS_MOBILE and -9 or -11)
    bg.BackgroundColor3 = state and Colors.ToggleOn or Colors.ToggleOff
    local BgCorner = Instance.new("UICorner", bg)
    BgCorner.CornerRadius = UDim.new(1, 0)
    local knob = Instance.new("Frame", bg)
    knob.Name = "ToggleKnob"
    knob.Size = UDim2.fromOffset(Settings.IS_MOBILE and 12 or 16, Settings.IS_MOBILE and 12 or 16)
    knob.Position = state and UDim2.fromOffset(Settings.IS_MOBILE and 21 or 23, 3) or UDim2.fromOffset(3, 3)
    knob.BackgroundColor3 = Color3.new(1, 1, 1)
    local KnobCorner = Instance.new("UICorner", knob)
    KnobCorner.CornerRadius = UDim.new(1, 0)
    local toggleBtn = Instance.new("TextButton", card)
    toggleBtn.Size = UDim2.fromScale(1, 1)
    toggleBtn.BackgroundTransparency = 1
    toggleBtn.Text = ""
    toggleBtn.ZIndex = 10
    table.insert(Data.AllToggles, {bg = bg, knob = knob, getState = function() return state end})
    toggleBtn.MouseButton1Click:Connect(function()
        state = not state
        Services.TweenService:Create(bg, TweenInfo.new(0.25, Enum.EasingStyle.Quint), {BackgroundColor3 = state and Colors.ToggleOn or Colors.ToggleOff}):Play()
        Services.TweenService:Create(knob, TweenInfo.new(0.25, Enum.EasingStyle.Quint), {Position = state and UDim2.fromOffset(Settings.IS_MOBILE and 21 or 23, 3) or UDim2.fromOffset(3, 3)}):Play()
        if cb then cb(state) end
    end)
    local tabName = "Unknown"
    for name, page in pairs(Data.Pages) do
        if parent == page or parent:IsDescendantOf(page) then
            tabName = name
            break
        end
    end
    Core.registerModule(text, card, parent, tabName, "toggle")
    return card, function() return state end, function(newState)
        state = newState
        bg.BackgroundColor3 = state and Colors.ToggleOn or Colors.ToggleOff
        knob.Position = state and UDim2.fromOffset(Settings.IS_MOBILE and 21 or 23, 3) or UDim2.fromOffset(3, 3)
    end
end

Core._slider = function(parent, text, layoutOrder, min, max, default, cb)
    local value = default
    local card = Core.moduleCard(parent, layoutOrder)
    card.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 48 or 56)
    local lbl = Instance.new("TextLabel", card)
    lbl.Size = UDim2.new(1, -70, 0, 20)
    lbl.Position = UDim2.fromOffset(14, Settings.IS_MOBILE and 4 or 6)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.Font = Enum.Font.FredokaOne
    lbl.TextSize = Settings.IS_MOBILE and 11 or 13
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.TextColor3 = Colors.TextMain
    local valueLabel = Instance.new("TextLabel", card)
    valueLabel.Size = UDim2.fromOffset(50, 20)
    valueLabel.Position = UDim2.new(1, -58, 0, Settings.IS_MOBILE and 4 or 6)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(value)
    valueLabel.Font = Enum.Font.FredokaOne
    valueLabel.TextSize = Settings.IS_MOBILE and 11 or 13
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.TextColor3 = Color3.new(1, 1, 1)
    local track = Instance.new("Frame", card)
    track.Name = "SliderTrack"
    track.Size = UDim2.new(1, -28, 0, 6)
    track.Position = UDim2.fromOffset(14, Settings.IS_MOBILE and 30 or 36)
    track.BackgroundColor3 = Colors.ToggleOff
    local TrackCorner = Instance.new("UICorner", track)
    TrackCorner.CornerRadius = UDim.new(1, 0)
    local fill = Instance.new("Frame", track)
    fill.Name = "SliderFill"
    fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
    fill.BackgroundColor3 = Colors.ToggleOn
    fill.BorderSizePixel = 0
    local FillCorner = Instance.new("UICorner", fill)
    FillCorner.CornerRadius = UDim.new(1, 0)
    local thumb = Instance.new("Frame", track)
    thumb.Name = "SliderThumb"
    thumb.Size = UDim2.fromOffset(16, 16)
    thumb.AnchorPoint = Vector2.new(0.5, 0.5)
    thumb.Position = UDim2.new((value - min) / (max - min), 0, 0.5, 0)
    thumb.BackgroundColor3 = Color3.new(1, 1, 1)
    thumb.BorderSizePixel = 0
    thumb.ZIndex = 2
    local ThumbCorner = Instance.new("UICorner", thumb)
    ThumbCorner.CornerRadius = UDim.new(1, 0)
    table.insert(Data.AllSliders, {track = track, fill = fill, valueLabel = valueLabel, thumb = thumb})
    local dragging = false
    local function updateSlider(inputPos)
        local trackAbsPos = track.AbsolutePosition
        local trackAbsSize = track.AbsoluteSize
        local relative = math.clamp((inputPos.X - trackAbsPos.X) / trackAbsSize.X, 0, 1)
        value = math.floor(min + relative * (max - min))
        fill.Size = UDim2.new(relative, 0, 1, 0)
        thumb.Position = UDim2.new(relative, 0, 0.5, 0)
        valueLabel.Text = tostring(value)
        if cb then cb(value) end
    end
    local sliderBtn = Instance.new("TextButton", track)
    sliderBtn.Size = UDim2.new(1, 0, 1, 20)
    sliderBtn.Position = UDim2.fromOffset(0, -10)
    sliderBtn.BackgroundTransparency = 1
    sliderBtn.Text = ""
    sliderBtn.ZIndex = 5
    sliderBtn.MouseButton1Down:Connect(function() dragging = true end)
    Services.UIS.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            updateSlider(input.Position)
        end
    end)
    Services.UIS.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    sliderBtn.MouseButton1Click:Connect(function()
        local mouse = Player:GetMouse()
        updateSlider(Vector3.new(mouse.X, mouse.Y, 0))
    end)
    local tabName = "Unknown"
    for name, page in pairs(Data.Pages) do
        if parent == page or parent:IsDescendantOf(page) then
            tabName = name
            break
        end
    end
    Core.registerModule(text, card, parent, tabName, "slider")
    return card, valueLabel, fill, thumb
end

Core._dropdown = function(parent, text, options, layoutOrder, cb)
    local isOpen = false
    local selectedOption = options[1] and options[1].name or "Select..."
    local OPTION_H = Settings.IS_MOBILE and 26 or 30
    local GAP = 2
    local PAD_Y = 4
    local MAX_VISIBLE = Settings.IS_MOBILE and 4 or 5
    local function calcOpenHeight(count)
        local visible = math.min(count, MAX_VISIBLE)
        if visible <= 0 then return PAD_Y * 2 end
        return PAD_Y * 2 + visible * OPTION_H + (visible - 1) * GAP
    end
    local container = Instance.new("Frame", parent)
    container.Name = "DropdownContainer"
    container.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 38 or 44)
    container.BackgroundTransparency = 1
    container.LayoutOrder = layoutOrder or 0
    container.ClipsDescendants = false
    local card = Instance.new("Frame", container)
    card.Name = "ModuleCard"
    card.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 38 or 44)
    card.BackgroundColor3 = Colors.Card
    card.BackgroundTransparency = 0.3
    card.BorderSizePixel = 0
    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 10)
    local s = Instance.new("UIStroke", card)
    s.Color = Colors.Border
    s.Transparency = 0.75
    s.Thickness = 1
    local lbl = Instance.new("TextLabel", card)
    lbl.Size = UDim2.new(0, Settings.IS_MOBILE and 50 or 80, 1, 0)
    lbl.Position = UDim2.fromOffset(14, 0)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.Font = Enum.Font.FredokaOne
    lbl.TextSize = Settings.IS_MOBILE and 11 or 13
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.TextColor3 = Colors.TextMain
    local selectedLabel = Instance.new("TextLabel", card)
    selectedLabel.Name = "SelectedOptionLabel"
    selectedLabel.Size = UDim2.new(1, Settings.IS_MOBILE and -90 or -120, 1, 0)
    selectedLabel.Position = UDim2.fromOffset(Settings.IS_MOBILE and 60 or 90, 0)
    selectedLabel.BackgroundTransparency = 1
    selectedLabel.Text = selectedOption
    selectedLabel.Font = Enum.Font.FredokaOne
    selectedLabel.TextSize = Settings.IS_MOBILE and 10 or 12
    selectedLabel.TextXAlignment = Enum.TextXAlignment.Right
    selectedLabel.TextColor3 = Color3.new(1, 1, 1)
    selectedLabel.TextTruncate = Enum.TextTruncate.AtEnd
    local arrow = Instance.new("TextLabel", card)
    arrow.Name = "DropdownArrow"
    arrow.Size = UDim2.fromOffset(20, Settings.IS_MOBILE and 38 or 44)
    arrow.Position = UDim2.new(1, -24, 0, 0)
    arrow.BackgroundTransparency = 1
    arrow.Text = "â–¼"
    arrow.Font = Enum.Font.FredokaOne
    arrow.TextSize = Settings.IS_MOBILE and 10 or 12
    arrow.TextColor3 = Colors.TextSub
    local optionsFrame = Instance.new("ScrollingFrame", container)
    optionsFrame.Name = "OptionsFrame"
    optionsFrame.Position = UDim2.fromOffset(0, Settings.IS_MOBILE and 40 or 46)
    optionsFrame.Size = UDim2.new(1, 0, 0, 0)
    optionsFrame.BackgroundColor3 = Colors.Base
    optionsFrame.BackgroundTransparency = 0.1
    optionsFrame.BorderSizePixel = 0
    optionsFrame.ClipsDescendants = true
    optionsFrame.ZIndex = 200
    optionsFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    optionsFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    optionsFrame.ScrollingDirection = Enum.ScrollingDirection.Y
    optionsFrame.ElasticBehavior = Enum.ElasticBehavior.Always
    Core.makeScrollBarInvisible(optionsFrame)
    Instance.new("UICorner", optionsFrame).CornerRadius = UDim.new(0, 10)
    local OptionsStroke = Instance.new("UIStroke", optionsFrame)
    OptionsStroke.Color = Colors.Border
    OptionsStroke.Transparency = 0.5
    OptionsStroke.Thickness = 1
    local optionsLayout = Instance.new("UIListLayout", optionsFrame)
    optionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    optionsLayout.Padding = UDim.new(0, GAP)
    local optionsPadding = Instance.new("UIPadding", optionsFrame)
    optionsPadding.PaddingTop = UDim.new(0, PAD_Y)
    optionsPadding.PaddingBottom = UDim.new(0, PAD_Y)
    optionsPadding.PaddingLeft = UDim.new(0, 4)
    optionsPadding.PaddingRight = UDim.new(0, 4)
    local tabName = "Unknown"
    for name, page in pairs(Data.Pages) do
        if parent == page or parent:IsDescendantOf(page) then
            tabName = name
            break
        end
    end
    for i, opt in ipairs(options) do
        local optBtn = Instance.new("TextButton", optionsFrame)
        optBtn.Size = UDim2.new(1, 0, 0, OPTION_H)
        optBtn.BackgroundColor3 = Colors.Card
        optBtn.BackgroundTransparency = 0.3
        optBtn.BorderSizePixel = 0
        optBtn.AutoButtonColor = false
        optBtn.Text = opt.name
        optBtn.Font = Enum.Font.FredokaOne
        optBtn.TextSize = Settings.IS_MOBILE and 10 or 12
        optBtn.TextColor3 = Colors.TextMain
        optBtn.LayoutOrder = i
        optBtn.ZIndex = 201
        Instance.new("UICorner", optBtn).CornerRadius = UDim.new(0, 8)
        optBtn.MouseEnter:Connect(function()
            Services.TweenService:Create(optBtn, TweenInfo.new(0.12), {
                BackgroundTransparency = 0.1,
                BackgroundColor3 = Colors.InteractiveHover
            }):Play()
        end)
        optBtn.MouseLeave:Connect(function()
            Services.TweenService:Create(optBtn, TweenInfo.new(0.12), {
                BackgroundTransparency = 0.3,
                BackgroundColor3 = Colors.Card
            }):Play()
        end)
        optBtn.MouseButton1Click:Connect(function()
            selectedOption = opt.name
            selectedLabel.Text = opt.name
            isOpen = false
            Services.TweenService:Create(arrow, TweenInfo.new(0.18, Enum.EasingStyle.Back), {Rotation = 0}):Play()
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.18), {Size = UDim2.new(1, 0, 0, 0)}):Play()
            Services.TweenService:Create(container, TweenInfo.new(0.18), {Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 38 or 44)}):Play()
            if cb then cb(opt) end
        end)
        Core.registerModule(opt.name .. " (" .. text .. ")", card, parent, tabName, "dropdown_option", {
            selectCallback = function()
                selectedOption = opt.name
                selectedLabel.Text = opt.name
                if cb then cb(opt) end
            end
        })
    end
    local openHeight = calcOpenHeight(#options)
    local mainBtn = Instance.new("TextButton", card)
    mainBtn.Size = UDim2.fromScale(1, 1)
    mainBtn.BackgroundTransparency = 1
    mainBtn.Text = ""
    mainBtn.ZIndex = 10
    mainBtn.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        if isOpen then
            Services.TweenService:Create(arrow, TweenInfo.new(0.18, Enum.EasingStyle.Back), {Rotation = 180}):Play()
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.18), {Size = UDim2.new(1, 0, 0, openHeight)}):Play()
            Services.TweenService:Create(container, TweenInfo.new(0.18), {
                Size = UDim2.new(1, 0, 0, (Settings.IS_MOBILE and 38 or 44) + openHeight + 2)
            }):Play()
        else
            Services.TweenService:Create(arrow, TweenInfo.new(0.18, Enum.EasingStyle.Back), {Rotation = 0}):Play()
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.18), {Size = UDim2.new(1, 0, 0, 0)}):Play()
            Services.TweenService:Create(container, TweenInfo.new(0.18), {Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 38 or 44)}):Play()
        end
    end)
    Core.registerModule(text, card, parent, tabName, "dropdown")
    return container, function(newName)
        selectedOption = newName
        selectedLabel.Text = newName
    end
end

Core._keybindButton = function(parent, text, layoutOrder, defaultBind, cb)
    local currentBind = defaultBind or Enum.KeyCode.E
    local isListening = false
    local card = Core.moduleCard(parent, layoutOrder)
    local connection = nil
    local lbl = Instance.new("TextLabel", card)
    lbl.Size = UDim2.new(1, -100, 1, 0)
    lbl.Position = UDim2.fromOffset(14, 0)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.Font = Enum.Font.FredokaOne
    lbl.TextSize = Settings.IS_MOBILE and 11 or 13
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.TextColor3 = Colors.TextMain
    local keyBtn = Instance.new("TextButton", card)
    keyBtn.Name = "KeybindText"
    keyBtn.Size = UDim2.fromOffset(Settings.IS_MOBILE and 60 or 80, Settings.IS_MOBILE and 24 or 28)
    keyBtn.Position = UDim2.new(1, Settings.IS_MOBILE and -70 or -90, 0.5, Settings.IS_MOBILE and -12 or -14)
    keyBtn.BackgroundColor3 = Colors.Interactive
    keyBtn.AutoButtonColor = false
    keyBtn.Font = Enum.Font.FredokaOne
    keyBtn.TextSize = Settings.IS_MOBILE and 9 or 11
    keyBtn.TextColor3 = Color3.new(1, 1, 1)
    table.insert(Data.AllKeybinds, {btn = keyBtn})
    local function UpdateBindText(bind)
        if bind.EnumType == Enum.KeyCode then
            keyBtn.Text = bind.Name
        elseif bind.EnumType == Enum.UserInputType then
            if bind == Enum.UserInputType.MouseButton1 then
                keyBtn.Text = "LMB"
            elseif bind == Enum.UserInputType.MouseButton2 then
                keyBtn.Text = "RMB"
            elseif bind == Enum.UserInputType.MouseButton3 then
                keyBtn.Text = "MMB"
            else
                keyBtn.Text = bind.Name
            end
        else
            keyBtn.Text = bind.Name or "None"
        end
    end
    UpdateBindText(currentBind)
    local keyBtnCorner = Instance.new("UICorner", keyBtn)
    keyBtnCorner.CornerRadius = UDim.new(0, 8)
    local keyBtnStroke = Instance.new("UIStroke", keyBtn)
    keyBtnStroke.Color = Colors.Border
    keyBtnStroke.Transparency = 0.5
    keyBtnStroke.Thickness = 1
    keyBtn.MouseEnter:Connect(function()
        if not isListening then 
            Services.TweenService:Create(keyBtn, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover}):Play() 
        end
    end)
    keyBtn.MouseLeave:Connect(function()
        if not isListening then 
            Services.TweenService:Create(keyBtn, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Interactive}):Play() 
        end
    end)
    keyBtn.MouseButton1Click:Connect(function()
        if isListening then return end
        if Settings.IS_MOBILE then return end
        isListening = true
        Settings.IS_BINDING = true
        keyBtn.Text = "..."
        Services.TweenService:Create(keyBtn, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveActive}):Play()
        connection = Services.UIS.InputBegan:Connect(function(input)
            if not isListening then return end
            local validInput = false
            if input.UserInputType == Enum.UserInputType.Keyboard then
                if input.KeyCode ~= Enum.KeyCode.Unknown then
                    currentBind = input.KeyCode
                    validInput = true
                end
            elseif input.UserInputType.Name:match("MouseButton") then
                currentBind = input.UserInputType
                validInput = true
            end
            if not validInput then return end
            isListening = false
            Settings.IS_BINDING = false
            if connection then
                connection:Disconnect()
                connection = nil
            end
            UpdateBindText(currentBind)
            Services.TweenService:Create(keyBtn, TweenInfo.new(0.2), {BackgroundColor3 = Colors.Interactive}):Play()
            if cb then cb(currentBind) end
            pcall(function()
                if writefile then
                    writefile("AimbotBind.txt", tostring(currentBind.EnumType) .. "," .. currentBind.Name)
                end
            end)
        end)
        task.delay(10, function()
            if isListening then
                isListening = false
                Settings.IS_BINDING = false
                if connection then
                    connection:Disconnect()
                    connection = nil
                end
                UpdateBindText(currentBind)
                Services.TweenService:Create(keyBtn, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Interactive}):Play()
            end
        end)
    end)
    local tabName = "Unknown"
    for name, page in pairs(Data.Pages) do
        if parent == page or parent:IsDescendantOf(page) then
            tabName = name
            break
        end
    end
    Core.registerModule(text, card, parent, tabName, "keybind")
    return card, function() return currentBind end, function(newBind)
        currentBind = newBind
        UpdateBindText(currentBind)
    end
end

local ThemeCategories = {
    Messengers = {
        {name = "Discord", colors = {Base = Color3.fromRGB(32,34,37), Header = Color3.fromRGB(47,49,54), Sidebar = Color3.fromRGB(32,34,37), Content = Color3.fromRGB(54,57,63), Card = Color3.fromRGB(64,68,75), Interactive = Color3.fromRGB(88,101,242), InteractiveHover = Color3.fromRGB(100,115,255), InteractiveActive = Color3.fromRGB(75,90,220), ToggleOn = Color3.fromRGB(100,115,255), ToggleOff = Color3.fromRGB(50,55,65), Border = Color3.fromRGB(88,101,242), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(185,187,190), Accent = Color3.fromRGB(88,101,242), Section = Color3.fromRGB(47,49,54), Success = Color3.fromRGB(87,242,135), Error = Color3.fromRGB(237,66,69), Warning = Color3.fromRGB(254,231,92)}},
        {name = "YouTube", colors = {Base = Color3.fromRGB(15,15,15), Header = Color3.fromRGB(33,33,33), Sidebar = Color3.fromRGB(20,20,20), Content = Color3.fromRGB(25,25,25), Card = Color3.fromRGB(40,40,40), Interactive = Color3.fromRGB(255,0,0), InteractiveHover = Color3.fromRGB(255,50,50), InteractiveActive = Color3.fromRGB(200,0,0), ToggleOn = Color3.fromRGB(255,50,50), ToggleOff = Color3.fromRGB(60,60,60), Border = Color3.fromRGB(255,0,0), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(170,170,170), Accent = Color3.fromRGB(255,0,0), Section = Color3.fromRGB(33,33,33), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(255,50,50), Warning = Color3.fromRGB(255,200,0)}},
        {name = "Telegram", colors = {Base = Color3.fromRGB(23,33,43), Header = Color3.fromRGB(36,47,61), Sidebar = Color3.fromRGB(23,33,43), Content = Color3.fromRGB(30,40,52), Card = Color3.fromRGB(43,56,72), Interactive = Color3.fromRGB(58,175,223), InteractiveHover = Color3.fromRGB(80,190,235), InteractiveActive = Color3.fromRGB(45,155,200), ToggleOn = Color3.fromRGB(80,190,235), ToggleOff = Color3.fromRGB(50,65,80), Border = Color3.fromRGB(58,175,223), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(150,170,190), Accent = Color3.fromRGB(58,175,223), Section = Color3.fromRGB(36,47,61), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "WhatsApp", colors = {Base = Color3.fromRGB(17,27,33), Header = Color3.fromRGB(31,44,52), Sidebar = Color3.fromRGB(17,27,33), Content = Color3.fromRGB(25,35,42), Card = Color3.fromRGB(38,52,62), Interactive = Color3.fromRGB(37,211,102), InteractiveHover = Color3.fromRGB(60,220,120), InteractiveActive = Color3.fromRGB(30,180,85), ToggleOn = Color3.fromRGB(60,220,120), ToggleOff = Color3.fromRGB(45,60,70), Border = Color3.fromRGB(37,211,102), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(140,160,175), Accent = Color3.fromRGB(37,211,102), Section = Color3.fromRGB(31,44,52), Success = Color3.fromRGB(37,211,102), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Spotify", colors = {Base = Color3.fromRGB(18,18,18), Header = Color3.fromRGB(24,24,24), Sidebar = Color3.fromRGB(0,0,0), Content = Color3.fromRGB(18,18,18), Card = Color3.fromRGB(40,40,40), Interactive = Color3.fromRGB(30,215,96), InteractiveHover = Color3.fromRGB(50,230,110), InteractiveActive = Color3.fromRGB(25,185,80), ToggleOn = Color3.fromRGB(50,230,110), ToggleOff = Color3.fromRGB(60,60,60), Border = Color3.fromRGB(30,215,96), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(179,179,179), Accent = Color3.fromRGB(30,215,96), Section = Color3.fromRGB(24,24,24), Success = Color3.fromRGB(30,215,96), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Twitter/X", colors = {Base = Color3.fromRGB(0,0,0), Header = Color3.fromRGB(22,24,28), Sidebar = Color3.fromRGB(0,0,0), Content = Color3.fromRGB(15,15,15), Card = Color3.fromRGB(32,35,39), Interactive = Color3.fromRGB(29,161,242), InteractiveHover = Color3.fromRGB(50,180,255), InteractiveActive = Color3.fromRGB(25,140,210), ToggleOn = Color3.fromRGB(50,180,255), ToggleOff = Color3.fromRGB(50,55,60), Border = Color3.fromRGB(29,161,242), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(139,152,165), Accent = Color3.fromRGB(29,161,242), Section = Color3.fromRGB(22,24,28), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "TikTok", colors = {Base = Color3.fromRGB(0,0,0), Header = Color3.fromRGB(18,18,18), Sidebar = Color3.fromRGB(0,0,0), Content = Color3.fromRGB(12,12,12), Card = Color3.fromRGB(30,30,30), Interactive = Color3.fromRGB(254,44,85), InteractiveHover = Color3.fromRGB(255,80,110), InteractiveActive = Color3.fromRGB(220,35,70), ToggleOn = Color3.fromRGB(0,242,234), ToggleOff = Color3.fromRGB(50,50,50), Border = Color3.fromRGB(254,44,85), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(160,160,160), Accent = Color3.fromRGB(0,242,234), Section = Color3.fromRGB(18,18,18), Success = Color3.fromRGB(0,242,234), Error = Color3.fromRGB(254,44,85), Warning = Color3.fromRGB(255,200,0)}},
        {name = "Twitch", colors = {Base = Color3.fromRGB(14,14,16), Header = Color3.fromRGB(24,24,27), Sidebar = Color3.fromRGB(14,14,16), Content = Color3.fromRGB(18,18,20), Card = Color3.fromRGB(38,38,44), Interactive = Color3.fromRGB(145,70,255), InteractiveHover = Color3.fromRGB(170,100,255), InteractiveActive = Color3.fromRGB(120,55,220), ToggleOn = Color3.fromRGB(170,100,255), ToggleOff = Color3.fromRGB(50,50,60), Border = Color3.fromRGB(145,70,255), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(173,173,184), Accent = Color3.fromRGB(145,70,255), Section = Color3.fromRGB(24,24,27), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Instagram", colors = {Base = Color3.fromRGB(0,0,0), Header = Color3.fromRGB(18,18,18), Sidebar = Color3.fromRGB(0,0,0), Content = Color3.fromRGB(12,12,12), Card = Color3.fromRGB(38,38,38), Interactive = Color3.fromRGB(225,48,108), InteractiveHover = Color3.fromRGB(245,80,130), InteractiveActive = Color3.fromRGB(193,53,132), ToggleOn = Color3.fromRGB(245,80,130), ToggleOff = Color3.fromRGB(60,60,60), Border = Color3.fromRGB(225,48,108), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(168,168,168), Accent = Color3.fromRGB(131,58,180), Section = Color3.fromRGB(18,18,18), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Facebook", colors = {Base = Color3.fromRGB(24,26,27), Header = Color3.fromRGB(36,37,38), Sidebar = Color3.fromRGB(24,26,27), Content = Color3.fromRGB(30,31,32), Card = Color3.fromRGB(58,59,60), Interactive = Color3.fromRGB(66,103,178), InteractiveHover = Color3.fromRGB(90,125,200), InteractiveActive = Color3.fromRGB(55,85,150), ToggleOn = Color3.fromRGB(90,125,200), ToggleOff = Color3.fromRGB(60,60,65), Border = Color3.fromRGB(66,103,178), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(176,179,184), Accent = Color3.fromRGB(66,103,178), Section = Color3.fromRGB(36,37,38), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Reddit", colors = {Base = Color3.fromRGB(26,26,27), Header = Color3.fromRGB(39,39,41), Sidebar = Color3.fromRGB(26,26,27), Content = Color3.fromRGB(30,30,31), Card = Color3.fromRGB(50,50,52), Interactive = Color3.fromRGB(255,69,0), InteractiveHover = Color3.fromRGB(255,100,50), InteractiveActive = Color3.fromRGB(220,55,0), ToggleOn = Color3.fromRGB(255,100,50), ToggleOff = Color3.fromRGB(60,60,65), Border = Color3.fromRGB(255,69,0), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(180,180,180), Accent = Color3.fromRGB(255,69,0), Section = Color3.fromRGB(39,39,41), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(255,69,0), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Snapchat", colors = {Base = Color3.fromRGB(20,20,20), Header = Color3.fromRGB(30,30,30), Sidebar = Color3.fromRGB(18,18,18), Content = Color3.fromRGB(25,25,25), Card = Color3.fromRGB(45,45,45), Interactive = Color3.fromRGB(255,252,0), InteractiveHover = Color3.fromRGB(255,255,80), InteractiveActive = Color3.fromRGB(220,218,0), ToggleOn = Color3.fromRGB(255,255,80), ToggleOff = Color3.fromRGB(60,60,60), Border = Color3.fromRGB(255,252,0), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(180,180,180), Accent = Color3.fromRGB(255,252,0), Section = Color3.fromRGB(30,30,30), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(255,252,0)}},
        {name = "LinkedIn", colors = {Base = Color3.fromRGB(25,30,35), Header = Color3.fromRGB(35,42,50), Sidebar = Color3.fromRGB(25,30,35), Content = Color3.fromRGB(30,35,42), Card = Color3.fromRGB(50,58,68), Interactive = Color3.fromRGB(0,119,181), InteractiveHover = Color3.fromRGB(30,145,205), InteractiveActive = Color3.fromRGB(0,100,155), ToggleOn = Color3.fromRGB(30,145,205), ToggleOff = Color3.fromRGB(60,65,70), Border = Color3.fromRGB(0,119,181), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(170,180,190), Accent = Color3.fromRGB(0,119,181), Section = Color3.fromRGB(35,42,50), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Pinterest", colors = {Base = Color3.fromRGB(15,15,15), Header = Color3.fromRGB(25,25,25), Sidebar = Color3.fromRGB(15,15,15), Content = Color3.fromRGB(20,20,20), Card = Color3.fromRGB(40,40,40), Interactive = Color3.fromRGB(230,0,35), InteractiveHover = Color3.fromRGB(255,50,70), InteractiveActive = Color3.fromRGB(200,0,30), ToggleOn = Color3.fromRGB(255,50,70), ToggleOff = Color3.fromRGB(60,60,60), Border = Color3.fromRGB(230,0,35), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(175,175,175), Accent = Color3.fromRGB(230,0,35), Section = Color3.fromRGB(25,25,25), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(230,0,35), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Slack", colors = {Base = Color3.fromRGB(26,29,33), Header = Color3.fromRGB(52,56,64), Sidebar = Color3.fromRGB(26,29,33), Content = Color3.fromRGB(34,37,42), Card = Color3.fromRGB(60,65,75), Interactive = Color3.fromRGB(74,21,75), InteractiveHover = Color3.fromRGB(100,45,100), InteractiveActive = Color3.fromRGB(60,18,60), ToggleOn = Color3.fromRGB(100,45,100), ToggleOff = Color3.fromRGB(60,62,68), Border = Color3.fromRGB(74,21,75), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(180,182,188), Accent = Color3.fromRGB(74,21,75), Section = Color3.fromRGB(52,56,64), Success = Color3.fromRGB(46,182,125), Error = Color3.fromRGB(224,30,90), Warning = Color3.fromRGB(236,178,46)}},
    },
    Colors = {
        {name = "Ocean Blue", colors = {Base = Color3.fromRGB(18,28,48), Header = Color3.fromRGB(22,34,58), Sidebar = Color3.fromRGB(16,24,44), Content = Color3.fromRGB(20,30,52), Card = Color3.fromRGB(26,38,64), Interactive = Color3.fromRGB(60,90,150), InteractiveHover = Color3.fromRGB(80,120,190), InteractiveActive = Color3.fromRGB(100,150,230), ToggleOn = Color3.fromRGB(120,180,255), ToggleOff = Color3.fromRGB(60,70,85), Border = Color3.fromRGB(90,140,220), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(180,200,255), Accent = Color3.fromRGB(120,180,255), Section = Color3.fromRGB(22,32,55), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Ruby Red", colors = {Base = Color3.fromRGB(45,12,18), Header = Color3.fromRGB(60,18,25), Sidebar = Color3.fromRGB(40,10,15), Content = Color3.fromRGB(50,15,22), Card = Color3.fromRGB(75,25,35), Interactive = Color3.fromRGB(180,40,55), InteractiveHover = Color3.fromRGB(210,60,75), InteractiveActive = Color3.fromRGB(230,80,95), ToggleOn = Color3.fromRGB(255,100,120), ToggleOff = Color3.fromRGB(80,40,45), Border = Color3.fromRGB(200,50,65), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(255,200,210), Accent = Color3.fromRGB(255,100,120), Section = Color3.fromRGB(55,18,25), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(255,80,90), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Emerald Green", colors = {Base = Color3.fromRGB(12,35,22), Header = Color3.fromRGB(18,48,32), Sidebar = Color3.fromRGB(10,30,18), Content = Color3.fromRGB(15,40,26), Card = Color3.fromRGB(22,58,38), Interactive = Color3.fromRGB(40,140,80), InteractiveHover = Color3.fromRGB(55,170,100), InteractiveActive = Color3.fromRGB(70,200,120), ToggleOn = Color3.fromRGB(100,220,140), ToggleOff = Color3.fromRGB(30,60,40), Border = Color3.fromRGB(50,160,90), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(180,240,200), Accent = Color3.fromRGB(100,220,140), Section = Color3.fromRGB(18,45,30), Success = Color3.fromRGB(60,200,110), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
        {name = "Royal Purple", colors = {Base = Color3.fromRGB(28,18,48), Header = Color3.fromRGB(38,25,65), Sidebar = Color3.fromRGB(24,15,42), Content = Color3.fromRGB(32,22,55), Card = Color3.fromRGB(48,32,78), Interactive = Color3.fromRGB(120,70,180), InteractiveHover = Color3.fromRGB(145,95,210), InteractiveActive = Color3.fromRGB(165,115,235), ToggleOn = Color3.fromRGB(180,140,255), ToggleOff = Color3.fromRGB(65,50,85), Border = Color3.fromRGB(130,85,200), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(220,200,255), Accent = Color3.fromRGB(180,140,255), Section = Color3.fromRGB(35,24,58), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
{name = "Sunset Orange", colors = {Base = Color3.fromRGB(45,25,15), Header = Color3.fromRGB(60,35,22), Sidebar = Color3.fromRGB(40,22,12), Content = Color3.fromRGB(52,30,18), Card = Color3.fromRGB(75,45,28), Interactive = Color3.fromRGB(230,120,40), InteractiveHover = Color3.fromRGB(250,145,65), InteractiveActive = Color3.fromRGB(255,165,85), ToggleOn = Color3.fromRGB(255,160,80), ToggleOff = Color3.fromRGB(80,50,30), Border = Color3.fromRGB(240,130,50), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(255,220,190), Accent = Color3.fromRGB(255,160,80), Section = Color3.fromRGB(55,32,20), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(255,180,50)}},
{name = "Golden Yellow", colors = {Base = Color3.fromRGB(40,35,15), Header = Color3.fromRGB(55,48,22), Sidebar = Color3.fromRGB(35,30,12), Content = Color3.fromRGB(48,42,18), Card = Color3.fromRGB(70,62,28), Interactive = Color3.fromRGB(220,180,40), InteractiveHover = Color3.fromRGB(240,200,60), InteractiveActive = Color3.fromRGB(255,215,80), ToggleOn = Color3.fromRGB(255,210,80), ToggleOff = Color3.fromRGB(75,65,35), Border = Color3.fromRGB(225,185,45), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(255,245,200), Accent = Color3.fromRGB(255,210,80), Section = Color3.fromRGB(50,44,20), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(255,200,50)}},
{name = "Rose Pink", colors = {Base = Color3.fromRGB(45,20,35), Header = Color3.fromRGB(60,28,48), Sidebar = Color3.fromRGB(40,18,30), Content = Color3.fromRGB(52,24,40), Card = Color3.fromRGB(78,38,60), Interactive = Color3.fromRGB(230,80,150), InteractiveHover = Color3.fromRGB(250,110,175), InteractiveActive = Color3.fromRGB(255,130,190), ToggleOn = Color3.fromRGB(255,140,195), ToggleOff = Color3.fromRGB(80,45,60), Border = Color3.fromRGB(235,90,155), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(255,210,235), Accent = Color3.fromRGB(255,140,195), Section = Color3.fromRGB(55,26,42), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(255,80,120), Warning = Color3.fromRGB(230,180,50)}},
{name = "Aqua Cyan", colors = {Base = Color3.fromRGB(15,35,42), Header = Color3.fromRGB(22,48,58), Sidebar = Color3.fromRGB(12,30,38), Content = Color3.fromRGB(18,42,52), Card = Color3.fromRGB(28,62,78), Interactive = Color3.fromRGB(50,180,210), InteractiveHover = Color3.fromRGB(75,205,235), InteractiveActive = Color3.fromRGB(95,225,250), ToggleOn = Color3.fromRGB(100,220,250), ToggleOff = Color3.fromRGB(35,65,75), Border = Color3.fromRGB(60,190,220), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(200,245,255), Accent = Color3.fromRGB(100,220,250), Section = Color3.fromRGB(20,45,55), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
{name = "Midnight Black", colors = {Base = Color3.fromRGB(8,8,8), Header = Color3.fromRGB(15,15,15), Sidebar = Color3.fromRGB(5,5,5), Content = Color3.fromRGB(12,12,12), Card = Color3.fromRGB(22,22,22), Interactive = Color3.fromRGB(60,60,60), InteractiveHover = Color3.fromRGB(80,80,80), InteractiveActive = Color3.fromRGB(100,100,100), ToggleOn = Color3.fromRGB(180,180,180), ToggleOff = Color3.fromRGB(40,40,40), Border = Color3.fromRGB(70,70,70), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(160,160,160), Accent = Color3.fromRGB(255,255,255), Section = Color3.fromRGB(18,18,18), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
{name = "Snow White", colors = {Base = Color3.fromRGB(245,247,250), Header = Color3.fromRGB(235,238,242), Sidebar = Color3.fromRGB(240,243,248), Content = Color3.fromRGB(250,252,255), Card = Color3.fromRGB(255,255,255), Interactive = Color3.fromRGB(100,120,160), InteractiveHover = Color3.fromRGB(80,100,140), InteractiveActive = Color3.fromRGB(60,80,120), ToggleOn = Color3.fromRGB(70,130,220), ToggleOff = Color3.fromRGB(180,185,195), Border = Color3.fromRGB(200,210,225), TextMain = Color3.fromRGB(30,35,45), TextSub = Color3.fromRGB(100,110,130), Accent = Color3.fromRGB(50,100,180), Section = Color3.fromRGB(235,238,242), Success = Color3.fromRGB(40,160,90), Error = Color3.fromRGB(200,50,50), Warning = Color3.fromRGB(200,150,30)}},
{name = "Lime Green", colors = {Base = Color3.fromRGB(20,35,15), Header = Color3.fromRGB(28,48,22), Sidebar = Color3.fromRGB(18,30,12), Content = Color3.fromRGB(24,42,18), Card = Color3.fromRGB(35,62,28), Interactive = Color3.fromRGB(140,220,50), InteractiveHover = Color3.fromRGB(165,240,75), InteractiveActive = Color3.fromRGB(185,255,95), ToggleOn = Color3.fromRGB(175,250,90), ToggleOff = Color3.fromRGB(45,65,35), Border = Color3.fromRGB(145,225,55), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(210,255,190), Accent = Color3.fromRGB(175,250,90), Section = Color3.fromRGB(26,45,20), Success = Color3.fromRGB(155,235,65), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
{name = "Teal", colors = {Base = Color3.fromRGB(15,35,35), Header = Color3.fromRGB(22,50,50), Sidebar = Color3.fromRGB(12,30,30), Content = Color3.fromRGB(18,42,42), Card = Color3.fromRGB(28,65,65), Interactive = Color3.fromRGB(50,180,180), InteractiveHover = Color3.fromRGB(70,210,210), InteractiveActive = Color3.fromRGB(90,235,235), ToggleOn = Color3.fromRGB(100,230,230), ToggleOff = Color3.fromRGB(35,70,70), Border = Color3.fromRGB(55,190,190), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(190,250,250), Accent = Color3.fromRGB(100,230,230), Section = Color3.fromRGB(20,48,48), Success = Color3.fromRGB(65,200,200), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
},
Events = {
{name = "Christmas", colors = {Base = Color3.fromRGB(25,12,12), Header = Color3.fromRGB(45,18,18), Sidebar = Color3.fromRGB(20,10,10), Content = Color3.fromRGB(35,15,15), Card = Color3.fromRGB(60,25,25), Interactive = Color3.fromRGB(180,40,40), InteractiveHover = Color3.fromRGB(210,60,60), InteractiveActive = Color3.fromRGB(50,180,80), ToggleOn = Color3.fromRGB(80,220,110), ToggleOff = Color3.fromRGB(80,35,35), Border = Color3.fromRGB(180,50,50), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(255,210,210), Accent = Color3.fromRGB(80,220,110), Section = Color3.fromRGB(40,18,18), Success = Color3.fromRGB(50,180,80), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(255,200,50)}},
{name = "New Year", colors = {Base = Color3.fromRGB(10,10,25), Header = Color3.fromRGB(18,18,40), Sidebar = Color3.fromRGB(8,8,20), Content = Color3.fromRGB(14,14,32), Card = Color3.fromRGB(25,25,55), Interactive = Color3.fromRGB(255,200,50), InteractiveHover = Color3.fromRGB(255,220,80), InteractiveActive = Color3.fromRGB(255,235,110), ToggleOn = Color3.fromRGB(255,215,80), ToggleOff = Color3.fromRGB(50,50,70), Border = Color3.fromRGB(255,200,50), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(200,200,230), Accent = Color3.fromRGB(255,215,80), Section = Color3.fromRGB(16,16,38), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(255,200,50)}},
{name = "Winter", colors = {Base = Color3.fromRGB(12,18,35), Header = Color3.fromRGB(18,26,50), Sidebar = Color3.fromRGB(10,15,30), Content = Color3.fromRGB(15,22,42), Card = Color3.fromRGB(22,35,65), Interactive = Color3.fromRGB(100,160,230), InteractiveHover = Color3.fromRGB(130,185,250), InteractiveActive = Color3.fromRGB(150,200,255), ToggleOn = Color3.fromRGB(150,200,255), ToggleOff = Color3.fromRGB(40,55,80), Border = Color3.fromRGB(110,170,240), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(200,220,255), Accent = Color3.fromRGB(150,200,255), Section = Color3.fromRGB(16,24,45), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
{name = "Halloween", colors = {Base = Color3.fromRGB(15,10,18), Header = Color3.fromRGB(25,15,30), Sidebar = Color3.fromRGB(12,8,15), Content = Color3.fromRGB(20,12,25), Card = Color3.fromRGB(35,22,45), Interactive = Color3.fromRGB(255,120,0), InteractiveHover = Color3.fromRGB(255,150,40), InteractiveActive = Color3.fromRGB(255,170,70), ToggleOn = Color3.fromRGB(255,130,20), ToggleOff = Color3.fromRGB(60,40,70), Border = Color3.fromRGB(255,120,0), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(200,180,210), Accent = Color3.fromRGB(180,80,255), Section = Color3.fromRGB(22,14,28), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(255,120,0)}},
{name = "Valentine", colors = {Base = Color3.fromRGB(45,15,25), Header = Color3.fromRGB(62,22,35), Sidebar = Color3.fromRGB(40,12,20), Content = Color3.fromRGB(55,18,30), Card = Color3.fromRGB(85,30,48), Interactive = Color3.fromRGB(255,70,120), InteractiveHover = Color3.fromRGB(255,100,145), InteractiveActive = Color3.fromRGB(255,130,170), ToggleOn = Color3.fromRGB(255,120,170), ToggleOff = Color3.fromRGB(80,35,50), Border = Color3.fromRGB(255,80,130), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(255,200,220), Accent = Color3.fromRGB(255,120,170), Section = Color3.fromRGB(58,20,32), Success = Color3.fromRGB(255,85,135), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(230,180,50)}},
{name = "Easter", colors = {Base = Color3.fromRGB(235,230,245), Header = Color3.fromRGB(220,215,235), Sidebar = Color3.fromRGB(230,225,240), Content = Color3.fromRGB(240,235,250), Card = Color3.fromRGB(250,245,255), Interactive = Color3.fromRGB(180,140,220), InteractiveHover = Color3.fromRGB(160,120,200), InteractiveActive = Color3.fromRGB(140,100,180), ToggleOn = Color3.fromRGB(170,220,150), ToggleOff = Color3.fromRGB(200,195,210), Border = Color3.fromRGB(200,170,240), TextMain = Color3.fromRGB(60,50,80), TextSub = Color3.fromRGB(120,100,150), Accent = Color3.fromRGB(255,180,200), Section = Color3.fromRGB(225,220,238), Success = Color3.fromRGB(150,210,130), Error = Color3.fromRGB(200,80,80), Warning = Color3.fromRGB(220,180,80)}},
{name = "St. Patrick", colors = {Base = Color3.fromRGB(15,40,25), Header = Color3.fromRGB(22,55,35), Sidebar = Color3.fromRGB(12,35,20), Content = Color3.fromRGB(18,48,30), Card = Color3.fromRGB(28,70,45), Interactive = Color3.fromRGB(50,200,100), InteractiveHover = Color3.fromRGB(70,225,120), InteractiveActive = Color3.fromRGB(90,245,140), ToggleOn = Color3.fromRGB(100,235,150), ToggleOff = Color3.fromRGB(30,60,40), Border = Color3.fromRGB(55,210,105), TextMain = Color3.fromRGB(255,255,255), TextSub = Color3.fromRGB(180,240,200), Accent = Color3.fromRGB(100,235,150), Section = Color3.fromRGB(20,52,32), Success = Color3.fromRGB(60,215,110), Error = Color3.fromRGB(220,60,60), Warning = Color3.fromRGB(255,200,50)}},
{name = "Summer", colors = {Base = Color3.fromRGB(255,248,235), Header = Color3.fromRGB(255,240,220), Sidebar = Color3.fromRGB(255,245,228), Content = Color3.fromRGB(255,250,240), Card = Color3.fromRGB(255,255,250), Interactive = Color3.fromRGB(255,150,50), InteractiveHover = Color3.fromRGB(255,130,30), InteractiveActive = Color3.fromRGB(235,110,20), ToggleOn = Color3.fromRGB(50,200,255), ToggleOff = Color3.fromRGB(200,190,175), Border = Color3.fromRGB(255,180,100), TextMain = Color3.fromRGB(60,50,30), TextSub = Color3.fromRGB(130,110,80), Accent = Color3.fromRGB(255,120,30), Section = Color3.fromRGB(255,242,222), Success = Color3.fromRGB(50,180,100), Error = Color3.fromRGB(220,80,60), Warning = Color3.fromRGB(255,180,50)}},
},
}

local Themes = {}
for _, themes in pairs(ThemeCategories) do
    for _, theme in ipairs(themes) do
        table.insert(Themes, theme)
    end
end

Core._applyTheme = function(theme)
    for k, v in pairs(theme) do Colors[k] = v end
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad)
    if UI.TimeContainer then
        Services.TweenService:Create(UI.TimeContainer, tweenInfo, {BackgroundColor3 = Colors.Interactive}):Play()
    end
    Services.TweenService:Create(UI.Main, tweenInfo, {BackgroundColor3 = Colors.Base}):Play()
    Services.TweenService:Create(UI.MainStroke, tweenInfo, {Color = Colors.Border}):Play()
    Services.TweenService:Create(UI.HeaderLine, tweenInfo, {BackgroundColor3 = Colors.Border}):Play()
    Services.TweenService:Create(UI.SidebarLine, tweenInfo, {BackgroundColor3 = Colors.Border}):Play()
    Services.TweenService:Create(UI.LogoContainer, tweenInfo, {BackgroundColor3 = Colors.Card}):Play()
    Services.TweenService:Create(UI.LogoStroke, tweenInfo, {Color = Colors.Border}):Play()
    Services.TweenService:Create(UI.Title, tweenInfo, {TextColor3 = Colors.TextMain}):Play()
    for _, toggle in ipairs(Data.AllToggles) do
        _G.toggleState = toggle.getState()
        if _G.toggleState then
            Services.TweenService:Create(toggle.bg, tweenInfo, {BackgroundColor3 = Colors.ToggleOn}):Play()
        else
            Services.TweenService:Create(toggle.bg, tweenInfo, {BackgroundColor3 = Colors.ToggleOff}):Play()
        end
    end
    for _, slider in ipairs(Data.AllSliders) do
        Services.TweenService:Create(slider.track, tweenInfo, {BackgroundColor3 = Colors.ToggleOff}):Play()
        Services.TweenService:Create(slider.fill, tweenInfo, {BackgroundColor3 = Colors.ToggleOn}):Play()
        Services.TweenService:Create(slider.valueLabel, tweenInfo, {TextColor3 = Colors.Accent}):Play()
    end
    for _, keybind in ipairs(Data.AllKeybinds) do
        if keybind.btn and keybind.btn.Parent then
            Services.TweenService:Create(keybind.btn, tweenInfo, {BackgroundColor3 = Colors.Interactive}):Play()
            local stroke = keybind.btn:FindFirstChildOfClass("UIStroke")
            if stroke then Services.TweenService:Create(stroke, tweenInfo, {Color = Colors.Border}):Play() end
        end
    end
    for _, btn in ipairs(UI.Controls:GetChildren()) do
        if btn:IsA("TextButton") then
            Services.TweenService:Create(btn, tweenInfo, {BackgroundColor3 = Colors.Interactive}):Play()
        end
    end
    for _, page in pairs(Data.Pages) do
        Services.TweenService:Create(page, tweenInfo, {ScrollBarImageColor3 = Colors.Interactive}):Play()
    end
    if UI.Sidebar then
        Services.TweenService:Create(UI.Sidebar, tweenInfo, {ScrollBarImageColor3 = Colors.Interactive}):Play()
    end
    for name, tab in pairs(Data.Tabs) do
        local isActive = (Data.ActiveTab == name)
        if isActive then
            Services.TweenService:Create(tab, tweenInfo, {
                BackgroundColor3 = Colors.Interactive,
                BackgroundTransparency = 0.3
            }):Play()
        else
            Services.TweenService:Create(tab, tweenInfo, {
                BackgroundColor3 = Colors.Card,
                BackgroundTransparency = 0.3
            }):Play()
        end
        local stroke = tab:FindFirstChild("TabStroke")
        if stroke then
            local strokeColor = isActive and Colors.Accent or Colors.Border
            Services.TweenService:Create(stroke, tweenInfo, {Color = strokeColor}):Play()
        end
    end
    for _, obj in ipairs(UI.Gui:GetDescendants()) do
        if obj.Name == "ModuleCard" and obj:IsA("Frame") then
            Services.TweenService:Create(obj, tweenInfo, {BackgroundColor3 = Colors.Card}):Play()
            local stroke = obj:FindFirstChildOfClass("UIStroke")
            if stroke then Services.TweenService:Create(stroke, tweenInfo, {Color = Colors.Border}):Play() end
        elseif obj.Name == "SectionContainer" and obj:IsA("Frame") then
            Services.TweenService:Create(obj, tweenInfo, {BackgroundColor3 = Colors.Card}):Play()
            local stroke = obj:FindFirstChildOfClass("UIStroke")
            if stroke then Services.TweenService:Create(stroke, tweenInfo, {Color = Colors.Border}):Play() end
        elseif obj.Name == "OptionsFrame" and obj:IsA("ScrollingFrame") then
            Services.TweenService:Create(obj, tweenInfo, {BackgroundColor3 = Colors.Base}):Play()
            local stroke = obj:FindFirstChildOfClass("UIStroke")
            if stroke then Services.TweenService:Create(stroke, tweenInfo, {Color = Colors.Border}):Play() end
        elseif obj.Parent and obj.Parent.Name == "OptionsFrame" and obj:IsA("TextButton") then
            Services.TweenService:Create(obj, tweenInfo, {BackgroundColor3 = Colors.Card, TextColor3 = Colors.TextMain}):Play()
        elseif obj:IsA("TextLabel") or obj:IsA("TextButton") then
            if obj.Name == "TimeLabel" or obj.Name == "Author" or obj.Name == "UserNick" or obj.Name == "SelectedOptionLabel" or obj.Name == "KeybindText" then
            elseif obj.TextSize <= 12 or obj.Name == "DropdownArrow" then
                Services.TweenService:Create(obj, tweenInfo, {TextColor3 = Colors.TextSub}):Play()
            else
                Services.TweenService:Create(obj, tweenInfo, {TextColor3 = Colors.TextMain}):Play()
            end
        end
    end
    if UI.l1 and UI.l2 then
        Services.TweenService:Create(UI.l1, tweenInfo, {BackgroundColor3 = Colors.Border}):Play()
        Services.TweenService:Create(UI.l2, tweenInfo, {BackgroundColor3 = Colors.Border}):Play()
    end
    local profileCard = UI.ContentHolder:FindFirstChild("ProfileCard")
    if profileCard then
        Services.TweenService:Create(profileCard, tweenInfo, {BackgroundColor3 = Colors.Card}):Play()
        local pStroke = profileCard:FindFirstChildOfClass("UIStroke")
        if pStroke then Services.TweenService:Create(pStroke, tweenInfo, {Color = Colors.Border}):Play() end
        local avatar = profileCard:FindFirstChild("Avatar")
        if avatar then
            Services.TweenService:Create(avatar, tweenInfo, {BackgroundColor3 = Colors.Card}):Play()
            local avStroke = avatar:FindFirstChildOfClass("UIStroke")
            if avStroke then Services.TweenService:Create(avStroke, tweenInfo, {Color = Colors.Border}):Play() end
        end
        local displayNick = profileCard:FindFirstChild("DisplayNick")
        if displayNick then Services.TweenService:Create(displayNick, tweenInfo, {TextColor3 = Colors.TextMain}):Play() end
    end
    Services.TweenService:Create(UI.SearchModal, tweenInfo, {BackgroundColor3 = Colors.Base}):Play()
    Services.TweenService:Create(UI.ModalStroke, tweenInfo, {Color = Colors.Border}):Play()
    Services.TweenService:Create(UI.ModalIcon, tweenInfo, {ImageColor3 = Colors.TextSub}):Play()
    Services.TweenService:Create(UI.SearchInput, tweenInfo, {TextColor3 = Colors.TextMain, PlaceholderColor3 = Colors.TextSub}):Play()
    Services.TweenService:Create(UI.CloseSearchBtn, tweenInfo, {BackgroundColor3 = Colors.Interactive}):Play()
    Services.TweenService:Create(UI.ResultsContainer, tweenInfo, {BackgroundColor3 = Colors.Base}):Play()
    Services.TweenService:Create(UI.ResStroke, tweenInfo, {Color = Colors.Border}):Play()
    Services.TweenService:Create(UI.SearchButton, tweenInfo, {BackgroundColor3 = Colors.Interactive}):Play()
    Services.TweenService:Create(UI.SearchIcon, tweenInfo, {ImageColor3 = Colors.TextMain}):Play()
    Services.TweenService:Create(UI.SearchLabel, tweenInfo, {TextColor3 = Colors.TextMain}):Play()
    if SEARCH_OPEN and UI.SearchInput.Text ~= "" then
        ShowResults(UI.SearchInput.Text)
    end
    if _G.ColorPickerOpen and _G.ColorPickerGui and _G.ColorPickerGui.Parent then
        Services.TweenService:Create(_G.ColorPickerGui, tweenInfo, {BackgroundColor3 = Colors.Base, BackgroundTransparency = Settings.GUI_OPACITY / 100}):Play()
        
        if _G.ColorPickerStroke and _G.ColorPickerStroke.Parent then
            Services.TweenService:Create(_G.ColorPickerStroke, tweenInfo, {Color = Colors.Border}):Play()
        end
        
        if _G.ColorPickerShadow and _G.ColorPickerShadow.Parent then
            Services.TweenService:Create(_G.ColorPickerShadow, tweenInfo, {ImageTransparency = 0.75}):Play()
        end
        
        if _G.ColorPickerTitle and _G.ColorPickerTitle.Parent then
            Services.TweenService:Create(_G.ColorPickerTitle, tweenInfo, {TextColor3 = Colors.TextMain}):Play()
        end
        
        if _G.ColorPickerCloseBtn and _G.ColorPickerCloseBtn.Parent then
            Services.TweenService:Create(_G.ColorPickerCloseBtn, tweenInfo, {BackgroundColor3 = Colors.Interactive, BackgroundTransparency = 0.3 + 0.4 * (Settings.GUI_OPACITY / 100)}):Play()
        end
        
        if _G.ColorPickerHueSaturation and _G.ColorPickerHueSaturation.Parent then
            _G.ColorPickerThemeHue = Colors.Accent:ToHSV()
            Services.TweenService:Create(_G.ColorPickerHueSaturation, tweenInfo, {BackgroundColor3 = Color3.fromHSV(_G.ColorPickerCurrentHue or 0, 1, 1)}):Play()
        end
        
        if _G.ColorPickerHueBar and _G.ColorPickerHueBar.Parent then
            Services.TweenService:Create(_G.ColorPickerHueBar, tweenInfo, {BackgroundColor3 = Color3.new(1, 1, 1)}):Play()
        end
        
        if _G.ColorPickerHueSatCursor and _G.ColorPickerHueSatCursor.Parent then
            Services.TweenService:Create(_G.ColorPickerHueSatCursor, tweenInfo, {BackgroundColor3 = Color3.new(1, 1, 1)}):Play()
        end
        
        if _G.ColorPickerHueCursor and _G.ColorPickerHueCursor.Parent then
            Services.TweenService:Create(_G.ColorPickerHueCursor, tweenInfo, {BackgroundColor3 = Color3.new(1, 1, 1)}):Play()
        end
        
        if _G.ColorPickerPreview and _G.ColorPickerPreview.Parent then
            Services.TweenService:Create(_G.ColorPickerPreview, tweenInfo, {BackgroundColor3 = ESPColor}):Play()
        end
        
        if _G.ColorPickerPreviewStroke and _G.ColorPickerPreviewStroke.Parent then
            Services.TweenService:Create(_G.ColorPickerPreviewStroke, tweenInfo, {Color = Colors.Border}):Play()
        end
        
        if _G.ColorPickerHexInput and _G.ColorPickerHexInput.Parent then
            Services.TweenService:Create(_G.ColorPickerHexInput, tweenInfo, {BackgroundColor3 = Colors.Card, BackgroundTransparency = Settings.GUI_OPACITY / 100, TextColor3 = Colors.TextMain, PlaceholderColor3 = Colors.TextSub}):Play()
        end
        
        if _G.ColorPickerHexInputStroke and _G.ColorPickerHexInputStroke.Parent then
            Services.TweenService:Create(_G.ColorPickerHexInputStroke, tweenInfo, {Color = Colors.Border}):Play()
        end
        
        if _G.ColorPickerPresetsFrame and _G.ColorPickerPresetsFrame.Parent then
            Services.TweenService:Create(_G.ColorPickerPresetsFrame, tweenInfo, {BackgroundColor3 = Colors.Card}):Play()
            
            if _G.ColorPickerPresetsFrameStroke and _G.ColorPickerPresetsFrameStroke.Parent then
                Services.TweenService:Create(_G.ColorPickerPresetsFrameStroke, tweenInfo, {Color = Colors.Border}):Play()
            end
        end
    end
end

Settings.COLORPICKER_RESTORE_ON_MINIMIZE = false

_G.HideColorPickerOnMinimize = function()
    if not _G.ColorPickerOpen then return end
    if not _G.ColorPickerGui then return end
    if not _G.ColorPickerGui.Parent then return end
    
    _G.LastColorPickerPosition = _G.ColorPickerGui.Position
    
    Services.TweenService:Create(_G.ColorPickerGui, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(0, 0),
        BackgroundTransparency = 1
    }):Play()
    
    if _G.ColorPickerStroke then
        Services.TweenService:Create(_G.ColorPickerStroke, TweenInfo.new(0.2), {Transparency = 1}):Play()
    end
    
    if _G.ColorPickerShadow then
        Services.TweenService:Create(_G.ColorPickerShadow, TweenInfo.new(0.2), {ImageTransparency = 1}):Play()
    end
    
    if _G.ColorPickerTitle then
        Services.TweenService:Create(_G.ColorPickerTitle, TweenInfo.new(0.15), {TextTransparency = 1}):Play()
    end
    
    if _G.ColorPickerCloseBtn then
        Services.TweenService:Create(_G.ColorPickerCloseBtn, TweenInfo.new(0.15), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
    end
    
    if _G.ColorPickerHueSaturation then
        Services.TweenService:Create(_G.ColorPickerHueSaturation, TweenInfo.new(0.15), {BackgroundTransparency = 1}):Play()
    end
    
    if _G.ColorPickerValueOverlay then
        Services.TweenService:Create(_G.ColorPickerValueOverlay, TweenInfo.new(0.15), {BackgroundTransparency = 1}):Play()
    end
    
    if _G.ColorPickerHueSatCursor then
        Services.TweenService:Create(_G.ColorPickerHueSatCursor, TweenInfo.new(0.15), {BackgroundTransparency = 1}):Play()
    end
    
    if _G.ColorPickerHueBar then
        Services.TweenService:Create(_G.ColorPickerHueBar, TweenInfo.new(0.15), {BackgroundTransparency = 1}):Play()
    end
    
    if _G.ColorPickerHueCursor then
        Services.TweenService:Create(_G.ColorPickerHueCursor, TweenInfo.new(0.15), {BackgroundTransparency = 1}):Play()
    end
    
    if _G.ColorPickerPreview then
        Services.TweenService:Create(_G.ColorPickerPreview, TweenInfo.new(0.15), {BackgroundTransparency = 1}):Play()
    end
    
    if _G.ColorPickerHexInput then
        Services.TweenService:Create(_G.ColorPickerHexInput, TweenInfo.new(0.15), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
    end
    
    if _G.ColorPickerPresetsFrame then
        _G.ColorPickerMinimizePresetButtons = _G.ColorPickerPresetsFrame:GetChildren()
        _G.ColorPickerMinimizePresetIndex = 1
        while _G.ColorPickerMinimizePresetIndex <= #_G.ColorPickerMinimizePresetButtons do
            _G.ColorPickerMinimizePresetBtn = _G.ColorPickerMinimizePresetButtons[_G.ColorPickerMinimizePresetIndex]
            if _G.ColorPickerMinimizePresetBtn:IsA("TextButton") then
                Services.TweenService:Create(_G.ColorPickerMinimizePresetBtn, TweenInfo.new(0.15), {BackgroundTransparency = 1}):Play()
            end
            _G.ColorPickerMinimizePresetIndex = _G.ColorPickerMinimizePresetIndex + 1
        end
    end
    
    task.delay(0.3, function()
        if _G.ColorPickerGui and _G.ColorPickerGui.Parent then
            _G.ColorPickerGui.Visible = false
        end
    end)
end

_G.ShowColorPickerOnRestore = function()
    if not _G.ColorPickerGui then return end
    if not _G.ColorPickerGui.Parent then return end
    
    _G.ColorPickerGui.Visible = true
    _G.ColorPickerGui.Size = UDim2.fromOffset(0, 0)
    
    if _G.LastColorPickerPosition then
        _G.ColorPickerGui.Position = _G.LastColorPickerPosition
    end
    
    Services.TweenService:Create(_G.ColorPickerGui, TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(300, 190),
        BackgroundTransparency = Settings.GUI_OPACITY / 100
    }):Play()
    
    if _G.ColorPickerStroke then
        Services.TweenService:Create(_G.ColorPickerStroke, TweenInfo.new(0.25), {Transparency = 0.5}):Play()
    end
    
    if _G.ColorPickerShadow then
        Services.TweenService:Create(_G.ColorPickerShadow, TweenInfo.new(0.25), {ImageTransparency = 0.5 + 0.3 * (Settings.GUI_OPACITY / 100)}):Play()
    end
    
    if _G.ColorPickerTitle then
        Services.TweenService:Create(_G.ColorPickerTitle, TweenInfo.new(0.2), {TextTransparency = 0}):Play()
    end
    
    if _G.ColorPickerCloseBtn then
        Services.TweenService:Create(_G.ColorPickerCloseBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0.3 + 0.4 * (Settings.GUI_OPACITY / 100), TextTransparency = 0}):Play()
    end
    
    if _G.ColorPickerHueSaturation then
        Services.TweenService:Create(_G.ColorPickerHueSaturation, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
    end
    
    if _G.ColorPickerValueOverlay then
        Services.TweenService:Create(_G.ColorPickerValueOverlay, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
    end
    
    if _G.ColorPickerHueSatCursor then
        Services.TweenService:Create(_G.ColorPickerHueSatCursor, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
    end
    
    if _G.ColorPickerHueBar then
        Services.TweenService:Create(_G.ColorPickerHueBar, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
    end
    
    if _G.ColorPickerHueCursor then
        Services.TweenService:Create(_G.ColorPickerHueCursor, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
    end
    
    if _G.ColorPickerPreview then
        Services.TweenService:Create(_G.ColorPickerPreview, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
    end
    
    if _G.ColorPickerHexInput then
        Services.TweenService:Create(_G.ColorPickerHexInput, TweenInfo.new(0.2), {BackgroundTransparency = Settings.GUI_OPACITY / 100, TextTransparency = 0}):Play()
    end
    
    if _G.ColorPickerPresetsFrame then
        _G.ColorPickerRestorePresetButtons = _G.ColorPickerPresetsFrame:GetChildren()
        _G.ColorPickerRestorePresetIndex = 1
        while _G.ColorPickerRestorePresetIndex <= #_G.ColorPickerRestorePresetButtons do
            _G.ColorPickerRestorePresetBtn = _G.ColorPickerRestorePresetButtons[_G.ColorPickerRestorePresetIndex]
            if _G.ColorPickerRestorePresetBtn:IsA("TextButton") then
                Services.TweenService:Create(_G.ColorPickerRestorePresetBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
            end
            _G.ColorPickerRestorePresetIndex = _G.ColorPickerRestorePresetIndex + 1
        end
    end
end

UI.MinBtn = Core.createControlButton(0, "â–²", function()
    Settings.WINDOW_MINIMIZED = not Settings.WINDOW_MINIMIZED
    if Settings.WINDOW_MINIMIZED then
        Settings.SEARCH_RESTORE_ON_MINIMIZE = SEARCH_OPEN
        if SEARCH_OPEN then
            CloseSearch()
        end
        Settings.COLORPICKER_RESTORE_ON_MINIMIZE = _G.ColorPickerOpen
        if _G.ColorPickerOpen then
            _G.HideColorPickerOnMinimize()
        end
        Core.updateHeaderFillVisibility(true)
        Services.TweenService:Create(UI.MinBtn, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Rotation = 180}):Play()
        Services.TweenService:Create(UI.Shadow, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Size = UDim2.fromOffset(Settings.GUI_WIDTH + 12, Settings.HEADER_HEIGHT + 12),
            ImageTransparency = 0.75
        }):Play()
        Services.TweenService:Create(UI.Main, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Size = UDim2.fromOffset(Settings.GUI_WIDTH, Settings.HEADER_HEIGHT)
        }):Play()
        Services.TweenService:Create(UI.ContentHolder, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Size = UDim2.new(1, 0, 0, 0)
        }):Play()
    else
        Core.updateHeaderFillVisibility(false)
        Services.TweenService:Create(UI.MinBtn, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Rotation = 0}):Play()
        Services.TweenService:Create(UI.Shadow, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Size = UDim2.fromOffset(Settings.GUI_WIDTH + 12, Settings.ORIGINAL_HEIGHT + 12),
            ImageTransparency = 0.75
        }):Play()
        Services.TweenService:Create(UI.Main, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Size = UDim2.fromOffset(Settings.GUI_WIDTH, Settings.ORIGINAL_HEIGHT)
        }):Play()
        Services.TweenService:Create(UI.ContentHolder, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Size = UDim2.new(1, 0, 1, -Settings.HEADER_HEIGHT)
        }):Play()
        if Settings.SEARCH_RESTORE_ON_MINIMIZE then
            task.spawn(function()
                task.wait(0.4)
                OpenSearch()
            end)
            Settings.SEARCH_RESTORE_ON_MINIMIZE = false
        end
        if Settings.COLORPICKER_RESTORE_ON_MINIMIZE then
            task.spawn(function()
                task.wait(0.4)
                _G.ShowColorPickerOnRestore()
            end)
            Settings.COLORPICKER_RESTORE_ON_MINIMIZE = false
        end
    end
end)
UI.MinBtn.Name = "MinBtn"

local CharacterModules = {
    Speed = {enabled = false, disableFunc = nil},
    Jump = {enabled = false, disableFunc = nil},
    Noclip = {enabled = false, disableFunc = nil},
    InfiniteJump = {enabled = false, disableFunc = nil},
    Bunnyhop = {enabled = false, disableFunc = nil},
    Fly = {enabled = false, disableFunc = nil},
    Spinbot = {enabled = false, disableFunc = nil}
}

local function DisableAllCharacterModules()
    for moduleName, moduleData in pairs(CharacterModules) do
        if moduleData.enabled and moduleData.disableFunc then
            moduleData.disableFunc()
            moduleData.enabled = false
        end
    end
end

_G.Combat = _G.Combat or {}
_G.Combat.Functions = _G.Combat.Functions or {}
_G.Combat.Functions.FullCleanup = _G.Combat.Functions.FullCleanup or function() end

UI.CloseBtn = Core.createControlButton(Settings.IS_MOBILE and 32 or 38, "Ã—", function()
    Core.saveSettings()
    DisableAllCharacterModules()
    if _G.Combat and _G.Combat.Functions and _G.Combat.Functions.FullCleanup then
        pcall(_G.Combat.Functions.FullCleanup)
    end
    pcall(function()
        if _G.Combat and _G.Combat.Circles then
            if _G.Combat.Circles.Silent then _G.Combat.Circles.Silent:Remove() end
            if _G.Combat.Circles.Aimbot then _G.Combat.Circles.Aimbot:Remove() end
        end
    end)
    AntiFlingEnabled = false
    if AntiFlingHeartbeat then
        AntiFlingHeartbeat:Disconnect()
        AntiFlingHeartbeat = nil
    end
    _G.DisableAntiAFK()
    _G.DisableXRay()
    
    if _G.FPSOriginalMaterials then
        for obj, originalMat in pairs(_G.FPSOriginalMaterials) do
            if obj and obj.Parent and obj:IsA("BasePart") then
                pcall(function()
                    obj.Material = originalMat
                end)
            end
        end
        _G.FPSOriginalMaterials = {}
    end
    if _G.FPSMaterialConnection then
        _G.FPSMaterialConnection:Disconnect()
        _G.FPSMaterialConnection = nil
    end
    
    if _G.ColorPickerOpen then
        _G.ColorPickerOpen = false
        if _G.ColorPickerGui and _G.ColorPickerGui.Parent then
            _G.ColorPickerGui:Destroy()
            _G.ColorPickerGui = nil
        end
        if _G.ColorPickerInputChangedConnection then
            _G.ColorPickerInputChangedConnection:Disconnect()
            _G.ColorPickerInputChangedConnection = nil
        end
        if _G.ColorPickerInputEndedConnection then
            _G.ColorPickerInputEndedConnection:Disconnect()
            _G.ColorPickerInputEndedConnection = nil
        end
        if _G.ColorPickerDragConnection then
            _G.ColorPickerDragConnection:Disconnect()
            _G.ColorPickerDragConnection = nil
        end
        if _G.ColorPickerDragEndConnection then
            _G.ColorPickerDragEndConnection:Disconnect()
            _G.ColorPickerDragEndConnection = nil
        end
    end
    
    if SEARCH_OPEN then
        SEARCH_OPEN = false
        LastSearchPosition = UI.SearchModal.Position
        if SearchModalTween then
            SearchModalTween:Cancel()
        end
        SearchModalTween = Services.TweenService:Create(UI.SearchModal, TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.fromOffset(Settings.IS_MOBILE and 200 or 280, Settings.IS_MOBILE and 30 or 36),
            Position = UI.SearchModal.Position + UDim2.fromOffset(0, -20)
        })
        SearchModalTween:Play()
        Services.TweenService:Create(UI.ResultsContainer, TweenInfo.new(0.15), {
            Size = UDim2.new(1, 0, 0, 0)
        }):Play()
        Services.TweenService:Create(UI.SearchModal, TweenInfo.new(0.2), {
            BackgroundTransparency = 1
        }):Play()
        UI.SearchInput.Text = ""
        UI.SearchOverlay.Active = false
    end
    Services.TweenService:Create(UI.Main, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
        Size = UDim2.fromOffset(0, 0),
        BackgroundTransparency = 1
    }):Play()
    Services.TweenService:Create(UI.Shadow, TweenInfo.new(0.3), {
        Size = UDim2.fromOffset(0, 0),
        ImageTransparency = 1
    }):Play()
    task.delay(0.35, function()
        if UI.Gui and UI.Gui.Parent then
            UI.Gui:Destroy()
        end
    end)
end)
UI.CloseBtn.Name = "CloseBtn"
UI.CloseBtn.TextSize = Settings.IS_MOBILE and 18 or 20
UI.CloseBtn.BackgroundTransparency = 0.5
UI.CloseBtn.TextColor3 = Color3.new(1, 1, 1)
UI.CloseBtn.MouseEnter:Connect(function()
    Services.TweenService:Create(UI.CloseBtn, TweenInfo.new(0.15), {
        BackgroundTransparency = 0.2,
        BackgroundColor3 = Colors.InteractiveHover
    }):Play()
end)
UI.CloseBtn.MouseLeave:Connect(function()
    Services.TweenService:Create(UI.CloseBtn, TweenInfo.new(0.15), {
        BackgroundTransparency = 0.5,
        BackgroundColor3 = Colors.Interactive
    }):Play()
end)

UI.ProfileCard = Instance.new("Frame", UI.ContentHolder)
UI.ProfileCard.Name = "ProfileCard"
UI.ProfileCard.AnchorPoint = Vector2.new(0, 1)
UI.ProfileCard.Position = UDim2.new(0, 10, 1, -10)
UI.ProfileCard.Size = UDim2.new(0, Settings.SIDEBAR_WIDTH - 20, 0, Settings.IS_MOBILE and 56 or 66)
UI.ProfileCard.BackgroundColor3 = Colors.Card
UI.ProfileCard.BackgroundTransparency = 0.3
UI.ProfileCard.BorderSizePixel = 0
UI.ProfileCard.ZIndex = 50

UI.ProfileCardCorner = Instance.new("UICorner", UI.ProfileCard)
UI.ProfileCardCorner.CornerRadius = UDim.new(0, 12)

UI.ProfileStroke = Instance.new("UIStroke", UI.ProfileCard)
UI.ProfileStroke.Color = Colors.Border
UI.ProfileStroke.Transparency = 0.6
UI.ProfileStroke.Thickness = 1

UI.avatar = Instance.new("ImageLabel", UI.ProfileCard)
UI.avatar.Name = "Avatar"
UI.avatar.Size = UDim2.fromOffset(Settings.IS_MOBILE and 36 or 44, Settings.IS_MOBILE and 36 or 44)
UI.avatar.Position = UDim2.fromOffset(10, Settings.IS_MOBILE and 10 or 11)
UI.avatar.BackgroundColor3 = Colors.Card
UI.avatar.BorderSizePixel = 0
UI.avatar.Image = ""
UI.avatar.ZIndex = 51
UI.avatar.ScaleType = Enum.ScaleType.Crop

UI.avatarCorner = Instance.new("UICorner", UI.avatar)
UI.avatarCorner.CornerRadius = UDim.new(1, 0)

UI.avStroke = Instance.new("UIStroke", UI.avatar)
UI.avStroke.Color = Colors.Border
UI.avStroke.Transparency = 0.6
UI.avStroke.Thickness = 1

UI.displayLabel = Instance.new("TextLabel", UI.ProfileCard)
UI.displayLabel.Name = "DisplayNick"
UI.displayLabel.BackgroundTransparency = 1
UI.displayLabel.Position = UDim2.fromOffset(Settings.IS_MOBILE and 54 or 62, Settings.IS_MOBILE and 10 or 12)
UI.displayLabel.Size = UDim2.new(1, -(Settings.IS_MOBILE and 64 or 74), 0, 20)
UI.displayLabel.TextXAlignment = Enum.TextXAlignment.Left
UI.displayLabel.Font = Enum.Font.FredokaOne
UI.displayLabel.TextSize = Settings.IS_MOBILE and 11 or 13
UI.displayLabel.TextColor3 = Colors.TextMain
UI.displayLabel.Text = Player.DisplayName
UI.displayLabel.ZIndex = 51
UI.displayLabel.TextTruncate = Enum.TextTruncate.AtEnd

UI.userLabel = Instance.new("TextLabel", UI.ProfileCard)
UI.userLabel.Name = "UserNick"
UI.userLabel.BackgroundTransparency = 1
UI.userLabel.Position = UDim2.fromOffset(Settings.IS_MOBILE and 54 or 62, Settings.IS_MOBILE and 30 or 34)
UI.userLabel.Size = UDim2.new(1, -(Settings.IS_MOBILE and 64 or 74), 0, 18)
UI.userLabel.TextXAlignment = Enum.TextXAlignment.Left
UI.userLabel.Font = Enum.Font.FredokaOne
UI.userLabel.TextSize = Settings.IS_MOBILE and 9 or 11
UI.userLabel.TextColor3 = Color3.new(1, 1, 1)
UI.userLabel.Text = "@" .. Player.Name
UI.userLabel.ZIndex = 51
UI.userLabel.TextTruncate = Enum.TextTruncate.AtEnd

task.spawn(function()
    local thumbType = Enum.ThumbnailType.HeadShot
    local thumbSize = Enum.ThumbnailSize.Size100x100
    local success, thumb = pcall(function()
        return Services.Players:GetUserThumbnailAsync(Player.UserId, thumbType, thumbSize)
    end)
    if success and thumb and thumb ~= "" then
        UI.avatar.Image = thumb
    end
end)

_G.Main = Core.createTab("Main", 0)
local Events = Core.createTab("Events", 0)
local Character = Core.createTab("Character", 1)
local Visual = Core.createTab("Visual", 2)
local Combat = Core.createTab("Combat", 3)
local Troll = Core.createTab("Troll", 4)
local Screen = Core.createTab("Screen", 5)
local Misc = Core.createTab("Misc", 6)
local SettingsTab = Core.createTab("Settings", 7)

local appearanceContent = Core.section(SettingsTab, "Appearance", 1)
local function ApplyThemeFromDropdown(opt)
    Settings.CURRENT_THEME = opt.name
    Core.applyTheme(opt.colors)
    Core.saveSettings()
end
local messengerOptions = {}
for _, theme in ipairs(ThemeCategories.Messengers) do
    table.insert(messengerOptions, {name = theme.name, colors = theme.colors})
end
local messengerDropdown = Core.dropdown(appearanceContent, "Messengers", messengerOptions, 1, ApplyThemeFromDropdown)
local colorOptions = {}
for _, theme in ipairs(ThemeCategories.Colors) do
    table.insert(colorOptions, {name = theme.name, colors = theme.colors})
end
local colorDropdown = Core.dropdown(appearanceContent, "Colors", colorOptions, 2, ApplyThemeFromDropdown)
local eventOptions = {}
for _, theme in ipairs(ThemeCategories.Events) do
    table.insert(eventOptions, {name = theme.name, colors = theme.colors})
end
local eventDropdown = Core.dropdown(appearanceContent, "Events", eventOptions, 3, ApplyThemeFromDropdown)
local opacityCard, opacityValueLabel, opacityFill, opacityThumb = Core.slider(appearanceContent, "GUI Opacity", 4, 0, 100, Settings.GUI_OPACITY or 0, function(v)
    Settings.GUI_OPACITY = v
    Core.updateGuiOpacity(v)
    Core.saveSettings()
    opacityValueLabel.Text = tostring(v)
end)
_G.bindSection = Core.section(SettingsTab, "Keybind", 2)
_G.bindKeybindCard = nil
_G.getBindKey = nil
_G.setBindKey = nil

_G.bindKeybindCard, _G.getBindKey, _G.setBindKey = Core.keybindButton(_G.bindSection, "Toggle GUI", 1, Settings.CURRENT_BIND, function(newKey)
    Settings.CURRENT_BIND = newKey
    Core.saveSettings()
end)

UI.Resize = Instance.new("Frame", UI.Main)
UI.Resize.Name = "ResizeHandle"
UI.Resize.Size = UDim2.fromOffset(24, 24)
UI.Resize.Position = UDim2.new(1, -24, 1, -24)
UI.Resize.BackgroundTransparency = 1
UI.Resize.ZIndex = 10

UI.l1 = Instance.new("Frame", UI.Resize)
UI.l1.Size = UDim2.fromOffset(10, 2)
UI.l1.Position = UDim2.fromOffset(6, 14)
UI.l1.BackgroundColor3 = Colors.Interactive
UI.l1.BackgroundTransparency = 0.3
UI.l1.BorderSizePixel = 0
UI.l1.Rotation = 45
UI.l1.ZIndex = 11

UI.l2 = Instance.new("Frame", UI.Resize)
UI.l2.Size = UDim2.fromOffset(10, 2)
UI.l2.Position = UDim2.fromOffset(10, 10)
UI.l2.BackgroundColor3 = Colors.Interactive
UI.l2.BackgroundTransparency = 0.3
UI.l2.BorderSizePixel = 0
UI.l2.Rotation = 45
UI.l2.ZIndex = 11

local resizing = false
local resizeStartSize, resizeStartMouse
local MIN_WIDTH = Settings.IS_MOBILE and 280 or 450
local MAX_WIDTH = Settings.IS_MOBILE and 520 or 900
local MIN_HEIGHT = Settings.IS_MOBILE and 300 or 360
local MAX_HEIGHT = Settings.IS_MOBILE and 580 or 750

UI.Resize.InputBegan:Connect(function(input)
    if Settings.WINDOW_MINIMIZED then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        resizing = true
        resizeStartSize = UI.Main.Size
        resizeStartMouse = input.Position
    end
end)

Services.UIS.InputChanged:Connect(function(input)
    if Settings.WINDOW_MINIMIZED then return end
    if resizing and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - resizeStartMouse
        local newWidth = math.clamp(resizeStartSize.X.Offset + delta.X, MIN_WIDTH, MAX_WIDTH)
        local newHeight = math.clamp(resizeStartSize.Y.Offset + delta.Y, MIN_HEIGHT, MAX_HEIGHT)
        UI.Main.Size = UDim2.fromOffset(newWidth, newHeight)
        UI.Shadow.Size = UDim2.fromOffset(newWidth + 12, newHeight + 12)
        Settings.GUI_WIDTH = newWidth
        Settings.ORIGINAL_HEIGHT = newHeight
    end
end)

Services.UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        if resizing then
            resizing = false
            Core.saveSettings()
        end
    end
end)

local effectsContent = Core.section(Events, "Holidays", 1)
characterContent = Core.section(Character, "Movement Controls", 1)
local espContent = Core.section(Visual, "Player ESP", 1)
local espSettingsContent = Core.section(Visual, "ESP Settings", 2)
local visualContent = Core.section(Visual, "Visual Effects", 3)
local aimbotContent = Core.section(Combat, "Aimbot", 1)
local silentContent = Core.section(Combat, "Silent Aim", 2)
local hitboxContent = Core.section(Combat, "Hitbox", 3)
local texturesContent = Core.section(Screen, "Textures", 1)
local wallVisionContent = Core.section(Screen, "Wall Vision", 2)

_G.Combat.Settings = _G.Combat.Settings or {
    HitboxExpander = {
        Enabled = false,
        Size = 25,
        Transparency = 70,
        TeamCheck = true,
        ShowHitbox = true
    },
    SilentAim = {
        Enabled = false,
        ShowFOV = true,
        RainbowFOV = false,
        FOVSize = 100,
        HeadSize = 10,
        TeamCheck = true
    },
    Aimbot = {
        PCEnabled = false,
        Bind = {Type = "KeyCode", Value = Enum.KeyCode.E},
        Part = "Head",
        Mode = "Hold",
        FOV = 200,
        MobileEnabled = false,
        TeamCheck = true,
        WallCheck = false,
        ShowFOV = true,
        Speed = 100
    }
}

_G.Combat.Data = _G.Combat.Data or {
    OriginalHeadSizes = {},
    AimbotActive = false,
    CurrentTarget = nil,
    RainbowHue = 0,
    Connections = {},
    Initialized = true,
    HitboxNeedsUpdate = true
}

_G.Combat.Circles = _G.Combat.Circles or {}
_G.Combat.UI = _G.Combat.UI or {}

_G.Combat.UI.AimbotPC = Core.toggle(aimbotContent, "Aimbot (PC)", 1, false, function(state)
    _G.Combat.Settings.Aimbot.PCEnabled = state
end)
Core.registerModule("Aimbot PC", _G.Combat.UI.AimbotPC, aimbotContent, "Combat", "toggle")

local newYearCard = Core.moduleCard(effectsContent, 1)
local newYearFrame = Instance.new("Frame")
newYearFrame.Size = UDim2.fromScale(1, 1)
newYearFrame.BackgroundTransparency = 1
newYearFrame.Parent = newYearCard

local newYearText = Instance.new("TextLabel")
newYearText.Size = UDim2.fromScale(1, 1)
newYearText.BackgroundTransparency = 1
newYearText.Text = "Load New Year Edition"
newYearText.Font = Enum.Font.FredokaOne
newYearText.TextSize = Settings.IS_MOBILE and 13 or 15
newYearText.TextColor3 = Colors.TextMain
newYearText.TextXAlignment = Enum.TextXAlignment.Center
newYearText.TextYAlignment = Enum.TextYAlignment.Center
newYearText.Parent = newYearFrame

local newYearBtn = Instance.new("TextButton")
newYearBtn.Size = UDim2.fromScale(1, 1)
newYearBtn.BackgroundTransparency = 1
newYearBtn.Text = ""
newYearBtn.ZIndex = 10
newYearBtn.Parent = newYearFrame

newYearBtn.MouseEnter:Connect(function()
    Services.TweenService:Create(newYearCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.1}):Play()
end)
newYearBtn.MouseLeave:Connect(function()
    Services.TweenService:Create(newYearCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.3}):Play()
end)

newYearBtn.MouseButton1Click:Connect(function()
    Services.TweenService:Create(newYearCard, TweenInfo.new(0.1), {BackgroundColor3 = Colors.InteractiveActive}):Play()
    task.delay(0.15, function()
        Services.TweenService:Create(newYearCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card}):Play()
    end)
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/zood1k/PrismaticaX-New-Year/main/PrismatikaNewYear"))()
        task.delay(3, function()
            local gui = game:GetService("CoreGui"):FindFirstChild("PrismaticaX_Main")
                or Player:FindFirstChild("PlayerGui"):FindFirstChild("PrismaticaX_Main")
            if gui then
                gui.Enabled = true
            end
        end)
    end)
end)

Core.registerModule("Load New Year Effects", newYearCard, effectsContent, "Events", "button")

local halloweenCard = Core.moduleCard(effectsContent, 2)
local halloweenFrame = Instance.new("Frame")
halloweenFrame.Size = UDim2.fromScale(1, 1)
halloweenFrame.BackgroundTransparency = 1
halloweenFrame.Parent = halloweenCard

local halloweenText = Instance.new("TextLabel")
halloweenText.Size = UDim2.fromScale(1, 1)
halloweenText.BackgroundTransparency = 1
halloweenText.Text = "Load Halloween Edition"
halloweenText.Font = Enum.Font.FredokaOne
halloweenText.TextSize = Settings.IS_MOBILE and 13 or 15
halloweenText.TextColor3 = Colors.TextMain
halloweenText.TextXAlignment = Enum.TextXAlignment.Center
halloweenText.TextYAlignment = Enum.TextYAlignment.Center
halloweenText.Parent = halloweenFrame

local halloweenBtn = Instance.new("TextButton")
halloweenBtn.Size = UDim2.fromScale(1, 1)
halloweenBtn.BackgroundTransparency = 1
halloweenBtn.Text = ""
halloweenBtn.ZIndex = 10
halloweenBtn.Parent = halloweenFrame

halloweenBtn.MouseEnter:Connect(function()
    Services.TweenService:Create(halloweenCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.1}):Play()
end)
halloweenBtn.MouseLeave:Connect(function()
    Services.TweenService:Create(halloweenCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.3}):Play()
end)

halloweenBtn.MouseButton1Click:Connect(function()
    Services.TweenService:Create(halloweenCard, TweenInfo.new(0.1), {BackgroundColor3 = Colors.InteractiveActive}):Play()
    task.delay(0.15, function()
        Services.TweenService:Create(halloweenCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card}):Play()
    end)
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/zood1k/PrXHalloWeen/main/PrXhwEdition"))()
        task.delay(3, function()
            local gui = game:GetService("CoreGui"):FindFirstChild("PrismaticaX_Main")
                or Player:FindFirstChild("PlayerGui"):FindFirstChild("PrismaticaX_Main")
            if gui then
                gui.Enabled = true
            end
        end)
    end)
end)

Core.registerModule("Load Halloween Edition", halloweenCard, effectsContent, "Events", "button")

_G.Combat.UI.AimbotBind = Core.keybindButton(aimbotContent, "Aimbot Bind", 2, _G.Combat.Settings.Aimbot.Bind.Value, function(newBind)
    if newBind.EnumType == Enum.KeyCode then
        _G.Combat.Settings.Aimbot.Bind = {Type = "KeyCode", Value = newBind}
    else
        _G.Combat.Settings.Aimbot.Bind = {Type = "UserInputType", Value = newBind}
    end
    _G.Combat.Functions.SaveBind()
end)
Core.registerModule("Aimbot Bind", _G.Combat.UI.AimbotBind, aimbotContent, "Combat", "keybind")

_G.Combat.UI.AimbotFOV = Core.slider(aimbotContent, "FOV Size", 3, 50, 500, 200, function(v)
    _G.Combat.Settings.Aimbot.FOV = v
end)
Core.registerModule("Aimbot FOV", _G.Combat.UI.AimbotFOV, aimbotContent, "Combat", "slider")

_G.Combat.UI.AimbotSpeed = Core.slider(aimbotContent, "Aim Speed", 4, 1, 100, 100, function(v)
    _G.Combat.Settings.Aimbot.Speed = v
end)
Core.registerModule("Aim Speed", _G.Combat.UI.AimbotSpeed, aimbotContent, "Combat", "slider")

local partOptions = {
    {name = "Head"},
    {name = "HumanoidRootPart"},}
_G.Combat.UI.AimbotPart = Core.dropdown(aimbotContent, "Target Part", partOptions, 5, function(opt)
    _G.Combat.Settings.Aimbot.Part = opt.name
end)
Core.registerModule("Target Part", _G.Combat.UI.AimbotPart, aimbotContent, "Combat", "dropdown")

local modeOptions = {
    {name = "Hold"},
    {name = "Toggle"}}
_G.Combat.UI.AimbotMode = Core.dropdown(aimbotContent, "Aim Mode", modeOptions, 6, function(opt)
    _G.Combat.Settings.Aimbot.Mode = opt.name
end)
Core.registerModule("Aim Mode", _G.Combat.UI.AimbotMode, aimbotContent, "Combat", "dropdown")

_G.Combat.UI.AimbotShowFOV = Core.toggle(aimbotContent, "Show FOV Circle", 7, true, function(state)
    _G.Combat.Settings.Aimbot.ShowFOV = state
end)
Core.registerModule("Aimbot Show FOV", _G.Combat.UI.AimbotShowFOV, aimbotContent, "Combat", "toggle")

_G.Combat.UI.AimbotTeamCheck = Core.toggle(aimbotContent, "Team Check", 8, true, function(state)
    _G.Combat.Settings.Aimbot.TeamCheck = state
end)
Core.registerModule("Aimbot Team Check", _G.Combat.UI.AimbotTeamCheck, aimbotContent, "Combat", "toggle")

_G.Combat.UI.AimbotWallCheck = Core.toggle(aimbotContent, "Wall Check", 9, false, function(state)
    _G.Combat.Settings.Aimbot.WallCheck = state
end)
Core.registerModule("Wall Check", _G.Combat.UI.AimbotWallCheck, aimbotContent, "Combat", "toggle")

_G.Combat.UI.AimbotMobile = Core.toggle(aimbotContent, "Aimbot (Mobile)", 10, false, function(state)
    _G.Combat.Settings.Aimbot.MobileEnabled = state
end)
Core.registerModule("Aimbot Mobile", _G.Combat.UI.AimbotMobile, aimbotContent, "Combat", "toggle")

local dragging = false
local dragStart, startPos
local currentTween = nil

UI.Header.InputBegan:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = i.Position
        startPos = UI.Main.Position
        if currentTween then
            currentTween:Cancel()
        end
    end
end)

Services.UIS.InputChanged:Connect(function(i)
    if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then
        local delta = i.Position - dragStart
        local targetPos = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
        if currentTween then
            currentTween:Cancel()
        end
        currentTween = Services.TweenService:Create(UI.Main, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = targetPos
        })
        currentTween:Play()
        Services.TweenService:Create(UI.Shadow, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = targetPos
        }):Play()
    end
end)

Services.UIS.InputEnded:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

Services.UIS.InputBegan:Connect(function(i, gp)
    if gp then return end
    if Settings.IS_BINDING then return end
    if i.KeyCode == Settings.CURRENT_BIND then
        Settings.GUI_OPEN = not Settings.GUI_OPEN
        UI.Gui.Enabled = true
        if not Settings.GUI_OPEN then
            Settings.SEARCH_RESTORE_ON_OPEN = SEARCH_OPEN
            if SEARCH_OPEN then
                CloseSearch()
            end
        end
        local targetSize
        if Settings.GUI_OPEN then
            targetSize = UDim2.fromOffset(Settings.GUI_WIDTH, Settings.WINDOW_MINIMIZED and Settings.HEADER_HEIGHT or Settings.ORIGINAL_HEIGHT)
        else
            targetSize = UDim2.fromOffset(0, 0)
        end
        Services.TweenService:Create(UI.Main, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Size = targetSize
        }):Play()
        Services.TweenService:Create(UI.Shadow, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Size = targetSize + UDim2.fromOffset(50, 50),
            ImageTransparency = Settings.GUI_OPEN and (Settings.WINDOW_MINIMIZED and 0.7 or 0.5) or 1
        }):Play()
        if Settings.GUI_OPEN then
            if Settings.SEARCH_RESTORE_ON_OPEN then
                task.spawn(function()
                    task.wait(0.4)
                    OpenSearch()
                end)
                Settings.SEARCH_RESTORE_ON_OPEN = false
            end
        else
            task.delay(0.1, function()
                if not Settings.GUI_OPEN then
                    UI.Gui.Enabled = false
                end
            end)
        end
    end
end)

_G.RunPrismaticaIntro = function()
    _G.IntroGui = Instance.new("ScreenGui")
    _G.IntroGui.Name = "PrismaticaX_Intro"
    _G.IntroGui.IgnoreGuiInset = true
    _G.IntroGui.DisplayOrder = 2147483647
    _G.IntroGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    _G.IntroGui.ResetOnSpawn = false
    
    pcall(function() 
        _G.IntroGui.OnTopOfCoreBlur = true 
    end)
    
    _G.IntroParentSuccess = pcall(function()
        _G.IntroGui.Parent = game:GetService("CoreGui")
    end)
    
    if not _G.IntroParentSuccess or not _G.IntroGui.Parent then
        _G.IntroGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    end
    
    -- ÐŸÐ¾Ð»ÑƒÐ¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹ Ñ‡Ñ‘Ñ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ð½
    _G.IntroOverlay = Instance.new("Frame")
    _G.IntroOverlay.Name = "IntroOverlay"
    _G.IntroOverlay.Size = UDim2.fromScale(1, 1)
    _G.IntroOverlay.Position = UDim2.fromScale(0, 0)
    _G.IntroOverlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    _G.IntroOverlay.BackgroundTransparency = 0.45
    _G.IntroOverlay.BorderSizePixel = 0
    _G.IntroOverlay.ZIndex = 1
    _G.IntroOverlay.Parent = _G.IntroGui
    
    -- Ð§Ñ‘Ñ€Ð½Ð¾-Ð±ÐµÐ»Ñ‹Ð¹ Ð³Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚
    _G.IntroGradient = Instance.new("UIGradient")
    _G.IntroGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
        ColorSequenceKeypoint.new(0.3, Color3.fromRGB(20, 20, 20)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(10, 10, 10)),
        ColorSequenceKeypoint.new(0.7, Color3.fromRGB(25, 25, 25)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 0))
    })
    _G.IntroGradient.Rotation = 0
    _G.IntroGradient.Parent = _G.IntroOverlay
    
    -- ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð´Ð»Ñ speed lines (Ð¼Ð°Ð½Ð³Ð° ÑÑ„Ñ„ÐµÐºÑ‚)
    _G.IntroSpeedLinesContainer = Instance.new("Frame")
    _G.IntroSpeedLinesContainer.Name = "SpeedLinesContainer"
    _G.IntroSpeedLinesContainer.Size = UDim2.fromScale(1, 1)
    _G.IntroSpeedLinesContainer.BackgroundTransparency = 1
    _G.IntroSpeedLinesContainer.ZIndex = 2
    _G.IntroSpeedLinesContainer.ClipsDescendants = true
    _G.IntroSpeedLinesContainer.Parent = _G.IntroOverlay
    
    -- Speed lines (Ð¼Ð°Ð½Ð³Ð° ÑÑ‚Ð¸Ð»ÑŒ)
    _G.IntroSpeedLines = {}
    _G.IntroSpeedLineIndex = 1
    while _G.IntroSpeedLineIndex <= 40 do
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex] = Instance.new("Frame")
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].Name = "SpeedLine" .. _G.IntroSpeedLineIndex
        
        _G.IntroLineWidth = math.random(1, 3)
        _G.IntroLineLength = math.random(80, 250)
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].Size = UDim2.fromOffset(_G.IntroLineLength, _G.IntroLineWidth)
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].Position = UDim2.fromScale(math.random() * 1.5 - 0.25, math.random())
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].AnchorPoint = Vector2.new(0.5, 0.5)
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].BackgroundTransparency = 0.7
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].BorderSizePixel = 0
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].Rotation = math.random(-5, 5)
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].ZIndex = 2
        _G.IntroSpeedLines[_G.IntroSpeedLineIndex].Parent = _G.IntroSpeedLinesContainer
        
        _G.IntroSpeedLineIndex = _G.IntroSpeedLineIndex + 1
    end
    
    -- ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð´Ð»Ñ Ñ‡Ð°ÑÑ‚Ð¸Ñ†
    _G.IntroParticlesContainer = Instance.new("Frame")
    _G.IntroParticlesContainer.Name = "ParticlesContainer"
    _G.IntroParticlesContainer.Size = UDim2.fromScale(1, 1)
    _G.IntroParticlesContainer.BackgroundTransparency = 1
    _G.IntroParticlesContainer.ZIndex = 3
    _G.IntroParticlesContainer.ClipsDescendants = true
    _G.IntroParticlesContainer.Parent = _G.IntroOverlay
    
    -- Ð§Ð°ÑÑ‚Ð¸Ñ†Ñ‹ Ð² ÑÑ‚Ð¸Ð»Ðµ Ð¼Ð°Ð½Ð³Ð¸ (Ñ‚Ð¾Ñ‡ÐºÐ¸, Ð±Ð»Ð¸ÐºÐ¸)
    _G.IntroParticles = {}
    _G.IntroParticleIndex = 1
    while _G.IntroParticleIndex <= 25 do
        _G.IntroParticles[_G.IntroParticleIndex] = Instance.new("Frame")
        _G.IntroParticles[_G.IntroParticleIndex].Name = "Particle" .. _G.IntroParticleIndex
        
        _G.IntroParticleSize = math.random(2, 6)
        _G.IntroParticles[_G.IntroParticleIndex].Size = UDim2.fromOffset(_G.IntroParticleSize, _G.IntroParticleSize)
        _G.IntroParticles[_G.IntroParticleIndex].Position = UDim2.fromScale(math.random(), math.random())
        _G.IntroParticles[_G.IntroParticleIndex].BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        _G.IntroParticles[_G.IntroParticleIndex].BackgroundTransparency = 0.4
        _G.IntroParticles[_G.IntroParticleIndex].BorderSizePixel = 0
        _G.IntroParticles[_G.IntroParticleIndex].ZIndex = 4
        _G.IntroParticles[_G.IntroParticleIndex].Parent = _G.IntroParticlesContainer
        
        _G.IntroParticleCorner = Instance.new("UICorner")
        _G.IntroParticleCorner.CornerRadius = UDim.new(1, 0)
        _G.IntroParticleCorner.Parent = _G.IntroParticles[_G.IntroParticleIndex]
        
        _G.IntroParticleIndex = _G.IntroParticleIndex + 1
    end
    
    -- Ð’Ð¸Ð½ÑŒÐµÑ‚ÐºÐ° (Ð·Ð°Ñ‚ÐµÐ¼Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÐºÑ€Ð°ÑÐ¼)
    _G.IntroVignette = Instance.new("ImageLabel")
    _G.IntroVignette.Name = "Vignette"
    _G.IntroVignette.Size = UDim2.fromScale(1, 1)
    _G.IntroVignette.Position = UDim2.fromScale(0.5, 0.5)
    _G.IntroVignette.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroVignette.BackgroundTransparency = 1
    _G.IntroVignette.Image = "rbxassetid://6014261993"
    _G.IntroVignette.ImageColor3 = Color3.fromRGB(0, 0, 0)
    _G.IntroVignette.ImageTransparency = 0.3
    _G.IntroVignette.ScaleType = Enum.ScaleType.Slice
    _G.IntroVignette.SliceCenter = Rect.new(49, 49, 450, 450)
    _G.IntroVignette.ZIndex = 5
    _G.IntroVignette.Parent = _G.IntroOverlay
    
    -- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°
    _G.IntroContentFrame = Instance.new("Frame")
    _G.IntroContentFrame.Name = "ContentFrame"
    _G.IntroContentFrame.Size = UDim2.fromOffset(550, 180)
    _G.IntroContentFrame.Position = UDim2.fromScale(0.5, 0.42)
    _G.IntroContentFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroContentFrame.BackgroundTransparency = 1
    _G.IntroContentFrame.ZIndex = 10
    _G.IntroContentFrame.Parent = _G.IntroOverlay
    
    -- Ð›Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ (Ñ‡Ñ‘Ñ€Ð½Ð¾-Ð±ÐµÐ»Ñ‹Ð¹ ÑÑ‚Ð¸Ð»ÑŒ)
    _G.IntroLogoContainer = Instance.new("Frame")
    _G.IntroLogoContainer.Name = "LogoContainer"
    _G.IntroLogoContainer.Size = UDim2.fromOffset(0, 0)
    _G.IntroLogoContainer.Position = UDim2.fromOffset(70, 90)
    _G.IntroLogoContainer.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroLogoContainer.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    _G.IntroLogoContainer.BackgroundTransparency = 0.1
    _G.IntroLogoContainer.ZIndex = 11
    _G.IntroLogoContainer.Rotation = -3
    _G.IntroLogoContainer.Parent = _G.IntroContentFrame
    
    -- Ð“Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚ Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° (Ð¾Ñ‚ Ñ‚Ñ‘Ð¼Ð½Ð¾Ð³Ð¾ Ðº ÑÐ²ÐµÑ‚Ð»Ð¾Ð¼Ñƒ)
    _G.IntroLogoContainerGradient = Instance.new("UIGradient")
    _G.IntroLogoContainerGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 30, 30)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(50, 50, 50)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 20))
    })
    _G.IntroLogoContainerGradient.Rotation = 45
    _G.IntroLogoContainerGradient.Parent = _G.IntroLogoContainer
    
    _G.IntroLogoCorner = Instance.new("UICorner")
    _G.IntroLogoCorner.CornerRadius = UDim.new(0, 18)
    _G.IntroLogoCorner.Parent = _G.IntroLogoContainer
    
    -- Ð‘ÐµÐ»Ð°Ñ Ð¾Ð±Ð²Ð¾Ð´ÐºÐ°
    _G.IntroLogoStroke = Instance.new("UIStroke")
    _G.IntroLogoStroke.Color = Color3.fromRGB(255, 255, 255)
    _G.IntroLogoStroke.Transparency = 1
    _G.IntroLogoStroke.Thickness = 2
    _G.IntroLogoStroke.Parent = _G.IntroLogoContainer
    
    -- Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾Ð±Ð²Ð¾Ð´ÐºÐ° (Ð´Ð²Ð¾Ð¹Ð½Ð°Ñ Ñ€Ð°Ð¼ÐºÐ° ÑÑ„Ñ„ÐµÐºÑ‚)
    _G.IntroLogoInnerBorder = Instance.new("Frame")
    _G.IntroLogoInnerBorder.Name = "InnerBorder"
    _G.IntroLogoInnerBorder.Size = UDim2.fromScale(0.88, 0.88)
    _G.IntroLogoInnerBorder.Position = UDim2.fromScale(0.5, 0.5)
    _G.IntroLogoInnerBorder.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroLogoInnerBorder.BackgroundTransparency = 1
    _G.IntroLogoInnerBorder.ZIndex = 11
    _G.IntroLogoInnerBorder.Parent = _G.IntroLogoContainer
    
    _G.IntroLogoInnerBorderStroke = Instance.new("UIStroke")
    _G.IntroLogoInnerBorderStroke.Color = Color3.fromRGB(200, 200, 200)
    _G.IntroLogoInnerBorderStroke.Transparency = 1
    _G.IntroLogoInnerBorderStroke.Thickness = 1
    _G.IntroLogoInnerBorderStroke.Parent = _G.IntroLogoInnerBorder
    
    _G.IntroLogoInnerBorderCorner = Instance.new("UICorner")
    _G.IntroLogoInnerBorderCorner.CornerRadius = UDim.new(0, 14)
    _G.IntroLogoInnerBorderCorner.Parent = _G.IntroLogoInnerBorder
    
    _G.IntroLogoIcon = Instance.new("ImageLabel")
    _G.IntroLogoIcon.Name = "LogoIcon"
    _G.IntroLogoIcon.Size = UDim2.fromScale(0.65, 0.65)
    _G.IntroLogoIcon.Position = UDim2.fromScale(0.5, 0.5)
    _G.IntroLogoIcon.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroLogoIcon.BackgroundTransparency = 1
    _G.IntroLogoIcon.Image = "rbxassetid://72998769206857"
    _G.IntroLogoIcon.ImageTransparency = 1
    _G.IntroLogoIcon.ImageColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroLogoIcon.ScaleType = Enum.ScaleType.Fit
    _G.IntroLogoIcon.ZIndex = 12
    _G.IntroLogoIcon.Parent = _G.IntroLogoContainer
    
    -- Ð‘ÐµÐ»Ð¾Ðµ ÑÐ²ÐµÑ‡ÐµÐ½Ð¸Ðµ
    _G.IntroLogoGlow = Instance.new("ImageLabel")
    _G.IntroLogoGlow.Name = "LogoGlow"
    _G.IntroLogoGlow.Size = UDim2.fromScale(2, 2)
    _G.IntroLogoGlow.Position = UDim2.fromScale(0.5, 0.5)
    _G.IntroLogoGlow.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroLogoGlow.BackgroundTransparency = 1
    _G.IntroLogoGlow.Image = "rbxassetid://6014261993"
    _G.IntroLogoGlow.ImageColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroLogoGlow.ImageTransparency = 1
    _G.IntroLogoGlow.ScaleType = Enum.ScaleType.Slice
    _G.IntroLogoGlow.SliceCenter = Rect.new(49, 49, 450, 450)
    _G.IntroLogoGlow.ZIndex = 9
    _G.IntroLogoGlow.Parent = _G.IntroLogoContainer
    
    -- Ð¡ÐµÑ€Ð¾Ðµ Ð²Ð½ÐµÑˆÐ½ÐµÐµ ÑÐ²ÐµÑ‡ÐµÐ½Ð¸Ðµ
    _G.IntroLogoGlow2 = Instance.new("ImageLabel")
    _G.IntroLogoGlow2.Name = "LogoGlow2"
    _G.IntroLogoGlow2.Size = UDim2.fromScale(2.8, 2.8)
    _G.IntroLogoGlow2.Position = UDim2.fromScale(0.5, 0.5)
    _G.IntroLogoGlow2.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroLogoGlow2.BackgroundTransparency = 1
    _G.IntroLogoGlow2.Image = "rbxassetid://6014261993"
    _G.IntroLogoGlow2.ImageColor3 = Color3.fromRGB(150, 150, 150)
    _G.IntroLogoGlow2.ImageTransparency = 1
    _G.IntroLogoGlow2.ScaleType = Enum.ScaleType.Slice
    _G.IntroLogoGlow2.SliceCenter = Rect.new(49, 49, 450, 450)
    _G.IntroLogoGlow2.ZIndex = 8
    _G.IntroLogoGlow2.Parent = _G.IntroLogoContainer
    
    -- Ð¢ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€
    _G.IntroTextContainer = Instance.new("Frame")
    _G.IntroTextContainer.Name = "TextContainer"
    _G.IntroTextContainer.Size = UDim2.fromOffset(400, 180)
    _G.IntroTextContainer.Position = UDim2.fromOffset(160, 0)
    _G.IntroTextContainer.BackgroundTransparency = 1
    _G.IntroTextContainer.ZIndex = 11
    _G.IntroTextContainer.Parent = _G.IntroContentFrame
    
    -- Ð”ÐµÐºÐ¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ð»Ð¸Ð½Ð¸Ñ ÑÐ²ÐµÑ€Ñ…Ñƒ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°
    _G.IntroTitleLineTop = Instance.new("Frame")
    _G.IntroTitleLineTop.Name = "TitleLineTop"
    _G.IntroTitleLineTop.Size = UDim2.fromOffset(0, 2)
    _G.IntroTitleLineTop.Position = UDim2.fromOffset(0, 25)
    _G.IntroTitleLineTop.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroTitleLineTop.BackgroundTransparency = 1
    _G.IntroTitleLineTop.BorderSizePixel = 0
    _G.IntroTitleLineTop.ZIndex = 12
    _G.IntroTitleLineTop.Parent = _G.IntroTextContainer
    
    -- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº
    _G.IntroTitle = Instance.new("TextLabel")
    _G.IntroTitle.Name = "Title"
    _G.IntroTitle.Size = UDim2.fromOffset(0, 60)
    _G.IntroTitle.Position = UDim2.fromOffset(0, 35)
    _G.IntroTitle.BackgroundTransparency = 1
    _G.IntroTitle.Text = "PrismaticaX"
    _G.IntroTitle.Font = Enum.Font.GothamBlack
    _G.IntroTitle.TextSize = 46
    _G.IntroTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroTitle.TextTransparency = 1
    _G.IntroTitle.TextXAlignment = Enum.TextXAlignment.Left
    _G.IntroTitle.TextStrokeTransparency = 1
    _G.IntroTitle.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    _G.IntroTitle.ZIndex = 12
    _G.IntroTitle.ClipsDescendants = true
    _G.IntroTitle.Parent = _G.IntroTextContainer
    
    -- Ð§Ñ‘Ñ€Ð½Ð¾-Ð±ÐµÐ»Ñ‹Ð¹ Ð³Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚ Ð´Ð»Ñ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°
    _G.IntroTitleGradient = Instance.new("UIGradient")
    _G.IntroTitleGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(200, 200, 200)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
    })
    _G.IntroTitleGradient.Parent = _G.IntroTitle
    
    -- Ð”ÐµÐºÐ¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ð»Ð¸Ð½Ð¸Ñ ÑÐ½Ð¸Ð·Ñƒ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°
    _G.IntroTitleLineBottom = Instance.new("Frame")
    _G.IntroTitleLineBottom.Name = "TitleLineBottom"
    _G.IntroTitleLineBottom.Size = UDim2.fromOffset(0, 2)
    _G.IntroTitleLineBottom.Position = UDim2.fromOffset(0, 100)
    _G.IntroTitleLineBottom.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroTitleLineBottom.BackgroundTransparency = 1
    _G.IntroTitleLineBottom.BorderSizePixel = 0
    _G.IntroTitleLineBottom.ZIndex = 12
    _G.IntroTitleLineBottom.Parent = _G.IntroTextContainer
    
    -- ÐŸÐ¾Ð´Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº
    _G.IntroSubtitle = Instance.new("TextLabel")
    _G.IntroSubtitle.Name = "Subtitle"
    _G.IntroSubtitle.Size = UDim2.fromOffset(400, 35)
    _G.IntroSubtitle.Position = UDim2.fromOffset(0, 110)
    _G.IntroSubtitle.BackgroundTransparency = 1
    _G.IntroSubtitle.Text = "â€” THE BEST UNIVERSAL SCRIPT â€”"
    _G.IntroSubtitle.Font = Enum.Font.Gotham
    _G.IntroSubtitle.TextSize = 16
    _G.IntroSubtitle.TextColor3 = Color3.fromRGB(180, 180, 180)
    _G.IntroSubtitle.TextTransparency = 1
    _G.IntroSubtitle.TextXAlignment = Enum.TextXAlignment.Left
    _G.IntroSubtitle.ZIndex = 12
    _G.IntroSubtitle.Parent = _G.IntroTextContainer
    
    -- Ð¯Ð¿Ð¾Ð½ÑÐºÐ¸Ð¹ Ñ‚ÐµÐºÑÑ‚ (Ð´ÐµÐºÐ¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹)
    _G.IntroJapaneseText = Instance.new("TextLabel")
    _G.IntroJapaneseText.Name = "JapaneseText"
    _G.IntroJapaneseText.Size = UDim2.fromOffset(200, 30)
    _G.IntroJapaneseText.Position = UDim2.fromOffset(0, 145)
    _G.IntroJapaneseText.BackgroundTransparency = 1
    _G.IntroJapaneseText.Text = "ãƒ—ãƒªã‚ºãƒžãƒ†ã‚£ã‚«"
    _G.IntroJapaneseText.Font = Enum.Font.Gotham
    _G.IntroJapaneseText.TextSize = 14
    _G.IntroJapaneseText.TextColor3 = Color3.fromRGB(120, 120, 120)
    _G.IntroJapaneseText.TextTransparency = 1
    _G.IntroJapaneseText.TextXAlignment = Enum.TextXAlignment.Left
    _G.IntroJapaneseText.ZIndex = 12
    _G.IntroJapaneseText.Parent = _G.IntroTextContainer
    
    -- ÐÐ²Ñ‚Ð¾Ñ€
    _G.IntroAuthor = Instance.new("TextLabel")
    _G.IntroAuthor.Name = "Author"
    _G.IntroAuthor.Size = UDim2.fromOffset(300, 30)
    _G.IntroAuthor.Position = UDim2.fromScale(0.5, 0.88)
    _G.IntroAuthor.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroAuthor.BackgroundTransparency = 1
    _G.IntroAuthor.Text = "[ @zood3llotgk ]"
    _G.IntroAuthor.Font = Enum.Font.Gotham
    _G.IntroAuthor.TextSize = 14
    _G.IntroAuthor.TextColor3 = Color3.fromRGB(150, 150, 150)
    _G.IntroAuthor.TextTransparency = 1
    _G.IntroAuthor.ZIndex = 12
    _G.IntroAuthor.Parent = _G.IntroOverlay
    
    -- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ Ð±Ð°Ñ€
    _G.IntroLoadingBar = Instance.new("Frame")
    _G.IntroLoadingBar.Name = "LoadingBar"
    _G.IntroLoadingBar.Size = UDim2.fromOffset(300, 3)
    _G.IntroLoadingBar.Position = UDim2.fromScale(0.5, 0.72)
    _G.IntroLoadingBar.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroLoadingBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    _G.IntroLoadingBar.BackgroundTransparency = 1
    _G.IntroLoadingBar.BorderSizePixel = 0
    _G.IntroLoadingBar.ZIndex = 11
    _G.IntroLoadingBar.Parent = _G.IntroOverlay
    
    _G.IntroLoadingBarCorner = Instance.new("UICorner")
    _G.IntroLoadingBarCorner.CornerRadius = UDim.new(1, 0)
    _G.IntroLoadingBarCorner.Parent = _G.IntroLoadingBar
    
    _G.IntroLoadingFill = Instance.new("Frame")
    _G.IntroLoadingFill.Name = "LoadingFill"
    _G.IntroLoadingFill.Size = UDim2.fromScale(0, 1)
    _G.IntroLoadingFill.Position = UDim2.fromScale(0, 0)
    _G.IntroLoadingFill.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroLoadingFill.BackgroundTransparency = 0
    _G.IntroLoadingFill.BorderSizePixel = 0
    _G.IntroLoadingFill.ZIndex = 12
    _G.IntroLoadingFill.Parent = _G.IntroLoadingBar
    
    _G.IntroLoadingFillCorner = Instance.new("UICorner")
    _G.IntroLoadingFillCorner.CornerRadius = UDim.new(1, 0)
    _G.IntroLoadingFillCorner.Parent = _G.IntroLoadingFill
    
    -- Ð“Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ Ð±Ð°Ñ€Ð°
    _G.IntroLoadingFillGradient = Instance.new("UIGradient")
    _G.IntroLoadingFillGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(180, 180, 180)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
    })
    _G.IntroLoadingFillGradient.Parent = _G.IntroLoadingFill
    
    -- Ð¢ÐµÐºÑÑ‚ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸
    _G.IntroLoadingText = Instance.new("TextLabel")
    _G.IntroLoadingText.Name = "LoadingText"
    _G.IntroLoadingText.Size = UDim2.fromOffset(200, 25)
    _G.IntroLoadingText.Position = UDim2.fromScale(0.5, 0.77)
    _G.IntroLoadingText.AnchorPoint = Vector2.new(0.5, 0.5)
    _G.IntroLoadingText.BackgroundTransparency = 1
    _G.IntroLoadingText.Text = "LOADING..."
    _G.IntroLoadingText.Font = Enum.Font.Gotham
    _G.IntroLoadingText.TextSize = 12
    _G.IntroLoadingText.TextColor3 = Color3.fromRGB(120, 120, 120)
    _G.IntroLoadingText.TextTransparency = 1
    _G.IntroLoadingText.ZIndex = 12
    _G.IntroLoadingText.Parent = _G.IntroOverlay
    
    -- Ð£Ð³Ð»Ð¾Ð²Ñ‹Ðµ Ð´ÐµÐºÐ¾Ñ€Ð°Ñ†Ð¸Ð¸ (Ð¼Ð°Ð½Ð³Ð° ÑÑ‚Ð¸Ð»ÑŒ)
    _G.IntroCornerTL = Instance.new("Frame")
    _G.IntroCornerTL.Name = "CornerTL"
    _G.IntroCornerTL.Size = UDim2.fromOffset(60, 60)
    _G.IntroCornerTL.Position = UDim2.fromScale(0.03, 0.05)
    _G.IntroCornerTL.BackgroundTransparency = 1
    _G.IntroCornerTL.ZIndex = 6
    _G.IntroCornerTL.Parent = _G.IntroOverlay
    
    _G.IntroCornerTL_H = Instance.new("Frame")
    _G.IntroCornerTL_H.Size = UDim2.fromOffset(40, 2)
    _G.IntroCornerTL_H.Position = UDim2.fromOffset(0, 0)
    _G.IntroCornerTL_H.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroCornerTL_H.BackgroundTransparency = 0.5
    _G.IntroCornerTL_H.BorderSizePixel = 0
    _G.IntroCornerTL_H.Parent = _G.IntroCornerTL
    
    _G.IntroCornerTL_V = Instance.new("Frame")
    _G.IntroCornerTL_V.Size = UDim2.fromOffset(2, 40)
    _G.IntroCornerTL_V.Position = UDim2.fromOffset(0, 0)
    _G.IntroCornerTL_V.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroCornerTL_V.BackgroundTransparency = 0.5
    _G.IntroCornerTL_V.BorderSizePixel = 0
    _G.IntroCornerTL_V.Parent = _G.IntroCornerTL
    
    _G.IntroCornerTR = Instance.new("Frame")
    _G.IntroCornerTR.Name = "CornerTR"
    _G.IntroCornerTR.Size = UDim2.fromOffset(60, 60)
    _G.IntroCornerTR.Position = UDim2.fromScale(0.97, 0.05)
    _G.IntroCornerTR.AnchorPoint = Vector2.new(1, 0)
    _G.IntroCornerTR.BackgroundTransparency = 1
    _G.IntroCornerTR.ZIndex = 6
    _G.IntroCornerTR.Parent = _G.IntroOverlay
    
    _G.IntroCornerTR_H = Instance.new("Frame")
    _G.IntroCornerTR_H.Size = UDim2.fromOffset(40, 2)
    _G.IntroCornerTR_H.Position = UDim2.fromOffset(20, 0)
    _G.IntroCornerTR_H.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroCornerTR_H.BackgroundTransparency = 0.5
    _G.IntroCornerTR_H.BorderSizePixel = 0
    _G.IntroCornerTR_H.Parent = _G.IntroCornerTR
    
    _G.IntroCornerTR_V = Instance.new("Frame")
    _G.IntroCornerTR_V.Size = UDim2.fromOffset(2, 40)
    _G.IntroCornerTR_V.Position = UDim2.fromOffset(58, 0)
    _G.IntroCornerTR_V.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroCornerTR_V.BackgroundTransparency = 0.5
    _G.IntroCornerTR_V.BorderSizePixel = 0
    _G.IntroCornerTR_V.Parent = _G.IntroCornerTR
    
    _G.IntroCornerBL = Instance.new("Frame")
    _G.IntroCornerBL.Name = "CornerBL"
    _G.IntroCornerBL.Size = UDim2.fromOffset(60, 60)
    _G.IntroCornerBL.Position = UDim2.fromScale(0.03, 0.95)
    _G.IntroCornerBL.AnchorPoint = Vector2.new(0, 1)
    _G.IntroCornerBL.BackgroundTransparency = 1
    _G.IntroCornerBL.ZIndex = 6
    _G.IntroCornerBL.Parent = _G.IntroOverlay
    
    _G.IntroCornerBL_H = Instance.new("Frame")
    _G.IntroCornerBL_H.Size = UDim2.fromOffset(40, 2)
    _G.IntroCornerBL_H.Position = UDim2.fromOffset(0, 58)
    _G.IntroCornerBL_H.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroCornerBL_H.BackgroundTransparency = 0.5
    _G.IntroCornerBL_H.BorderSizePixel = 0
    _G.IntroCornerBL_H.Parent = _G.IntroCornerBL
    
    _G.IntroCornerBL_V = Instance.new("Frame")
    _G.IntroCornerBL_V.Size = UDim2.fromOffset(2, 40)
    _G.IntroCornerBL_V.Position = UDim2.fromOffset(0, 20)
    _G.IntroCornerBL_V.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroCornerBL_V.BackgroundTransparency = 0.5
    _G.IntroCornerBL_V.BorderSizePixel = 0
    _G.IntroCornerBL_V.Parent = _G.IntroCornerBL
    
    _G.IntroCornerBR = Instance.new("Frame")
    _G.IntroCornerBR.Name = "CornerBR"
    _G.IntroCornerBR.Size = UDim2.fromOffset(60, 60)
    _G.IntroCornerBR.Position = UDim2.fromScale(0.97, 0.95)
    _G.IntroCornerBR.AnchorPoint = Vector2.new(1, 1)
    _G.IntroCornerBR.BackgroundTransparency = 1
    _G.IntroCornerBR.ZIndex = 6
    _G.IntroCornerBR.Parent = _G.IntroOverlay
    
    _G.IntroCornerBR_H = Instance.new("Frame")
    _G.IntroCornerBR_H.Size = UDim2.fromOffset(40, 2)
    _G.IntroCornerBR_H.Position = UDim2.fromOffset(20, 58)
    _G.IntroCornerBR_H.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroCornerBR_H.BackgroundTransparency = 0.5
    _G.IntroCornerBR_H.BorderSizePixel = 0
    _G.IntroCornerBR_H.Parent = _G.IntroCornerBR
    
    _G.IntroCornerBR_V = Instance.new("Frame")
    _G.IntroCornerBR_V.Size = UDim2.fromOffset(2, 40)
    _G.IntroCornerBR_V.Position = UDim2.fromOffset(58, 20)
    _G.IntroCornerBR_V.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    _G.IntroCornerBR_V.BackgroundTransparency = 0.5
    _G.IntroCornerBR_V.BorderSizePixel = 0
    _G.IntroCornerBR_V.Parent = _G.IntroCornerBR
    
    -- Ð“Ð»Ð¸Ñ‚Ñ‡ Ð»Ð¸Ð½Ð¸Ð¸ (ÑÐºÐ°Ð½Ð»Ð°Ð¹Ð½Ñ‹)
    _G.IntroScanlines = Instance.new("Frame")
    _G.IntroScanlines.Name = "Scanlines"
    _G.IntroScanlines.Size = UDim2.fromScale(1, 1)
    _G.IntroScanlines.BackgroundTransparency = 1
    _G.IntroScanlines.ZIndex = 20
    _G.IntroScanlines.Parent = _G.IntroOverlay
    
    _G.IntroScanlinesArray = {}
    _G.IntroScanlineIndex = 1
    while _G.IntroScanlineIndex <= 8 do
        _G.IntroScanlinesArray[_G.IntroScanlineIndex] = Instance.new("Frame")
        _G.IntroScanlinesArray[_G.IntroScanlineIndex].Size = UDim2.new(1, 0, 0, 1)
        _G.IntroScanlinesArray[_G.IntroScanlineIndex].Position = UDim2.fromScale(0, math.random())
        _G.IntroScanlinesArray[_G.IntroScanlineIndex].BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        _G.IntroScanlinesArray[_G.IntroScanlineIndex].BackgroundTransparency = 0.95
        _G.IntroScanlinesArray[_G.IntroScanlineIndex].BorderSizePixel = 0
        _G.IntroScanlinesArray[_G.IntroScanlineIndex].ZIndex = 21
        _G.IntroScanlinesArray[_G.IntroScanlineIndex].Parent = _G.IntroScanlines
        _G.IntroScanlineIndex = _G.IntroScanlineIndex + 1
    end
    
    task.spawn(function()
        _G.IntroAssets = {UI.Shadow.Image, UI.LogoIcon.Image}
        Services.ContentProvider:PreloadAsync(_G.IntroAssets)
    end)
    
    -- Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸
    _G.IntroGradientRotation = 0
    _G.IntroGlowPulse = 0
    _G.IntroFlicker = 0
    _G.IntroParticleData = {}
    _G.IntroSpeedLineData = {}
    
    -- Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ñ‡Ð°ÑÑ‚Ð¸Ñ†
    _G.IntroParticleInitIndex = 1
    while _G.IntroParticleInitIndex <= 25 do
        _G.IntroParticleData[_G.IntroParticleInitIndex] = {
            speedX = (math.random() - 0.5) * 0.08,
            speedY = (math.random() - 0.5) * 0.08,
            startX = math.random(),
            startY = math.random(),
            flickerSpeed = math.random() * 3 + 2
        }
        _G.IntroParticleInitIndex = _G.IntroParticleInitIndex + 1
    end
    
    -- Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ speed lines
    _G.IntroSpeedLineInitIndex = 1
    while _G.IntroSpeedLineInitIndex <= 40 do
        _G.IntroSpeedLineData[_G.IntroSpeedLineInitIndex] = {
            speed = math.random() * 0.3 + 0.2,
            startX = math.random() * 1.5 - 0.25,
            flickerOffset = math.random() * 10
        }
        _G.IntroSpeedLineInitIndex = _G.IntroSpeedLineInitIndex + 1
    end
    
    -- ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ð¿Ð¾ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð°
    Services.TweenService:Create(_G.IntroLogoContainer, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(120, 120),
        Rotation = 0
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoStroke, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Transparency = 0.3
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoInnerBorderStroke, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Transparency = 0.5
    }):Play()
    
    task.wait(0.12)
    
    Services.TweenService:Create(_G.IntroLogoIcon, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        ImageTransparency = 0
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoGlow, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        ImageTransparency = 0.6
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoGlow2, TweenInfo.new(0.6, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        ImageTransparency = 0.75
    }):Play()
    
    task.wait(0.1)
    
    -- ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð½Ð¸Ð¹ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°
    Services.TweenService:Create(_G.IntroTitleLineTop, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(280, 2),
        BackgroundTransparency = 0.4
    }):Play()
    
    task.wait(0.08)
    
    -- ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°
    Services.TweenService:Create(_G.IntroTitle, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(360, 60),
        TextTransparency = 0,
        TextStrokeTransparency = 0.7
    }):Play()
    
    task.wait(0.08)
    
    Services.TweenService:Create(_G.IntroTitleLineBottom, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(280, 2),
        BackgroundTransparency = 0.4
    }):Play()
    
    task.wait(0.08)
    
    Services.TweenService:Create(_G.IntroSubtitle, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 0.2
    }):Play()
    
    task.wait(0.06)
    
    Services.TweenService:Create(_G.IntroJapaneseText, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 0.4
    }):Play()
    
    Services.TweenService:Create(_G.IntroAuthor, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 0.4
    }):Play()
    
    Services.TweenService:Create(_G.IntroLoadingBar, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.6
    }):Play()
    
    Services.TweenService:Create(_G.IntroLoadingText, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 0.4
    }):Play()
    
    -- Ð£Ð³Ð»Ð¾Ð²Ñ‹Ðµ Ð´ÐµÐºÐ¾Ñ€Ð°Ñ†Ð¸Ð¸
    Services.TweenService:Create(_G.IntroCornerTL_H, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.3
    }):Play()
    Services.TweenService:Create(_G.IntroCornerTL_V, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.3
    }):Play()
    Services.TweenService:Create(_G.IntroCornerTR_H, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.3
    }):Play()
    Services.TweenService:Create(_G.IntroCornerTR_V, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.3
    }):Play()
    Services.TweenService:Create(_G.IntroCornerBL_H, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.3
    }):Play()
    Services.TweenService:Create(_G.IntroCornerBL_V, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.3
    }):Play()
    Services.TweenService:Create(_G.IntroCornerBR_H, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.3
    }):Play()
    Services.TweenService:Create(_G.IntroCornerBR_V, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.3
    }):Play()
    
    task.wait(0.06)
    
    -- Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ Ð±Ð°Ñ€Ð°
    Services.TweenService:Create(_G.IntroLoadingFill, TweenInfo.new(2.0, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {
        Size = UDim2.fromScale(1, 1)
    }):Play()
    
    -- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ†Ð¸ÐºÐ» Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸
    _G.IntroAnimationConnection = Services.RunService.RenderStepped:Connect(function(dt)
        if not _G.IntroGui or not _G.IntroGui.Parent then
            if _G.IntroAnimationConnection then
                _G.IntroAnimationConnection:Disconnect()
            end
            return
        end
        
        _G.IntroGradientRotation = _G.IntroGradientRotation + dt * 15
        _G.IntroGlowPulse = _G.IntroGlowPulse + dt * 3
        _G.IntroFlicker = _G.IntroFlicker + dt
        
        if _G.IntroGradient and _G.IntroGradient.Parent then
            _G.IntroGradient.Rotation = _G.IntroGradientRotation
        end
        
        -- ÐŸÑƒÐ»ÑŒÑÐ°Ñ†Ð¸Ñ ÑÐ²ÐµÑ‡ÐµÐ½Ð¸Ð¹
        if _G.IntroLogoGlow and _G.IntroLogoGlow.Parent then
            _G.IntroLogoGlow.ImageTransparency = 0.55 + math.sin(_G.IntroGlowPulse) * 0.15
            _G.IntroLogoGlow.Size = UDim2.fromScale(2 + math.sin(_G.IntroGlowPulse * 0.8) * 0.15, 2 + math.sin(_G.IntroGlowPulse * 0.8) * 0.15)
        end
        
        if _G.IntroLogoGlow2 and _G.IntroLogoGlow2.Parent then
            _G.IntroLogoGlow2.ImageTransparency = 0.7 + math.sin(_G.IntroGlowPulse * 0.7) * 0.1
            _G.IntroLogoGlow2.Rotation = _G.IntroGlowPulse * 5
        end
        
        if _G.IntroLogoContainer and _G.IntroLogoContainer.Parent then
            _G.IntroLogoContainer.Rotation = math.sin(_G.IntroGlowPulse * 0.5) * 2
        end
        
        if _G.IntroLogoIcon and _G.IntroLogoIcon.Parent then
            _G.IntroLogoIcon.Rotation = math.sin(_G.IntroGlowPulse * 0.3) * 3
        end
        
        -- ÐœÐµÑ€Ñ†Ð°Ð½Ð¸Ðµ Ð¾Ð±Ð²Ð¾Ð´ÐºÐ¸
        if _G.IntroLogoStroke and _G.IntroLogoStroke.Parent then
            _G.IntroLogoStroke.Transparency = 0.3 + math.sin(_G.IntroGlowPulse * 4) * 0.15
        end
        
        -- Ð“Ñ€Ð°Ð´Ð¸ÐµÐ½Ñ‚ Ñ‚ÐµÐºÑÑ‚Ð°
        if _G.IntroTitleGradient and _G.IntroTitleGradient.Parent then
            _G.IntroTitleGradient.Offset = Vector2.new((math.sin(_G.IntroGlowPulse * 0.8) + 1) / 2 * 0.3 - 0.15, 0)
        end
        
        if _G.IntroLoadingFillGradient and _G.IntroLoadingFillGradient.Parent then
            _G.IntroLoadingFillGradient.Offset = Vector2.new((math.sin(_G.IntroGlowPulse * 1.5) + 1) / 2 * 0.4 - 0.2, 0)
        end
        
        -- ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ñ‡Ð°ÑÑ‚Ð¸Ñ†
        _G.IntroParticleAnimIndex = 1
        while _G.IntroParticleAnimIndex <= 25 do
            if _G.IntroParticles[_G.IntroParticleAnimIndex] and _G.IntroParticles[_G.IntroParticleAnimIndex].Parent then
                _G.IntroParticleCurrentData = _G.IntroParticleData[_G.IntroParticleAnimIndex]
                
                _G.IntroParticleNewX = _G.IntroParticleCurrentData.startX + math.sin(_G.IntroGlowPulse * 0.5 + _G.IntroParticleAnimIndex) * 0.03
                _G.IntroParticleNewY = (_G.IntroParticleCurrentData.startY + _G.IntroFlicker * _G.IntroParticleCurrentData.speedY) % 1
                
                _G.IntroParticles[_G.IntroParticleAnimIndex].Position = UDim2.fromScale(_G.IntroParticleNewX, _G.IntroParticleNewY)
                _G.IntroParticles[_G.IntroParticleAnimIndex].BackgroundTransparency = 0.3 + math.sin(_G.IntroFlicker * _G.IntroParticleCurrentData.flickerSpeed + _G.IntroParticleAnimIndex) * 0.3
            end
            _G.IntroParticleAnimIndex = _G.IntroParticleAnimIndex + 1
        end
        
        -- ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ speed lines
        _G.IntroSpeedLineAnimIndex = 1
        while _G.IntroSpeedLineAnimIndex <= 40 do
            if _G.IntroSpeedLines[_G.IntroSpeedLineAnimIndex] and _G.IntroSpeedLines[_G.IntroSpeedLineAnimIndex].Parent then
                _G.IntroSpeedLineCurrentData = _G.IntroSpeedLineData[_G.IntroSpeedLineAnimIndex]
                
                _G.IntroSpeedLineNewX = (_G.IntroSpeedLineCurrentData.startX - _G.IntroFlicker * _G.IntroSpeedLineCurrentData.speed) % 1.5 - 0.25
                
                _G.IntroSpeedLines[_G.IntroSpeedLineAnimIndex].Position = UDim2.fromScale(_G.IntroSpeedLineNewX, _G.IntroSpeedLines[_G.IntroSpeedLineAnimIndex].Position.Y.Scale)
                _G.IntroSpeedLines[_G.IntroSpeedLineAnimIndex].BackgroundTransparency = 0.6 + math.sin(_G.IntroFlicker * 3 + _G.IntroSpeedLineCurrentData.flickerOffset) * 0.25
            end
            _G.IntroSpeedLineAnimIndex = _G.IntroSpeedLineAnimIndex + 1
        end
        
        -- ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ ÑÐºÐ°Ð½Ð»Ð°Ð¹Ð½Ð¾Ð²
        _G.IntroScanlineAnimIndex = 1
        while _G.IntroScanlineAnimIndex <= 8 do
            if _G.IntroScanlinesArray[_G.IntroScanlineAnimIndex] and _G.IntroScanlinesArray[_G.IntroScanlineAnimIndex].Parent then
                _G.IntroScanlinesArray[_G.IntroScanlineAnimIndex].Position = UDim2.fromScale(0, (_G.IntroScanlinesArray[_G.IntroScanlineAnimIndex].Position.Y.Scale + dt * 0.3) % 1)
                _G.IntroScanlinesArray[_G.IntroScanlineAnimIndex].BackgroundTransparency = 0.9 + math.sin(_G.IntroFlicker * 10 + _G.IntroScanlineAnimIndex) * 0.05
            end
            _G.IntroScanlineAnimIndex = _G.IntroScanlineAnimIndex + 1
        end
        
        -- ÐœÐµÑ€Ñ†Ð°Ð½Ð¸Ðµ Ð²Ð¸Ð½ÑŒÐµÑ‚ÐºÐ¸
        if _G.IntroVignette and _G.IntroVignette.Parent then
            _G.IntroVignette.ImageTransparency = 0.25 + math.sin(_G.IntroGlowPulse * 0.5) * 0.1
        end
    end)
    
    task.wait(2.3)
    
    -- ÐžÑ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸
    if _G.IntroAnimationConnection then
        _G.IntroAnimationConnection:Disconnect()
        _G.IntroAnimationConnection = nil
    end
    
    -- ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ð¸ÑÑ‡ÐµÐ·Ð½Ð¾Ð²ÐµÐ½Ð¸Ñ
    Services.TweenService:Create(_G.IntroLogoContainer, TweenInfo.new(0.45, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
        Size = UDim2.fromOffset(0, 0),
        BackgroundTransparency = 1,
        Rotation = 15
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoIcon, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        ImageTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoGlow, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        ImageTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoGlow2, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        ImageTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoStroke, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Transparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroLogoInnerBorderStroke, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Transparency = 1
    }):Play()
    
    task.wait(0.05)
    
    Services.TweenService:Create(_G.IntroTitleLineTop, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(0, 2),
        BackgroundTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroTitle, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 1,
        TextStrokeTransparency = 1,
        Position = UDim2.fromOffset(-30, 35)
    }):Play()
    
    task.wait(0.04)
    
    Services.TweenService:Create(_G.IntroTitleLineBottom, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Size = UDim2.fromOffset(0, 2),
        BackgroundTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroSubtitle, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 1,
        Position = UDim2.fromOffset(-30, 110)
    }):Play()
    
    Services.TweenService:Create(_G.IntroJapaneseText, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroLoadingBar, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroLoadingFill, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroLoadingText, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroAuthor, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        TextTransparency = 1
    }):Play()
    
    -- Ð˜ÑÑ‡ÐµÐ·Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ ÑƒÐ³Ð»Ð¾Ð²
    Services.TweenService:Create(_G.IntroCornerTL_H, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    Services.TweenService:Create(_G.IntroCornerTL_V, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    Services.TweenService:Create(_G.IntroCornerTR_H, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    Services.TweenService:Create(_G.IntroCornerTR_V, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    Services.TweenService:Create(_G.IntroCornerBL_H, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    Services.TweenService:Create(_G.IntroCornerBL_V, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    Services.TweenService:Create(_G.IntroCornerBR_H, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    Services.TweenService:Create(_G.IntroCornerBR_V, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    
    -- Ð˜ÑÑ‡ÐµÐ·Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ Ñ‡Ð°ÑÑ‚Ð¸Ñ†
    _G.IntroParticleFadeIndex = 1
    while _G.IntroParticleFadeIndex <= 25 do
        if _G.IntroParticles[_G.IntroParticleFadeIndex] and _G.IntroParticles[_G.IntroParticleFadeIndex].Parent then
            Services.TweenService:Create(_G.IntroParticles[_G.IntroParticleFadeIndex], TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundTransparency = 1
            }):Play()
        end
        _G.IntroParticleFadeIndex = _G.IntroParticleFadeIndex + 1
    end
    
    -- Ð˜ÑÑ‡ÐµÐ·Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ speed lines
    _G.IntroSpeedLineFadeIndex = 1
    while _G.IntroSpeedLineFadeIndex <= 40 do
        if _G.IntroSpeedLines[_G.IntroSpeedLineFadeIndex] and _G.IntroSpeedLines[_G.IntroSpeedLineFadeIndex].Parent then
            Services.TweenService:Create(_G.IntroSpeedLines[_G.IntroSpeedLineFadeIndex], TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundTransparency = 1
            }):Play()
        end
        _G.IntroSpeedLineFadeIndex = _G.IntroSpeedLineFadeIndex + 1
    end
    
    Services.TweenService:Create(_G.IntroVignette, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        ImageTransparency = 1
    }):Play()
    
    Services.TweenService:Create(_G.IntroOverlay, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        BackgroundTransparency = 1
    }):Play()
    
    task.wait(0.55)
    
    if _G.IntroGui and _G.IntroGui.Parent then
        _G.IntroGui:Destroy()
        _G.IntroGui = nil
    end
end

_G.RunPrismaticaIntro()
task.wait(0.2)

local savedSettings = Core.loadSettings()
if savedSettings then
    if savedSettings.guiWidth then Settings.GUI_WIDTH = savedSettings.guiWidth end
    if savedSettings.guiHeight then Settings.ORIGINAL_HEIGHT = savedSettings.guiHeight end
    if savedSettings.guiOpacity then
        Settings.GUI_OPACITY = math.clamp(savedSettings.guiOpacity, 0, 100)
        local relative = Settings.GUI_OPACITY / 100
        opacityFill.Size = UDim2.new(relative, 0, 1, 0)
        opacityThumb.Position = UDim2.new(relative, 0, 0.5, 0)
        opacityValueLabel.Text = tostring(Settings.GUI_OPACITY)
        Core.updateGuiOpacity(Settings.GUI_OPACITY)
    end
    if savedSettings.keybind then
        local keycode = Enum.KeyCode[savedSettings.keybind]
        if keycode then
            Settings.CURRENT_BIND = keycode
            if setBindKey then setBindKey(keycode) end
        end
    end
    if savedSettings.theme then
        Settings.CURRENT_THEME = savedSettings.theme
        for _, theme in ipairs(Themes) do
            if theme.name == savedSettings.theme then
                Core.applyTheme(theme.colors)
                break
            end
        end
    end
    if UI.Sidebar and UI.Sidebar:IsA("ScrollingFrame") then
        UI.Sidebar.ScrollBarImageColor3 = Colors.Interactive
    end
    for _, page in pairs(Data.Pages) do
        if page:IsA("ScrollingFrame") then
            page.ScrollBarImageColor3 = Colors.Interactive
        end
    end
    UI.Main.Size = UDim2.fromOffset(Settings.GUI_WIDTH, Settings.ORIGINAL_HEIGHT)
    UI.Shadow.Size = UDim2.fromOffset(Settings.GUI_WIDTH + 50, Settings.ORIGINAL_HEIGHT + 50)
end

local startTime = os.time()
task.spawn(function()
    while UI.Gui.Parent do
        local elapsed = os.time() - startTime
        local hours = math.floor(elapsed / 3600)
        local mins = math.floor((elapsed % 3600) / 60)
        local secs = elapsed % 60
        if UI.TimeLabel then
            UI.TimeLabel.Text = string.format("%02d:%02d:%02d", hours, mins, secs)
        end
        task.wait(1)
    end
end)

UI.Main.Visible = true
UI.Shadow.Visible = true
UI.Main.Size = UDim2.fromOffset(0, 0)
UI.Shadow.Size = UDim2.fromOffset(12, 12)
UI.Shadow.ImageTransparency = 1
UI.Main.BackgroundTransparency = Settings.GUI_OPACITY / 100

Services.TweenService:Create(UI.Main, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
    Size = UDim2.fromOffset(Settings.GUI_WIDTH, Settings.ORIGINAL_HEIGHT)
}):Play()
Services.TweenService:Create(UI.Shadow, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
    Size = UDim2.fromOffset(Settings.GUI_WIDTH + 12, Settings.ORIGINAL_HEIGHT + 12),
    ImageTransparency = 0.75
}):Play()

local function ForceWhiteHeader()
    for _, child in ipairs(characterContent:GetDescendants()) do
        if child:IsA("TextLabel") and (child.Text == "Movement Controls" or child.Name == "SectionTitle" or child.Name == "Header") then
            child.TextColor3 = Color3.fromRGB(255, 255, 255)
        end
    end
end

ForceWhiteHeader()

for _, child in ipairs(characterContent:GetDescendants()) do
    if child:IsA("TextLabel") and (child.Text == "Movement Controls" or child.Name == "SectionTitle" or child.Name == "Header") then
        child.TextColor3 = Color3.fromRGB(255, 255, 255)
        child:GetPropertyChangedSignal("TextColor3"):Connect(function()
            if child.TextColor3 ~= Color3.fromRGB(255, 255, 255) then
                child.TextColor3 = Color3.fromRGB(255, 255, 255)
            end
        end)
    end
end

local SpeedEnabled = false
local SpeedValue = 16
local JumpEnabled = false
local JumpValue = 50
local InfiniteJumpEnabled = false
local NoclipEnabled = false
local FlyEnabled = false
local FlySpeed = 50
local BunnyhopEnabled = false
local BunnyhopPower = 50
local SpinbotEnabled = false
local SpinbotSpeed = 5
local MovementConns = {}
local FlyBodyGyro = nil
local FlyBodyVelocity = nil

function ClearMoveConn(name)
    if MovementConns[name] then
        MovementConns[name]:Disconnect()
        MovementConns[name] = nil
    end
end

function GetChar()
    return Player.Character
end

function GetHum()
    local char = Player.Character
    if char then
        return char:FindFirstChildOfClass("Humanoid")
    end
    return nil
end

function GetRoot()
    local char = Player.Character
    if char then
        return char:FindFirstChild("HumanoidRootPart") or char.PrimaryPart
    end
    return nil
end

_G.originalWalkSpeed = 16

task.spawn(function()
    local char = GetChar()
    if char then
        local h = char:FindFirstChildOfClass("Humanoid")
        if h then
            _G.originalWalkSpeed = h.WalkSpeed
        end
    end
end)

Player.CharacterAdded:Connect(function(newChar)
    task.wait(0.5)
    local h = newChar:FindFirstChildOfClass("Humanoid")
    if h then
        _G.originalWalkSpeed = h.WalkSpeed
        if SpeedEnabled then
            h.WalkSpeed = SpeedValue
        else
            h.WalkSpeed = _G.originalWalkSpeed
        end
    end
end)

_G.SpeedBypassEnabled = false
_G.TargetSpeed = 100
_G.CurrentVelocity = Vector3.new(0, 0, 0)
_G.Acceleration = 85
_G.Deceleration = 130

-- ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ (Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ)
local speedConn = nil

local function SpeedUpdate(dt)
    if not _G.SpeedBypassEnabled then return end

    local char = Player.Character
    if not char then return end

    local humanoid = char:FindFirstChildOfClass("Humanoid")
    local root = char:FindFirstChild("HumanoidRootPart")
    if not humanoid or not root then return end

    local moveDir = humanoid.MoveDirection
    local targetVel = moveDir.Magnitude > 0 and (moveDir.Unit * _G.TargetSpeed) or Vector3.zero

    local accel = targetVel.Magnitude > 0 and _G.Acceleration or _G.Deceleration
    _G.CurrentVelocity = _G.CurrentVelocity:Lerp(targetVel, accel * dt)

    if _G.CurrentVelocity.Magnitude > 0.01 then
        root.CFrame += _G.CurrentVelocity * dt
    end
end

local function StartSpeed()
    if speedConn then return end
    _G.CurrentVelocity = Vector3.zero
    speedConn = game:GetService("RunService").Heartbeat:Connect(SpeedUpdate)
end

local function StopSpeed()
    if speedConn then
        speedConn:Disconnect()
        speedConn = nil
    end
    _G.CurrentVelocity = Vector3.zero
end

local speedToggle = Core.toggle(
    characterContent,
    "Speed Bypass",
    1,
    false,
    function(state)
        _G.SpeedBypassEnabled = state
        if state then StartSpeed() else StopSpeed() end
    end
)

local speedSliderCard, speedValueLabel, speedFill, speedThumb = Core.slider(
    characterContent,
    "Speed Value",
    2,
    1,
    100,
    1,
    function(v)
        _G.TargetSpeed = v
        if speedValueLabel then
            speedValueLabel.Text = tostring(v)
        end
    end
)

_G.TargetSpeed = 1
if speedValueLabel then
    speedValueLabel.Text = "1"
end
if speedFill then
    speedFill.Size = UDim2.new(0, 0, 1, 0)
end
if speedThumb then
    speedThumb.Position = UDim2.new(0, 0, 0.5, 0)
end

Core.registerModule("Speed Bypass", speedToggle, characterContent, "Character", "toggle")
Core.registerModule("Speed Value", speedSliderCard, characterContent, "Character", "slider")

-- Ð ÐµÑÐ¿Ð°Ð²Ð½
Player.CharacterAdded:Connect(function()
    task.wait(0.8)
    if _G.SpeedBypassEnabled and speedConn == nil then
        StartSpeed()
    end
end)

local jumpCard, getJumpState, setJumpState = Core.toggle(characterContent, "Jump Power", 3, false, function(state)
    JumpEnabled = state
    CharacterModules.Jump.enabled = state
    CharacterModules.Jump.disableFunc = function()
        JumpEnabled = false
        local h = GetHum()
        if h then
            h.UseJumpPower = true
            h.JumpPower = 50
        end
    end
    local h = GetHum()
    if h then
        h.UseJumpPower = true
        h.JumpPower = state and JumpValue or 50
    end
end)

local jumpSliderCard, jumpValueLabel = Core.slider(characterContent, "Jump Value", 4, 50, 500, 50, function(value)
    JumpValue = value
    if JumpEnabled then
        local h = GetHum()
        if h then
            h.UseJumpPower = true
            h.JumpPower = value
        end
    end
end)

Core.registerModule("Jump Power", jumpCard, characterContent, "Character", "toggle")
Core.registerModule("Jump Value", jumpSliderCard, characterContent, "Character", "slider")

local infJumpCard, getInfJumpState, setInfJumpState = Core.toggle(characterContent, "Infinite Jump", 5, false, function(state)
    InfiniteJumpEnabled = state
    CharacterModules.InfiniteJump.enabled = state
    CharacterModules.InfiniteJump.disableFunc = function()
        InfiniteJumpEnabled = false
    end
end)

Services.UIS.JumpRequest:Connect(function()
    if InfiniteJumpEnabled then
        local h = GetHum()
        if h then
            h:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

Core.registerModule("Infinite Jump", infJumpCard, characterContent, "Character", "toggle")

local noclipCard, getNoclipState, setNoclipState = Core.toggle(characterContent, "Noclip", 6, false, function(state)
    NoclipEnabled = state
    CharacterModules.Noclip.enabled = state
    CharacterModules.Noclip.disableFunc = function()
        NoclipEnabled = false
        ClearMoveConn("Noclip")
        local c = GetChar()
        if c then
            for _, part in ipairs(c:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
        end
    end
    ClearMoveConn("Noclip")
    if state then
        MovementConns["Noclip"] = Services.RunService.Stepped:Connect(function()
            if NoclipEnabled then
                local c = GetChar()
                if c then
                    for _, part in ipairs(c:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end
        end)
    else
        local c = GetChar()
        if c then
            for _, part in ipairs(c:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
        end
    end
end)

Core.registerModule("Noclip", noclipCard, characterContent, "Character", "toggle")

_G.FlySpeed = 100
_G.FlyEnabled = false
_G.FlyBodyGyro = nil
_G.FlyBodyVelocity = nil

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

function GetRoot()
    local char = LocalPlayer.Character
    return char and char:FindFirstChild("HumanoidRootPart")
end

function GetHum()
    local char = LocalPlayer.Character
    return char and char:FindFirstChildOfClass("Humanoid")
end

function StartFly()
    local root = GetRoot()
    local hum = GetHum()
    if not root or not hum then return end

    if _G.FlyBodyGyro then _G.FlyBodyGyro:Destroy() end
    if _G.FlyBodyVelocity then _G.FlyBodyVelocity:Destroy() end

    _G.FlyBodyGyro = Instance.new("BodyGyro")
    _G.FlyBodyGyro.Name = "FlyGyro"
    _G.FlyBodyGyro.P = 15000
    _G.FlyBodyGyro.D = 1000
    _G.FlyBodyGyro.MaxTorque = Vector3.new(1e6, 1e6, 1e6)
    _G.FlyBodyGyro.CFrame = root.CFrame
    _G.FlyBodyGyro.Parent = root

    _G.FlyBodyVelocity = Instance.new("BodyVelocity")
    _G.FlyBodyVelocity.Name = "FlyVelocity"
    _G.FlyBodyVelocity.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    _G.FlyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
    _G.FlyBodyVelocity.Parent = root

    hum.PlatformStand = true

    ClearMoveConn("Fly")

    MovementConns["Fly"] = RunService.Heartbeat:Connect(function()
        if not _G.FlyEnabled then return end

        root = GetRoot()
        hum = GetHum()
        if not root or not hum then return end

        local cam = workspace.CurrentCamera
        local moveDir = Vector3.new(0, 0, 0)

        if UserInputService:IsKeyDown(Enum.KeyCode.W) then
            moveDir += cam.CFrame.LookVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then
            moveDir -= cam.CFrame.LookVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then
            moveDir -= cam.CFrame.RightVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then
            moveDir += cam.CFrame.RightVector
        end

        if moveDir.Magnitude > 0 then
            moveDir = moveDir.Unit * _G.FlySpeed
        end

        _G.FlyBodyVelocity.Velocity = moveDir
        _G.FlyBodyGyro.CFrame = cam.CFrame
    end)
end

function StopFly()
    ClearMoveConn("Fly")

    local root = GetRoot()
    local hum = GetHum()

    if _G.FlyBodyGyro then
        _G.FlyBodyGyro:Destroy()
        _G.FlyBodyGyro = nil
    end

    if _G.FlyBodyVelocity then
        _G.FlyBodyVelocity:Destroy()
        _G.FlyBodyVelocity = nil
    end

    if hum then
        -- Ð’Ð°Ð¶Ð½Ð°Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ñ…Ð¾Ð´Ð°
        hum.PlatformStand = false
        hum:ChangeState(Enum.HumanoidStateType.GettingUp)
        task.wait(0.03)  -- ÐºÑ€Ð¾ÑˆÐµÑ‡Ð½Ð°Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ ÑÑ‚Ð°Ð±Ð¸Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´
        hum:ChangeState(Enum.HumanoidStateType.Running)  -- Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð² Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ
    end

    if root then
        root.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
        root.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
        root.Velocity = Vector3.new(0, 0, 0)
    end
end

-- Ð ÐµÑÐ¿Ð°Ð²Ð½ â€” Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº fly, ÐµÑÐ»Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ñ‘Ð½
LocalPlayer.CharacterAdded:Connect(function(newChar)
    task.wait(0.8)
    if _G.FlyEnabled then
        local hum = newChar:WaitForChild("Humanoid", 5)
        if hum then
            hum.PlatformStand = true
            StartFly()
        end
    end
end)

local flyToggleCard, getFlyState, setFlyState = Core.toggle(
    characterContent,
    "Fly (PC)",
    7,
    false,
    function(state)
        _G.FlyEnabled = state
        CharacterModules.Fly.enabled = state
        CharacterModules.Fly.disableFunc = function()
            _G.FlyEnabled = false
            StopFly()
        end
        if state then
            task.wait(0.15)
            StartFly()
        else
            StopFly()
        end
    end
)

local flySpeedSliderCard, flySpeedLabel = Core.slider(
    characterContent,
    "Fly Speed",
    8,
    10,
    300,
    100,
    function(value)
        _G.FlySpeed = value
        if flySpeedLabel then
            flySpeedLabel.Text = tostring(value)
        end
    end
)

_G.FlySpeed = 100
if flySpeedLabel then
    flySpeedLabel.Text = "100"
end

Core.registerModule("Fly (PC)", flyToggleCard, characterContent, "Character", "toggle")
Core.registerModule("Fly Speed", flySpeedSliderCard, characterContent, "Character", "slider")

local flyMobileCard = Core.moduleCard(characterContent, 9)
local flyMobileFrame = Instance.new("Frame")
flyMobileFrame.Size = UDim2.fromScale(1, 1)
flyMobileFrame.BackgroundTransparency = 1
flyMobileFrame.Parent = flyMobileCard
local flyMobileText = Instance.new("TextLabel")
flyMobileText.Size = UDim2.fromScale(1, 1)
flyMobileText.Position = UDim2.fromScale(0, 0)
flyMobileText.BackgroundTransparency = 1
flyMobileText.Text = "Load Fly (Mobile)"
flyMobileText.Font = Enum.Font.FredokaOne
flyMobileText.TextSize = Settings.IS_MOBILE and 11 or 13
flyMobileText.TextColor3 = Colors.TextMain
flyMobileText.TextXAlignment = Enum.TextXAlignment.Center
flyMobileText.TextYAlignment = Enum.TextYAlignment.Center
flyMobileText.Parent = flyMobileFrame
local flyMobileBtn = Instance.new("TextButton")
flyMobileBtn.Size = UDim2.fromScale(1, 1)
flyMobileBtn.BackgroundTransparency = 1
flyMobileBtn.Text = ""
flyMobileBtn.ZIndex = 10
flyMobileBtn.Parent = flyMobileFrame
flyMobileBtn.MouseEnter:Connect(function()
    Services.TweenService:Create(flyMobileCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.1}):Play()
end)
flyMobileBtn.MouseLeave:Connect(function()
    Services.TweenService:Create(flyMobileCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.3}):Play()
end)
flyMobileBtn.MouseButton1Click:Connect(function()
    Services.TweenService:Create(flyMobileCard, TweenInfo.new(0.1), {BackgroundColor3 = Colors.InteractiveActive}):Play()
    task.delay(0.15, function()
        Services.TweenService:Create(flyMobileCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card}):Play()
    end)
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt"))()
    end)
end)

Core.registerModule("Fly Mobile", flyMobileCard, characterContent, "Character", "button")

local bunnyhopCard, getBunnyhopState, setBunnyhopState = Core.toggle(characterContent, "Bunnyhop", 10, false, function(state)
    BunnyhopEnabled = state
    CharacterModules.Bunnyhop.enabled = state
    CharacterModules.Bunnyhop.disableFunc = function()
        BunnyhopEnabled = false
        ClearMoveConn("Bunnyhop")
    end
    ClearMoveConn("Bunnyhop")
    if state then
        MovementConns["Bunnyhop"] = Services.RunService.Heartbeat:Connect(function()
            if not BunnyhopEnabled then return end
            local hum = GetHum()
            local root = GetRoot()
            if hum and root then
                if hum.FloorMaterial ~= Enum.Material.Air then
                    hum:ChangeState(Enum.HumanoidStateType.Jumping)
                    root.AssemblyLinearVelocity = Vector3.new(
                        root.AssemblyLinearVelocity.X * 1.01,
                        BunnyhopPower,
                        root.AssemblyLinearVelocity.Z * 1.01
                    )
                end
            end
        end)
    end
end)

local bunnyhopSliderCard, bunnyhopValueLabel = Core.slider(characterContent, "Bunnyhop Power", 11, 20, 150, 50, function(value)
    BunnyhopPower = value
end)

Core.registerModule("Bunnyhop", bunnyhopCard, characterContent, "Character", "toggle")
Core.registerModule("Bunnyhop Power", bunnyhopSliderCard, characterContent, "Character", "slider")

local SpinRotation = 0
local spinbotCard, getSpinbotState, setSpinbotState = Core.toggle(characterContent, "Spinbot", 12, false, function(state)
    SpinbotEnabled = state
    CharacterModules.Spinbot.enabled = state
    CharacterModules.Spinbot.disableFunc = function()
        SpinbotEnabled = false
        ClearMoveConn("Spinbot")
    end
    ClearMoveConn("Spinbot")
    if state then
        SpinRotation = 0
        MovementConns["Spinbot"] = Services.RunService.RenderStepped:Connect(function(dt)
            if not SpinbotEnabled then return end
            local root = GetRoot()
            if root then
                SpinRotation = SpinRotation + (SpinbotSpeed * dt * 360)
                if SpinRotation >= 360 then SpinRotation = SpinRotation - 360 end
                root.CFrame = CFrame.new(root.Position) * CFrame.Angles(0, math.rad(SpinRotation), 0)
            end
        end)
    end
end)

local spinbotSliderCard, spinbotValueLabel = Core.slider(characterContent, "Spin Speed", 13, 1, 20, 5, function(value)
    SpinbotSpeed = value
end)

Core.registerModule("Spinbot", spinbotCard, characterContent, "Character", "toggle")
Core.registerModule("Spin Speed", spinbotSliderCard, characterContent, "Character", "slider")

Player.CharacterAdded:Connect(function(char)
    task.wait(0.5)
    local hum = char:FindFirstChildOfClass("Humanoid")
    if hum then
        _G.originalWalkSpeed = hum.WalkSpeed
        if SpeedEnabled then 
            hum.WalkSpeed = SpeedValue 
        else
            hum.WalkSpeed = _G.originalWalkSpeed
        end
        if JumpEnabled then
            hum.UseJumpPower = true
            hum.JumpPower = JumpValue
        end
    end
    if FlyEnabled then
        StopFly()
        task.wait(0.3)
        StartFly()
    end
end)

ESPEnabled = false
NameESPEnabled = false
DistanceESPEnabled = false
TeamCheckEnabled = true
ESPTextSize = 14
ESPTransparency = 50
ESPColor = Color3.fromRGB(255, 0, 0)
local FireAuraEnabled = false
local DiscoLightsEnabled = false
local LaserEyesEnabled = false
local GalaxyOrbitEnabled = false
local NeonOutlineEnabled = false
local VisualEffects = {}
local VisualConns = {}
ESPHighlights = {}
ESPNameBillboards = {}
ESPDistanceBillboards = {}
ESPConnections = {}
ESPNameBillboards = {}
ESPDistanceBillboards = {}

local SAVE_FILE = "PX_ColorSettings.json"

function SaveColorSettings()
    pcall(function()
        if writefile then
            local data = {
                ESPColor = {ESPColor.R * 255, ESPColor.G * 255, ESPColor.B * 255},
                ESPTransparency = ESPTransparency
            }
            writefile(SAVE_FILE, Services.HttpService:JSONEncode(data))
        end
    end)
end

function LoadColorSettings()
    pcall(function()
        if readfile and isfile and isfile(SAVE_FILE) then
            local data = Services.HttpService:JSONDecode(readfile(SAVE_FILE))
            if data.ESPColor then
                ESPColor = Color3.fromRGB(data.ESPColor[1], data.ESPColor[2], data.ESPColor[3])
            end
            if data.ESPTransparency then
                ESPTransparency = data.ESPTransparency
            end
        end
    end)
end

LoadColorSettings()

function DisableAllVisualFeatures()
    ESPEnabled = false
    NameESPEnabled = false
    DistanceESPEnabled = false
    TeamCheckEnabled = true
    for plr, hl in pairs(ESPHighlights) do
        if hl then pcall(function() hl:Destroy() end) end
    end
    ESPHighlights = {}
    for plr, bb in pairs(ESPNameBillboards) do
        if bb then pcall(function() bb:Destroy() end) end
    end
    ESPNameBillboards = {}
    for plr, bb in pairs(ESPDistanceBillboards) do
        if bb then pcall(function() bb:Destroy() end) end
    end
    ESPDistanceBillboards = {}
    FireAuraEnabled = false
    DiscoLightsEnabled = false
    LaserEyesEnabled = false
    GalaxyOrbitEnabled = false
    NeonOutlineEnabled = false
    ClearAllVisualEffects()
end

if UI.Gui then
    UI.Gui.Destroying:Connect(DisableAllVisualFeatures)
end

function ClearVisualConn(name)
    if VisualConns[name] then
        VisualConns[name]:Disconnect()
        VisualConns[name] = nil
    end
end

function IsTeammate(plr)
    if not TeamCheckEnabled then return false end
    return Player.Team and plr.Team and Player.Team == plr.Team
end

function RemoveESPFromPlayer(plr)
    if ESPHighlights[plr] then
        pcall(function() ESPHighlights[plr]:Destroy() end)
        ESPHighlights[plr] = nil
    end
    if ESPNameBillboards[plr] then
        pcall(function() ESPNameBillboards[plr]:Destroy() end)
        ESPNameBillboards[plr] = nil
    end
    if ESPDistanceBillboards[plr] then
        pcall(function() ESPDistanceBillboards[plr]:Destroy() end)
        ESPDistanceBillboards[plr] = nil
    end
end

function CreateESPForPlayer(plr)
    if plr == Player then return end
    if IsTeammate(plr) then
        RemoveESPFromPlayer(plr)
        return
    end
    _G.char = plr.Character
    if not _G.char then return end
    _G.humanoid = _G.char:FindFirstChildOfClass("Humanoid")
    if not _G.humanoid or _G.humanoid.Health <= 0 then
        RemoveESPFromPlayer(plr)
        return
    end
    _G.head = _G.char:FindFirstChild("Head")
    _G.hrp = _G.char:FindFirstChild("HumanoidRootPart")
    if not _G.head or not _G.hrp then return end
    if ESPEnabled then
        _G.existingHL = ESPHighlights[plr]
        if not _G.existingHL or not _G.existingHL.Parent or _G.existingHL.Adornee ~= _G.char then
            if _G.existingHL then
                pcall(function() _G.existingHL:Destroy() end)
            end
            _G.hl = Instance.new("Highlight")
            _G.hl.Name = "PX_ESP"
            _G.hl.FillTransparency = ESPTransparency / 100
            _G.hl.OutlineTransparency = 0
            _G.hl.Adornee = _G.char
            _G.hl.Parent = _G.char
            ESPHighlights[plr] = _G.hl
        end
        ESPHighlights[plr].FillColor = ESPColor
        ESPHighlights[plr].OutlineColor = ESPColor
    else
        if ESPHighlights[plr] then
            pcall(function() ESPHighlights[plr]:Destroy() end)
            ESPHighlights[plr] = nil
        end
    end
    if NameESPEnabled then
        _G.existingNameBB = ESPNameBillboards[plr]
        if not _G.existingNameBB or not _G.existingNameBB.Parent or _G.existingNameBB.Adornee ~= _G.head then
            if _G.existingNameBB then
                pcall(function() _G.existingNameBB:Destroy() end)
            end
            _G.nameBB = Instance.new("BillboardGui")
            _G.nameBB.Name = "PX_NameBB"
            _G.nameBB.Size = UDim2.fromOffset(150, 30)
            _G.nameBB.StudsOffset = Vector3.new(0, 2.5, 0)
            _G.nameBB.AlwaysOnTop = true
            _G.nameBB.Adornee = _G.head
            _G.nameBB.Parent = _G.head
            _G.nameLabel = Instance.new("TextLabel", _G.nameBB)
            _G.nameLabel.Name = "NameInfo"
            _G.nameLabel.Size = UDim2.fromScale(1, 1)
            _G.nameLabel.BackgroundTransparency = 1
            _G.nameLabel.Font = Enum.Font.FredokaOne
            _G.nameLabel.TextStrokeTransparency = 0.3
            _G.nameLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
            _G.nameLabel.TextColor3 = ESPColor
            _G.nameLabel.TextSize = ESPTextSize
            ESPNameBillboards[plr] = _G.nameBB
        end
        _G.nameBB = ESPNameBillboards[plr]
        if _G.nameBB and _G.nameBB.Parent then
            _G.nameBB.Adornee = _G.head
            _G.nameInfo = _G.nameBB:FindFirstChild("NameInfo")
            if _G.nameInfo then
                _G.nameInfo.Text = plr.Name
                _G.nameInfo.TextColor3 = ESPColor
                _G.nameInfo.TextSize = ESPTextSize
            end
        end
    else
        if ESPNameBillboards[plr] then
            pcall(function() ESPNameBillboards[plr]:Destroy() end)
            ESPNameBillboards[plr] = nil
        end
    end
    if DistanceESPEnabled then
        _G.existingDistBB = ESPDistanceBillboards[plr]
        if not _G.existingDistBB or not _G.existingDistBB.Parent or _G.existingDistBB.Adornee ~= _G.hrp then
            if _G.existingDistBB then
                pcall(function() _G.existingDistBB:Destroy() end)
            end
            _G.distBB = Instance.new("BillboardGui")
            _G.distBB.Name = "PX_DistBB"
            _G.distBB.Size = UDim2.fromOffset(100, 25)
            _G.distBB.StudsOffset = Vector3.new(0, -3.5, 0)
            _G.distBB.AlwaysOnTop = true
            _G.distBB.Adornee = _G.hrp
            _G.distBB.Parent = _G.hrp
            _G.distLabel = Instance.new("TextLabel", _G.distBB)
            _G.distLabel.Name = "DistInfo"
            _G.distLabel.Size = UDim2.fromScale(1, 1)
            _G.distLabel.BackgroundTransparency = 1
            _G.distLabel.Font = Enum.Font.FredokaOne
            _G.distLabel.TextStrokeTransparency = 0.3
            _G.distLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
            _G.distLabel.TextColor3 = ESPColor
            _G.distLabel.TextSize = ESPTextSize
            ESPDistanceBillboards[plr] = _G.distBB
        end
        _G.distBB = ESPDistanceBillboards[plr]
        if _G.distBB and _G.distBB.Parent then
            _G.distBB.Adornee = _G.hrp
            _G.distInfo = _G.distBB:FindFirstChild("DistInfo")
            if _G.distInfo then
                _G.myRoot = GetRoot()
                if _G.myRoot and _G.hrp then
                    _G.dist = math.floor((_G.myRoot.Position - _G.hrp.Position).Magnitude)
                    _G.distInfo.Text = _G.dist .. "m"
                    _G.distInfo.TextColor3 = ESPColor
                    _G.distInfo.TextSize = ESPTextSize
                end
            end
        end
    else
        if ESPDistanceBillboards[plr] then
            pcall(function() ESPDistanceBillboards[plr]:Destroy() end)
            ESPDistanceBillboards[plr] = nil
        end
    end
end

function RefreshAllESP()
    for _, plr in ipairs(Services.Players:GetPlayers()) do
        if plr ~= Player then
            CreateESPForPlayer(plr)
        end
    end
end

function UpdateAllESPColors()
    if ESPHighlights then
        for plr, hl in pairs(ESPHighlights) do
            if hl and hl.Parent then
                hl.FillColor = ESPColor
                hl.OutlineColor = ESPColor
            end
        end
    end
    if ESPNameBillboards then
        for plr, bb in pairs(ESPNameBillboards) do
            if bb and bb.Parent then
                _G.nameInfoUpdate = bb:FindFirstChild("NameInfo")
                if _G.nameInfoUpdate then
                    _G.nameInfoUpdate.TextColor3 = ESPColor
                end
            end
        end
    end
    if ESPDistanceBillboards then
        for plr, bb in pairs(ESPDistanceBillboards) do
            if bb and bb.Parent then
                _G.distInfoUpdate = bb:FindFirstChild("DistInfo")
                if _G.distInfoUpdate then
                    _G.distInfoUpdate.TextColor3 = ESPColor
                end
            end
        end
    end
end

function SetupPlayerESP(plr)
    if plr == Player then return end
    if ESPConnections[plr] then
        for _, conn in pairs(ESPConnections[plr]) do
            pcall(function() conn:Disconnect() end)
        end
    end
    ESPConnections[plr] = {}
    local charConn = plr.CharacterAdded:Connect(function(char)
        task.wait(0.3)
        local hum = char:WaitForChild("Humanoid", 5)
        local head = char:WaitForChild("Head", 5)
        local hrp = char:WaitForChild("HumanoidRootPart", 5)
        if not hum or not head or not hrp then return end
        RemoveESPFromPlayer(plr)
        task.wait(0.2)
        if ESPEnabled or NameESPEnabled or DistanceESPEnabled then
            CreateESPForPlayer(plr)
        end
    end)
    table.insert(ESPConnections[plr], charConn)
    if plr.Character then
        task.spawn(function()
            task.wait(0.1)
            if ESPEnabled or NameESPEnabled or DistanceESPEnabled then
                CreateESPForPlayer(plr)
            end
        end)
    end
end

function CleanupPlayerESP(plr)
    RemoveESPFromPlayer(plr)
    if ESPConnections[plr] then
        for _, conn in pairs(ESPConnections[plr]) do
            pcall(function() conn:Disconnect() end)
        end
        ESPConnections[plr] = nil
    end
end

function InitializeESP()
    for _, plr in ipairs(Services.Players:GetPlayers()) do
        SetupPlayerESP(plr)
    end
end

Services.Players.PlayerAdded:Connect(function(plr)
    SetupPlayerESP(plr)
end)

Services.Players.PlayerRemoving:Connect(function(plr)
    CleanupPlayerESP(plr)
end)

Services.RunService.Heartbeat:Connect(function()
    if not (ESPEnabled or NameESPEnabled or DistanceESPEnabled) then return end
    for _, plr in ipairs(Services.Players:GetPlayers()) do
        if plr ~= Player then
            _G.espChar = plr.Character
            if _G.espChar then
                _G.espHead = _G.espChar:FindFirstChild("Head")
                _G.espHrp = _G.espChar:FindFirstChild("HumanoidRootPart")
                _G.espHum = _G.espChar:FindFirstChildOfClass("Humanoid")
                if _G.espHead and _G.espHrp and _G.espHum and _G.espHum.Health > 0 then
                    _G.needRecreate = false
                    if ESPEnabled then
                        _G.espHl = ESPHighlights[plr]
                        if not _G.espHl or not _G.espHl.Parent or _G.espHl.Adornee ~= _G.espChar then
                            _G.needRecreate = true
                        end
                    end
                    if NameESPEnabled then
                        _G.espNameBB = ESPNameBillboards[plr]
                        if not _G.espNameBB or not _G.espNameBB.Parent or _G.espNameBB.Adornee ~= _G.espHead then
                            _G.needRecreate = true
                        end
                    end
                    if DistanceESPEnabled then
                        _G.espDistBB = ESPDistanceBillboards[plr]
                        if not _G.espDistBB or not _G.espDistBB.Parent or _G.espDistBB.Adornee ~= _G.espHrp then
                            _G.needRecreate = true
                        end
                    end
                    if _G.needRecreate then
                        CreateESPForPlayer(plr)
                    else
                        if NameESPEnabled and ESPNameBillboards[plr] then
                            _G.nameInfo = ESPNameBillboards[plr]:FindFirstChild("NameInfo")
                            if _G.nameInfo then
                                _G.nameInfo.Text = plr.Name
                                _G.nameInfo.TextColor3 = ESPColor
                                _G.nameInfo.TextSize = ESPTextSize
                            end
                        end
                        if DistanceESPEnabled and ESPDistanceBillboards[plr] then
                            _G.distInfo = ESPDistanceBillboards[plr]:FindFirstChild("DistInfo")
                            if _G.distInfo then
                                _G.myRoot = GetRoot()
                                if _G.myRoot and _G.espHrp then
                                    _G.dist = math.floor((_G.myRoot.Position - _G.espHrp.Position).Magnitude)
                                    _G.distInfo.Text = _G.dist .. "m"
                                    _G.distInfo.TextColor3 = ESPColor
                                    _G.distInfo.TextSize = ESPTextSize
                                end
                            end
                        end
                    end
                else
                    RemoveESPFromPlayer(plr)
                end
            else
                RemoveESPFromPlayer(plr)
            end
        end
    end
end)

InitializeESP()

local highlightESPCard = Core.toggle(espContent, "Highlight ESP", 1, false, function(state)
    ESPEnabled = state
    if state then
        RefreshAllESP()
    else
        for plr, hl in pairs(ESPHighlights) do
            if hl then pcall(function() hl:Destroy() end) end
        end
        ESPHighlights = {}
    end
end)

nameESPCard = Core.toggle(espContent, "Name ESP", 2, false, function(state)
    NameESPEnabled = state
    if state then
        RefreshAllESP()
    else
        for plr, bb in pairs(ESPNameBillboards) do
            if bb then pcall(function() bb:Destroy() end) end
        end
        ESPNameBillboards = {}
    end
end)

distanceESPCard = Core.toggle(espContent, "Distance ESP", 3, false, function(state)
    DistanceESPEnabled = state
    if state then
        RefreshAllESP()
    else
        for plr, bb in pairs(ESPDistanceBillboards) do
            if bb then pcall(function() bb:Destroy() end) end
        end
        ESPDistanceBillboards = {}
    end
end)

local teamCheckCard = Core.toggle(espContent, "Team Check", 4, true, function(state)
    TeamCheckEnabled = state
    RefreshAllESP()
end)

Core.registerModule("Highlight ESP", highlightESPCard, espContent, "Visual", "toggle")
Core.registerModule("Name ESP", nameESPCard, espContent, "Visual", "toggle")
Core.registerModule("Distance ESP", distanceESPCard, espContent, "Visual", "toggle")
Core.registerModule("Team Check", teamCheckCard, espContent, "Visual", "toggle")

local title = espSettingsContent:FindFirstChildWhichIsA("TextLabel", true)
if title then title.TextColor3 = Color3.new(1,1,1) end

espTextSizeCard = Core.slider(espSettingsContent, "ESP Text Size", 1, 8, 24, 14, function(value)
    ESPTextSize = value
    RefreshAllESP()
end)

Core.registerModule("ESP Text Size", espTextSizeCard, espSettingsContent, "Visual", "slider")

espTransparencyCard = Core.slider(espSettingsContent, "ESP Transparency", 2, 0, 100, ESPTransparency, function(value)
    ESPTransparency = value
    for plr, hl in pairs(ESPHighlights) do
        if hl and hl.Parent then
            hl.FillTransparency = value / 100
        end
    end
    SaveColorSettings()
end)

Core.registerModule("ESP Transparency", espTransparencyCard, espSettingsContent, "Visual", "slider")

_G.ColorPickerOpen = false
_G.ColorPickerGui = nil
_G.LastColorPickerPosition = nil

CreateColorPicker = function() 
    if _G.ColorPickerGui and _G.ColorPickerGui.Parent then 
        _G.ColorPickerGui:Destroy() 
        _G.ColorPickerGui = nil 
    end

    _G.ColorPickerGui = Instance.new("Frame") 
    _G.ColorPickerGui.Name = "ColorPickerFrame" 
    _G.ColorPickerGui.Size = UDim2.fromOffset(300, 190)
    _G.ColorPickerGui.Position = UDim2.fromScale(0.5, 0.5) 
    _G.ColorPickerGui.AnchorPoint = Vector2.new(0.5, 0.5) 
    _G.ColorPickerGui.BackgroundColor3 = Colors.Base 
    _G.ColorPickerGui.BackgroundTransparency = Settings.GUI_OPACITY / 100
    _G.ColorPickerGui.BorderSizePixel = 0 
    _G.ColorPickerGui.ZIndex = 10000 
    _G.ColorPickerGui.ClipsDescendants = true
    _G.ColorPickerGui.Parent = UI.Gui
    _G.ColorPickerGui.Visible = false

    _G.ColorPickerCorner = Instance.new("UICorner") 
    _G.ColorPickerCorner.CornerRadius = UDim.new(0, 12) 
    _G.ColorPickerCorner.Parent = _G.ColorPickerGui

    _G.ColorPickerStroke = Instance.new("UIStroke") 
    _G.ColorPickerStroke.Color = Colors.Border 
    _G.ColorPickerStroke.Thickness = 1 
    _G.ColorPickerStroke.Transparency = 0.5 
    _G.ColorPickerStroke.Parent = _G.ColorPickerGui

    _G.ColorPickerShadow = Instance.new("ImageLabel") 
    _G.ColorPickerShadow.Name = "Shadow" 
    _G.ColorPickerShadow.AnchorPoint = Vector2.new(0, 0) 
    _G.ColorPickerShadow.Position = UDim2.fromOffset(-6, -6) 
    _G.ColorPickerShadow.Size = UDim2.new(1, 12, 1, 12) 
    _G.ColorPickerShadow.BackgroundTransparency = 1 
    _G.ColorPickerShadow.Image = "rbxassetid://6014261993" 
    _G.ColorPickerShadow.ImageColor3 = Color3.new(0, 0, 0) 
    _G.ColorPickerShadow.ImageTransparency = 0.75 
    _G.ColorPickerShadow.ScaleType = Enum.ScaleType.Slice 
    _G.ColorPickerShadow.SliceCenter = Rect.new(49, 49, 450, 450) 
    _G.ColorPickerShadow.ZIndex = 9999 
    _G.ColorPickerShadow.Parent = _G.ColorPickerGui

    _G.ColorPickerTitle = Instance.new("TextLabel") 
    _G.ColorPickerTitle.Name = "Title" 
    _G.ColorPickerTitle.Size = UDim2.new(1, -40, 0, 28) 
    _G.ColorPickerTitle.Position = UDim2.fromOffset(10, 6) 
    _G.ColorPickerTitle.BackgroundTransparency = 1 
    _G.ColorPickerTitle.Text = "ESP Color" 
    _G.ColorPickerTitle.Font = Enum.Font.FredokaOne 
    _G.ColorPickerTitle.TextSize = 12 
    _G.ColorPickerTitle.TextColor3 = Colors.TextMain 
    _G.ColorPickerTitle.TextXAlignment = Enum.TextXAlignment.Left 
    _G.ColorPickerTitle.ZIndex = 10001 
    _G.ColorPickerTitle.Parent = _G.ColorPickerGui

    _G.ColorPickerCloseBtn = Instance.new("TextButton") 
    _G.ColorPickerCloseBtn.Name = "CloseBtn" 
    _G.ColorPickerCloseBtn.Size = UDim2.fromOffset(20, 20) 
    _G.ColorPickerCloseBtn.Position = UDim2.new(1, -26, 0, 8) 
    _G.ColorPickerCloseBtn.BackgroundColor3 = Colors.Interactive 
    _G.ColorPickerCloseBtn.BackgroundTransparency = 0.3 + 0.4 * (Settings.GUI_OPACITY / 100)
    _G.ColorPickerCloseBtn.Text = "Ã—" 
    _G.ColorPickerCloseBtn.Font = Enum.Font.FredokaOne 
    _G.ColorPickerCloseBtn.TextSize = 14 
    _G.ColorPickerCloseBtn.TextColor3 = Colors.TextMain 
    _G.ColorPickerCloseBtn.AutoButtonColor = false 
    _G.ColorPickerCloseBtn.ZIndex = 10001 
    _G.ColorPickerCloseBtn.Parent = _G.ColorPickerGui

    _G.ColorPickerCloseBtnCorner = Instance.new("UICorner") 
    _G.ColorPickerCloseBtnCorner.CornerRadius = UDim.new(0, 4) 
    _G.ColorPickerCloseBtnCorner.Parent = _G.ColorPickerCloseBtn

    _G.ColorPickerCloseBtn.MouseEnter:Connect(function() 
        Services.TweenService:Create(_G.ColorPickerCloseBtn, TweenInfo.new(0.15), { 
            BackgroundColor3 = Colors.InteractiveHover, 
            BackgroundTransparency = 0.2 
        }):Play() 
    end)

    _G.ColorPickerCloseBtn.MouseLeave:Connect(function() 
        Services.TweenService:Create(_G.ColorPickerCloseBtn, TweenInfo.new(0.15), { 
            BackgroundColor3 = Colors.Interactive, 
            BackgroundTransparency = 0.3 + 0.4 * (Settings.GUI_OPACITY / 100) 
        }):Play() 
    end)

    _G.ColorPickerCloseBtn.MouseButton1Click:Connect(function() 
        CloseColorPicker() 
        if _G.ColorPickerToggleSetState then 
            _G.ColorPickerToggleSetState(false) 
        end 
    end)

    _G.ColorPickerHueSaturation = Instance.new("Frame") 
    _G.ColorPickerHueSaturation.Name = "HueSaturation" 
    _G.ColorPickerHueSaturation.Size = UDim2.fromOffset(100, 100) 
    _G.ColorPickerHueSaturation.Position = UDim2.fromOffset(10, 38) 
    _G.ColorPickerHueSaturation.BackgroundColor3 = Color3.new(1, 0, 0) 
    _G.ColorPickerHueSaturation.BorderSizePixel = 0 
    _G.ColorPickerHueSaturation.ZIndex = 10001 
    _G.ColorPickerHueSaturation.Parent = _G.ColorPickerGui

    _G.ColorPickerHueSaturationCorner = Instance.new("UICorner") 
    _G.ColorPickerHueSaturationCorner.CornerRadius = UDim.new(0, 4) 
    _G.ColorPickerHueSaturationCorner.Parent = _G.ColorPickerHueSaturation

    _G.ColorPickerWhiteGradient = Instance.new("UIGradient") 
    _G.ColorPickerWhiteGradient.Color = ColorSequence.new(Color3.new(1, 1, 1)) 
    _G.ColorPickerWhiteGradient.Transparency = NumberSequence.new({ 
        NumberSequenceKeypoint.new(0, 0), 
        NumberSequenceKeypoint.new(1, 1) 
    }) 
    _G.ColorPickerWhiteGradient.Rotation = 0 
    _G.ColorPickerWhiteGradient.Parent = _G.ColorPickerHueSaturation

    _G.ColorPickerValueOverlay = Instance.new("Frame") 
    _G.ColorPickerValueOverlay.Name = "ValueOverlay" 
    _G.ColorPickerValueOverlay.Size = UDim2.fromScale(1, 1) 
    _G.ColorPickerValueOverlay.BackgroundColor3 = Color3.new(0, 0, 0) 
    _G.ColorPickerValueOverlay.BackgroundTransparency = 0 
    _G.ColorPickerValueOverlay.BorderSizePixel = 0 
    _G.ColorPickerValueOverlay.ZIndex = 10002 
    _G.ColorPickerValueOverlay.Parent = _G.ColorPickerHueSaturation

    _G.ColorPickerValueOverlayCorner = Instance.new("UICorner") 
    _G.ColorPickerValueOverlayCorner.CornerRadius = UDim.new(0, 4) 
    _G.ColorPickerValueOverlayCorner.Parent = _G.ColorPickerValueOverlay

    _G.ColorPickerValueGradient = Instance.new("UIGradient") 
    _G.ColorPickerValueGradient.Color = ColorSequence.new(Color3.new(0, 0, 0)) 
    _G.ColorPickerValueGradient.Transparency = NumberSequence.new({ 
        NumberSequenceKeypoint.new(0, 1), 
        NumberSequenceKeypoint.new(1, 0) 
    }) 
    _G.ColorPickerValueGradient.Rotation = 90 
    _G.ColorPickerValueGradient.Parent = _G.ColorPickerValueOverlay

    _G.ColorPickerHueSatCursor = Instance.new("Frame") 
    _G.ColorPickerHueSatCursor.Name = "Cursor" 
    _G.ColorPickerHueSatCursor.Size = UDim2.fromOffset(10, 10) 
    _G.ColorPickerHueSatCursor.AnchorPoint = Vector2.new(0.5, 0.5) 
    _G.ColorPickerHueSatCursor.Position = UDim2.fromScale(1, 0) 
    _G.ColorPickerHueSatCursor.BackgroundColor3 = Color3.new(1, 1, 1) 
    _G.ColorPickerHueSatCursor.BorderSizePixel = 0 
    _G.ColorPickerHueSatCursor.ZIndex = 10003 
    _G.ColorPickerHueSatCursor.Parent = _G.ColorPickerHueSaturation

    _G.ColorPickerHueSatCursorCorner = Instance.new("UICorner") 
    _G.ColorPickerHueSatCursorCorner.CornerRadius = UDim.new(1, 0) 
    _G.ColorPickerHueSatCursorCorner.Parent = _G.ColorPickerHueSatCursor

    _G.ColorPickerHueSatCursorStroke = Instance.new("UIStroke") 
    _G.ColorPickerHueSatCursorStroke.Color = Color3.new(0, 0, 0) 
    _G.ColorPickerHueSatCursorStroke.Thickness = 1 
    _G.ColorPickerHueSatCursorStroke.Parent = _G.ColorPickerHueSatCursor

    _G.ColorPickerHueBar = Instance.new("Frame") 
    _G.ColorPickerHueBar.Name = "HueBar" 
    _G.ColorPickerHueBar.Size = UDim2.fromOffset(100, 8) 
    _G.ColorPickerHueBar.Position = UDim2.fromOffset(10, 144) 
    _G.ColorPickerHueBar.BackgroundColor3 = Color3.new(1, 1, 1) 
    _G.ColorPickerHueBar.BorderSizePixel = 0 
    _G.ColorPickerHueBar.ZIndex = 10001 
    _G.ColorPickerHueBar.Parent = _G.ColorPickerGui

    _G.ColorPickerHueBarCorner = Instance.new("UICorner") 
    _G.ColorPickerHueBarCorner.CornerRadius = UDim.new(0, 2) 
    _G.ColorPickerHueBarCorner.Parent = _G.ColorPickerHueBar

    _G.ColorPickerHueGradient = Instance.new("UIGradient") 
    _G.ColorPickerHueGradient.Color = ColorSequence.new({ 
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)), 
        ColorSequenceKeypoint.new(0.167, Color3.fromRGB(255, 255, 0)), 
        ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0, 255, 0)), 
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)), 
        ColorSequenceKeypoint.new(0.667, Color3.fromRGB(0, 0, 255)), 
        ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255, 0, 255)), 
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0)) 
    }) 
    _G.ColorPickerHueGradient.Parent = _G.ColorPickerHueBar

    _G.ColorPickerHueCursor = Instance.new("Frame") 
    _G.ColorPickerHueCursor.Name = "HueCursor" 
    _G.ColorPickerHueCursor.Size = UDim2.fromOffset(4, 14) 
    _G.ColorPickerHueCursor.AnchorPoint = Vector2.new(0.5, 0.5) 
    _G.ColorPickerHueCursor.Position = UDim2.new(0, 0, 0.5, 0) 
    _G.ColorPickerHueCursor.BackgroundColor3 = Color3.new(1, 1, 1) 
    _G.ColorPickerHueCursor.BorderSizePixel = 0 
    _G.ColorPickerHueCursor.ZIndex = 10002 
    _G.ColorPickerHueCursor.Parent = _G.ColorPickerHueBar

    _G.ColorPickerHueCursorCorner = Instance.new("UICorner") 
    _G.ColorPickerHueCursorCorner.CornerRadius = UDim.new(0, 2) 
    _G.ColorPickerHueCursorCorner.Parent = _G.ColorPickerHueCursor

    _G.ColorPickerHueCursorStroke = Instance.new("UIStroke") 
    _G.ColorPickerHueCursorStroke.Color = Color3.new(0, 0, 0) 
    _G.ColorPickerHueCursorStroke.Thickness = 1 
    _G.ColorPickerHueCursorStroke.Parent = _G.ColorPickerHueCursor

    _G.ColorPickerPreview = Instance.new("Frame") 
    _G.ColorPickerPreview.Name = "Preview" 
    _G.ColorPickerPreview.Size = UDim2.fromOffset(36, 36) 
    _G.ColorPickerPreview.Position = UDim2.fromOffset(120, 38) 
    _G.ColorPickerPreview.BackgroundColor3 = ESPColor 
    _G.ColorPickerPreview.BorderSizePixel = 0 
    _G.ColorPickerPreview.ZIndex = 10001 
    _G.ColorPickerPreview.Parent = _G.ColorPickerGui

    _G.ColorPickerPreviewCorner = Instance.new("UICorner") 
    _G.ColorPickerPreviewCorner.CornerRadius = UDim.new(0, 6) 
    _G.ColorPickerPreviewCorner.Parent = _G.ColorPickerPreview

    _G.ColorPickerPreviewStroke = Instance.new("UIStroke") 
    _G.ColorPickerPreviewStroke.Color = Colors.Border 
    _G.ColorPickerPreviewStroke.Thickness = 1 
    _G.ColorPickerPreviewStroke.Transparency = 0.5 
    _G.ColorPickerPreviewStroke.Parent = _G.ColorPickerPreview

    _G.ColorPickerHexInput = Instance.new("TextBox") 
    _G.ColorPickerHexInput.Name = "HexInput" 
    _G.ColorPickerHexInput.Size = UDim2.fromOffset(80, 28) 
    _G.ColorPickerHexInput.Position = UDim2.fromOffset(120, 80) 
    _G.ColorPickerHexInput.BackgroundColor3 = Colors.Card 
    _G.ColorPickerHexInput.BackgroundTransparency = Settings.GUI_OPACITY / 100 
    _G.ColorPickerHexInput.BorderSizePixel = 0 
    _G.ColorPickerHexInput.Text = "#" .. string.format("%02X%02X%02X", math.floor(ESPColor.R * 255), math.floor(ESPColor.G * 255), math.floor(ESPColor.B * 255)) 
    _G.ColorPickerHexInput.Font = Enum.Font.FredokaOne 
    _G.ColorPickerHexInput.TextSize = 11 
    _G.ColorPickerHexInput.TextColor3 = Colors.TextMain 
    _G.ColorPickerHexInput.PlaceholderText = "#FF0000" 
    _G.ColorPickerHexInput.PlaceholderColor3 = Colors.TextSub 
    _G.ColorPickerHexInput.ClearTextOnFocus = false 
    _G.ColorPickerHexInput.ZIndex = 10001 
    _G.ColorPickerHexInput.Parent = _G.ColorPickerGui

    _G.ColorPickerHexInputCorner = Instance.new("UICorner") 
    _G.ColorPickerHexInputCorner.CornerRadius = UDim.new(0, 6) 
    _G.ColorPickerHexInputCorner.Parent = _G.ColorPickerHexInput

    _G.ColorPickerHexInputStroke = Instance.new("UIStroke") 
    _G.ColorPickerHexInputStroke.Color = Colors.Border 
    _G.ColorPickerHexInputStroke.Thickness = 1 
    _G.ColorPickerHexInputStroke.Transparency = 0.5 
    _G.ColorPickerHexInputStroke.Parent = _G.ColorPickerHexInput

    _G.ColorPresets = { 
        Color3.fromRGB(255, 0, 0),
        Color3.fromRGB(255, 165, 0),
        Color3.fromRGB(255, 255, 0),
        Color3.fromRGB(0, 255, 0),
        Color3.fromRGB(0, 255, 255),
        Color3.fromRGB(0, 0, 255),
        Color3.fromRGB(128, 0, 128),
        Color3.fromRGB(255, 255, 255),
        Color3.fromRGB(0, 0, 0),
    }

    _G.ColorPickerPresetsFrame = Instance.new("Frame") 
_G.ColorPickerPresetsFrame.Name = "PresetsFrame" 
_G.ColorPickerPresetsFrame.Size = UDim2.new(1, -20, 0, 30) 
_G.ColorPickerPresetsFrame.Position = UDim2.fromOffset(10, 156)
_G.ColorPickerPresetsFrame.BackgroundColor3 = Colors.Card
_G.ColorPickerPresetsFrame.BackgroundTransparency = 0.3
_G.ColorPickerPresetsFrame.BorderSizePixel = 0
_G.ColorPickerPresetsFrame.ZIndex = 10001
_G.ColorPickerPresetsFrame.ClipsDescendants = true
_G.ColorPickerPresetsFrame.Parent = _G.ColorPickerGui

_G.ColorPickerPresetsFrameCorner = Instance.new("UICorner")
_G.ColorPickerPresetsFrameCorner.CornerRadius = UDim.new(0, 8)
_G.ColorPickerPresetsFrameCorner.Parent = _G.ColorPickerPresetsFrame

_G.ColorPickerPresetsFrameStroke = Instance.new("UIStroke")
_G.ColorPickerPresetsFrameStroke.Color = Colors.Border
_G.ColorPickerPresetsFrameStroke.Thickness = 1
_G.ColorPickerPresetsFrameStroke.Transparency = 0.5
_G.ColorPickerPresetsFrameStroke.Parent = _G.ColorPickerPresetsFrame

_G.ColorPickerPresetsLayout = Instance.new("UIListLayout") 
_G.ColorPickerPresetsLayout.FillDirection = Enum.FillDirection.Horizontal 
_G.ColorPickerPresetsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center 
_G.ColorPickerPresetsLayout.VerticalAlignment = Enum.VerticalAlignment.Center 
_G.ColorPickerPresetsLayout.Padding = UDim.new(0, 5) 
_G.ColorPickerPresetsLayout.Parent = _G.ColorPickerPresetsFrame

_G.ColorPickerPresetsPadding = Instance.new("UIPadding")
_G.ColorPickerPresetsPadding.PaddingTop = UDim.new(0, 4)
_G.ColorPickerPresetsPadding.PaddingBottom = UDim.new(0, 4)
_G.ColorPickerPresetsPadding.PaddingLeft = UDim.new(0, 6)
_G.ColorPickerPresetsPadding.PaddingRight = UDim.new(0, 6)
_G.ColorPickerPresetsPadding.Parent = _G.ColorPickerPresetsFrame

    _G.ColorPickerPresetButtons = {}

_G.ColorPickerPresetButtons = {}

_G.CreatePresetButton = function(presetIndex, presetColor)
    _G.ColorPickerPresetButtons[presetIndex] = Instance.new("TextButton") 
    _G.ColorPickerPresetButtons[presetIndex].Name = "PresetButton_" .. presetIndex
    _G.ColorPickerPresetButtons[presetIndex].Size = UDim2.fromOffset(20, 20)
    _G.ColorPickerPresetButtons[presetIndex].BackgroundColor3 = presetColor 
    _G.ColorPickerPresetButtons[presetIndex].Text = "" 
    _G.ColorPickerPresetButtons[presetIndex].AutoButtonColor = false 
    _G.ColorPickerPresetButtons[presetIndex].BorderSizePixel = 1 
    _G.ColorPickerPresetButtons[presetIndex].BorderColor3 = Color3.fromRGB(60, 60, 60) 
    _G.ColorPickerPresetButtons[presetIndex].Parent = _G.ColorPickerPresetsFrame
    _G.ColorPickerPresetButtons[presetIndex].ZIndex = 10002

    _G.ColorPickerPresetBtnCorner = Instance.new("UICorner", _G.ColorPickerPresetButtons[presetIndex]) 
    _G.ColorPickerPresetBtnCorner.CornerRadius = UDim.new(0.5, 0)

    _G.ColorPickerPresetButtons[presetIndex].MouseButton1Click:Connect(function() 
        _G.ColorPickerCurrentHue, _G.ColorPickerCurrentSat, _G.ColorPickerCurrentVal = presetColor:ToHSV() 
        UpdateColorPickerFromHSV() 
    end)

    _G.ColorPickerPresetButtons[presetIndex].MouseEnter:Connect(function() 
        Services.TweenService:Create(_G.ColorPickerPresetButtons[presetIndex], TweenInfo.new(0.2), {Size = UDim2.fromOffset(22, 22)}):Play() 
    end)

    _G.ColorPickerPresetButtons[presetIndex].MouseLeave:Connect(function() 
        Services.TweenService:Create(_G.ColorPickerPresetButtons[presetIndex], TweenInfo.new(0.2), {Size = UDim2.fromOffset(20, 20)}):Play() 
    end)
end

_G.ColorPickerPresetIndex = 1
while _G.ColorPickerPresetIndex <= #_G.ColorPresets do
    _G.CreatePresetButton(_G.ColorPickerPresetIndex, _G.ColorPresets[_G.ColorPickerPresetIndex])
    _G.ColorPickerPresetIndex = _G.ColorPickerPresetIndex + 1
end

    _G.ColorPickerCurrentHue = 0 
    _G.ColorPickerCurrentSat = 1 
    _G.ColorPickerCurrentVal = 1

    _G.ColorPickerH, _G.ColorPickerS, _G.ColorPickerV = ESPColor:ToHSV() 
    _G.ColorPickerCurrentHue = _G.ColorPickerH 
    _G.ColorPickerCurrentSat = _G.ColorPickerS 
    _G.ColorPickerCurrentVal = _G.ColorPickerV

    UpdateColorPickerFromHSV()

    _G.ColorPickerDraggingHueSat = false 
    _G.ColorPickerDraggingHue = false

    _G.ColorPickerHueSatInput = Instance.new("TextButton") 
    _G.ColorPickerHueSatInput.Name = "HueSatInput" 
    _G.ColorPickerHueSatInput.Size = UDim2.fromScale(1, 1) 
    _G.ColorPickerHueSatInput.BackgroundTransparency = 1 
    _G.ColorPickerHueSatInput.Text = "" 
    _G.ColorPickerHueSatInput.ZIndex = 10004 
    _G.ColorPickerHueSatInput.Parent = _G.ColorPickerHueSaturation

    _G.ColorPickerHueSatInput.InputBegan:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
            _G.ColorPickerDraggingHueSat = true 
        end 
    end)

    _G.ColorPickerHueBarInput = Instance.new("TextButton") 
    _G.ColorPickerHueBarInput.Name = "HueBarInput" 
    _G.ColorPickerHueBarInput.Size = UDim2.fromScale(1, 1) 
    _G.ColorPickerHueBarInput.BackgroundTransparency = 1 
    _G.ColorPickerHueBarInput.Text = "" 
    _G.ColorPickerHueBarInput.ZIndex = 10003 
    _G.ColorPickerHueBarInput.Parent = _G.ColorPickerHueBar

    _G.ColorPickerHueBarInput.InputBegan:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
            _G.ColorPickerDraggingHue = true 
        end 
    end)

    _G.ColorPickerInputChangedConnection = Services.UIS.InputChanged:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then 
            if _G.ColorPickerDraggingHueSat then 
                _G.ColorPickerAbsPos = _G.ColorPickerHueSaturation.AbsolutePosition 
                _G.ColorPickerAbsSize = _G.ColorPickerHueSaturation.AbsoluteSize 
                _G.ColorPickerRelativeX = math.clamp((input.Position.X - _G.ColorPickerAbsPos.X) / _G.ColorPickerAbsSize.X, 0, 1) 
                _G.ColorPickerRelativeY = math.clamp((input.Position.Y - _G.ColorPickerAbsPos.Y) / _G.ColorPickerAbsSize.Y, 0, 1) 
                _G.ColorPickerCurrentSat = _G.ColorPickerRelativeX 
                _G.ColorPickerCurrentVal = 1 - _G.ColorPickerRelativeY 
                UpdateColorPickerFromHSV() 
            end 
            if _G.ColorPickerDraggingHue then 
                _G.ColorPickerHueAbsPos = _G.ColorPickerHueBar.AbsolutePosition 
                _G.ColorPickerHueAbsSize = _G.ColorPickerHueBar.AbsoluteSize 
                _G.ColorPickerHueRelativeX = math.clamp((input.Position.X - _G.ColorPickerHueAbsPos.X) / _G.ColorPickerHueAbsSize.X, 0, 1) 
                _G.ColorPickerCurrentHue = _G.ColorPickerHueRelativeX 
                UpdateColorPickerFromHSV() 
            end 
        end 
    end)

    _G.ColorPickerInputEndedConnection = Services.UIS.InputEnded:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
            _G.ColorPickerDraggingHueSat = false 
            _G.ColorPickerDraggingHue = false 
        end 
    end)

    _G.ColorPickerHexInput.FocusLost:Connect(function(enterPressed) 
        _G.ColorPickerHexText = _G.ColorPickerHexInput.Text:gsub("#", ""):gsub(" ", "") 
        if #_G.ColorPickerHexText == 6 then 
            _G.ColorPickerR = tonumber(_G.ColorPickerHexText:sub(1, 2), 16) 
            _G.ColorPickerG = tonumber(_G.ColorPickerHexText:sub(3, 4), 16) 
            _G.ColorPickerB = tonumber(_G.ColorPickerHexText:sub(5, 6), 16) 
            if _G.ColorPickerR and _G.ColorPickerG and _G.ColorPickerB then 
                _G.ColorPickerNewColorFromHex = Color3.fromRGB(_G.ColorPickerR, _G.ColorPickerG, _G.ColorPickerB) 
                _G.ColorPickerCurrentHue, _G.ColorPickerCurrentSat, _G.ColorPickerCurrentVal = _G.ColorPickerNewColorFromHex:ToHSV() 
                UpdateColorPickerFromHSV() 
            end 
        end 
        _G.ColorPickerHexInput.Text = "#" .. string.format("%02X%02X%02X", math.floor(ESPColor.R * 255), math.floor(ESPColor.G * 255), math.floor(ESPColor.B * 255)) 
    end)

    _G.ColorPickerDragging = false 
    _G.ColorPickerDragStart = nil 
    _G.ColorPickerStartPos = nil

    _G.ColorPickerGui.InputBegan:Connect(function(input) 
        if _G.CurrentlyDragging then return end 
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
            _G.CurrentlyDragging = "ColorPicker" 
            _G.ColorPickerDragging = true 
            _G.ColorPickerDragStart = input.Position 
            _G.ColorPickerStartPos = _G.ColorPickerGui.Position 
        end 
    end)

    _G.ColorPickerDragConnection = Services.UIS.InputChanged:Connect(function(input) 
        if _G.ColorPickerDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then 
            _G.ColorPickerDelta = input.Position - _G.ColorPickerDragStart 
            _G.ColorPickerTargetPos = UDim2.new( 
                _G.ColorPickerStartPos.X.Scale, _G.ColorPickerStartPos.X.Offset + _G.ColorPickerDelta.X, 
                _G.ColorPickerStartPos.Y.Scale, _G.ColorPickerStartPos.Y.Offset + _G.ColorPickerDelta.Y 
            ) 
            Services.TweenService:Create(_G.ColorPickerGui, TweenInfo.new(0.1), {Position = _G.ColorPickerTargetPos}):Play() 
        end 
    end)

    _G.ColorPickerDragEndConnection = Services.UIS.InputEnded:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
            if _G.ColorPickerDragging then
                _G.ColorPickerDragging = false 
                _G.CurrentlyDragging = nil 
                if _G.ColorPickerOpen and _G.ColorPickerGui then 
                    _G.LastColorPickerPosition = _G.ColorPickerGui.Position
                end 
            end
        end 
    end) 
end

UpdateColorPickerFromHSV = function() 
    _G.ColorPickerNewColor = Color3.fromHSV(_G.ColorPickerCurrentHue, _G.ColorPickerCurrentSat, _G.ColorPickerCurrentVal) 
    _G.ColorPickerHueSaturation.BackgroundColor3 = Color3.fromHSV(_G.ColorPickerCurrentHue, 1, 1) 
    _G.ColorPickerPreview.BackgroundColor3 = _G.ColorPickerNewColor 
    _G.ColorPickerHueCursor.Position = UDim2.new(_G.ColorPickerCurrentHue, 0, 0.5, 0) 
    _G.ColorPickerHueSatCursor.Position = UDim2.new(_G.ColorPickerCurrentSat, 0, 1 - _G.ColorPickerCurrentVal, 0) 
    _G.ColorPickerHexInput.Text = "#" .. string.format("%02X%02X%02X", math.floor(_G.ColorPickerNewColor.R * 255), math.floor(_G.ColorPickerNewColor.G * 255), math.floor(_G.ColorPickerNewColor.B * 255)) 
    ESPColor = _G.ColorPickerNewColor 
    UpdateAllESPColors() 
    SaveColorSettings() 
end

UpdateColorPickerOpacity = function() 
    if not _G.ColorPickerGui or not _G.ColorPickerGui.Parent then return end

    _G.ColorPickerTrans = Settings.GUI_OPACITY / 100

    _G.ColorPickerGui.BackgroundTransparency = _G.ColorPickerTrans

    if _G.ColorPickerShadow then 
        _G.ColorPickerShadow.ImageTransparency = 0.5 + 0.3 * _G.ColorPickerTrans 
    end

    if _G.ColorPickerCloseBtn then 
        _G.ColorPickerCloseBtn.BackgroundTransparency = 0.3 + 0.4 * _G.ColorPickerTrans 
    end

    if _G.ColorPickerHexInput then 
        _G.ColorPickerHexInput.BackgroundTransparency = _G.ColorPickerTrans 
    end 
end

OpenColorPicker = function() 
    if _G.ColorPickerOpen then return end 
    _G.ColorPickerOpen = true

    if _G.ColorPickerGui and _G.ColorPickerGui.Parent then 
        _G.ColorPickerGui:Destroy() 
    end 
    if _G.ColorPickerOverlay and _G.ColorPickerOverlay.Parent then
        _G.ColorPickerOverlay:Destroy()
    end
    
    CreateColorPicker()

    _G.ColorPickerH, _G.ColorPickerS, _G.ColorPickerV = ESPColor:ToHSV() 
    _G.ColorPickerCurrentHue = _G.ColorPickerH 
    _G.ColorPickerCurrentSat = _G.ColorPickerS 
    _G.ColorPickerCurrentVal = _G.ColorPickerV 
    UpdateColorPickerFromHSV()
    _G.ColorPickerGui.Visible = true 
    _G.ColorPickerGui.Size = UDim2.fromOffset(0, 0)
    _G.ColorPickerGui.BackgroundTransparency = 1
    _G.ColorPickerGui.AnchorPoint = Vector2.new(0.5, 0.5)
    
    if _G.ColorPickerShadow then
        _G.ColorPickerShadow.ImageTransparency = 1
    end
    
    if _G.ColorPickerStroke then
        _G.ColorPickerStroke.Transparency = 1
    end
    
    if _G.LastColorPickerPosition then
        _G.ColorPickerGui.Position = _G.LastColorPickerPosition
    else
        _G.ColorPickerGui.Position = UDim2.fromScale(0.5, 0.5)
    end
    
    if _G.ColorPickerPresetsFrame and _G.ColorPickerPresetsFrame.Parent then
        _G.ColorPickerPresetsFrame.BackgroundTransparency = 1
    end
    
    if _G.ColorPickerPresetsFrameStroke and _G.ColorPickerPresetsFrameStroke.Parent then
        _G.ColorPickerPresetsFrameStroke.Transparency = 1
    end
    
    if _G.ColorPickerPresetsFrame then
        _G.ColorPickerOpenPresetButtons = _G.ColorPickerPresetsFrame:GetChildren()
        _G.ColorPickerOpenPresetIndex = 1
        while _G.ColorPickerOpenPresetIndex <= #_G.ColorPickerOpenPresetButtons do
            _G.ColorPickerOpenPresetBtn = _G.ColorPickerOpenPresetButtons[_G.ColorPickerOpenPresetIndex]
            if _G.ColorPickerOpenPresetBtn:IsA("TextButton") then
                _G.ColorPickerOpenPresetBtn.BackgroundTransparency = 1
            end
            _G.ColorPickerOpenPresetIndex = _G.ColorPickerOpenPresetIndex + 1
        end
    end
    
    Services.TweenService:Create(_G.ColorPickerGui, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), { 
        Size = UDim2.fromOffset(300, 190),
        BackgroundTransparency = Settings.GUI_OPACITY / 100
    }):Play()
    
    if _G.ColorPickerShadow then
        Services.TweenService:Create(_G.ColorPickerShadow, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            ImageTransparency = 0.75
        }):Play()
    end
    
    if _G.ColorPickerStroke then
        Services.TweenService:Create(_G.ColorPickerStroke, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Transparency = 0.5
        }):Play()
    end
    
    task.delay(0.15, function()
        if _G.ColorPickerPresetsFrame and _G.ColorPickerPresetsFrame.Parent then
            Services.TweenService:Create(_G.ColorPickerPresetsFrame, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundTransparency = 0.3
            }):Play()
        end
        
        if _G.ColorPickerPresetsFrameStroke and _G.ColorPickerPresetsFrameStroke.Parent then
            Services.TweenService:Create(_G.ColorPickerPresetsFrameStroke, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                Transparency = 0.5
            }):Play()
        end
        
        if _G.ColorPickerPresetsFrame then
            _G.ColorPickerAnimPresetButtons = _G.ColorPickerPresetsFrame:GetChildren()
            _G.ColorPickerAnimPresetIndex = 1
            while _G.ColorPickerAnimPresetIndex <= #_G.ColorPickerAnimPresetButtons do
                _G.ColorPickerAnimPresetBtn = _G.ColorPickerAnimPresetButtons[_G.ColorPickerAnimPresetIndex]
                if _G.ColorPickerAnimPresetBtn:IsA("TextButton") then
                    Services.TweenService:Create(_G.ColorPickerAnimPresetBtn, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                        BackgroundTransparency = 0
                    }):Play()
                end
                _G.ColorPickerAnimPresetIndex = _G.ColorPickerAnimPresetIndex + 1
            end
        end
    end)
end

CloseColorPicker = function() 
    if not _G.ColorPickerOpen then return end 
    _G.ColorPickerOpen = false

    if _G.ColorPickerGui and _G.ColorPickerGui.Parent then 
        _G.LastColorPickerPosition = _G.ColorPickerGui.Position
        
        _G.ColorPickerCloseTween = TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
        
        Services.TweenService:Create(_G.ColorPickerGui, _G.ColorPickerCloseTween, { 
            Size = UDim2.fromOffset(0, 0),
            BackgroundTransparency = 1
        }):Play()
        
        if _G.ColorPickerStroke then
            Services.TweenService:Create(_G.ColorPickerStroke, _G.ColorPickerCloseTween, { 
                Transparency = 1
            }):Play()
        end
        
        if _G.ColorPickerShadow then
            Services.TweenService:Create(_G.ColorPickerShadow, _G.ColorPickerCloseTween, { 
                ImageTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerTitle then
            Services.TweenService:Create(_G.ColorPickerTitle, _G.ColorPickerCloseTween, { 
                TextTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerCloseBtn then
            Services.TweenService:Create(_G.ColorPickerCloseBtn, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1,
                TextTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerHueSaturation then
            Services.TweenService:Create(_G.ColorPickerHueSaturation, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerValueOverlay then
            Services.TweenService:Create(_G.ColorPickerValueOverlay, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerHueSatCursor then
            Services.TweenService:Create(_G.ColorPickerHueSatCursor, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerHueBar then
            Services.TweenService:Create(_G.ColorPickerHueBar, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerHueCursor then
            Services.TweenService:Create(_G.ColorPickerHueCursor, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerPreview then
            Services.TweenService:Create(_G.ColorPickerPreview, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerPreviewStroke then
            Services.TweenService:Create(_G.ColorPickerPreviewStroke, _G.ColorPickerCloseTween, { 
                Transparency = 1
            }):Play()
        end
        
        if _G.ColorPickerHexInput then
            Services.TweenService:Create(_G.ColorPickerHexInput, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1,
                TextTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerHexInputStroke then
            Services.TweenService:Create(_G.ColorPickerHexInputStroke, _G.ColorPickerCloseTween, { 
                Transparency = 1
            }):Play()
        end
        
        if _G.ColorPickerPresetsFrame and _G.ColorPickerPresetsFrame.Parent then
            Services.TweenService:Create(_G.ColorPickerPresetsFrame, _G.ColorPickerCloseTween, { 
                BackgroundTransparency = 1
            }):Play()
        end
        
        if _G.ColorPickerPresetsFrameStroke and _G.ColorPickerPresetsFrameStroke.Parent then
            Services.TweenService:Create(_G.ColorPickerPresetsFrameStroke, _G.ColorPickerCloseTween, { 
                Transparency = 1
            }):Play()
        end
        
        if _G.ColorPickerPresetsFrame then
            _G.ColorPickerClosePresetButtons = _G.ColorPickerPresetsFrame:GetChildren()
            _G.ColorPickerClosePresetIndex = 1
            while _G.ColorPickerClosePresetIndex <= #_G.ColorPickerClosePresetButtons do
                _G.ColorPickerClosePresetBtn = _G.ColorPickerClosePresetButtons[_G.ColorPickerClosePresetIndex]
                if _G.ColorPickerClosePresetBtn:IsA("TextButton") then
                    Services.TweenService:Create(_G.ColorPickerClosePresetBtn, _G.ColorPickerCloseTween, { 
                        BackgroundTransparency = 1
                    }):Play()
                end
                _G.ColorPickerClosePresetIndex = _G.ColorPickerClosePresetIndex + 1
            end
        end

        task.delay(0.3, function() 
            if _G.ColorPickerGui and _G.ColorPickerGui.Parent then 
                _G.ColorPickerGui:Destroy() 
                _G.ColorPickerGui = nil 
            end 
        end) 
    end
end

_G.OriginalUpdateGuiOpacity = Core._updateGuiOpacity
Core._updateGuiOpacity = function(opacity)
    _G.OriginalUpdateGuiOpacity(opacity)
    UpdateColorPickerOpacity()
end


_G.ColorPickerToggleVersion = 0
_G.ColorPickerPendingOperation = nil

_G.ColorPickerToggleVersion = 0
_G.ColorPickerPendingOperation = nil

espColorCard, _G.ColorPickerToggleGetState, _G.ColorPickerToggleSetState = Core.toggle(espSettingsContent, "ESP Color Picker", 3, false, function(state)
    _G.ColorPickerToggleVersion = _G.ColorPickerToggleVersion + 1
    _G.ColorPickerCurrentVersion = _G.ColorPickerToggleVersion
    
    if _G.ColorPickerPendingOperation then
        task.cancel(_G.ColorPickerPendingOperation)
        _G.ColorPickerPendingOperation = nil
    end
    
    if state then
        if _G.ColorPickerOpen then
            CloseColorPicker()
        end
        
        _G.ColorPickerPendingOperation = task.spawn(function()
            _G.ColorPickerWaitVersion = _G.ColorPickerCurrentVersion
            task.wait(0.2)
            
            if _G.ColorPickerToggleVersion == _G.ColorPickerWaitVersion then
                if _G.ColorPickerToggleGetState and _G.ColorPickerToggleGetState() then
                    if not _G.ColorPickerOpen then
                        OpenColorPicker()
                    end
                end
            end
            _G.ColorPickerPendingOperation = nil
        end)
    else
        if _G.ColorPickerOpen then
            CloseColorPicker()
        end
    end
end)
Core.registerModule("ESP Color Picker", espColorCard, espSettingsContent, "Visual", "toggle")

function ClearAllVisualEffects()
    for _, conn in pairs(VisualConns) do
        if conn then pcall(function() conn:Disconnect() end) end
    end
    VisualConns = {}
    for _, eff in pairs(VisualEffects) do
        if type(eff) == "table" then
            for _, e in ipairs(eff) do if e and e.Parent then pcall(function() e:Destroy() end) end end
        elseif eff and eff.Parent then
            pcall(function() eff:Destroy() end)
        end
    end
    VisualEffects = {}
    for _, c in ipairs(workspace:GetChildren()) do
        if c.Name:match("^VFX_") then pcall(function() c:Destroy() end) end
    end
end

function ApplyFireAura()
    _G.fireHrp = GetRoot()
    if _G.fireHrp then
        if VisualEffects.Fire then
            pcall(function() VisualEffects.Fire:Destroy() end)
            VisualEffects.Fire = nil
        end
        _G.fire = Instance.new("Fire")
        _G.fire.Name = "VFX_Fire"
        _G.fire.Size = 6
        _G.fire.Heat = 8
        _G.fire.Color = Color3.fromRGB(255, 100, 0)
        _G.fire.SecondaryColor = Color3.fromRGB(255, 200, 0)
        _G.fire.Parent = _G.fireHrp
        VisualEffects.Fire = _G.fire
    end
end

function RemoveFireAura()
    if VisualEffects.Fire then
        pcall(function() VisualEffects.Fire:Destroy() end)
        VisualEffects.Fire = nil
    end
end

function ApplyDiscoLights()
    ClearVisualConn("Disco")
    RemoveDiscoLights()
    local hrp = GetRoot()
    if hrp then
        local light = Instance.new("PointLight")
        light.Name = "VFX_Disco"
        light.Range = 25
        light.Brightness = 2
        light.Parent = hrp
        VisualEffects.Disco = light
        DiscoHue = 0
        VisualConns.Disco = Services.RunService.Heartbeat:Connect(function(dt)
            if VisualEffects.Disco and VisualEffects.Disco.Parent then
                DiscoHue = (DiscoHue + dt * 0.4) % 1
                VisualEffects.Disco.Color = Color3.fromHSV(DiscoHue, 1, 1)
            end
        end)
    end
end

function RemoveDiscoLights()
    ClearVisualConn("Disco")
    if VisualEffects.Disco then
        pcall(function() VisualEffects.Disco:Destroy() end)
        VisualEffects.Disco = nil
    end
end

function ApplyLaserEyes()
    ClearVisualConn("Laser")
    RemoveLaserEyes()
    local head = GetChar() and GetChar():FindFirstChild("Head")
    if head then
        local beams = {}
        for i = 1, 2 do
            local beam = Instance.new("Part")
            beam.Name = "VFX_Laser" .. i
            beam.Size = Vector3.new(0.08, 0.08, 40)
            beam.Anchored = true
            beam.CanCollide = false
            beam.Material = Enum.Material.Neon
            beam.Color = Color3.fromRGB(255, 0, 0)
            beam.CastShadow = false
            beam.Parent = workspace
            beams[i] = beam
        end
        VisualEffects.Lasers = beams
        VisualConns.Laser = Services.RunService.Heartbeat:Connect(function()
            local h = GetChar() and GetChar():FindFirstChild("Head")
            if h and beams[1] and beams[1].Parent then
                local cf = h.CFrame
                beams[1].CFrame = cf * CFrame.new(-0.25, 0.15, -20)
                beams[2].CFrame = cf * CFrame.new(0.25, 0.15, -20)
            end
        end)
    end
end

function RemoveLaserEyes()
    ClearVisualConn("Laser")
    if VisualEffects.Lasers then
        for _, b in ipairs(VisualEffects.Lasers) do pcall(function() b:Destroy() end) end
        VisualEffects.Lasers = nil
    end
end

function ApplyGalaxyOrbit()
    ClearVisualConn("Galaxy")
    RemoveGalaxyOrbit()
    local hrp = GetRoot()
    if hrp then
        local stars = {}
        for i = 1, 5 do
            local star = Instance.new("Part")
            star.Name = "VFX_Star" .. i
            star.Size = Vector3.new(0.4, 0.4, 0.4)
            star.Shape = Enum.PartType.Ball
            star.Anchored = true
            star.CanCollide = false
            star.Material = Enum.Material.Neon
            star.Color = Color3.fromHSV(i / 5, 1, 1)
            star.CastShadow = false
            star.Parent = workspace
            stars[i] = star
        end
        VisualEffects.Stars = stars
        GalaxyAngle = 0
        VisualConns.Galaxy = Services.RunService.Heartbeat:Connect(function(dt)
            GalaxyAngle = GalaxyAngle + dt * 1.5
            local root = GetRoot()
            if root and stars[1] and stars[1].Parent then
                local center = root.Position
                for i, star in ipairs(stars) do
                    local off = (i - 1) * (math.pi * 2 / 5)
                    star.Position = center + Vector3.new(
                        math.cos(GalaxyAngle + off) * 3.5,
                        math.sin(GalaxyAngle + off) * 1.5,
                        math.sin(GalaxyAngle + off) * 3.5
                    )
                    star.Color = Color3.fromHSV((GalaxyAngle * 0.1 + i / 5) % 1, 1, 1)
                end
            end
        end)
    end
end

function RemoveGalaxyOrbit()
    ClearVisualConn("Galaxy")
    if VisualEffects.Stars then
        for _, s in ipairs(VisualEffects.Stars) do pcall(function() s:Destroy() end) end
        VisualEffects.Stars = nil
    end
end

function ApplyNeonOutline()
    ClearVisualConn("Neon")
    RemoveNeonOutline()
    local char = GetChar()
    if char then
        local hl = Instance.new("Highlight")
        hl.Name = "VFX_Neon"
        hl.FillTransparency = 1
        hl.OutlineTransparency = 0
        hl.Adornee = char
        hl.Parent = char
        VisualEffects.Neon = hl
        NeonHue = 0
        VisualConns.Neon = Services.RunService.Heartbeat:Connect(function(dt)
            if VisualEffects.Neon and VisualEffects.Neon.Parent then
                NeonHue = (NeonHue + dt * 0.25) % 1
                VisualEffects.Neon.OutlineColor = Color3.fromHSV(NeonHue, 1, 1)
            end
        end)
    end
end

function RemoveNeonOutline()
    ClearVisualConn("Neon")
    if VisualEffects.Neon then
        pcall(function() VisualEffects.Neon:Destroy() end)
        VisualEffects.Neon = nil
    end
end

local fireCard, _, setFireState = Core.toggle(visualContent, "Fire Aura", 1, false, function(state)
    FireAuraEnabled = state
    if state then ApplyFireAura() else RemoveFireAura() end
end)

local discoCard, _, setDiscoState = Core.toggle(visualContent, "Disco Lights", 2, false, function(state)
    DiscoLightsEnabled = state
    if state then ApplyDiscoLights() else RemoveDiscoLights() end
end)

local laserCard, _, setLaserState = Core.toggle(visualContent, "Laser Eyes", 3, false, function(state)
    LaserEyesEnabled = state
    if state then ApplyLaserEyes() else RemoveLaserEyes() end
end)

local galaxyCard, _, setGalaxyState = Core.toggle(visualContent, "Galaxy Orbit", 4, false, function(state)
    GalaxyOrbitEnabled = state
    if state then ApplyGalaxyOrbit() else RemoveGalaxyOrbit() end
end)

local neonCard, _, setNeonState = Core.toggle(visualContent, "Neon Outline", 5, false, function(state)
    NeonOutlineEnabled = state
    if state then ApplyNeonOutline() else RemoveNeonOutline() end
end)

_G.clearCard = Core.moduleCard(visualContent, 6)

_G.clearBtn = Instance.new("TextButton", _G.clearCard)
_G.clearBtn.Size = UDim2.fromScale(1, 1)
_G.clearBtn.BackgroundTransparency = 1
_G.clearBtn.Text = "Clear All Visual Effects"
_G.clearBtn.Font = Enum.Font.FredokaOne
_G.clearBtn.TextSize = Settings.IS_MOBILE and 12 or 14
_G.clearBtn.TextColor3 = Color3.new(1, 1, 1)
_G.clearBtn.ZIndex = 10

_G.clearBtn.MouseEnter:Connect(function()
    Services.TweenService:Create(_G.clearCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.1}):Play()
end)

_G.clearBtn.MouseLeave:Connect(function()
    Services.TweenService:Create(_G.clearCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.3}):Play()
end)

_G.clearBtn.MouseButton1Click:Connect(function()
    Services.TweenService:Create(_G.clearCard, TweenInfo.new(0.1), {BackgroundColor3 = Colors.InteractiveActive}):Play()
    task.delay(0.15, function()
        Services.TweenService:Create(_G.clearCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card}):Play()
    end)
    FireAuraEnabled = false
    DiscoLightsEnabled = false
    LaserEyesEnabled = false
    GalaxyOrbitEnabled = false
    NeonOutlineEnabled = false
    setFireState(false)
    setDiscoState(false)
    setLaserState(false)
    setGalaxyState(false)
    setNeonState(false)
    ClearAllVisualEffects()
end)

Core.registerModule("Fire Aura", fireCard, visualContent, "Visual", "toggle")
Core.registerModule("Disco Lights", discoCard, visualContent, "Visual", "toggle")
Core.registerModule("Laser Eyes", laserCard, visualContent, "Visual", "toggle")
Core.registerModule("Galaxy Orbit", galaxyCard, visualContent, "Visual", "toggle")
Core.registerModule("Neon Outline", neonCard, visualContent, "Visual", "toggle")
Core.registerModule("Clear All Effects", clearCard, visualContent, "Visual", "button")

Player.CharacterAdded:Connect(function(newChar)
    task.wait(0.8)
    if FireAuraEnabled then
        RemoveFireAura()
        task.wait(0.1)
        ApplyFireAura()
    end
    if DiscoLightsEnabled then
        RemoveDiscoLights()
        task.wait(0.1)
        ApplyDiscoLights()
    end
    if LaserEyesEnabled then
        RemoveLaserEyes()
        task.wait(0.1)
        ApplyLaserEyes()
    end
    if GalaxyOrbitEnabled then
        RemoveGalaxyOrbit()
        task.wait(0.1)
        ApplyGalaxyOrbit()
    end
    if NeonOutlineEnabled then
        RemoveNeonOutline()
        task.wait(0.1)
        ApplyNeonOutline()
    end
end)

_G.Services = {
    Players = game:GetService("Players"),
    RunService = game:GetService("RunService"),
    UserInputService = game:GetService("UserInputService"),
    LocalPlayer = game:GetService("Players").LocalPlayer
}

_G.Combat.Functions.GetCamera = function()
    return workspace.CurrentCamera
end

pcall(function()
    if readfile and isfile and isfile("AimbotBind.txt") then
        local data = readfile("AimbotBind.txt")
        local parts = data:split(",")
        if #parts == 2 then
            local success, enumType = pcall(function() return Enum[parts[1]] end)
            if success and enumType then
                local success2, enumValue = pcall(function() return enumType[parts[2]] end)
                if success2 and enumValue then
                    _G.Combat.Settings.Aimbot.Bind = {Type = parts[1], Value = enumValue}
                end
            end
        end
    end
end)

_G.Combat.Circles.Silent = Drawing.new("Circle")
_G.Combat.Circles.Silent.Thickness = 1.5
_G.Combat.Circles.Silent.Filled = false
_G.Combat.Circles.Silent.NumSides = 64
_G.Combat.Circles.Silent.Color = Color3.fromRGB(255, 255, 255)
_G.Combat.Circles.Silent.Visible = false
_G.Combat.Circles.Silent.Radius = 100

_G.Combat.Circles.Aimbot = Drawing.new("Circle")
_G.Combat.Circles.Aimbot.Thickness = 1.5
_G.Combat.Circles.Aimbot.Filled = false
_G.Combat.Circles.Aimbot.NumSides = 64
_G.Combat.Circles.Aimbot.Color = Color3.fromRGB(255, 255, 255)
_G.Combat.Circles.Aimbot.Visible = false
_G.Combat.Circles.Aimbot.Radius = 200

_G.Combat.Functions.IsVisible = function(part)
    if not part then return false end
    local camera = _G.Combat.Functions.GetCamera()
    local origin = camera.CFrame.Position
    local direction = (part.Position - origin)
    local params = RaycastParams.new()
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.FilterDescendantsInstances = {_G.Services.LocalPlayer.Character or {}, camera}
    local result = workspace:Raycast(origin, direction, params)
    if not result then return true end
    return result.Instance:IsDescendantOf(part.Parent)
end

_G.Combat.Functions.IsTeammate = function(player)
    if not _G.Combat.Settings.Aimbot.TeamCheck then return false end
    local localTeam = _G.Services.LocalPlayer.Team
    local playerTeam = player.Team
    if not localTeam or not playerTeam then return false end
    return localTeam == playerTeam
end

_G.Combat.Functions.IsBasicallyAlive = function(player)
    if not player then return false end
    if player == _G.Services.LocalPlayer then return false end
    local char = player.Character
    if not char then return false end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum or hum.Health <= 0 then return false end
    return true
end

_G.Combat.Functions.IsValidTarget = function(player)
    if not _G.Combat.Functions.IsBasicallyAlive(player) then 
        return false 
    end
    local char = player.Character
    local partName = _G.Combat.Settings.Aimbot.Part or "Head"
    local part = char:FindFirstChild(partName) or char:FindFirstChild("Head") or char:FindFirstChild("HumanoidRootPart")
    if not part then 
        return false 
    end
    if _G.Combat.Functions.IsTeammate(player) then 
        return false 
    end
    if _G.Combat.Settings.Aimbot.WallCheck and not _G.Combat.Functions.IsVisible(part) then 
        return false 
    end
    return true
end

_G.Combat.Functions.IsInFOV = function(player)
    if not player or not player.Character then return false, math.huge end
    local camera = _G.Combat.Functions.GetCamera()
    local partName = _G.Combat.Settings.Aimbot.Part or "Head"
    local part = player.Character:FindFirstChild(partName) or player.Character:FindFirstChild("Head")
    if not part then return false, math.huge end
    local screenPos, onScreen = camera:WorldToViewportPoint(part.Position)
    if not onScreen then return false, math.huge end
    local center = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    local distance = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
    return distance <= _G.Combat.Settings.Aimbot.FOV, distance
end

_G.Combat.Functions.GetClosestInFOV = function()
    local bestPlayer = nil
    local bestDistance = math.huge
    for _, player in pairs(_G.Services.Players:GetPlayers()) do
        if _G.Combat.Functions.IsValidTarget(player) then
            local inFOV, distance = _G.Combat.Functions.IsInFOV(player)
            if inFOV and distance < bestDistance then
                bestDistance = distance
                bestPlayer = player
            end
        end
    end
    return bestPlayer
end

_G.Combat.Functions.GetTargetPart = function(player)
    if not player or not player.Character then return nil end
    local partName = _G.Combat.Settings.Aimbot.Part or "Head"
    return player.Character:FindFirstChild(partName) 
        or player.Character:FindFirstChild("Head") 
        or player.Character:FindFirstChild("HumanoidRootPart")
end

_G.Combat.Functions.UpdateHitboxes = function()
    _G.Combat.Data.HitboxNeedsUpdate = false
    for _, player in pairs(_G.Services.Players:GetPlayers()) do
        if player ~= _G.Services.LocalPlayer and player.Character then
            local hrp = player.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                local shouldExpand = _G.Combat.Settings.HitboxExpander.Enabled
                if shouldExpand and _G.Combat.Settings.HitboxExpander.TeamCheck then
                    local localTeam = _G.Services.LocalPlayer.Team
                    local playerTeam = player.Team
                    if localTeam and playerTeam and localTeam == playerTeam then
                        shouldExpand = false
                    end
                end
                if shouldExpand then
                    hrp.Size = Vector3.new(
                        _G.Combat.Settings.HitboxExpander.Size,
                        _G.Combat.Settings.HitboxExpander.Size,
                        _G.Combat.Settings.HitboxExpander.Size
                    )
                    if _G.Combat.Settings.HitboxExpander.ShowHitbox then
                        hrp.Transparency = _G.Combat.Settings.HitboxExpander.Transparency / 100
                    else
                        hrp.Transparency = 1
                    end
                    hrp.Material = Enum.Material.Neon
                    hrp.CanCollide = false
                else
                    hrp.Size = Vector3.new(2, 2, 1)
                    hrp.Transparency = 1
                    hrp.Material = Enum.Material.Plastic
                    hrp.CanCollide = false
                end
            end
        end
    end
end

_G.Combat.Functions.UpdateSilentHeads = function()
    local S = _G.Combat.Settings.SilentAim
    if not S.Enabled then
        for player, size in pairs(_G.Combat.Data.OriginalHeadSizes) do
            pcall(function()
                if player and player.Character then
                    local head = player.Character:FindFirstChild("Head")
                    if head then
                        head.Size = size
                        head.Transparency = 0
                    end
                end
            end)
        end
        _G.Combat.Data.OriginalHeadSizes = {}
        return
    end
    local camera = _G.Combat.Functions.GetCamera()
    local center = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    local radius = S.FOVSize * 4
    for _, player in pairs(_G.Services.Players:GetPlayers()) do
        if player ~= _G.Services.LocalPlayer and player.Character then
            local head = player.Character:FindFirstChild("Head")
            local hum = player.Character:FindFirstChildOfClass("Humanoid")
            if head and hum and hum.Health > 0 then
                local isTeammate = false
                if S.TeamCheck then
                    local localTeam = _G.Services.LocalPlayer.Team
                    local playerTeam = player.Team
                    if localTeam and playerTeam and localTeam == playerTeam then
                        isTeammate = true
                    end
                end
                local screenPos, onScreen = camera:WorldToViewportPoint(head.Position)
                local distance = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
                if not _G.Combat.Data.OriginalHeadSizes[player] then
                    _G.Combat.Data.OriginalHeadSizes[player] = head.Size
                end
                if onScreen and distance <= radius and not isTeammate then
                    head.Size = Vector3.new(S.HeadSize, S.HeadSize, S.HeadSize)
                    head.Transparency = 0.9
                else
                    head.Size = _G.Combat.Data.OriginalHeadSizes[player]
                    head.Transparency = 0
                end
            end
        end
    end
end

_G.Combat.Functions.FullCleanup = function()
    if not _G.Combat or not _G.Combat.Data.Initialized then return end
    _G.Combat.Settings.HitboxExpander.Enabled = false
    _G.Combat.Settings.SilentAim.Enabled = false
    _G.Combat.Settings.Aimbot.PCEnabled = false
    _G.Combat.Settings.Aimbot.MobileEnabled = false
    _G.Combat.Data.AimbotActive = false
    _G.Combat.Data.CurrentTarget = nil
    
    for _, player in pairs(_G.Services.Players:GetPlayers()) do
        if player ~= _G.Services.LocalPlayer and player.Character then
            local hrp = player.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.Size = Vector3.new(2, 2, 1)
                hrp.Transparency = 1
                hrp.Material = Enum.Material.Plastic
            end
        end
    end
    
    for player, size in pairs(_G.Combat.Data.OriginalHeadSizes) do
        pcall(function()
            if player and player.Character then
                local head = player.Character:FindFirstChild("Head")
                if head then
                    head.Size = size
                    head.Transparency = 0
                end
            end
        end)
    end
    _G.Combat.Data.OriginalHeadSizes = {} 
    if _G.Combat.Circles.Silent then
        _G.Combat.Circles.Silent.Visible = false
    end
    if _G.Combat.Circles.Aimbot then
        _G.Combat.Circles.Aimbot.Visible = false
    end
    end

_G.Combat.Functions.SaveBind = function()
    pcall(function()
        if writefile then
            local b = _G.Combat.Settings.Aimbot.Bind
            writefile("AimbotBind.txt", b.Type .. "," .. b.Value.Name)
        end
    end)
end

_G.Combat.Functions.IsBind = function(input)
    local bind = _G.Combat.Settings.Aimbot.Bind
    if bind.Type == "KeyCode" then
        return input.KeyCode == bind.Value
    elseif bind.Type == "UserInputType" then
        return input.UserInputType == bind.Value
    end
    return false
end

_G.Combat.Data.Connections.InputBegan = _G.Services.UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if not _G.Combat.Functions.IsBind(input) then return end
    if not _G.Combat.Settings.Aimbot.PCEnabled then return end
    local mode = _G.Combat.Settings.Aimbot.Mode
    if mode == "Hold" then
        _G.Combat.Data.AimbotActive = true
        _G.Combat.Data.CurrentTarget = _G.Combat.Functions.GetClosestInFOV()
    else
        _G.Combat.Data.AimbotActive = not _G.Combat.Data.AimbotActive
        if _G.Combat.Data.AimbotActive then
            _G.Combat.Data.CurrentTarget = _G.Combat.Functions.GetClosestInFOV()
        else
            _G.Combat.Data.CurrentTarget = nil
        end
    end
end)

_G.Combat.Data.Connections.InputEnded = _G.Services.UserInputService.InputEnded:Connect(function(input)
    if not _G.Combat.Functions.IsBind(input) then return end
    if _G.Combat.Settings.Aimbot.Mode == "Hold" then
        _G.Combat.Data.AimbotActive = false
        _G.Combat.Data.CurrentTarget = nil
    end
end)

_G.Combat.Data.Connections.Render = _G.Services.RunService.RenderStepped:Connect(function(dt)
    if not _G.Combat or not _G.Combat.Data.Initialized then return end
    local camera = _G.Combat.Functions.GetCamera()
    local center = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    local S = _G.Combat.Settings
    local D = _G.Combat.Data
    local C = _G.Combat.Circles
    if C.Silent then
        if S.SilentAim.RainbowFOV and S.SilentAim.Enabled then
            D.RainbowHue = (D.RainbowHue + dt * 0.5) % 1
            C.Silent.Color = Color3.fromHSV(D.RainbowHue, 1, 1)
        else
            C.Silent.Color = Color3.fromRGB(255, 255, 255)
        end
        C.Silent.Position = center
        C.Silent.Radius = S.SilentAim.FOVSize * 4
        C.Silent.Visible = S.SilentAim.Enabled and S.SilentAim.ShowFOV
    end
    if C.Aimbot then
        C.Aimbot.Position = center
        C.Aimbot.Radius = S.Aimbot.FOV
        C.Aimbot.Visible = (S.Aimbot.PCEnabled or S.Aimbot.MobileEnabled) and S.Aimbot.ShowFOV
    end
    local shouldAim = (S.Aimbot.PCEnabled and D.AimbotActive) or S.Aimbot.MobileEnabled
    if shouldAim then
        if D.CurrentTarget then
            if not _G.Combat.Functions.IsBasicallyAlive(D.CurrentTarget) then
                D.CurrentTarget = nil
            end
        end
        if not D.CurrentTarget then
            D.CurrentTarget = _G.Combat.Functions.GetClosestInFOV()
        end
        if D.CurrentTarget then
            local part = _G.Combat.Functions.GetTargetPart(D.CurrentTarget)
            if part then
                local targetCFrame = CFrame.new(camera.CFrame.Position, part.Position)
                local lerpValue = S.Aimbot.Speed / 100
                camera.CFrame = camera.CFrame:Lerp(targetCFrame, lerpValue)
            end
        end
    end
    _G.Combat.Functions.UpdateSilentHeads()
    if D.HitboxNeedsUpdate then
        _G.Combat.Functions.UpdateHitboxes()
    end
end)

_G.Combat.Data.Connections.PlayerAdded = _G.Services.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        task.wait(1)
        if _G.Combat and _G.Combat.Data.Initialized then
            _G.Combat.Data.HitboxNeedsUpdate = true
        end
    end)
end)

_G.Combat.Data.Connections.PlayerRemoving = _G.Services.Players.PlayerRemoving:Connect(function(player)
    if player == _G.Services.LocalPlayer then
        _G.Combat.Functions.FullCleanup()
        return
    end
    if _G.Combat.Data.CurrentTarget == player then
        _G.Combat.Data.CurrentTarget = nil
    end
    _G.Combat.Data.OriginalHeadSizes[player] = nil
end)

for _, player in pairs(_G.Services.Players:GetPlayers()) do
    if player ~= _G.Services.LocalPlayer then
        player.CharacterAdded:Connect(function()
            task.wait(1)
            if _G.Combat and _G.Combat.Data.Initialized then
                _G.Combat.Data.HitboxNeedsUpdate = true
            end
        end)
    end
end

if UI.Gui then
    UI.Gui.AncestryChanged:Connect(function(_, parent)
        if not parent then _G.Combat.Functions.FullCleanup() end
    end)
end
_G.CleanupCombat = _G.Combat.Functions.FullCleanup

_G.Combat.UI.HitboxToggle = Core.toggle(hitboxContent, "Hitbox Expander", 1, false, function(state)
    _G.Combat.Settings.HitboxExpander.Enabled = state
    _G.Combat.Data.HitboxNeedsUpdate = true
end)
Core.registerModule("Hitbox Expander", _G.Combat.UI.HitboxToggle, hitboxContent, "Combat", "toggle")

_G.Combat.UI.HitboxTeamCheck = Core.toggle(hitboxContent, "Team Check", 2, true, function(state)
    _G.Combat.Settings.HitboxExpander.TeamCheck = state
    _G.Combat.Data.HitboxNeedsUpdate = true
end)
Core.registerModule("Hitbox Team Check", _G.Combat.UI.HitboxTeamCheck, hitboxContent, "Combat", "toggle")

_G.Combat.UI.HitboxShow = Core.toggle(hitboxContent, "Show Hitbox", 3, true, function(state)
    _G.Combat.Settings.HitboxExpander.ShowHitbox = state
    _G.Combat.Data.HitboxNeedsUpdate = true
end)
Core.registerModule("Show Hitbox", _G.Combat.UI.HitboxShow, hitboxContent, "Combat", "toggle")

_G.Combat.UI.HitboxSize = Core.slider(hitboxContent, "Hitbox Size", 4, 1, 50, 25, function(v)
    _G.Combat.Settings.HitboxExpander.Size = v
    _G.Combat.Data.HitboxNeedsUpdate = true
end)
Core.registerModule("Hitbox Size", _G.Combat.UI.HitboxSize, hitboxContent, "Combat", "slider")

_G.Combat.UI.HitboxTrans = Core.slider(hitboxContent, "Hitbox Transparency", 5, 0, 100, 70, function(v)
    _G.Combat.Settings.HitboxExpander.Transparency = v
    _G.Combat.Data.HitboxNeedsUpdate = true
end)
Core.registerModule("Hitbox Transparency", _G.Combat.UI.HitboxTrans, hitboxContent, "Combat", "slider")

_G.Combat.UI.SilentToggle = Core.toggle(silentContent, "Silent Aim", 1, false, function(state)
    _G.Combat.Settings.SilentAim.Enabled = state
end)
Core.registerModule("Silent Aim", _G.Combat.UI.SilentToggle, silentContent, "Combat", "toggle")

_G.Combat.UI.SilentShowFOV = Core.toggle(silentContent, "Show FOV Circle", 2, true, function(state)
    _G.Combat.Settings.SilentAim.ShowFOV = state
end)
Core.registerModule("Show FOV Circle", _G.Combat.UI.SilentShowFOV, silentContent, "Combat", "toggle")

_G.Combat.UI.SilentRainbow = Core.toggle(silentContent, "Rainbow FOV", 3, false, function(state)
    _G.Combat.Settings.SilentAim.RainbowFOV = state
end)
Core.registerModule("Rainbow FOV", _G.Combat.UI.SilentRainbow, silentContent, "Combat", "toggle")

_G.Combat.UI.SilentFOVSize = Core.slider(silentContent, "FOV Size", 4, 1, 200, 100, function(v)
    _G.Combat.Settings.SilentAim.FOVSize = v
end)
Core.registerModule("FOV Size", _G.Combat.UI.SilentFOVSize, silentContent, "Combat", "slider")

_G.Combat.UI.SilentHeadSize = Core.slider(silentContent, "Head Size", 5, 1, 30, 10, function(v)
    _G.Combat.Settings.SilentAim.HeadSize = v
end)
Core.registerModule("Head Size", _G.Combat.UI.SilentHeadSize, silentContent, "Combat", "slider")

_G.Combat.UI.SilentTeam = Core.toggle(silentContent, "Team Check", 6, true, function(state)
    _G.Combat.Settings.SilentAim.TeamCheck = state
end)
Core.registerModule("Team Check", _G.Combat.UI.SilentTeam, silentContent, "Combat", "toggle")

_G.XRayEnabled = false
_G.XRayTransparency = 0.5
_G.XRayConnection = nil
_G.XRayMakePart = function(part)
    if part:FindFirstAncestorOfClass("Model") and
       part:FindFirstAncestorOfClass("Model"):FindFirstChildOfClass("Humanoid") then
        return
    end
    part.LocalTransparencyModifier = _G.XRayTransparency
end
_G.XRayRecurse = function(object)
    if object:IsA("BasePart") then
        _G.XRayMakePart(object)
    end
    if object:FindFirstChildOfClass("Humanoid") then return end
    for _, child in pairs(object:GetChildren()) do
        _G.XRayRecurse(child)
    end
end
_G.EnableXRay = function()
    if _G.XRayConnection then
        _G.XRayConnection:Disconnect()
        _G.XRayConnection = nil
    end
    _G.XRayEnabled = true
    for _, part in ipairs(workspace:GetDescendants()) do
        if part:IsA("BasePart") then
            _G.XRayMakePart(part)
        end
    end
    _G.XRayConnection = workspace.DescendantAdded:Connect(function(child)
        if _G.XRayEnabled then
            _G.XRayRecurse(child)
        end
    end)
end
_G.DisableXRay = function()
    _G.XRayEnabled = false
    if _G.XRayConnection then
        _G.XRayConnection:Disconnect()
        _G.XRayConnection = nil
    end
    for _, part in ipairs(workspace:GetDescendants()) do
        if part:IsA("BasePart") then
            part.LocalTransparencyModifier = 0
        end
    end
end
_G.FPSOriginalMaterials = {}
_G.FPSMaterialConnection = nil

local fpsBoosterToggle = Core.toggle(texturesContent, "FPS Booster", 1, false, function(state)
    if state then
        _G.FPSOriginalMaterials = _G.FPSOriginalMaterials or {}
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") and not _G.FPSOriginalMaterials[obj] then
                _G.FPSOriginalMaterials[obj] = obj.Material
                obj.Material = Enum.Material.Plastic
            end
        end
        if not _G.FPSMaterialConnection then
            _G.FPSMaterialConnection = workspace.DescendantAdded:Connect(function(obj)
                if obj:IsA("BasePart") and not _G.FPSOriginalMaterials[obj] then
                    _G.FPSOriginalMaterials[obj] = obj.Material
                    obj.Material = Enum.Material.Plastic
                end
            end)
        end
    else
        if _G.FPSOriginalMaterials then
            for obj, originalMat in pairs(_G.FPSOriginalMaterials) do
                if obj and obj.Parent and obj:IsA("BasePart") then
                    pcall(function()
                        obj.Material = originalMat
                    end)
                end
            end
        end
        _G.FPSOriginalMaterials = {}
        if _G.FPSMaterialConnection then
            _G.FPSMaterialConnection:Disconnect()
            _G.FPSMaterialConnection = nil
        end
    end
end)

_G.xRayToggle = Core.toggle(wallVisionContent, "X-Ray", 1, false, function(state)
    if state then _G.EnableXRay() else _G.DisableXRay() end
end)

_G.xRaySliderCard = Core.slider(wallVisionContent, "X-Ray Transparency", 2, 1, 9, 5, function(value)
    _G.XRayTransparency = value * 0.1
    if _G.XRayEnabled then
        _G.DisableXRay()
        _G.EnableXRay()
    end
end)

Player.CharacterAdded:Connect(function()
    task.wait(2)
    if fpsBoosterToggle.Value then
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") and not _G.FPSOriginalMaterials[obj] then
                _G.FPSOriginalMaterials[obj] = obj.Material
                obj.Material = Enum.Material.Plastic
            end
        end
    end
end)

local miscContent = Core.section(Misc, "Misc Features", 1)

_G.AntiAFKConnection = nil

_G.EnableAntiAFK = function()
    if _G.AntiAFKConnection then return end
    local VirtualUser = game:GetService("VirtualUser")
    _G.AntiAFKConnection = game.Players.LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end)
end

_G.DisableAntiAFK = function()
    if _G.AntiAFKConnection then
        _G.AntiAFKConnection:Disconnect()
        _G.AntiAFKConnection = nil
    end
end

_G.AntiFling = {}

_G.AntiFling.Enabled = false
_G.AntiFling.Connection = nil
_G.AntiFling.CollisionConnection = nil
_G.AntiFling.CharacterConnection = nil
_G.AntiFling.SafeCFrame = nil
_G.AntiFling.LastUpdate = 0
_G.AntiFling.UpdateInterval = 0.1
_G.AntiFling.SpawnTime = 0
_G.AntiFling.SpawnDelay = 1.0
_G.AntiFling.MaxAngular = 50
_G.AntiFling.MaxHorizontal = 200
_G.AntiFling.Character = nil
_G.AntiFling.HRP = nil
_G.AntiFling.Humanoid = nil
_G.AntiFling.Vel = nil
_G.AntiFling.Ang = nil
_G.AntiFling.HVel = 0
_G.AntiFling.AMag = 0
_G.AntiFling.CurrentTime = 0
_G.AntiFling.IsFlung = false

_G.AntiFling.GetCharacter = function()
    _G.AntiFling.Character = Player.Character
    if not _G.AntiFling.Character then return false end
    
    _G.AntiFling.HRP = _G.AntiFling.Character:FindFirstChild("HumanoidRootPart")
    _G.AntiFling.Humanoid = _G.AntiFling.Character:FindFirstChildOfClass("Humanoid")
    
    if not _G.AntiFling.HRP then return false end
    if not _G.AntiFling.Humanoid then return false end
    if _G.AntiFling.Humanoid.Health <= 0 then return false end
    
    return true
end

_G.AntiFling.IsGrounded = function()
    if not _G.AntiFling.Humanoid then return false end
    return _G.AntiFling.Humanoid.FloorMaterial ~= Enum.Material.Air
end

_G.AntiFling.SaveSafePosition = function()
    if not _G.AntiFling.GetCharacter() then return end
    if not _G.AntiFling.IsGrounded() then return end
    
    _G.AntiFling.Vel = _G.AntiFling.HRP.AssemblyLinearVelocity
    _G.AntiFling.Ang = _G.AntiFling.HRP.AssemblyAngularVelocity
    
    _G.AntiFling.HVel = Vector3.new(_G.AntiFling.Vel.X, 0, _G.AntiFling.Vel.Z).Magnitude
    _G.AntiFling.AMag = _G.AntiFling.Ang.Magnitude
    
    if _G.AntiFling.HVel < 30 and _G.AntiFling.AMag < 5 then
        _G.AntiFling.SafeCFrame = _G.AntiFling.HRP.CFrame
        _G.AntiFling.IsFlung = false
    end
end

_G.AntiFling.DetectAndStop = function()
    if not _G.AntiFling.HRP then return end
    if not _G.AntiFling.HRP.Parent then return end
    
    _G.AntiFling.Vel = _G.AntiFling.HRP.AssemblyLinearVelocity
    _G.AntiFling.Ang = _G.AntiFling.HRP.AssemblyAngularVelocity
    
    _G.AntiFling.AMag = _G.AntiFling.Ang.Magnitude
    _G.AntiFling.HVel = Vector3.new(_G.AntiFling.Vel.X, 0, _G.AntiFling.Vel.Z).Magnitude
    
    if _G.AntiFling.AMag > _G.AntiFling.MaxAngular then
        _G.AntiFling.HRP.AssemblyAngularVelocity = Vector3.zero
        _G.AntiFling.IsFlung = true
    end
    
    if _G.AntiFling.HVel > _G.AntiFling.MaxHorizontal and _G.AntiFling.AMag > 30 then
        _G.AntiFling.HRP.AssemblyLinearVelocity = Vector3.new(0, _G.AntiFling.Vel.Y, 0)
        _G.AntiFling.HRP.AssemblyAngularVelocity = Vector3.zero
        _G.AntiFling.IsFlung = true
    end
    
    if _G.AntiFling.IsFlung and _G.AntiFling.SafeCFrame then
        _G.AntiFling.HRP.CFrame = _G.AntiFling.SafeCFrame
        _G.AntiFling.HRP.AssemblyLinearVelocity = Vector3.zero
        _G.AntiFling.HRP.AssemblyAngularVelocity = Vector3.zero
        _G.AntiFling.IsFlung = false
    end
end

_G.AntiFling.DisableCollisions = function()
    _G.AntiFling.CollisionIndex = nil
    _G.AntiFling.CollisionPlayer = nil
    _G.AntiFling.CollisionPart = nil
    _G.AntiFling.CollisionPlayers = Services.Players:GetPlayers()
    
    _G.AntiFling.CollisionIndex = 1
    while _G.AntiFling.CollisionIndex <= #_G.AntiFling.CollisionPlayers do
        _G.AntiFling.CollisionPlayer = _G.AntiFling.CollisionPlayers[_G.AntiFling.CollisionIndex]
        
        if _G.AntiFling.CollisionPlayer ~= Player and _G.AntiFling.CollisionPlayer.Character then
            _G.AntiFling.CollisionParts = _G.AntiFling.CollisionPlayer.Character:GetDescendants()
            _G.AntiFling.CollisionPartIndex = 1
            
            while _G.AntiFling.CollisionPartIndex <= #_G.AntiFling.CollisionParts do
                _G.AntiFling.CollisionPart = _G.AntiFling.CollisionParts[_G.AntiFling.CollisionPartIndex]
                
                if _G.AntiFling.CollisionPart:IsA("BasePart") then
                    _G.AntiFling.CollisionPart.CanCollide = false
                end
                
                _G.AntiFling.CollisionPartIndex = _G.AntiFling.CollisionPartIndex + 1
            end
        end
        
        _G.AntiFling.CollisionIndex = _G.AntiFling.CollisionIndex + 1
    end
end

_G.AntiFling.MainLoop = function()
    if not _G.AntiFling.Enabled then return end
    
    _G.AntiFling.CurrentTime = tick()
    
    if _G.AntiFling.CurrentTime - _G.AntiFling.SpawnTime < _G.AntiFling.SpawnDelay then return end
    
    if not _G.AntiFling.GetCharacter() then return end
    
    _G.AntiFling.DetectAndStop()
    
    if _G.AntiFling.CurrentTime - _G.AntiFling.LastUpdate >= _G.AntiFling.UpdateInterval then
        _G.AntiFling.LastUpdate = _G.AntiFling.CurrentTime
        _G.AntiFling.SaveSafePosition()
        _G.AntiFling.DisableCollisions()
    end
end

_G.AntiFling.Start = function()
    if _G.AntiFling.Connection then
        _G.AntiFling.Connection:Disconnect()
        _G.AntiFling.Connection = nil
    end
    
    if _G.AntiFling.CharacterConnection then
        _G.AntiFling.CharacterConnection:Disconnect()
        _G.AntiFling.CharacterConnection = nil
    end
    
    _G.AntiFling.Enabled = true
    _G.AntiFling.SpawnTime = tick()
    _G.AntiFling.SafeCFrame = nil
    _G.AntiFling.IsFlung = false
    
    if _G.AntiFling.GetCharacter() and _G.AntiFling.IsGrounded() then
        _G.AntiFling.SafeCFrame = _G.AntiFling.HRP.CFrame
    end
    
    _G.AntiFling.Connection = Services.RunService.Heartbeat:Connect(_G.AntiFling.MainLoop)
    
    _G.AntiFling.CharacterConnection = Player.CharacterAdded:Connect(function()
        _G.AntiFling.SpawnTime = tick()
        _G.AntiFling.SafeCFrame = nil
        _G.AntiFling.IsFlung = false
        
        task.delay(1.5, function()
            if _G.AntiFling.Enabled and _G.AntiFling.GetCharacter() and _G.AntiFling.IsGrounded() then
                _G.AntiFling.SafeCFrame = _G.AntiFling.HRP.CFrame
            end
        end)
    end)
end

_G.AntiFling.Stop = function()
    _G.AntiFling.Enabled = false
    
    if _G.AntiFling.Connection then
        _G.AntiFling.Connection:Disconnect()
        _G.AntiFling.Connection = nil
    end
    
    if _G.AntiFling.CharacterConnection then
        _G.AntiFling.CharacterConnection:Disconnect()
        _G.AntiFling.CharacterConnection = nil
    end
    
    _G.AntiFling.SafeCFrame = nil
    _G.AntiFling.IsFlung = false
end

_G.AntiFling.Toggle = function(state)
    if state then
        _G.AntiFling.Start()
    else
        _G.AntiFling.Stop()
    end
end

_G.antiFlingToggle, _G.antiFlingToggleCard, _G.antiFlingToggleSetState = Core.toggle(miscContent, "Anti Fling", 2, true, function(state)
    _G.AntiFling.Toggle(state)
end)

Core.registerModule("Anti Fling", _G.antiFlingToggle, miscContent, "Misc", "toggle")

_G.AntiFling.Start()

_G.antiAFKToggle, _G.antiAFKCard, _G.antiAFKSetState = Core.toggle(miscContent, "Anti AFK", 1, true, function(state)
    if state then
        _G.EnableAntiAFK()
    else
        _G.DisableAntiAFK()
    end
end)
Core.registerModule("Anti AFK", _G.antiAFKToggle, miscContent, "Misc", "toggle")

-- ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ð™ Ð—ÐÐŸÐ£Ð¡Ðš Anti-AFK Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°
task.spawn(function()
    task.wait(0.5)
    _G.EnableAntiAFK()
end)

--[[ Advanced Troll Tab - Fully Optimized Fling + Orbit on Death ]]
_G.trollContent = Core.section(Troll, "Player Modifications", 1)

-- PLAYER DROPDOWN SYSTEM
_G.playerOptions = {{name = "None"}}
_G.selectedPlayer = nil
_G.playerDropdownContainer = nil
_G.setSelectedFunction = nil
_G.preserveName = "None"
_G.allPlayersTable = nil
_G.currentPlayerInLoop = nil
_G.playerIndex = nil
_G.optionIndex = nil
_G.foundPlayerInList = nil

_G.UpdatePlayerDropdown = function()
    _G.playerOptions = {{name = "None"}}
    _G.preserveName = "None"
    
    if _G.selectedPlayer and _G.selectedPlayer.Parent then
        _G.preserveName = _G.selectedPlayer.Name
    end
    
    _G.allPlayersTable = Services.Players:GetPlayers()
    _G.playerIndex = 1
    while _G.playerIndex <= #_G.allPlayersTable do
        _G.currentPlayerInLoop = _G.allPlayersTable[_G.playerIndex]
        if _G.currentPlayerInLoop ~= Player then
            table.insert(_G.playerOptions, {name = _G.currentPlayerInLoop.Name})
        end
        _G.playerIndex = _G.playerIndex + 1
    end
    
    if _G.playerDropdownContainer then
        _G.playerDropdownContainer:Destroy()
        _G.playerDropdownContainer = nil
    end
    
    _G.playerDropdownContainer, _G.setSelectedFunction = Core.dropdown(_G.trollContent, "Select Player", _G.playerOptions, 1, function(selectedOption)
        if selectedOption.name == "None" then
            _G.selectedPlayer = nil
        else
            _G.selectedPlayer = Services.Players:FindFirstChild(selectedOption.name)
        end
        if not _G.selectedPlayer then
            if _G.flingToggleSetState then _G.flingToggleSetState(false) end
            if _G.spectateToggleSetState then _G.spectateToggleSetState(false) end
            if _G.orbitToggleSetState then _G.orbitToggleSetState(false) end
            if _G.freezeToggleSetState then _G.freezeToggleSetState(false) end
        end
    end)
    
    if _G.preserveName ~= "None" and _G.setSelectedFunction then
        _G.foundPlayerInList = false
        _G.optionIndex = 1
        while _G.optionIndex <= #_G.playerOptions do
            if _G.playerOptions[_G.optionIndex].name == _G.preserveName then
                _G.foundPlayerInList = true
                break
            end
            _G.optionIndex = _G.optionIndex + 1
        end
        if _G.foundPlayerInList then
            _G.setSelectedFunction(_G.preserveName)
        end
    end
    
    Core.registerModule("Select Player", _G.playerDropdownContainer, _G.trollContent, "Troll", "dropdown")
end

_G.UpdatePlayerDropdown()

_G.playerAddedConnection = Services.Players.PlayerAdded:Connect(function(addedPlayer)
    if addedPlayer ~= Player then
        _G.UpdatePlayerDropdown()
    end
end)

_G.playerRemovingConnection = Services.Players.PlayerRemoving:Connect(function(removingPlayer)
    if _G.selectedPlayer == removingPlayer then
        _G.selectedPlayer = nil
    end
    _G.UpdatePlayerDropdown()
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- OPTIMIZED FLING PLAYER SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.flingEnabled = false
_G.flingConnection = nil
_G.flingAngle = 0
_G.flingPhase = 0
_G.flingFrameCounter = 0
_G.flingFrameSkip = 2
_G.flingOriginalPosition = nil
_G.flingOriginalFallenHeight = nil
_G.flingBodyVelocity = nil
_G.flingTargetPlayer = nil
_G.flingMyCharacter = nil
_G.flingMyRootPart = nil
_G.flingMyHumanoid = nil
_G.flingTargetCharacter = nil
_G.flingTargetRootPart = nil
_G.flingTargetHumanoid = nil
_G.flingTargetHead = nil
_G.flingTargetAccessory = nil
_G.flingTargetHandle = nil
_G.flingTargetBasePart = nil
_G.flingMoveDirection = nil
_G.flingTargetVelocity = nil
_G.flingVelocityMagnitude = nil
_G.flingPredictionOffset = nil
_G.flingNewCFrame = nil
_G.flingReturnIndex = nil
_G.flingCameraHumanoid = nil

_G.FlingUpdatePosition = function(targetBasePart, verticalOffset, rotationAngle)
    if not _G.flingMyRootPart or not _G.flingMyRootPart.Parent then return end
    if not targetBasePart or not targetBasePart.Parent then return end
    if not _G.flingTargetHumanoid then return end
    
    _G.flingTargetVelocity = targetBasePart.Velocity
    _G.flingPredictionOffset = _G.flingTargetVelocity * 0.3
    
    _G.flingNewCFrame = CFrame.new(targetBasePart.Position + _G.flingPredictionOffset) 
        * CFrame.new(0, verticalOffset, 0) 
        * CFrame.Angles(rotationAngle, 0, 0)
    
    _G.flingMyRootPart.CFrame = _G.flingNewCFrame
    _G.flingMyRootPart.Velocity = Vector3.new(9e7, 9e7 * 12, 9e7)
    _G.flingMyRootPart.RotVelocity = Vector3.new(9e8, 9e8, 9e8)
end

_G.FlingHeartbeatHandler = function(deltaTime)
    if not _G.flingEnabled then return end
    
    if not _G.flingTargetPlayer or not _G.flingTargetPlayer.Parent then return end
    
    _G.flingTargetCharacter = _G.flingTargetPlayer.Character
    if not _G.flingTargetCharacter then return end
    
    _G.flingTargetHumanoid = _G.flingTargetCharacter:FindFirstChildOfClass("Humanoid")
    if not _G.flingTargetHumanoid or _G.flingTargetHumanoid.Sit then return end
    
    if not _G.flingMyRootPart or not _G.flingMyRootPart.Parent then return end
    
    _G.flingTargetRootPart = _G.flingTargetHumanoid.RootPart
    _G.flingTargetHead = _G.flingTargetCharacter:FindFirstChild("Head")
    _G.flingTargetAccessory = _G.flingTargetCharacter:FindFirstChildOfClass("Accessory")
    _G.flingTargetHandle = _G.flingTargetAccessory and _G.flingTargetAccessory:FindFirstChild("Handle")
    
    _G.flingTargetBasePart = _G.flingTargetRootPart or _G.flingTargetHead or _G.flingTargetHandle
    if not _G.flingTargetBasePart then return end
    
    if _G.flingTargetHead then
        workspace.CurrentCamera.CameraSubject = _G.flingTargetHead
    elseif _G.flingTargetHandle then
        workspace.CurrentCamera.CameraSubject = _G.flingTargetHandle
    elseif _G.flingTargetHumanoid then
        workspace.CurrentCamera.CameraSubject = _G.flingTargetHumanoid
    end
    
    _G.flingAngle = _G.flingAngle + deltaTime * math.rad(360 * 6)
    
    if _G.flingPhase == 0 then
        _G.flingPhase = 1
        _G.FlingUpdatePosition(_G.flingTargetBasePart, 3, _G.flingAngle)
    else
        _G.flingPhase = 0
        _G.FlingUpdatePosition(_G.flingTargetBasePart, -5, _G.flingAngle)
    end
end

_G.FlingCleanup = function()
    if _G.flingConnection then
        _G.flingConnection:Disconnect()
        _G.flingConnection = nil
    end
    
    if _G.flingBodyVelocity and _G.flingBodyVelocity.Parent then
        _G.flingBodyVelocity:Destroy()
        _G.flingBodyVelocity = nil
    end
    
    if _G.flingOriginalFallenHeight then
        workspace.FallenPartsDestroyHeight = -500
        _G.flingOriginalFallenHeight = nil
    end
    
    if _G.flingMyHumanoid and _G.flingMyHumanoid.Parent then
        _G.flingMyHumanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, true)
    end
    
    if Player.Character then
        _G.flingCameraHumanoid = Player.Character:FindFirstChildOfClass("Humanoid")
        if _G.flingCameraHumanoid then
            workspace.CurrentCamera.CameraSubject = _G.flingCameraHumanoid
        end
    end
    
    if _G.flingOriginalPosition and _G.flingMyRootPart and _G.flingMyRootPart.Parent then
        _G.flingMyRootPart.CFrame = _G.flingOriginalPosition
        _G.flingMyRootPart.Velocity = Vector3.zero
        _G.flingMyRootPart.RotVelocity = Vector3.zero
    end
    
    _G.flingTargetPlayer = nil
    _G.flingEnabled = false
    _G.flingAngle = 0
    _G.flingPhase = 0
end

_G.flingAntiFlingWasEnabled = false

_G.flingToggle, _G.flingToggleCard, _G.flingToggleSetState = Core.toggle(_G.trollContent, "Fling Player", 2, false, function(toggleState)
    _G.flingEnabled = toggleState
    
    if toggleState then
        if not _G.selectedPlayer then
            _G.flingEnabled = false
            return
        end
        
        _G.flingTargetPlayer = _G.selectedPlayer
        _G.flingMyCharacter = Player.Character
        
        if not _G.flingMyCharacter then
            _G.flingEnabled = false
            return
        end
        
        _G.flingMyRootPart = _G.flingMyCharacter:FindFirstChild("HumanoidRootPart")
        _G.flingMyHumanoid = _G.flingMyCharacter:FindFirstChildOfClass("Humanoid")
        
        if not _G.flingMyRootPart then
            _G.flingEnabled = false
            return
        end
        
        if not _G.flingMyHumanoid then
            _G.flingEnabled = false
            return
        end
        
        _G.flingAntiFlingWasEnabled = _G.AntiFling.Enabled
        if _G.AntiFling.Enabled then
            _G.AntiFling.Stop()
            if _G.antiFlingToggleSetState then
                _G.antiFlingToggleSetState(false)
            end
        end
        
        _G.flingOriginalPosition = _G.flingMyRootPart.CFrame
        _G.flingOriginalFallenHeight = workspace.FallenPartsDestroyHeight
        workspace.FallenPartsDestroyHeight = 0/0
        
        _G.flingBodyVelocity = Instance.new("BodyVelocity")
        _G.flingBodyVelocity.Name = "FlingBodyVelocity"
        _G.flingBodyVelocity.Velocity = Vector3.new(0, 0, 0)
        _G.flingBodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        _G.flingBodyVelocity.Parent = _G.flingMyRootPart
        
        _G.flingMyHumanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, false)
        
        _G.flingAngle = 0
        _G.flingPhase = 0
        _G.flingFrameCounter = 0
        
        if _G.flingConnection then
            _G.flingConnection:Disconnect()
            _G.flingConnection = nil
        end
        
        _G.flingConnection = Services.RunService.Heartbeat:Connect(_G.FlingHeartbeatHandler)
    else
        _G.FlingCleanup()
        
        if _G.flingAntiFlingWasEnabled then
            _G.AntiFling.Start()
            if _G.antiFlingToggleSetState then
                _G.antiFlingToggleSetState(true)
            end
        end
        _G.flingAntiFlingWasEnabled = false
    end
end)

Core.registerModule("Fling Player", _G.flingToggle, _G.trollContent, "Troll", "toggle")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SPECTATE PLAYER SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.spectateEnabled = false
_G.spectateTargetHumanoid = nil
_G.spectateCameraHumanoid = nil

_G.spectateToggle, _G.spectateToggleCard, _G.spectateToggleSetState = Core.toggle(_G.trollContent, "Spectate Player", 3, false, function(toggleState)
    _G.spectateEnabled = toggleState
    
    if toggleState then
        if _G.selectedPlayer and _G.selectedPlayer.Character then
            _G.spectateTargetHumanoid = _G.selectedPlayer.Character:FindFirstChildOfClass("Humanoid")
            if _G.spectateTargetHumanoid then
                workspace.CurrentCamera.CameraSubject = _G.spectateTargetHumanoid
            end
        end
    else
        if Player.Character then
            _G.spectateCameraHumanoid = Player.Character:FindFirstChildOfClass("Humanoid")
            if _G.spectateCameraHumanoid then
                workspace.CurrentCamera.CameraSubject = _G.spectateCameraHumanoid
            end
        end
    end
end)

Core.registerModule("Spectate Player", _G.spectateToggle, _G.trollContent, "Troll", "toggle")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- TELEPORT BEHIND BUTTON
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.teleportBehindCard = Core.moduleCard(_G.trollContent, 4)

_G.teleportBehindFrame = Instance.new("Frame")
_G.teleportBehindFrame.Name = "TeleportBehindFrame"
_G.teleportBehindFrame.Size = UDim2.fromScale(1, 1)
_G.teleportBehindFrame.BackgroundTransparency = 1
_G.teleportBehindFrame.Parent = _G.teleportBehindCard

_G.teleportBehindTextLabel = Instance.new("TextLabel")
_G.teleportBehindTextLabel.Name = "TeleportBehindLabel"
_G.teleportBehindTextLabel.Size = UDim2.fromScale(1, 1)
_G.teleportBehindTextLabel.BackgroundTransparency = 1
_G.teleportBehindTextLabel.Text = "Teleport Behind"
_G.teleportBehindTextLabel.Font = Enum.Font.FredokaOne
_G.teleportBehindTextLabel.TextSize = Settings.IS_MOBILE and 13 or 15
_G.teleportBehindTextLabel.TextColor3 = Colors.TextMain
_G.teleportBehindTextLabel.TextXAlignment = Enum.TextXAlignment.Center
_G.teleportBehindTextLabel.TextYAlignment = Enum.TextYAlignment.Center
_G.teleportBehindTextLabel.Parent = _G.teleportBehindFrame

_G.teleportBehindButton = Instance.new("TextButton")
_G.teleportBehindButton.Name = "TeleportBehindButton"
_G.teleportBehindButton.Size = UDim2.fromScale(1, 1)
_G.teleportBehindButton.BackgroundTransparency = 1
_G.teleportBehindButton.Text = ""
_G.teleportBehindButton.ZIndex = 10
_G.teleportBehindButton.Parent = _G.teleportBehindFrame

_G.teleportBehindMyRoot = nil
_G.teleportBehindTargetRoot = nil
_G.teleportBehindPosition = nil

_G.teleportBehindButton.MouseButton1Click:Connect(function()
    if _G.selectedPlayer and _G.selectedPlayer.Character then
        _G.teleportBehindMyRoot = GetRoot()
        _G.teleportBehindTargetRoot = _G.selectedPlayer.Character:FindFirstChild("HumanoidRootPart")
        
        if _G.teleportBehindMyRoot and _G.teleportBehindTargetRoot then
            _G.teleportBehindPosition = _G.teleportBehindTargetRoot.Position - _G.teleportBehindTargetRoot.CFrame.LookVector * 0.1
            _G.teleportBehindMyRoot.CFrame = CFrame.lookAt(_G.teleportBehindPosition, _G.teleportBehindTargetRoot.Position)
        end
    end
end)

Core.registerModule("Teleport Behind", _G.teleportBehindCard, _G.trollContent, "Troll", "button")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ORBIT PLAYER SYSTEM (WITH DEATH CONTINUATION)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
_G.orbitEnabled = false
_G.orbitAngle = 0
_G.orbitDistance = 5
_G.orbitSpeed = 2
_G.orbitTargetPlayer = nil
_G.orbitConnection = nil
_G.orbitCharacterAddedConnection = nil
_G.orbitTargetCharacter = nil
_G.orbitTargetRoot = nil
_G.orbitMyRoot = nil
_G.orbitOffset = nil
_G.orbitPosition = nil

_G.OrbitUpdateTarget = function()
    if _G.orbitTargetPlayer then
        _G.orbitTargetCharacter = _G.orbitTargetPlayer.Character
        if _G.orbitTargetCharacter then
            _G.orbitTargetRoot = _G.orbitTargetCharacter:FindFirstChild("HumanoidRootPart")
        else
            _G.orbitTargetRoot = nil
        end
    end
end

_G.OrbitRenderHandler = function(deltaTime)
    if not _G.orbitEnabled then
        return
    end
    
    _G.orbitMyRoot = GetRoot()
    if not _G.orbitMyRoot then
        return
    end
    
    if not _G.orbitTargetRoot then
        _G.OrbitUpdateTarget()
        return
    end
    
    if not _G.orbitTargetRoot.Parent then
        _G.OrbitUpdateTarget()
        return
    end
    
    _G.orbitAngle = _G.orbitAngle + deltaTime * _G.orbitSpeed
    
    if _G.orbitAngle >= math.pi * 2 then
        _G.orbitAngle = _G.orbitAngle - math.pi * 2
    end
    
    _G.orbitOffset = Vector3.new(
        math.cos(_G.orbitAngle) * _G.orbitDistance,
        0,
        math.sin(_G.orbitAngle) * _G.orbitDistance
    )
    
    _G.orbitPosition = _G.orbitTargetRoot.Position + _G.orbitOffset
    _G.orbitMyRoot.CFrame = CFrame.lookAt(_G.orbitPosition, _G.orbitTargetRoot.Position)
end

_G.OrbitCleanup = function()
    if _G.orbitConnection then
        _G.orbitConnection:Disconnect()
        _G.orbitConnection = nil
    end
    
    if _G.orbitCharacterAddedConnection then
        _G.orbitCharacterAddedConnection:Disconnect()
        _G.orbitCharacterAddedConnection = nil
    end
end

_G.orbitToggle, _G.orbitToggleCard, _G.orbitToggleSetState = Core.toggle(_G.trollContent, "Orbit Player", 5, false, function(toggleState)
    _G.orbitEnabled = toggleState
    
    if toggleState then
        if not _G.selectedPlayer then
            _G.orbitEnabled = false
            return
        end
        
        _G.orbitTargetPlayer = _G.selectedPlayer
        _G.orbitMyRoot = GetRoot()
        
        if not _G.orbitMyRoot then
            _G.orbitEnabled = false
            return
        end
        
        _G.OrbitUpdateTarget()
        
        -- ÐžÑ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹
        _G.OrbitCleanup()
        
        -- ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑŽ Ñ€ÐµÑÐ¿Ð°Ð²Ð½Ð° Ñ†ÐµÐ»Ð¸
        _G.orbitCharacterAddedConnection = _G.orbitTargetPlayer.CharacterAdded:Connect(function(newCharacter)
            task.wait(0.5)
            _G.OrbitUpdateTarget()
        end)
        
        -- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ñ€ÐµÐ½Ð´ÐµÑ€Ñƒ
        _G.orbitConnection = Services.RunService.RenderStepped:Connect(_G.OrbitRenderHandler)
    else
        _G.OrbitCleanup()
    end
end)

Core.registerModule("Orbit Player", _G.orbitToggle, _G.trollContent, "Troll", "toggle")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ORBIT DISTANCE SLIDER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.orbitDistanceSlider = Core.slider(_G.trollContent, "Orbit Distance", 6, 3, 20, 5, function(sliderValue)
    _G.orbitDistance = sliderValue
end)

Core.registerModule("Orbit Distance", _G.orbitDistanceSlider, _G.trollContent, "Troll", "slider")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ORBIT SPEED SLIDER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.orbitSpeedSlider = Core.slider(_G.trollContent, "Orbit Speed", 7, 1, 10, 2, function(sliderValue)
    _G.orbitSpeed = sliderValue
end)

Core.registerModule("Orbit Speed", _G.orbitSpeedSlider, _G.trollContent, "Troll", "slider")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- FREEZE PLAYER (VISUAL) SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.freezeEnabled = false
_G.freezeTargetRoot = nil
_G.freezeTargetHumanoid = nil
_G.freezeToggle, _G.freezeToggleCard, _G.freezeToggleSetState = Core.toggle(_G.trollContent, "Freeze Player (Visual)", 8, false, function(toggleState)
    _G.freezeEnabled = toggleState
    
    if toggleState then
        if _G.selectedPlayer and _G.selectedPlayer.Character then
            _G.freezeTargetRoot = _G.selectedPlayer.Character:FindFirstChild("HumanoidRootPart")
            _G.freezeTargetHumanoid = _G.selectedPlayer.Character:FindFirstChildOfClass("Humanoid")
            
            if _G.freezeTargetRoot and _G.freezeTargetHumanoid then
                _G.freezeTargetRoot.Anchored = true
                _G.freezeTargetHumanoid.WalkSpeed = 0
                _G.freezeTargetHumanoid.JumpPower = 0
            end
        end
    else
        if _G.selectedPlayer and _G.selectedPlayer.Character then
            _G.freezeTargetRoot = _G.selectedPlayer.Character:FindFirstChild("HumanoidRootPart")
            _G.freezeTargetHumanoid = _G.selectedPlayer.Character:FindFirstChildOfClass("Humanoid")
            
            if _G.freezeTargetRoot and _G.freezeTargetHumanoid then
                _G.freezeTargetRoot.Anchored = false
                _G.freezeTargetHumanoid.WalkSpeed = 16
                _G.freezeTargetHumanoid.JumpPower = 50
            end
        end
    end
end)

Core.registerModule("Freeze Player (Visual)", _G.freezeToggle, _G.trollContent, "Troll", "toggle")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- FAKE EXPLODE PLAYER BUTTON
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.explodeCard = Core.moduleCard(_G.trollContent, 9)

_G.explodeFrame = Instance.new("Frame")
_G.explodeFrame.Name = "ExplodeFrame"
_G.explodeFrame.Size = UDim2.fromScale(1, 1)
_G.explodeFrame.BackgroundTransparency = 1
_G.explodeFrame.Parent = _G.explodeCard

_G.explodeTextLabel = Instance.new("TextLabel")
_G.explodeTextLabel.Name = "ExplodeLabel"
_G.explodeTextLabel.Size = UDim2.fromScale(1, 1)
_G.explodeTextLabel.BackgroundTransparency = 1
_G.explodeTextLabel.Text = "Fake Explode Player"
_G.explodeTextLabel.Font = Enum.Font.FredokaOne
_G.explodeTextLabel.TextSize = Settings.IS_MOBILE and 13 or 15
_G.explodeTextLabel.TextColor3 = Colors.TextMain
_G.explodeTextLabel.TextXAlignment = Enum.TextXAlignment.Center
_G.explodeTextLabel.TextYAlignment = Enum.TextYAlignment.Center
_G.explodeTextLabel.Parent = _G.explodeFrame

_G.explodeButton = Instance.new("TextButton")
_G.explodeButton.Name = "ExplodeButton"
_G.explodeButton.Size = UDim2.fromScale(1, 1)
_G.explodeButton.BackgroundTransparency = 1
_G.explodeButton.Text = ""
_G.explodeButton.ZIndex = 10
_G.explodeButton.Parent = _G.explodeFrame

_G.explodeTargetPosition = nil
_G.explodeExplosion = nil
_G.explodeDebrisPart = nil
_G.explodeDebrisIndex = nil
_G.explodeDebrisTween = nil

_G.explodeButton.MouseButton1Click:Connect(function()
    if _G.selectedPlayer and _G.selectedPlayer.Character then
        _G.explodeTargetRoot = _G.selectedPlayer.Character:FindFirstChild("HumanoidRootPart")
        
        if _G.explodeTargetRoot then
            _G.explodeTargetPosition = _G.explodeTargetRoot.Position
            
            _G.explodeExplosion = Instance.new("Explosion")
            _G.explodeExplosion.Position = _G.explodeTargetPosition
            _G.explodeExplosion.BlastPressure = 0
            _G.explodeExplosion.BlastRadius = 15
            _G.explodeExplosion.DestroyJointRadiusPercent = 0
            _G.explodeExplosion.Parent = workspace
            
            _G.explodeDebrisIndex = 1
            while _G.explodeDebrisIndex <= 25 do
                _G.explodeDebrisPart = Instance.new("Part")
                _G.explodeDebrisPart.Name = "FakeDebris"
                _G.explodeDebrisPart.Size = Vector3.new(
                    math.random(1, 3),
                    math.random(1, 3),
                    math.random(1, 3)
                )
                _G.explodeDebrisPart.Position = _G.explodeTargetPosition + Vector3.new(
                    math.random(-8, 8),
                    math.random(-2, 12),
                    math.random(-8, 8)
                )
                _G.explodeDebrisPart.Velocity = Vector3.new(
                    math.random(-100, 100),
                    math.random(50, 150),
                    math.random(-100, 100)
                )
                _G.explodeDebrisPart.Color = Color3.fromRGB(
                    math.random(200, 255),
                    math.random(50, 150),
                    0
                )
                _G.explodeDebrisPart.Material = Enum.Material.Neon
                _G.explodeDebrisPart.Anchored = false
                _G.explodeDebrisPart.CanCollide = false
                _G.explodeDebrisPart.Parent = workspace
                
                _G.explodeDebrisTween = Services.TweenService:Create(
                    _G.explodeDebrisPart,
                    TweenInfo.new(0.6),
                    {
                        Transparency = 1,
                        Size = Vector3.new(0, 0, 0)
                    }
                )
                _G.explodeDebrisTween:Play()
                
                task.delay(0.6, function()
                    if _G.explodeDebrisPart and _G.explodeDebrisPart.Parent then
                        _G.explodeDebrisPart:Destroy()
                    end
                end)
                
                _G.explodeDebrisIndex = _G.explodeDebrisIndex + 1
            end
        end
    end
end)

Core.registerModule("Fake Explode Player", _G.explodeCard, _G.trollContent, "Troll", "button")

if UI.Gui then
    UI.Gui.AncestryChanged:Connect(function(_, parent)
        if not parent then
            if _G.AntiFlingSettings and _G.AntiFlingSettings.Enabled then
                _G.AntiFlingStop()
            end
            
            _G.DisableAntiAFK()
        end
    end)
end

-- Watermark Mini GUI (Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ)

_G.WatermarkGui = Instance.new("ScreenGui")
_G.WatermarkGui.Name = "PrismaticaX_Watermark"
_G.WatermarkGui.ResetOnSpawn = false
_G.WatermarkGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
_G.WatermarkGui.DisplayOrder = 2147483646
_G.WatermarkGui.IgnoreGuiInset = true
_G.WatermarkGui.Parent = Core.getGui()

pcall(function()
    if syn and syn.protect_gui then
        syn.protect_gui(_G.WatermarkGui)
    end
end)

_G.WatermarkTotalWidth = Settings.IS_MOBILE and 280 or 340
_G.WatermarkTotalHeight = Settings.IS_MOBILE and 28 or 32

_G.WatermarkFrame = Instance.new("Frame")
_G.WatermarkFrame.Name = "WatermarkFrame"
_G.WatermarkFrame.Size = UDim2.fromOffset(_G.WatermarkTotalWidth, _G.WatermarkTotalHeight)
_G.WatermarkFrame.Position = UDim2.fromOffset(5, 5)
_G.WatermarkFrame.AnchorPoint = Vector2.new(0, 0)
_G.WatermarkFrame.BackgroundColor3 = Colors.Base
_G.WatermarkFrame.BackgroundTransparency = 0
_G.WatermarkFrame.BorderSizePixel = 0
_G.WatermarkFrame.ZIndex = 2
_G.WatermarkFrame.Parent = _G.WatermarkGui

_G.WatermarkFrameCorner = Instance.new("UICorner")
_G.WatermarkFrameCorner.CornerRadius = UDim.new(0, 10)
_G.WatermarkFrameCorner.Parent = _G.WatermarkFrame

_G.WatermarkStroke = Instance.new("UIStroke")
_G.WatermarkStroke.Color = Colors.Border
_G.WatermarkStroke.Transparency = 0.3
_G.WatermarkStroke.Thickness = 1.5
_G.WatermarkStroke.Parent = _G.WatermarkFrame

_G.WatermarkShadow = Instance.new("ImageLabel")
_G.WatermarkShadow.Name = "Shadow"
_G.WatermarkShadow.Size = UDim2.new(1, 12, 1, 12)
_G.WatermarkShadow.Position = UDim2.fromOffset(-6, -6)
_G.WatermarkShadow.BackgroundTransparency = 1
_G.WatermarkShadow.Image = "rbxassetid://6014261993"
_G.WatermarkShadow.ImageColor3 = Color3.new(0, 0, 0)
_G.WatermarkShadow.ImageTransparency = 0.75
_G.WatermarkShadow.ScaleType = Enum.ScaleType.Slice
_G.WatermarkShadow.SliceCenter = Rect.new(49, 49, 450, 450)
_G.WatermarkShadow.ZIndex = 1
_G.WatermarkShadow.Parent = _G.WatermarkFrame

_G.WatermarkContentFrame = Instance.new("Frame")
_G.WatermarkContentFrame.Name = "ContentFrame"
_G.WatermarkContentFrame.Size = UDim2.new(1, 0, 1, 0)
_G.WatermarkContentFrame.Position = UDim2.fromOffset(0, 0)
_G.WatermarkContentFrame.BackgroundTransparency = 1
_G.WatermarkContentFrame.BorderSizePixel = 0
_G.WatermarkContentFrame.ZIndex = 3
_G.WatermarkContentFrame.Parent = _G.WatermarkFrame

_G.WatermarkPadding = Instance.new("UIPadding")
_G.WatermarkPadding.PaddingLeft = UDim.new(0, 12)
_G.WatermarkPadding.PaddingRight = UDim.new(0, 12)
_G.WatermarkPadding.PaddingTop = UDim.new(0, 0)
_G.WatermarkPadding.PaddingBottom = UDim.new(0, 0)
_G.WatermarkPadding.Parent = _G.WatermarkContentFrame

_G.WatermarkLayout = Instance.new("UIListLayout")
_G.WatermarkLayout.FillDirection = Enum.FillDirection.Horizontal
_G.WatermarkLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
_G.WatermarkLayout.VerticalAlignment = Enum.VerticalAlignment.Center
_G.WatermarkLayout.Padding = UDim.new(0, 10)
_G.WatermarkLayout.SortOrder = Enum.SortOrder.LayoutOrder
_G.WatermarkLayout.Parent = _G.WatermarkContentFrame

_G.WatermarkLogoContainer = Instance.new("Frame")
_G.WatermarkLogoContainer.Name = "LogoContainer"
_G.WatermarkLogoContainer.Size = UDim2.fromOffset(Settings.IS_MOBILE and 20 or 24, Settings.IS_MOBILE and 20 or 24)
_G.WatermarkLogoContainer.BackgroundColor3 = Colors.Card
_G.WatermarkLogoContainer.BackgroundTransparency = 0.5
_G.WatermarkLogoContainer.BorderSizePixel = 0
_G.WatermarkLogoContainer.LayoutOrder = 1
_G.WatermarkLogoContainer.ZIndex = 4
_G.WatermarkLogoContainer.Parent = _G.WatermarkContentFrame

_G.WatermarkLogoContainerCorner = Instance.new("UICorner")
_G.WatermarkLogoContainerCorner.CornerRadius = UDim.new(0, 6)
_G.WatermarkLogoContainerCorner.Parent = _G.WatermarkLogoContainer

_G.WatermarkLogoStroke = Instance.new("UIStroke")
_G.WatermarkLogoStroke.Color = Colors.Border
_G.WatermarkLogoStroke.Transparency = 0.5
_G.WatermarkLogoStroke.Thickness = 1
_G.WatermarkLogoStroke.Parent = _G.WatermarkLogoContainer

_G.WatermarkLogoIcon = Instance.new("ImageLabel")
_G.WatermarkLogoIcon.Name = "LogoIcon"
_G.WatermarkLogoIcon.Size = UDim2.fromOffset(Settings.IS_MOBILE and 16 or 20, Settings.IS_MOBILE and 16 or 20)
_G.WatermarkLogoIcon.Position = UDim2.fromOffset(2, 2)
_G.WatermarkLogoIcon.BackgroundTransparency = 1
_G.WatermarkLogoIcon.Image = "rbxassetid://72998769206857"
_G.WatermarkLogoIcon.ImageTransparency = 0
_G.WatermarkLogoIcon.ScaleType = Enum.ScaleType.Fit
_G.WatermarkLogoIcon.ZIndex = 5
_G.WatermarkLogoIcon.Parent = _G.WatermarkLogoContainer

_G.WatermarkSep1 = Instance.new("TextLabel")
_G.WatermarkSep1.Name = "Sep1"
_G.WatermarkSep1.Size = UDim2.fromOffset(8, Settings.IS_MOBILE and 20 or 24)
_G.WatermarkSep1.BackgroundTransparency = 1
_G.WatermarkSep1.Text = "|"
_G.WatermarkSep1.Font = Enum.Font.FredokaOne
_G.WatermarkSep1.TextSize = Settings.IS_MOBILE and 14 or 16
_G.WatermarkSep1.TextColor3 = Color3.fromRGB(100, 100, 100)
_G.WatermarkSep1.TextTransparency = 0
_G.WatermarkSep1.TextXAlignment = Enum.TextXAlignment.Center
_G.WatermarkSep1.TextYAlignment = Enum.TextYAlignment.Center
_G.WatermarkSep1.LayoutOrder = 2
_G.WatermarkSep1.ZIndex = 4
_G.WatermarkSep1.Parent = _G.WatermarkContentFrame

_G.WatermarkFPSLabel = Instance.new("TextLabel")
_G.WatermarkFPSLabel.Name = "FPSLabel"
_G.WatermarkFPSLabel.Size = UDim2.fromOffset(Settings.IS_MOBILE and 55 or 65, Settings.IS_MOBILE and 20 or 24)
_G.WatermarkFPSLabel.BackgroundTransparency = 1
_G.WatermarkFPSLabel.Text = "FPS: 60"
_G.WatermarkFPSLabel.Font = Enum.Font.FredokaOne
_G.WatermarkFPSLabel.TextSize = Settings.IS_MOBILE and 12 or 14
_G.WatermarkFPSLabel.TextColor3 = Color3.new(1, 1, 1)
_G.WatermarkFPSLabel.TextTransparency = 0
_G.WatermarkFPSLabel.TextXAlignment = Enum.TextXAlignment.Center
_G.WatermarkFPSLabel.TextYAlignment = Enum.TextYAlignment.Center
_G.WatermarkFPSLabel.LayoutOrder = 3
_G.WatermarkFPSLabel.ZIndex = 4
_G.WatermarkFPSLabel.Parent = _G.WatermarkContentFrame

_G.WatermarkSep2 = Instance.new("TextLabel")
_G.WatermarkSep2.Name = "Sep2"
_G.WatermarkSep2.Size = UDim2.fromOffset(8, Settings.IS_MOBILE and 20 or 24)
_G.WatermarkSep2.BackgroundTransparency = 1
_G.WatermarkSep2.Text = "|"
_G.WatermarkSep2.Font = Enum.Font.FredokaOne
_G.WatermarkSep2.TextSize = Settings.IS_MOBILE and 14 or 16
_G.WatermarkSep2.TextColor3 = Color3.fromRGB(100, 100, 100)
_G.WatermarkSep2.TextTransparency = 0
_G.WatermarkSep2.TextXAlignment = Enum.TextXAlignment.Center
_G.WatermarkSep2.TextYAlignment = Enum.TextYAlignment.Center
_G.WatermarkSep2.LayoutOrder = 4
_G.WatermarkSep2.ZIndex = 4
_G.WatermarkSep2.Parent = _G.WatermarkContentFrame

_G.WatermarkPingLabel = Instance.new("TextLabel")
_G.WatermarkPingLabel.Name = "PingLabel"
_G.WatermarkPingLabel.Size = UDim2.fromOffset(Settings.IS_MOBILE and 75 or 90, Settings.IS_MOBILE and 20 or 24)
_G.WatermarkPingLabel.BackgroundTransparency = 1
_G.WatermarkPingLabel.Text = "Ping: 50ms"
_G.WatermarkPingLabel.Font = Enum.Font.FredokaOne
_G.WatermarkPingLabel.TextSize = Settings.IS_MOBILE and 12 or 14
_G.WatermarkPingLabel.TextColor3 = Color3.new(1, 1, 1)
_G.WatermarkPingLabel.TextTransparency = 0
_G.WatermarkPingLabel.TextXAlignment = Enum.TextXAlignment.Center
_G.WatermarkPingLabel.TextYAlignment = Enum.TextYAlignment.Center
_G.WatermarkPingLabel.LayoutOrder = 5
_G.WatermarkPingLabel.ZIndex = 4
_G.WatermarkPingLabel.Parent = _G.WatermarkContentFrame

_G.WatermarkSep3 = Instance.new("TextLabel")
_G.WatermarkSep3.Name = "Sep3"
_G.WatermarkSep3.Size = UDim2.fromOffset(8, Settings.IS_MOBILE and 20 or 24)
_G.WatermarkSep3.BackgroundTransparency = 1
_G.WatermarkSep3.Text = "|"
_G.WatermarkSep3.Font = Enum.Font.FredokaOne
_G.WatermarkSep3.TextSize = Settings.IS_MOBILE and 14 or 16
_G.WatermarkSep3.TextColor3 = Color3.fromRGB(100, 100, 100)
_G.WatermarkSep3.TextTransparency = 0
_G.WatermarkSep3.TextXAlignment = Enum.TextXAlignment.Center
_G.WatermarkSep3.TextYAlignment = Enum.TextYAlignment.Center
_G.WatermarkSep3.LayoutOrder = 6
_G.WatermarkSep3.ZIndex = 4
_G.WatermarkSep3.Parent = _G.WatermarkContentFrame

_G.WatermarkTimeLabel = Instance.new("TextLabel")
_G.WatermarkTimeLabel.Name = "TimeLabel"
_G.WatermarkTimeLabel.Size = UDim2.fromOffset(Settings.IS_MOBILE and 60 or 50, Settings.IS_MOBILE and 20 or 24)
_G.WatermarkTimeLabel.BackgroundTransparency = 1
_G.WatermarkTimeLabel.Text = "00:00:00"
_G.WatermarkTimeLabel.Font = Enum.Font.FredokaOne
_G.WatermarkTimeLabel.TextSize = Settings.IS_MOBILE and 12 or 14
_G.WatermarkTimeLabel.TextColor3 = Color3.new(1, 1, 1)
_G.WatermarkTimeLabel.TextTransparency = 0
_G.WatermarkTimeLabel.TextXAlignment = Enum.TextXAlignment.Center
_G.WatermarkTimeLabel.TextYAlignment = Enum.TextYAlignment.Center
_G.WatermarkTimeLabel.LayoutOrder = 7
_G.WatermarkTimeLabel.ZIndex = 4
_G.WatermarkTimeLabel.Parent = _G.WatermarkContentFrame

_G.WatermarkDragging = false
_G.WatermarkDragStart = nil
_G.WatermarkFrameStartPos = nil
_G.WatermarkEdgePadding = 5
_G.WatermarkLastOpacity = -1
_G.WatermarkFPSFrameCount = 0
_G.WatermarkFPSLastTime = tick()
_G.WatermarkCurrentFPS = 0
_G.WatermarkLastSecond = -1
_G.WatermarkLastFullUpdate = 0
_G.WatermarkUpdateInterval = 0.5
_G.WatermarkLastColors = ""
_G.WatermarkDragTween = nil

task.spawn(function()
    task.wait(0.1)
    _G.WatermarkCamera = workspace.CurrentCamera
    if _G.WatermarkCamera and _G.WatermarkFrame and _G.WatermarkFrame.Parent then
        _G.WatermarkViewportSize = _G.WatermarkCamera.ViewportSize
        _G.WatermarkStartX = _G.WatermarkViewportSize.X - _G.WatermarkTotalWidth - _G.WatermarkEdgePadding
        _G.WatermarkFrame.Position = UDim2.fromOffset(_G.WatermarkStartX, _G.WatermarkEdgePadding)
    end
end)

_G.WatermarkClampPosition = function(posX, posY)
    _G.WatermarkClampCamera = workspace.CurrentCamera
    if not _G.WatermarkClampCamera then return posX, posY end
    
    _G.WatermarkClampViewport = _G.WatermarkClampCamera.ViewportSize
    _G.WatermarkClampPadding = _G.WatermarkEdgePadding
    
    _G.WatermarkClampedX = math.clamp(posX, _G.WatermarkClampPadding, _G.WatermarkClampViewport.X - _G.WatermarkTotalWidth - _G.WatermarkClampPadding)
    _G.WatermarkClampedY = math.clamp(posY, _G.WatermarkClampPadding, _G.WatermarkClampViewport.Y - _G.WatermarkTotalHeight - _G.WatermarkClampPadding)
    
    return _G.WatermarkClampedX, _G.WatermarkClampedY
end

_G.WatermarkFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        _G.WatermarkDragging = true
        _G.WatermarkDragStart = input.Position
        _G.WatermarkFrameStartPos = _G.WatermarkFrame.Position
    end
end)

_G.WatermarkDragConnection = Services.UIS.InputChanged:Connect(function(input)
    if _G.WatermarkDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        _G.WatermarkDragDelta = input.Position - _G.WatermarkDragStart
        _G.WatermarkNewX = _G.WatermarkFrameStartPos.X.Offset + _G.WatermarkDragDelta.X
        _G.WatermarkNewY = _G.WatermarkFrameStartPos.Y.Offset + _G.WatermarkDragDelta.Y
        
        _G.WatermarkFinalX, _G.WatermarkFinalY = _G.WatermarkClampPosition(_G.WatermarkNewX, _G.WatermarkNewY)
        
        if _G.WatermarkDragTween then
            _G.WatermarkDragTween:Cancel()
        end
        
        _G.WatermarkDragTween = Services.TweenService:Create(_G.WatermarkFrame, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = UDim2.fromOffset(_G.WatermarkFinalX, _G.WatermarkFinalY)
        })
        _G.WatermarkDragTween:Play()
    end
end)

_G.WatermarkDragEndConnection = Services.UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        _G.WatermarkDragging = false
    end
end)

_G.WatermarkViewportConnection = workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(function()
    if _G.WatermarkFrame and _G.WatermarkFrame.Parent and not _G.WatermarkDragging then
        _G.WatermarkCurrentX = _G.WatermarkFrame.Position.X.Offset
        _G.WatermarkCurrentY = _G.WatermarkFrame.Position.Y.Offset
        _G.WatermarkNewPosX, _G.WatermarkNewPosY = _G.WatermarkClampPosition(_G.WatermarkCurrentX, _G.WatermarkCurrentY)
        _G.WatermarkFrame.Position = UDim2.fromOffset(_G.WatermarkNewPosX, _G.WatermarkNewPosY)
    end
end)

_G.WatermarkUpdateConnection = Services.RunService.Heartbeat:Connect(function()
    if not _G.WatermarkGui or not _G.WatermarkGui.Parent then return end
    if not _G.WatermarkFrame or not _G.WatermarkFrame.Parent then return end
    
    _G.WatermarkCurrentTime = tick()
    
    _G.WatermarkFPSFrameCount = _G.WatermarkFPSFrameCount + 1
    if _G.WatermarkCurrentTime - _G.WatermarkFPSLastTime >= 1 then
        _G.WatermarkCurrentFPS = math.floor(_G.WatermarkFPSFrameCount / (_G.WatermarkCurrentTime - _G.WatermarkFPSLastTime) + 0.5)
        _G.WatermarkFPSFrameCount = 0
        _G.WatermarkFPSLastTime = _G.WatermarkCurrentTime
        
        if _G.WatermarkFPSLabel and _G.WatermarkFPSLabel.Parent then
            _G.WatermarkFPSLabel.Text = "FPS: " .. _G.WatermarkCurrentFPS
        end
    end
    
    if _G.WatermarkCurrentTime - _G.WatermarkLastFullUpdate < _G.WatermarkUpdateInterval then return end
    _G.WatermarkLastFullUpdate = _G.WatermarkCurrentTime
    
    if _G.WatermarkPingLabel and _G.WatermarkPingLabel.Parent then
        _G.WatermarkPingSuccess, _G.WatermarkPingValue = pcall(function()
            return math.round(Player:GetNetworkPing() * 1000)
        end)
        if _G.WatermarkPingSuccess and _G.WatermarkPingValue then
            _G.WatermarkPingLabel.Text = "Ping: " .. _G.WatermarkPingValue .. "ms"
        end
    end
    
    _G.WatermarkCurrentSecond = os.time()
    if _G.WatermarkCurrentSecond ~= _G.WatermarkLastSecond then
        _G.WatermarkLastSecond = _G.WatermarkCurrentSecond
        if _G.WatermarkTimeLabel and _G.WatermarkTimeLabel.Parent then
            _G.WatermarkTimeLabel.Text = os.date("%H:%M:%S")
        end
    end
    
    _G.WatermarkCurrentOpacity = Settings.GUI_OPACITY or 0
    if _G.WatermarkCurrentOpacity ~= _G.WatermarkLastOpacity then
        _G.WatermarkLastOpacity = _G.WatermarkCurrentOpacity
        _G.WatermarkTrans = math.min(_G.WatermarkCurrentOpacity / 100, 0.7)
        
        _G.WatermarkFrame.BackgroundTransparency = _G.WatermarkTrans
        _G.WatermarkStroke.Transparency = 0.3 + 0.3 * _G.WatermarkTrans
        _G.WatermarkShadow.ImageTransparency = 0.75
        _G.WatermarkLogoContainer.BackgroundTransparency = 0.3 + 0.4 * _G.WatermarkTrans
        _G.WatermarkLogoStroke.Transparency = 0.3 + 0.4 * _G.WatermarkTrans
    end
    
    _G.WatermarkNewColorHash = tostring(Colors.Base) .. tostring(Colors.Border)
    if _G.WatermarkLastColors ~= _G.WatermarkNewColorHash then
        _G.WatermarkLastColors = _G.WatermarkNewColorHash
        _G.WatermarkFrame.BackgroundColor3 = Colors.Base
        _G.WatermarkStroke.Color = Colors.Border
        _G.WatermarkLogoContainer.BackgroundColor3 = Colors.Card
        _G.WatermarkLogoStroke.Color = Colors.Border
    end
end)

task.spawn(function()
    task.wait(0.15)
    _G.WatermarkInitialTrans = math.min((Settings.GUI_OPACITY or 0) / 100, 0.7)
    
    _G.WatermarkFrame.BackgroundTransparency = _G.WatermarkInitialTrans
    _G.WatermarkStroke.Transparency = 0.3 + 0.3 * _G.WatermarkInitialTrans
        _G.WatermarkShadow.ImageTransparency = 0.75
    _G.WatermarkLogoContainer.BackgroundTransparency = 0.3 + 0.4 * _G.WatermarkInitialTrans
    _G.WatermarkLogoStroke.Transparency = 0.3 + 0.4 * _G.WatermarkInitialTrans
end)

_G.DestroyWatermark = function()
    if not _G.WatermarkGui then return end
    
    if _G.WatermarkUpdateConnection then
        _G.WatermarkUpdateConnection:Disconnect()
        _G.WatermarkUpdateConnection = nil
    end
    
    if _G.WatermarkDragConnection then
        _G.WatermarkDragConnection:Disconnect()
        _G.WatermarkDragConnection = nil
    end
    
    if _G.WatermarkDragEndConnection then
        _G.WatermarkDragEndConnection:Disconnect()
        _G.WatermarkDragEndConnection = nil
    end
    
    if _G.WatermarkViewportConnection then
        _G.WatermarkViewportConnection:Disconnect()
        _G.WatermarkViewportConnection = nil
    end
    
    _G.WatermarkCloseTweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
    _G.WatermarkCloseTextTweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
    
    if _G.WatermarkFrame and _G.WatermarkFrame.Parent then
        Services.TweenService:Create(_G.WatermarkFrame, _G.WatermarkCloseTweenInfo, {
            BackgroundTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkStroke and _G.WatermarkStroke.Parent then
        Services.TweenService:Create(_G.WatermarkStroke, _G.WatermarkCloseTweenInfo, {
            Transparency = 1
        }):Play()
    end
    
    if _G.WatermarkShadow and _G.WatermarkShadow.Parent then
        Services.TweenService:Create(_G.WatermarkShadow, _G.WatermarkCloseTweenInfo, {
            ImageTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkLogoContainer and _G.WatermarkLogoContainer.Parent then
        Services.TweenService:Create(_G.WatermarkLogoContainer, _G.WatermarkCloseTextTweenInfo, {
            BackgroundTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkLogoStroke and _G.WatermarkLogoStroke.Parent then
        Services.TweenService:Create(_G.WatermarkLogoStroke, _G.WatermarkCloseTextTweenInfo, {
            Transparency = 1
        }):Play()
    end
    
    if _G.WatermarkLogoIcon and _G.WatermarkLogoIcon.Parent then
        Services.TweenService:Create(_G.WatermarkLogoIcon, _G.WatermarkCloseTextTweenInfo, {
            ImageTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkFPSLabel and _G.WatermarkFPSLabel.Parent then
        Services.TweenService:Create(_G.WatermarkFPSLabel, _G.WatermarkCloseTextTweenInfo, {
            TextTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkPingLabel and _G.WatermarkPingLabel.Parent then
        Services.TweenService:Create(_G.WatermarkPingLabel, _G.WatermarkCloseTextTweenInfo, {
            TextTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkTimeLabel and _G.WatermarkTimeLabel.Parent then
        Services.TweenService:Create(_G.WatermarkTimeLabel, _G.WatermarkCloseTextTweenInfo, {
            TextTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkSep1 and _G.WatermarkSep1.Parent then
        Services.TweenService:Create(_G.WatermarkSep1, _G.WatermarkCloseTextTweenInfo, {
            TextTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkSep2 and _G.WatermarkSep2.Parent then
        Services.TweenService:Create(_G.WatermarkSep2, _G.WatermarkCloseTextTweenInfo, {
            TextTransparency = 1
        }):Play()
    end
    
    if _G.WatermarkSep3 and _G.WatermarkSep3.Parent then
        Services.TweenService:Create(_G.WatermarkSep3, _G.WatermarkCloseTextTweenInfo, {
            TextTransparency = 1
        }):Play()
    end
    
    task.delay(0.35, function()
        if _G.WatermarkGui and _G.WatermarkGui.Parent then
            _G.WatermarkGui:Destroy()
            _G.WatermarkGui = nil
        end
    end)
end

if UI.Gui then
    UI.Gui.AncestryChanged:Connect(function(_, parent)
        if not parent then
            _G.DestroyWatermark()
        end
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MAIN TAB - INFORMATION & UTILITIES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.PRISMATICAX_VERSION = "2.4"
_G.PRISMATICAX_NAME = "PrismaticaX"
_G.PRISMATICAX_AUTHOR = "@zood3llotgk"
_G.PRISMATICAX_TELEGRAM = "https://t.me/zood3llotgk"
_G.PRISMATICAX_SCRIPT = 'loadstring(game:HttpGet("https://raw.githubusercontent.com/zood1k/ezk1nz/main/PrismaticaX"))()'

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NOTIFICATION SYSTEM (FIXED)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.NotificationContainer = nil
_G.NotificationCount = 0

_G.CreateNotificationContainer = function()
    if _G.NotificationContainer and _G.NotificationContainer.Parent then
        return
    end
    
    _G.NotificationContainer = Instance.new("Frame", UI.Gui)
    _G.NotificationContainer.Name = "NotificationContainer"
    _G.NotificationContainer.Size = UDim2.fromOffset(Settings.IS_MOBILE and 200 or 260, 300)
    _G.NotificationContainer.Position = UDim2.new(1, Settings.IS_MOBILE and -210 or -270, 1, -310)
    _G.NotificationContainer.BackgroundTransparency = 1
    _G.NotificationContainer.BorderSizePixel = 0
    _G.NotificationContainer.ZIndex = 50000
    _G.NotificationContainer.ClipsDescendants = false
    
    _G.NotificationLayout = Instance.new("UIListLayout", _G.NotificationContainer)
    _G.NotificationLayout.SortOrder = Enum.SortOrder.LayoutOrder
    _G.NotificationLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
    _G.NotificationLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    _G.NotificationLayout.Padding = UDim.new(0, 8)
end

_G.ShowCopyNotification = function(text)
    _G.CreateNotificationContainer()
    
    _G.NotificationCount = _G.NotificationCount + 1
    _G.CurrentNotifId = _G.NotificationCount
    
    _G.NotifFrames = _G.NotifFrames or {}
    
    _G.NotifOpacity = math.min(Settings.GUI_OPACITY / 100, 0.7)
    
    _G.NotifFrames[_G.CurrentNotifId] = Instance.new("Frame", _G.NotificationContainer)
    _G.NotifFrames[_G.CurrentNotifId].Name = "Notification_" .. _G.CurrentNotifId
    _G.NotifFrames[_G.CurrentNotifId].Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 40 or 46)
    _G.NotifFrames[_G.CurrentNotifId].BackgroundColor3 = Colors.Base
    _G.NotifFrames[_G.CurrentNotifId].BackgroundTransparency = _G.NotifOpacity
    _G.NotifFrames[_G.CurrentNotifId].BorderSizePixel = 0
    _G.NotifFrames[_G.CurrentNotifId].LayoutOrder = -_G.CurrentNotifId
    _G.NotifFrames[_G.CurrentNotifId].ClipsDescendants = true
    
    Instance.new("UICorner", _G.NotifFrames[_G.CurrentNotifId]).CornerRadius = UDim.new(0, 10)
    
    _G.NotifStrokes = _G.NotifStrokes or {}
    _G.NotifStrokes[_G.CurrentNotifId] = Instance.new("UIStroke", _G.NotifFrames[_G.CurrentNotifId])
    _G.NotifStrokes[_G.CurrentNotifId].Color = Colors.Border
    _G.NotifStrokes[_G.CurrentNotifId].Transparency = 0.3
    _G.NotifStrokes[_G.CurrentNotifId].Thickness = 1.5
    
    _G.NotifShadows = _G.NotifShadows or {}
    _G.NotifShadows[_G.CurrentNotifId] = Instance.new("ImageLabel", _G.NotifFrames[_G.CurrentNotifId])
    _G.NotifShadows[_G.CurrentNotifId].Name = "Shadow"
    _G.NotifShadows[_G.CurrentNotifId].Size = UDim2.new(1, 12, 1, 12)
    _G.NotifShadows[_G.CurrentNotifId].Position = UDim2.fromOffset(-6, -6)
    _G.NotifShadows[_G.CurrentNotifId].BackgroundTransparency = 1
    _G.NotifShadows[_G.CurrentNotifId].Image = "rbxassetid://6014261993"
    _G.NotifShadows[_G.CurrentNotifId].ImageColor3 = Color3.new(0, 0, 0)
    _G.NotifShadows[_G.CurrentNotifId].ImageTransparency = 0.75
    _G.NotifShadows[_G.CurrentNotifId].ScaleType = Enum.ScaleType.Slice
    _G.NotifShadows[_G.CurrentNotifId].SliceCenter = Rect.new(49, 49, 450, 450)
    _G.NotifShadows[_G.CurrentNotifId].ZIndex = -1
    
    _G.NotifTexts = _G.NotifTexts or {}
    _G.NotifTexts[_G.CurrentNotifId] = Instance.new("TextLabel", _G.NotifFrames[_G.CurrentNotifId])
    _G.NotifTexts[_G.CurrentNotifId].Size = UDim2.new(1, -20, 1, 0)
    _G.NotifTexts[_G.CurrentNotifId].Position = UDim2.fromOffset(10, 0)
    _G.NotifTexts[_G.CurrentNotifId].BackgroundTransparency = 1
    _G.NotifTexts[_G.CurrentNotifId].Text = "Copied: " .. text
    _G.NotifTexts[_G.CurrentNotifId].Font = Enum.Font.FredokaOne
    _G.NotifTexts[_G.CurrentNotifId].TextSize = Settings.IS_MOBILE and 11 or 13
    _G.NotifTexts[_G.CurrentNotifId].TextColor3 = Color3.new(1, 1, 1)
    _G.NotifTexts[_G.CurrentNotifId].TextXAlignment = Enum.TextXAlignment.Left
    _G.NotifTexts[_G.CurrentNotifId].TextTruncate = Enum.TextTruncate.AtEnd
    
    _G.NotifFrames[_G.CurrentNotifId].Size = UDim2.new(0, 0, 0, Settings.IS_MOBILE and 40 or 46)
    
    Services.TweenService:Create(_G.NotifFrames[_G.CurrentNotifId], TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 40 or 46)
    }):Play()
    
    _G.ScheduleNotificationRemoval(_G.CurrentNotifId)
end

_G.ScheduleNotificationRemoval = function(notifId)
    task.delay(2.5, function()
        if _G.NotifFrames and _G.NotifFrames[notifId] and _G.NotifFrames[notifId].Parent then
            Services.TweenService:Create(_G.NotifFrames[notifId], TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {
                Size = UDim2.new(0, 0, 0, Settings.IS_MOBILE and 40 or 46),
                BackgroundTransparency = 1
            }):Play()
            
            task.delay(0.35, function()
                if _G.NotifFrames[notifId] and _G.NotifFrames[notifId].Parent then
                    _G.NotifFrames[notifId]:Destroy()
                    _G.NotifFrames[notifId] = nil
                end
                if _G.NotifStrokes then
                    _G.NotifStrokes[notifId] = nil
                end
                if _G.NotifTexts then
                    _G.NotifTexts[notifId] = nil
                end
            end)
        end
    end)
end

_G.CopyToClipboard = function(text, displayText)
    pcall(function()
        if setclipboard then
            setclipboard(tostring(text))
        elseif toclipboard then
            toclipboard(tostring(text))
        end
    end)
    _G.ShowCopyNotification(displayText or tostring(text))
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- HOVER SETUP FUNCTIONS (FIXES CLOSURE ISSUE)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.SetupCardHover = function(card, btn, copyValue, displayText)
    btn.MouseEnter:Connect(function()
        Services.TweenService:Create(card, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.1}):Play()
    end)
    
    btn.MouseLeave:Connect(function()
        Services.TweenService:Create(card, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.3}):Play()
    end)
    
    btn.MouseButton1Click:Connect(function()
        Services.TweenService:Create(card, TweenInfo.new(0.1), {BackgroundColor3 = Colors.InteractiveActive}):Play()
        _G.CopyToClipboard(copyValue, displayText)
        task.delay(0.2, function()
            Services.TweenService:Create(card, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card}):Play()
        end)
    end)
end

_G.SetupButtonHover = function(card, btn)
end

_G.PlayerEntryHoverStates = {}

_G.SetupPlayerEntryHover = function(frame, btn, avatar, plrName, plrUserId)
    _G.PlayerEntryHoverStates[frame] = false
    
    task.spawn(function()
        _G.avatarSuccessTemp, _G.avatarThumbTemp = pcall(function()
            return Services.Players:GetUserThumbnailAsync(plrUserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
        end)
        if _G.avatarSuccessTemp and _G.avatarThumbTemp and avatar and avatar.Parent then
            avatar.Image = _G.avatarThumbTemp
        end
    end)
    
    btn.MouseEnter:Connect(function()
        _G.PlayerEntryHoverStates[frame] = true
        Services.TweenService:Create(frame, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.2}):Play()
    end)
    
    btn.MouseLeave:Connect(function()
        _G.PlayerEntryHoverStates[frame] = false
        Services.TweenService:Create(frame, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.5}):Play()
    end)
    
    btn.MouseButton1Click:Connect(function()
        Services.TweenService:Create(frame, TweenInfo.new(0.1), {BackgroundColor3 = Colors.InteractiveActive}):Play()
        _G.CopyToClipboard(plrName, "Username")
        task.delay(0.2, function()
            if not _G.PlayerEntryHoverStates[frame] then
                Services.TweenService:Create(frame, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card}):Play()
            else
                Services.TweenService:Create(frame, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover}):Play()
            end
        end)
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CLICKABLE INFO CARD CREATOR (FIXED)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.InfoCardStorage = {}
_G.InfoCardCount = 0

_G.CreateInfoCard = function(parent, labelText, valueText, copyValue, layoutOrder)
    _G.InfoCardCount = _G.InfoCardCount + 1
    _G.InfoCardStorage[_G.InfoCardCount] = {}
    
    _G.InfoCardStorage[_G.InfoCardCount].card = Core.moduleCard(parent, layoutOrder)
    
    _G.InfoCardStorage[_G.InfoCardCount].label = Instance.new("TextLabel", _G.InfoCardStorage[_G.InfoCardCount].card)
    _G.InfoCardStorage[_G.InfoCardCount].label.Size = UDim2.new(0.4, 0, 1, 0)
    _G.InfoCardStorage[_G.InfoCardCount].label.Position = UDim2.fromOffset(14, 0)
    _G.InfoCardStorage[_G.InfoCardCount].label.BackgroundTransparency = 1
    _G.InfoCardStorage[_G.InfoCardCount].label.Text = labelText
    _G.InfoCardStorage[_G.InfoCardCount].label.Font = Enum.Font.FredokaOne
    _G.InfoCardStorage[_G.InfoCardCount].label.TextSize = Settings.IS_MOBILE and 11 or 13
    _G.InfoCardStorage[_G.InfoCardCount].label.TextColor3 = Color3.new(1, 1, 1)
    _G.InfoCardStorage[_G.InfoCardCount].label.TextXAlignment = Enum.TextXAlignment.Left
    
    _G.InfoCardStorage[_G.InfoCardCount].value = Instance.new("TextLabel", _G.InfoCardStorage[_G.InfoCardCount].card)
    _G.InfoCardStorage[_G.InfoCardCount].value.Size = UDim2.new(0.55, -20, 1, 0)
    _G.InfoCardStorage[_G.InfoCardCount].value.Position = UDim2.new(0.45, 0, 0, 0)
    _G.InfoCardStorage[_G.InfoCardCount].value.BackgroundTransparency = 1
    _G.InfoCardStorage[_G.InfoCardCount].value.Text = valueText
    _G.InfoCardStorage[_G.InfoCardCount].value.Font = Enum.Font.FredokaOne
    _G.InfoCardStorage[_G.InfoCardCount].value.TextSize = Settings.IS_MOBILE and 11 or 13
    _G.InfoCardStorage[_G.InfoCardCount].value.TextColor3 = Color3.new(1, 1, 1)
    _G.InfoCardStorage[_G.InfoCardCount].value.TextXAlignment = Enum.TextXAlignment.Right
    _G.InfoCardStorage[_G.InfoCardCount].value.TextTruncate = Enum.TextTruncate.AtEnd
    
    _G.InfoCardStorage[_G.InfoCardCount].btn = Instance.new("TextButton", _G.InfoCardStorage[_G.InfoCardCount].card)
    _G.InfoCardStorage[_G.InfoCardCount].btn.Size = UDim2.fromScale(1, 1)
    _G.InfoCardStorage[_G.InfoCardCount].btn.BackgroundTransparency = 1
    _G.InfoCardStorage[_G.InfoCardCount].btn.Text = ""
    _G.InfoCardStorage[_G.InfoCardCount].btn.ZIndex = 10
    
    _G.SetupCardHover(
        _G.InfoCardStorage[_G.InfoCardCount].card,
        _G.InfoCardStorage[_G.InfoCardCount].btn,
        copyValue,
        labelText
    )
    
    return _G.InfoCardStorage[_G.InfoCardCount].card
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- WELCOME SECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.welcomeSection = Core.section(_G.Main, "Welcome", 1)

_G.welcomeCard = Core.moduleCard(_G.welcomeSection, 1)
_G.welcomeCard.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 70 or 85)
_G.welcomeCard.BackgroundColor3 = Colors.Interactive
_G.welcomeCard.BackgroundTransparency = 0.3

_G.welcomeGradient = Instance.new("UIGradient", _G.welcomeCard)
_G.welcomeGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
})
_G.welcomeGradient.Transparency = NumberSequence.new({
    NumberSequenceKeypoint.new(0, 0.7),
    NumberSequenceKeypoint.new(1, 0.9)
})
_G.welcomeGradient.Rotation = 45

_G.welcomeIcon = Instance.new("ImageLabel", _G.welcomeCard)
_G.welcomeIcon.Size = UDim2.fromOffset(Settings.IS_MOBILE and 40 or 50, Settings.IS_MOBILE and 40 or 50)
_G.welcomeIcon.Position = UDim2.fromOffset(Settings.IS_MOBILE and 10 or 14, Settings.IS_MOBILE and 15 or 18)
_G.welcomeIcon.BackgroundTransparency = 1
_G.welcomeIcon.Image = "rbxassetid://72998769206857"
_G.welcomeIcon.ScaleType = Enum.ScaleType.Fit
_G.welcomeIcon.ZIndex = 10

_G.welcomeTitle = Instance.new("TextLabel", _G.welcomeCard)
_G.welcomeTitle.Size = UDim2.new(1, -70, 0, 24)
_G.welcomeTitle.Position = UDim2.fromOffset(Settings.IS_MOBILE and 56 or 72, Settings.IS_MOBILE and 10 or 12)
_G.welcomeTitle.BackgroundTransparency = 1
_G.welcomeTitle.Text = "Welcome to " .. _G.PRISMATICAX_NAME .. "!"
_G.welcomeTitle.Font = Enum.Font.FredokaOne
_G.welcomeTitle.TextSize = Settings.IS_MOBILE and 14 or 18
_G.welcomeTitle.TextColor3 = Color3.new(1, 1, 1)
_G.welcomeTitle.TextXAlignment = Enum.TextXAlignment.Left
_G.welcomeTitle.ZIndex = 10

_G.welcomeSubtitle = Instance.new("TextLabel", _G.welcomeCard)
_G.welcomeSubtitle.Size = UDim2.new(1, -70, 0, 18)
_G.welcomeSubtitle.Position = UDim2.fromOffset(Settings.IS_MOBILE and 56 or 72, Settings.IS_MOBILE and 30 or 34)
_G.welcomeSubtitle.BackgroundTransparency = 1
_G.welcomeSubtitle.Text = "Hello, " .. Player.DisplayName .. "! Enjoy the script."
_G.welcomeSubtitle.Font = Enum.Font.FredokaOne
_G.welcomeSubtitle.TextSize = Settings.IS_MOBILE and 10 or 12
_G.welcomeSubtitle.TextColor3 = Color3.new(1, 1, 1)
_G.welcomeSubtitle.TextXAlignment = Enum.TextXAlignment.Left
_G.welcomeSubtitle.ZIndex = 10

_G.welcomeVersion = Instance.new("TextLabel", _G.welcomeCard)
_G.welcomeVersion.Size = UDim2.new(1, -70, 0, 16)
_G.welcomeVersion.Position = UDim2.fromOffset(Settings.IS_MOBILE and 56 or 72, Settings.IS_MOBILE and 48 or 54)
_G.welcomeVersion.BackgroundTransparency = 1
_G.welcomeVersion.Text = "Version " .. _G.PRISMATICAX_VERSION .. " â€¢ by " .. _G.PRISMATICAX_AUTHOR
_G.welcomeVersion.Font = Enum.Font.FredokaOne
_G.welcomeVersion.TextSize = Settings.IS_MOBILE and 9 or 11
_G.welcomeVersion.TextColor3 = Color3.new(1, 1, 1)
_G.welcomeVersion.TextXAlignment = Enum.TextXAlignment.Left
_G.welcomeVersion.ZIndex = 10

Core.registerModule("Welcome Card", _G.welcomeCard, _G.welcomeSection, "Main", "module")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SCRIPT INFO SECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.scriptInfoSection = Core.section(_G.Main, "Script Information", 2)

_G.scriptNameCard = _G.CreateInfoCard(_G.scriptInfoSection, "Script Name", _G.PRISMATICAX_NAME, _G.PRISMATICAX_NAME, 1)
_G.scriptVersionCard = _G.CreateInfoCard(_G.scriptInfoSection, "Version", _G.PRISMATICAX_VERSION, _G.PRISMATICAX_VERSION, 2)
_G.scriptAuthorCard = _G.CreateInfoCard(_G.scriptInfoSection, "Author", _G.PRISMATICAX_AUTHOR, _G.PRISMATICAX_TELEGRAM, 3)
_G.scriptLinkCard = _G.CreateInfoCard(_G.scriptInfoSection, "Script Link", "Click to copy", _G.PRISMATICAX_SCRIPT, 4)

_G.scriptExecutorName = "Unknown"
pcall(function()
    if identifyexecutor then
        _G.scriptExecutorName = identifyexecutor()
    elseif getexecutorname then
        _G.scriptExecutorName = getexecutorname()
    end
end)

_G.scriptExecutorCard = _G.CreateInfoCard(_G.scriptInfoSection, "Executor", _G.scriptExecutorName, _G.scriptExecutorName, 5)

Core.registerModule("Script Name", _G.scriptNameCard, _G.scriptInfoSection, "Main", "module")
Core.registerModule("Script Version", _G.scriptVersionCard, _G.scriptInfoSection, "Main", "module")
Core.registerModule("Script Author", _G.scriptAuthorCard, _G.scriptInfoSection, "Main", "module")
Core.registerModule("Script Link", _G.scriptLinkCard, _G.scriptInfoSection, "Main", "module")
Core.registerModule("Executor", _G.scriptExecutorCard, _G.scriptInfoSection, "Main", "module")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- GAME INFO SECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.gameInfoSection = Core.section(_G.Main, "Game Information", 3)

_G.currentGameName = "Unknown"
pcall(function()
    _G.currentGameName = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name
end)

_G.gameNameCard = _G.CreateInfoCard(_G.gameInfoSection, "Game Name", _G.currentGameName, _G.currentGameName, 1)
_G.gamePlaceIdCard = _G.CreateInfoCard(_G.gameInfoSection, "Place ID", tostring(game.PlaceId), tostring(game.PlaceId), 2)
_G.gameUniverseIdCard = _G.CreateInfoCard(_G.gameInfoSection, "Universe ID", tostring(game.GameId), tostring(game.GameId), 3)
_G.gameJobIdCard = _G.CreateInfoCard(_G.gameInfoSection, "Job ID", string.sub(game.JobId, 1, 20) .. "...", game.JobId, 4)

Core.registerModule("Game Name", _G.gameNameCard, _G.gameInfoSection, "Main", "module")
Core.registerModule("Place ID", _G.gamePlaceIdCard, _G.gameInfoSection, "Main", "module")
Core.registerModule("Universe ID", _G.gameUniverseIdCard, _G.gameInfoSection, "Main", "module")
Core.registerModule("Job ID", _G.gameJobIdCard, _G.gameInfoSection, "Main", "module")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- PLAYER INFO SECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.playerInfoSection = Core.section(_G.Main, "Your Information", 4)

_G.playerUsernameCard = _G.CreateInfoCard(_G.playerInfoSection, "Username", Player.Name, Player.Name, 1)
_G.playerDisplayCard = _G.CreateInfoCard(_G.playerInfoSection, "Display Name", Player.DisplayName, Player.DisplayName, 2)
_G.playerUserIdCard = _G.CreateInfoCard(_G.playerInfoSection, "User ID", tostring(Player.UserId), tostring(Player.UserId), 3)
_G.playerAccountAgeCard = _G.CreateInfoCard(_G.playerInfoSection, "Account Age", tostring(Player.AccountAge) .. " days", tostring(Player.AccountAge), 4)

Core.registerModule("Your Username", _G.playerUsernameCard, _G.playerInfoSection, "Main", "module")
Core.registerModule("Your Display Name", _G.playerDisplayCard, _G.playerInfoSection, "Main", "module")
Core.registerModule("Your User ID", _G.playerUserIdCard, _G.playerInfoSection, "Main", "module")
Core.registerModule("Your Account Age", _G.playerAccountAgeCard, _G.playerInfoSection, "Main", "module")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SERVER PLAYERS SECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.serverPlayersSection = Core.section(_G.Main, "Server Players", 5)

_G.playerCountCard = Core.moduleCard(_G.serverPlayersSection, 1)

_G.playerCountLabel = Instance.new("TextLabel", _G.playerCountCard)
_G.playerCountLabel.Size = UDim2.new(0.5, 0, 1, 0)
_G.playerCountLabel.Position = UDim2.fromOffset(14, 0)
_G.playerCountLabel.BackgroundTransparency = 1
_G.playerCountLabel.Text = "Players Online"
_G.playerCountLabel.Font = Enum.Font.FredokaOne
_G.playerCountLabel.TextSize = Settings.IS_MOBILE and 11 or 13
_G.playerCountLabel.TextColor3 = Color3.new(1, 1, 1)
_G.playerCountLabel.TextXAlignment = Enum.TextXAlignment.Left

_G.playerCountValue = Instance.new("TextLabel", _G.playerCountCard)
_G.playerCountValue.Size = UDim2.new(0.45, -20, 1, 0)
_G.playerCountValue.Position = UDim2.new(0.55, 0, 0, 0)
_G.playerCountValue.BackgroundTransparency = 1
_G.playerCountValue.Text = tostring(#Services.Players:GetPlayers()) .. " / " .. tostring(Services.Players.MaxPlayers)
_G.playerCountValue.Font = Enum.Font.FredokaOne
_G.playerCountValue.TextSize = Settings.IS_MOBILE and 11 or 13
_G.playerCountValue.TextColor3 = Color3.new(1, 1, 1)
_G.playerCountValue.TextXAlignment = Enum.TextXAlignment.Right

_G.playerCountBtn = Instance.new("TextButton", _G.playerCountCard)
_G.playerCountBtn.Size = UDim2.fromScale(1, 1)
_G.playerCountBtn.BackgroundTransparency = 1
_G.playerCountBtn.Text = ""
_G.playerCountBtn.ZIndex = 10

_G.playerCountBtn.MouseEnter:Connect(function()
    Services.TweenService:Create(_G.playerCountCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.1}):Play()
end)

_G.playerCountBtn.MouseLeave:Connect(function()
    Services.TweenService:Create(_G.playerCountCard, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.3}):Play()
end)

_G.playerListScrollCard = Core.moduleCard(_G.serverPlayersSection, 2)
_G.playerListScrollCard.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 150 or 180)
_G.playerListScrollCard.ClipsDescendants = true

_G.playerListScroll = Instance.new("ScrollingFrame", _G.playerListScrollCard)
_G.playerListScroll.Size = UDim2.new(1, -8, 1, -8)
_G.playerListScroll.Position = UDim2.fromOffset(4, 4)
_G.playerListScroll.BackgroundTransparency = 1
_G.playerListScroll.BorderSizePixel = 0
_G.playerListScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
_G.playerListScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
_G.playerListScroll.ScrollingDirection = Enum.ScrollingDirection.Y
_G.playerListScroll.ScrollBarThickness = 3
_G.playerListScroll.ScrollBarImageColor3 = Colors.Interactive

_G.playerListLayout = Instance.new("UIListLayout", _G.playerListScroll)
_G.playerListLayout.Padding = UDim.new(0, 4)
_G.playerListLayout.SortOrder = Enum.SortOrder.LayoutOrder

_G.playerListPadding = Instance.new("UIPadding", _G.playerListScroll)
_G.playerListPadding.PaddingTop = UDim.new(0, 2)
_G.playerListPadding.PaddingBottom = UDim.new(0, 2)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- PLAYER ENTRY CREATOR (FIXED WITH THEME UPDATE)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.PlayerEntryStorage = {}
_G.PlayerEntryCount = 0
_G.MainTabColorElements = {}
_G.MainTabColorElementsCount = 0

_G.RegisterMainTabColorElement = function(element, elementType)
    _G.MainTabColorElementsCount = _G.MainTabColorElementsCount + 1
    _G.MainTabColorElements[_G.MainTabColorElementsCount] = {}
    _G.MainTabColorElements[_G.MainTabColorElementsCount].element = element
    _G.MainTabColorElements[_G.MainTabColorElementsCount].elementType = elementType
end

_G.UpdateMainTabColors = function()
    _G.mainTabColorIndex = 1
    while _G.mainTabColorIndex <= _G.MainTabColorElementsCount do
        _G.mainTabColorData = _G.MainTabColorElements[_G.mainTabColorIndex]
        if _G.mainTabColorData and _G.mainTabColorData.element and _G.mainTabColorData.element.Parent then
            if _G.mainTabColorData.elementType == "avatar" then
                _G.mainTabColorData.element.BackgroundColor3 = Colors.Interactive
            elseif _G.mainTabColorData.elementType == "playerFrame" then
                _G.mainTabColorData.element.BackgroundColor3 = Colors.Card
            elseif _G.mainTabColorData.elementType == "scrollbar" then
                _G.mainTabColorData.element.ScrollBarImageColor3 = Colors.Interactive
            end
        end
        _G.mainTabColorIndex = _G.mainTabColorIndex + 1
    end
end

_G.CreatePlayerEntry = function(plr, layoutOrder)
    _G.PlayerEntryCount = _G.PlayerEntryCount + 1
    _G.PlayerEntryStorage[_G.PlayerEntryCount] = {}
    
    _G.PlayerEntryStorage[_G.PlayerEntryCount].frame = Instance.new("Frame", _G.playerListScroll)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].frame.Name = "Player_" .. plr.Name
    _G.PlayerEntryStorage[_G.PlayerEntryCount].frame.Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 36 or 42)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].frame.BackgroundColor3 = Colors.Card
    _G.PlayerEntryStorage[_G.PlayerEntryCount].frame.BackgroundTransparency = 0.5
    _G.PlayerEntryStorage[_G.PlayerEntryCount].frame.BorderSizePixel = 0
    _G.PlayerEntryStorage[_G.PlayerEntryCount].frame.LayoutOrder = layoutOrder
    
    _G.RegisterMainTabColorElement(_G.PlayerEntryStorage[_G.PlayerEntryCount].frame, "playerFrame")
    
    Instance.new("UICorner", _G.PlayerEntryStorage[_G.PlayerEntryCount].frame).CornerRadius = UDim.new(0, 8)
    
    _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar = Instance.new("ImageLabel", _G.PlayerEntryStorage[_G.PlayerEntryCount].frame)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar.Size = UDim2.fromOffset(Settings.IS_MOBILE and 28 or 32, Settings.IS_MOBILE and 28 or 32)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar.Position = UDim2.fromOffset(6, Settings.IS_MOBILE and 4 or 5)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar.BackgroundColor3 = Colors.Interactive
    _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar.BorderSizePixel = 0
    _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar.Image = ""
    _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar.ScaleType = Enum.ScaleType.Crop
    
    _G.RegisterMainTabColorElement(_G.PlayerEntryStorage[_G.PlayerEntryCount].avatar, "avatar")
    
    Instance.new("UICorner", _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar).CornerRadius = UDim.new(1, 0)
    
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel = Instance.new("TextLabel", _G.PlayerEntryStorage[_G.PlayerEntryCount].frame)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.Size = UDim2.new(1, -50, 0, 16)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.Position = UDim2.fromOffset(Settings.IS_MOBILE and 40 or 46, Settings.IS_MOBILE and 4 or 5)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.BackgroundTransparency = 1
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.Text = plr.DisplayName
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.Font = Enum.Font.FredokaOne
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.TextSize = Settings.IS_MOBILE and 11 or 13
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.TextColor3 = Color3.new(1, 1, 1)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    _G.PlayerEntryStorage[_G.PlayerEntryCount].nameLabel.TextTruncate = Enum.TextTruncate.AtEnd
    
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel = Instance.new("TextLabel", _G.PlayerEntryStorage[_G.PlayerEntryCount].frame)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.Size = UDim2.new(1, -50, 0, 14)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.Position = UDim2.fromOffset(Settings.IS_MOBILE and 40 or 46, Settings.IS_MOBILE and 20 or 22)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.BackgroundTransparency = 1
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.Text = "@" .. plr.Name
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.Font = Enum.Font.FredokaOne
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.TextSize = Settings.IS_MOBILE and 9 or 10
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.TextColor3 = Color3.new(1, 1, 1)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.TextXAlignment = Enum.TextXAlignment.Left
    _G.PlayerEntryStorage[_G.PlayerEntryCount].usernameLabel.TextTruncate = Enum.TextTruncate.AtEnd
    
    _G.PlayerEntryStorage[_G.PlayerEntryCount].btn = Instance.new("TextButton", _G.PlayerEntryStorage[_G.PlayerEntryCount].frame)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].btn.Size = UDim2.fromScale(1, 1)
    _G.PlayerEntryStorage[_G.PlayerEntryCount].btn.BackgroundTransparency = 1
    _G.PlayerEntryStorage[_G.PlayerEntryCount].btn.Text = ""
    _G.PlayerEntryStorage[_G.PlayerEntryCount].btn.ZIndex = 10
    
    _G.SetupPlayerEntryHover(
        _G.PlayerEntryStorage[_G.PlayerEntryCount].frame,
        _G.PlayerEntryStorage[_G.PlayerEntryCount].btn,
        _G.PlayerEntryStorage[_G.PlayerEntryCount].avatar,
        plr.Name,
        plr.UserId
    )
    
    return _G.PlayerEntryStorage[_G.PlayerEntryCount].frame
end

_G.RefreshPlayerList = function()
    _G.existingEntries = _G.playerListScroll:GetChildren()
    _G.existingEntryIndex = 1
    while _G.existingEntryIndex <= #_G.existingEntries do
        _G.existingEntry = _G.existingEntries[_G.existingEntryIndex]
        if _G.existingEntry:IsA("Frame") then
            _G.existingEntry:Destroy()
        end
        _G.existingEntryIndex = _G.existingEntryIndex + 1
    end
    
    _G.PlayerEntryStorage = {}
    _G.PlayerEntryCount = 0
    _G.MainTabColorElements = {}
    _G.MainTabColorElementsCount = 0
    
    _G.RegisterMainTabColorElement(_G.playerListScroll, "scrollbar")
    
    _G.allPlayers = Services.Players:GetPlayers()
    _G.playerListIndex = 1
    while _G.playerListIndex <= #_G.allPlayers do
        _G.CreatePlayerEntry(_G.allPlayers[_G.playerListIndex], _G.playerListIndex)
        _G.playerListIndex = _G.playerListIndex + 1
    end
    
    _G.playerCountValue.Text = tostring(#_G.allPlayers) .. " / " .. tostring(Services.Players.MaxPlayers)
    
    _G.playerListScroll.ScrollBarImageColor3 = Colors.Interactive
end

_G.RefreshPlayerList()

Services.Players.PlayerAdded:Connect(function()
    task.wait(0.5)
    _G.RefreshPlayerList()
end)

Services.Players.PlayerRemoving:Connect(function()
    task.wait(0.5)
    _G.RefreshPlayerList()
end)

Services.Players.PlayerRemoving:Connect(function()
    task.wait(0.5)
    _G.RefreshPlayerList()
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ACTION BUTTONS (CLOSURE FIX - USING BUTTONID LOOKUP)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ActionButtonStorage = {}
_G.ActionButtonCount = 0
_G.ActionButtonHoverStates = {}

_G.SetupActionButtonEvents = function(buttonId)
    if not _G.ActionButtonStorage[buttonId] then
        return
    end
    
    _G.ActionButtonStorage[buttonId].btn.MouseEnter:Connect(function()
        _G.ActionButtonHoverStates[_G.ActionButtonStorage[buttonId].card] = true
        Services.TweenService:Create(_G.ActionButtonStorage[buttonId].card, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover, BackgroundTransparency = 0.1}):Play()
    end)
    
    _G.ActionButtonStorage[buttonId].btn.MouseLeave:Connect(function()
        _G.ActionButtonHoverStates[_G.ActionButtonStorage[buttonId].card] = false
        Services.TweenService:Create(_G.ActionButtonStorage[buttonId].card, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card, BackgroundTransparency = 0.3}):Play()
    end)
    
    _G.ActionButtonStorage[buttonId].btn.MouseButton1Click:Connect(function()
        Services.TweenService:Create(_G.ActionButtonStorage[buttonId].card, TweenInfo.new(0.1), {BackgroundColor3 = Colors.InteractiveActive}):Play()
        task.delay(0.2, function()
            if _G.ActionButtonHoverStates[_G.ActionButtonStorage[buttonId].card] then
                Services.TweenService:Create(_G.ActionButtonStorage[buttonId].card, TweenInfo.new(0.15), {BackgroundColor3 = Colors.InteractiveHover}):Play()
            else
                Services.TweenService:Create(_G.ActionButtonStorage[buttonId].card, TweenInfo.new(0.15), {BackgroundColor3 = Colors.Card}):Play()
            end
        end)
        if _G.ActionButtonStorage[buttonId].callback then
            _G.ActionButtonStorage[buttonId].callback(_G.ActionButtonStorage[buttonId].label)
        end
    end)
end

_G.CreateActionButton = function(parent, text, layoutOrder, onClick)
    _G.ActionButtonCount = _G.ActionButtonCount + 1
    _G.ActionButtonCurrentId = _G.ActionButtonCount
    
    _G.ActionButtonStorage[_G.ActionButtonCurrentId] = {}
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].id = _G.ActionButtonCurrentId
    
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].card = Core.moduleCard(parent, layoutOrder)
    
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label = Instance.new("TextLabel", _G.ActionButtonStorage[_G.ActionButtonCurrentId].card)
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label.Size = UDim2.fromScale(1, 1)
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label.Position = UDim2.fromOffset(0, 0)
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label.BackgroundTransparency = 1
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label.Text = text
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label.Font = Enum.Font.FredokaOne
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label.TextSize = Settings.IS_MOBILE and 11 or 13
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label.TextColor3 = Color3.new(1, 1, 1)
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].label.TextXAlignment = Enum.TextXAlignment.Center
    
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].btn = Instance.new("TextButton", _G.ActionButtonStorage[_G.ActionButtonCurrentId].card)
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].btn.Size = UDim2.fromScale(1, 1)
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].btn.BackgroundTransparency = 1
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].btn.Text = ""
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].btn.ZIndex = 10
    
    _G.ActionButtonStorage[_G.ActionButtonCurrentId].callback = onClick
    
    _G.ActionButtonHoverStates[_G.ActionButtonStorage[_G.ActionButtonCurrentId].card] = false
    
    _G.SetupActionButtonEvents(_G.ActionButtonCurrentId)
    
    return _G.ActionButtonStorage[_G.ActionButtonCurrentId].card, _G.ActionButtonStorage[_G.ActionButtonCurrentId].label
end

_G.refreshPlayersCard, _G.refreshPlayersLabel = _G.CreateActionButton(_G.serverPlayersSection, "Refresh Player List", 3, function(label)
    _G.RefreshPlayerList()
end)

_G.copyAllNicksCard, _G.copyAllNicksLabel = _G.CreateActionButton(_G.serverPlayersSection, "Copy All Usernames", 4, function(label)
    _G.allNicknames = ""
    _G.allPlayersForNicks = Services.Players:GetPlayers()
    _G.nickIndex = 1
    while _G.nickIndex <= #_G.allPlayersForNicks do
        _G.allNicknames = _G.allNicknames .. _G.allPlayersForNicks[_G.nickIndex].Name
        if _G.nickIndex < #_G.allPlayersForNicks then
            _G.allNicknames = _G.allNicknames .. ", "
        end
        _G.nickIndex = _G.nickIndex + 1
    end
    _G.CopyToClipboard(_G.allNicknames, "All Usernames")
end)

Core.registerModule("Players Online", _G.playerCountCard, _G.serverPlayersSection, "Main", "module")
Core.registerModule("Player List", _G.playerListScrollCard, _G.serverPlayersSection, "Main", "module")
Core.registerModule("Refresh Player List", _G.refreshPlayersCard, _G.serverPlayersSection, "Main", "button")
Core.registerModule("Copy All Usernames", _G.copyAllNicksCard, _G.serverPlayersSection, "Main", "button")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- QUICK ACTIONS SECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.quickActionsSection = Core.section(_G.Main, "Quick Actions", 6)

_G.rejoinServerCard, _G.rejoinServerLabel = _G.CreateActionButton(_G.quickActionsSection, "Rejoin Server", 1, function(label)
    label.Text = "Rejoining..."
    task.delay(0.5, function()
        pcall(function()
            Services.TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId)
        end)
    end)
end)

_G.serverHopCard, _G.serverHopLabel = _G.CreateActionButton(_G.quickActionsSection, "Server Hop (Random Server)", 2, function(label)
    label.Text = "Finding server..."
    
    task.spawn(function()
        pcall(function()
            _G.serverHopServers = Services.HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
            
            if _G.serverHopServers and _G.serverHopServers.data then
                _G.serverHopIndex = 1
                while _G.serverHopIndex <= #_G.serverHopServers.data do
                    _G.serverHopServer = _G.serverHopServers.data[_G.serverHopIndex]
                    if _G.serverHopServer.id ~= game.JobId and _G.serverHopServer.playing < _G.serverHopServer.maxPlayers then
                        label.Text = "Teleporting..."
                        Services.TeleportService:TeleportToPlaceInstance(game.PlaceId, _G.serverHopServer.id)
                        return
                    end
                    _G.serverHopIndex = _G.serverHopIndex + 1
                end
            end
            
            label.Text = "No servers found!"
            
            task.delay(2, function()
                label.Text = "Server Hop (Random Server)"
            end)
        end)
    end)
end)

_G.resetCharCard, _G.resetCharLabel = _G.CreateActionButton(_G.quickActionsSection, "Reset Character", 3, function(label)
    if Player.Character then
        _G.resetHumanoid = Player.Character:FindFirstChildOfClass("Humanoid")
        if _G.resetHumanoid then
            _G.resetHumanoid.Health = 0
        end
    end
end)

Core.registerModule("Rejoin Server", _G.rejoinServerCard, _G.quickActionsSection, "Main", "button")
Core.registerModule("Server Hop", _G.serverHopCard, _G.quickActionsSection, "Main", "button")
Core.registerModule("Reset Character", _G.resetCharCard, _G.quickActionsSection, "Main", "button")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MAIN TAB COLOR UPDATE SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.MainTabLastInteractiveColor = Colors.Interactive
_G.MainTabLastCardColor = Colors.Card

_G.MainTabColorUpdateConnection = Services.RunService.Heartbeat:Connect(function()
    if _G.playerListScroll and _G.playerListScroll.Parent then
        _G.playerListScroll.ScrollBarImageColor3 = Colors.Interactive
    end
    
    if _G.MainTabLastInteractiveColor ~= Colors.Interactive or _G.MainTabLastCardColor ~= Colors.Card then
        _G.MainTabLastInteractiveColor = Colors.Interactive
        _G.MainTabLastCardColor = Colors.Card
        _G.UpdateMainTabColors()
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CONFIGURATION SYSTEM (Rewritten with Core.dropdown)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ConfigSystem = {}
_G.ConfigSystem.Folder = "PrismaticaX_Configs"
_G.ConfigSystem.Selected = ""
_G.ConfigSystem.InputName = ""
_G.ConfigSystem.DropdownContainer = nil
_G.ConfigSystem.SetDropdownFunction = nil

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NOTIFICATION HELPER (uses existing notification system)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ShowNotification = function(text)
    _G.CreateNotificationContainer()
    
    _G.NotificationCount = _G.NotificationCount + 1
    _G.CurrentNotifId = _G.NotificationCount
    
    _G.NotifFrames = _G.NotifFrames or {}
    
    _G.NotifOpacity = math.min(Settings.GUI_OPACITY / 100, 0.7)
    
    _G.NotifFrames[_G.CurrentNotifId] = Instance.new("Frame", _G.NotificationContainer)
    _G.NotifFrames[_G.CurrentNotifId].Name = "Notification_" .. _G.CurrentNotifId
    _G.NotifFrames[_G.CurrentNotifId].Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 40 or 46)
    _G.NotifFrames[_G.CurrentNotifId].BackgroundColor3 = Colors.Base
    _G.NotifFrames[_G.CurrentNotifId].BackgroundTransparency = _G.NotifOpacity
    _G.NotifFrames[_G.CurrentNotifId].BorderSizePixel = 0
    _G.NotifFrames[_G.CurrentNotifId].LayoutOrder = -_G.CurrentNotifId
    _G.NotifFrames[_G.CurrentNotifId].ClipsDescendants = true
    
    Instance.new("UICorner", _G.NotifFrames[_G.CurrentNotifId]).CornerRadius = UDim.new(0, 10)
    
    _G.NotifStrokes = _G.NotifStrokes or {}
    _G.NotifStrokes[_G.CurrentNotifId] = Instance.new("UIStroke", _G.NotifFrames[_G.CurrentNotifId])
    _G.NotifStrokes[_G.CurrentNotifId].Color = Colors.Border
    _G.NotifStrokes[_G.CurrentNotifId].Transparency = 0.3
    _G.NotifStrokes[_G.CurrentNotifId].Thickness = 1.5
    
    _G.NotifShadows = _G.NotifShadows or {}
    _G.NotifShadows[_G.CurrentNotifId] = Instance.new("ImageLabel", _G.NotifFrames[_G.CurrentNotifId])
    _G.NotifShadows[_G.CurrentNotifId].Name = "Shadow"
    _G.NotifShadows[_G.CurrentNotifId].Size = UDim2.new(1, 12, 1, 12)
    _G.NotifShadows[_G.CurrentNotifId].Position = UDim2.fromOffset(-6, -6)
    _G.NotifShadows[_G.CurrentNotifId].BackgroundTransparency = 1
    _G.NotifShadows[_G.CurrentNotifId].Image = "rbxassetid://6014261993"
    _G.NotifShadows[_G.CurrentNotifId].ImageColor3 = Color3.new(0, 0, 0)
    _G.NotifShadows[_G.CurrentNotifId].ImageTransparency = 0.75
    _G.NotifShadows[_G.CurrentNotifId].ScaleType = Enum.ScaleType.Slice
    _G.NotifShadows[_G.CurrentNotifId].SliceCenter = Rect.new(49, 49, 450, 450)
    _G.NotifShadows[_G.CurrentNotifId].ZIndex = -1
    
    _G.NotifTexts = _G.NotifTexts or {}
    _G.NotifTexts[_G.CurrentNotifId] = Instance.new("TextLabel", _G.NotifFrames[_G.CurrentNotifId])
    _G.NotifTexts[_G.CurrentNotifId].Size = UDim2.new(1, -20, 1, 0)
    _G.NotifTexts[_G.CurrentNotifId].Position = UDim2.fromOffset(10, 0)
    _G.NotifTexts[_G.CurrentNotifId].BackgroundTransparency = 1
    _G.NotifTexts[_G.CurrentNotifId].Text = text
    _G.NotifTexts[_G.CurrentNotifId].Font = Enum.Font.FredokaOne
    _G.NotifTexts[_G.CurrentNotifId].TextSize = Settings.IS_MOBILE and 11 or 13
    _G.NotifTexts[_G.CurrentNotifId].TextColor3 = Color3.new(1, 1, 1)
    _G.NotifTexts[_G.CurrentNotifId].TextXAlignment = Enum.TextXAlignment.Left
    _G.NotifTexts[_G.CurrentNotifId].TextTruncate = Enum.TextTruncate.AtEnd
    
    _G.NotifFrames[_G.CurrentNotifId].Size = UDim2.new(0, 0, 0, Settings.IS_MOBILE and 40 or 46)
    
    Services.TweenService:Create(_G.NotifFrames[_G.CurrentNotifId], TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(1, 0, 0, Settings.IS_MOBILE and 40 or 46)
    }):Play()
    
    _G.ScheduleNotificationRemoval(_G.CurrentNotifId)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- UTILITY FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ConfigSystem.EnsureFolder = function()
    _G.cfgFolderSuccess = pcall(function()
        if makefolder and not isfolder(_G.ConfigSystem.Folder) then
            makefolder(_G.ConfigSystem.Folder)
        end
    end)
    return _G.cfgFolderSuccess
end

_G.ConfigSystem.IsValidName = function(name)
    if not name or name == "" then return false end
    return string.match(name, "^[a-zA-Z0-9_%-]+$") ~= nil
end

_G.ConfigSystem.GetList = function()
    _G.cfgConfigs = {}
    _G.ConfigSystem.EnsureFolder()
    
    _G.cfgListSuccess, _G.cfgFiles = pcall(function()
        if listfiles then
            return listfiles(_G.ConfigSystem.Folder)
        end
        return {}
    end)
    
    if _G.cfgListSuccess and _G.cfgFiles then
        _G.cfgIdx = 1
        while _G.cfgIdx <= #_G.cfgFiles do
            _G.cfgFile = _G.cfgFiles[_G.cfgIdx]
            if string.sub(_G.cfgFile, -5) == ".json" then
                _G.cfgName = _G.cfgFile:match("([^/\\]+)%.json$")
                if _G.cfgName and _G.ConfigSystem.IsValidName(_G.cfgName) then
                    table.insert(_G.cfgConfigs, _G.cfgName)
                end
            end
            _G.cfgIdx = _G.cfgIdx + 1
        end
    end
    
    table.sort(_G.cfgConfigs)
    return _G.cfgConfigs
end

_G.ConfigSystem.GetOptionsTable = function()
    _G.cfgOptionsTable = {{name = "None"}}
    _G.cfgConfigsList = _G.ConfigSystem.GetList()
    
    _G.cfgOptIdx = 1
    while _G.cfgOptIdx <= #_G.cfgConfigsList do
        table.insert(_G.cfgOptionsTable, {name = _G.cfgConfigsList[_G.cfgOptIdx]})
        _G.cfgOptIdx = _G.cfgOptIdx + 1
    end
    
    return _G.cfgOptionsTable
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SAVE CONFIGURATION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ConfigSystem.Save = function(configName)
    if not _G.ConfigSystem.IsValidName(configName) then
        return false, "Invalid name"
    end
    
    _G.ConfigSystem.EnsureFolder()
    
    _G.cfgSaveData = {
        version = "2.0",
        timestamp = os.time(),
        date = os.date("%Y-%m-%d %H:%M:%S"),
        
        settings = {
            theme = Settings.CURRENT_THEME or "Default",
            guiOpacity = Settings.GUI_OPACITY or 0.85,
            keybind = Settings.CURRENT_BIND and Settings.CURRENT_BIND.Name or "RightShift",
            guiWidth = Settings.GUI_WIDTH or 400,
            guiHeight = Settings.ORIGINAL_HEIGHT or 500
        },
        
        esp = {
            enabled = ESPEnabled or false,
            nameEnabled = NameESPEnabled or false,
            distanceEnabled = DistanceESPEnabled or false,
            teamCheck = TeamCheckEnabled ~= false,
            textSize = ESPTextSize or 14,
            transparency = ESPTransparency or 50,
            color = ESPColor and {
                r = math.floor(ESPColor.R * 255),
                g = math.floor(ESPColor.G * 255),
                b = math.floor(ESPColor.B * 255)
            } or {r = 255, g = 0, b = 0}
        },
        
        character = {
            speed = {
                enabled = SpeedEnabled or false,
                value = SpeedValue or 16
            },
            jump = {
                enabled = JumpEnabled or false,
                value = JumpValue or 50
            },
            infiniteJump = InfiniteJumpEnabled or false,
            noclip = NoclipEnabled or false,
            fly = {
                enabled = FlyEnabled or false,
                speed = FlySpeed or 50
            },
            bunnyhop = {
                enabled = BunnyhopEnabled or false,
                power = BunnyhopPower or 50
            },
            spinbot = {
                enabled = SpinbotEnabled or false,
                speed = SpinbotSpeed or 5
            }
        },
        
        combat = {
            aimbot = {
                pcEnabled = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.PCEnabled or false,
                mobileEnabled = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.MobileEnabled or false,
                fov = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.FOV or 200,
                speed = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.Speed or 100,
                part = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.Part or "Head",
                mode = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.Mode or "Hold",
                showFOV = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.ShowFOV ~= false,
                teamCheck = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.TeamCheck ~= false,
                wallCheck = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.Aimbot.WallCheck or false
            },
            silent = {
                enabled = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.SilentAim.Enabled or false,
                showFOV = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.SilentAim.ShowFOV ~= false,
                rainbow = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.SilentAim.RainbowFOV or false,
                fovSize = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.SilentAim.FOVSize or 100,
                headSize = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.SilentAim.HeadSize or 10,
                teamCheck = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.SilentAim.TeamCheck ~= false
            },
            hitbox = {
                enabled = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.HitboxExpander.Enabled or false,
                size = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.HitboxExpander.Size or 25,
                transparency = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.HitboxExpander.Transparency or 70,
                show = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.HitboxExpander.ShowHitbox ~= false,
                teamCheck = _G.Combat and _G.Combat.Settings and _G.Combat.Settings.HitboxExpander.TeamCheck ~= false
            }
        },
        
        visual = {
            fireAura = FireAuraEnabled or false,
            discoLights = DiscoLightsEnabled or false,
            laserEyes = LaserEyesEnabled or false,
            galaxyOrbit = GalaxyOrbitEnabled or false,
            neonOutline = NeonOutlineEnabled or false
        },
        
        misc = {
            antiFling = _G.AntiFlingSettings and _G.AntiFlingSettings.Enabled ~= false,
            xray = {
                enabled = _G.XRayEnabled or false,
                transparency = _G.XRayTransparency or 0.5
            }
        }
    }
    
    _G.cfgFilePath = _G.ConfigSystem.Folder .. "/" .. configName .. ".json"
    
    _G.cfgSaveSuccess, _G.cfgSaveErr = pcall(function()
        _G.cfgJson = Services.HttpService:JSONEncode(_G.cfgSaveData)
        writefile(_G.cfgFilePath, _G.cfgJson)
    end)
    
    if _G.cfgSaveSuccess then
        return true, "Saved"
    else
        return false, "Save failed"
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- LOAD CONFIGURATION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ConfigSystem.Load = function(configName)
    if not configName or configName == "" then
        return false, "No config selected"
    end
    
    _G.cfgLoadPath = _G.ConfigSystem.Folder .. "/" .. configName .. ".json"
    
    _G.cfgReadSuccess, _G.cfgContent = pcall(function()
        if isfile and isfile(_G.cfgLoadPath) then
            return readfile(_G.cfgLoadPath)
        end
        return nil
    end)
    
    if not _G.cfgReadSuccess or not _G.cfgContent then
        return false, "File not found"
    end
    
    _G.cfgParseSuccess, _G.cfgData = pcall(function()
        return Services.HttpService:JSONDecode(_G.cfgContent)
    end)
    
    if not _G.cfgParseSuccess or not _G.cfgData then
        return false, "Invalid config"
    end
    
    -- Apply Settings
    if _G.cfgData.settings then
        _G.cfgS = _G.cfgData.settings
        
        if _G.cfgS.theme and Themes then
            Settings.CURRENT_THEME = _G.cfgS.theme
            _G.cfgThemeIdx = 1
            while _G.cfgThemeIdx <= #Themes do
                if Themes[_G.cfgThemeIdx].name == _G.cfgS.theme then
                    Core.applyTheme(Themes[_G.cfgThemeIdx].colors)
                    break
                end
                _G.cfgThemeIdx = _G.cfgThemeIdx + 1
            end
        end
        
        if _G.cfgS.guiOpacity then
            Settings.GUI_OPACITY = _G.cfgS.guiOpacity
            if Core.updateGuiOpacity then
                Core.updateGuiOpacity(_G.cfgS.guiOpacity)
            end
        end
        
        if _G.cfgS.keybind then
            _G.cfgKeycode = Enum.KeyCode[_G.cfgS.keybind]
            if _G.cfgKeycode then
                Settings.CURRENT_BIND = _G.cfgKeycode
            end
        end
    end
    
    -- Apply ESP
    if _G.cfgData.esp then
        _G.cfgE = _G.cfgData.esp
        ESPEnabled = _G.cfgE.enabled or false
        NameESPEnabled = _G.cfgE.nameEnabled or false
        DistanceESPEnabled = _G.cfgE.distanceEnabled or false
        TeamCheckEnabled = _G.cfgE.teamCheck ~= false
        ESPTextSize = _G.cfgE.textSize or 14
        ESPTransparency = _G.cfgE.transparency or 50
        
        if _G.cfgE.color then
            ESPColor = Color3.fromRGB(_G.cfgE.color.r or 255, _G.cfgE.color.g or 0, _G.cfgE.color.b or 0)
        end
        
        if RefreshAllESP then
            pcall(RefreshAllESP)
        end
    end
    
    -- Apply Character
    if _G.cfgData.character then
        _G.cfgC = _G.cfgData.character
        
        if _G.cfgC.speed then
            SpeedValue = _G.cfgC.speed.value or 16
            SpeedEnabled = _G.cfgC.speed.enabled or false
            if SpeedEnabled then
                _G.cfgHum = GetHum and GetHum()
                if _G.cfgHum then _G.cfgHum.WalkSpeed = SpeedValue end
            end
        end
        
        if _G.cfgC.jump then
            JumpValue = _G.cfgC.jump.value or 50
            JumpEnabled = _G.cfgC.jump.enabled or false
            if JumpEnabled then
                _G.cfgHum2 = GetHum and GetHum()
                if _G.cfgHum2 then
                    _G.cfgHum2.UseJumpPower = true
                    _G.cfgHum2.JumpPower = JumpValue
                end
            end
        end
        
        InfiniteJumpEnabled = _G.cfgC.infiniteJump or false
        NoclipEnabled = _G.cfgC.noclip or false
        
        if _G.cfgC.fly then
            FlySpeed = _G.cfgC.fly.speed or 50
            if _G.cfgC.fly.enabled and StartFly then
                FlyEnabled = true
                pcall(StartFly)
            end
        end
        
        if _G.cfgC.bunnyhop then
            BunnyhopPower = _G.cfgC.bunnyhop.power or 50
            BunnyhopEnabled = _G.cfgC.bunnyhop.enabled or false
        end
        
        if _G.cfgC.spinbot then
            SpinbotSpeed = _G.cfgC.spinbot.speed or 5
            SpinbotEnabled = _G.cfgC.spinbot.enabled or false
        end
    end
    
    -- Apply Combat
    if _G.cfgData.combat and _G.Combat and _G.Combat.Settings then
        _G.cfgCombat = _G.Combat.Settings
        
        if _G.cfgData.combat.aimbot then
            _G.cfgA = _G.cfgData.combat.aimbot
            _G.cfgCombat.Aimbot.PCEnabled = _G.cfgA.pcEnabled or false
            _G.cfgCombat.Aimbot.MobileEnabled = _G.cfgA.mobileEnabled or false
            _G.cfgCombat.Aimbot.FOV = _G.cfgA.fov or 200
            _G.cfgCombat.Aimbot.Speed = _G.cfgA.speed or 100
            _G.cfgCombat.Aimbot.Part = _G.cfgA.part or "Head"
            _G.cfgCombat.Aimbot.Mode = _G.cfgA.mode or "Hold"
            _G.cfgCombat.Aimbot.ShowFOV = _G.cfgA.showFOV ~= false
            _G.cfgCombat.Aimbot.TeamCheck = _G.cfgA.teamCheck ~= false
            _G.cfgCombat.Aimbot.WallCheck = _G.cfgA.wallCheck or false
        end
        
        if _G.cfgData.combat.silent then
            _G.cfgSil = _G.cfgData.combat.silent
            _G.cfgCombat.SilentAim.Enabled = _G.cfgSil.enabled or false
            _G.cfgCombat.SilentAim.ShowFOV = _G.cfgSil.showFOV ~= false
            _G.cfgCombat.SilentAim.RainbowFOV = _G.cfgSil.rainbow or false
            _G.cfgCombat.SilentAim.FOVSize = _G.cfgSil.fovSize or 100
            _G.cfgCombat.SilentAim.HeadSize = _G.cfgSil.headSize or 10
            _G.cfgCombat.SilentAim.TeamCheck = _G.cfgSil.teamCheck ~= false
        end
        
        if _G.cfgData.combat.hitbox then
            _G.cfgH = _G.cfgData.combat.hitbox
            _G.cfgCombat.HitboxExpander.Enabled = _G.cfgH.enabled or false
            _G.cfgCombat.HitboxExpander.Size = _G.cfgH.size or 25
            _G.cfgCombat.HitboxExpander.Transparency = _G.cfgH.transparency or 70
            _G.cfgCombat.HitboxExpander.ShowHitbox = _G.cfgH.show ~= false
            _G.cfgCombat.HitboxExpander.TeamCheck = _G.cfgH.teamCheck ~= false
            
            if _G.Combat.Data then
                _G.Combat.Data.HitboxNeedsUpdate = true
            end
        end
    end
    
    -- Apply Visual
    if _G.cfgData.visual then
        _G.cfgV = _G.cfgData.visual
        if _G.cfgV.fireAura and ApplyFireAura then FireAuraEnabled = true pcall(ApplyFireAura) end
        if _G.cfgV.discoLights and ApplyDiscoLights then DiscoLightsEnabled = true pcall(ApplyDiscoLights) end
        if _G.cfgV.laserEyes and ApplyLaserEyes then LaserEyesEnabled = true pcall(ApplyLaserEyes) end
        if _G.cfgV.galaxyOrbit and ApplyGalaxyOrbit then GalaxyOrbitEnabled = true pcall(ApplyGalaxyOrbit) end
        if _G.cfgV.neonOutline and ApplyNeonOutline then NeonOutlineEnabled = true pcall(ApplyNeonOutline) end
    end
    
    -- Apply Misc
    if _G.cfgData.misc then
        _G.cfgM = _G.cfgData.misc
        
        if _G.AntiFlingSettings then
            _G.AntiFlingSettings.Enabled = _G.cfgM.antiFling ~= false
            if _G.cfgM.antiFling and _G.AntiFlingStart then
                pcall(_G.AntiFlingStart)
            end
        end
        
        if _G.cfgM.xray then
            _G.XRayEnabled = _G.cfgM.xray.enabled or false
            _G.XRayTransparency = _G.cfgM.xray.transparency or 0.5
            if _G.XRayEnabled and _G.EnableXRay then
                pcall(_G.EnableXRay)
            end
        end
    end
    
    return true, "Loaded"
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DELETE CONFIGURATION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ConfigSystem.Delete = function(configName)
    if not configName or configName == "" then
        return false, "No config selected"
    end
    
    _G.cfgDelPath = _G.ConfigSystem.Folder .. "/" .. configName .. ".json"
    
    _G.cfgDelSuccess = pcall(function()
        if delfile and isfile and isfile(_G.cfgDelPath) then
            delfile(_G.cfgDelPath)
        end
    end)
    
    if _G.cfgDelSuccess then
        return true, "Deleted"
    else
        return false, "Delete failed"
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DROPDOWN UPDATE FUNCTION (OPTIMIZED - NO DELAYS)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ConfigSystem.UpdateDropdown = function()
    _G.cfgPreserveName = "None"
    
    if _G.ConfigSystem.Selected and _G.ConfigSystem.Selected ~= "" then
        _G.cfgPreserveName = _G.ConfigSystem.Selected
    end
    
    if _G.ConfigSystem.DropdownContainer then
        _G.ConfigSystem.DropdownContainer:Destroy()
        _G.ConfigSystem.DropdownContainer = nil
    end
    
    _G.cfgOptions = _G.ConfigSystem.GetOptionsTable()
    
    _G.ConfigSystem.DropdownContainer, _G.ConfigSystem.SetDropdownFunction = Core.dropdown(_G.cfgSection, "Select Config", _G.cfgOptions, 2, function(selectedOption)
        if selectedOption.name == "None" then
            _G.ConfigSystem.Selected = ""
        else
            _G.ConfigSystem.Selected = selectedOption.name
        end
    end)
    
    if _G.cfgPreserveName ~= "None" and _G.ConfigSystem.SetDropdownFunction then
        _G.cfgFoundInList = false
        _G.cfgSearchIdx = 1
        while _G.cfgSearchIdx <= #_G.cfgOptions do
            if _G.cfgOptions[_G.cfgSearchIdx].name == _G.cfgPreserveName then
                _G.cfgFoundInList = true
                break
            end
            _G.cfgSearchIdx = _G.cfgSearchIdx + 1
        end
        if _G.cfgFoundInList then
            _G.ConfigSystem.SetDropdownFunction(_G.cfgPreserveName)
        end
    end
    
    Core.registerModule("Select Config", _G.ConfigSystem.DropdownContainer, _G.cfgSection, "Settings", "dropdown")
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CLEAR INPUT FUNCTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.ConfigSystem.ClearInput = function()
    if _G.cfgNameInput then
        _G.cfgNameInput.Text = ""
    end
    _G.ConfigSystem.InputName = ""
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- UI ELEMENTS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.cfgSection = Core.section(SettingsTab, "Configuration", 3)

-- Config Name Input Card
_G.cfgNameCard = Core.moduleCard(_G.cfgSection, 1)

_G.cfgNameLabel = Instance.new("TextLabel", _G.cfgNameCard)
_G.cfgNameLabel.Size = UDim2.new(0, Settings.IS_MOBILE and 80 or 100, 1, 0)
_G.cfgNameLabel.Position = UDim2.fromOffset(14, 0)
_G.cfgNameLabel.BackgroundTransparency = 1
_G.cfgNameLabel.Text = "Config Name"
_G.cfgNameLabel.Font = Enum.Font.FredokaOne
_G.cfgNameLabel.TextSize = Settings.IS_MOBILE and 11 or 13
_G.cfgNameLabel.TextXAlignment = Enum.TextXAlignment.Left
_G.cfgNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)

_G.cfgNameInput = Instance.new("TextBox", _G.cfgNameCard)
_G.cfgNameInput.Size = UDim2.fromOffset(Settings.IS_MOBILE and 90 or 120, Settings.IS_MOBILE and 26 or 30)
_G.cfgNameInput.Position = UDim2.new(1, Settings.IS_MOBILE and -100 or -132, 0.5, Settings.IS_MOBILE and -13 or -15)
_G.cfgNameInput.BackgroundColor3 = Colors.Interactive
_G.cfgNameInput.BackgroundTransparency = 0.3
_G.cfgNameInput.BorderSizePixel = 0
_G.cfgNameInput.Text = ""
_G.cfgNameInput.PlaceholderText = "Enter name..."
_G.cfgNameInput.PlaceholderColor3 = Colors.TextMain
_G.cfgNameInput.Font = Enum.Font.FredokaOne
_G.cfgNameInput.TextSize = Settings.IS_MOBILE and 10 or 12
_G.cfgNameInput.TextColor3 = Colors.TextMain
_G.cfgNameInput.ClearTextOnFocus = false
_G.cfgNameInput.ClipsDescendants = true

_G.cfgNameInputCorner = Instance.new("UICorner", _G.cfgNameInput)
_G.cfgNameInputCorner.CornerRadius = UDim.new(0, 8)

_G.cfgNameInputStroke = Instance.new("UIStroke", _G.cfgNameInput)
_G.cfgNameInputStroke.Color = Colors.Border
_G.cfgNameInputStroke.Transparency = 0.5
_G.cfgNameInputStroke.Thickness = 1

_G.cfgNameInput:GetPropertyChangedSignal("Text"):Connect(function()
    _G.ConfigSystem.InputName = _G.cfgNameInput.Text
end)

_G.cfgNameInput.MouseEnter:Connect(function()
    Services.TweenService:Create(_G.cfgNameInput, TweenInfo.new(0.15), {BackgroundTransparency = 0.2}):Play()
end)

_G.cfgNameInput.MouseLeave:Connect(function()
    Services.TweenService:Create(_G.cfgNameInput, TweenInfo.new(0.15), {BackgroundTransparency = 0.3}):Play()
end)

Core.registerModule("Config Name", _G.cfgNameCard, _G.cfgSection, "Settings", "module")

-- Create Dropdown (using Core.dropdown like in troll tab)
_G.ConfigSystem.UpdateDropdown()

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ACTION BUTTONS (WITH NOTIFICATIONS INSTEAD OF TEXT CHANGE)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_G.CreateConfigButton = function(name, order, callback)
    _G["cfgBtn" .. order .. "Card"] = Core.moduleCard(_G.cfgSection, order)
    
    _G["cfgBtn" .. order .. "Text"] = Instance.new("TextLabel", _G["cfgBtn" .. order .. "Card"])
    _G["cfgBtn" .. order .. "Text"].Size = UDim2.fromScale(1, 1)
    _G["cfgBtn" .. order .. "Text"].BackgroundTransparency = 1
    _G["cfgBtn" .. order .. "Text"].Text = name
    _G["cfgBtn" .. order .. "Text"].Font = Enum.Font.FredokaOne
    _G["cfgBtn" .. order .. "Text"].TextSize = Settings.IS_MOBILE and 11 or 13
    _G["cfgBtn" .. order .. "Text"].TextColor3 = Color3.fromRGB(255, 255, 255)
    
    _G["cfgBtn" .. order .. "Button"] = Instance.new("TextButton", _G["cfgBtn" .. order .. "Card"])
    _G["cfgBtn" .. order .. "Button"].Size = UDim2.fromScale(1, 1)
    _G["cfgBtn" .. order .. "Button"].BackgroundTransparency = 1
    _G["cfgBtn" .. order .. "Button"].Text = ""
    _G["cfgBtn" .. order .. "Button"].ZIndex = 10
    
    _G["cfgBtn" .. order .. "Button"].MouseEnter:Connect(function()
        Services.TweenService:Create(_G["cfgBtn" .. order .. "Card"], TweenInfo.new(0.15), {
            BackgroundColor3 = Colors.InteractiveHover,
            BackgroundTransparency = 0.15
        }):Play()
    end)
    
    _G["cfgBtn" .. order .. "Button"].MouseLeave:Connect(function()
        Services.TweenService:Create(_G["cfgBtn" .. order .. "Card"], TweenInfo.new(0.15), {
            BackgroundColor3 = Colors.Card,
            BackgroundTransparency = 0.3
        }):Play()
    end)
    
    _G["cfgBtn" .. order .. "Button"].MouseButton1Click:Connect(function()
        Services.TweenService:Create(_G["cfgBtn" .. order .. "Card"], TweenInfo.new(0.1), {
            BackgroundColor3 = Colors.InteractiveActive
        }):Play()
        
        task.delay(0.15, function()
            Services.TweenService:Create(_G["cfgBtn" .. order .. "Card"], TweenInfo.new(0.15), {
                BackgroundColor3 = Colors.Card
            }):Play()
        end)
        
        callback()
    end)
    
    Core.registerModule(name, _G["cfgBtn" .. order .. "Card"], _G.cfgSection, "Settings", "button")
    return _G["cfgBtn" .. order .. "Card"], _G["cfgBtn" .. order .. "Text"]
end

-- Save Button
_G.CreateConfigButton("Save Configuration", 3, function()
    if _G.ConfigSystem.InputName == "" then
        _G.ShowNotification("Enter config name!")
        return
    end
    
    _G.cfgSaveRes, _G.cfgSaveMsg = _G.ConfigSystem.Save(_G.ConfigSystem.InputName)
    
    if _G.cfgSaveRes then
        _G.ShowNotification("Config '" .. _G.ConfigSystem.InputName .. "' saved!")
        _G.ConfigSystem.ClearInput()
        _G.ConfigSystem.UpdateDropdown()
    else
        _G.ShowNotification("Error: " .. _G.cfgSaveMsg)
    end
end)

-- Load Button
_G.CreateConfigButton("Load Configuration", 4, function()
    if _G.ConfigSystem.Selected == "" then
        _G.ShowNotification("Select a config first!")
        return
    end
    
    _G.cfgLoadRes, _G.cfgLoadMsg = _G.ConfigSystem.Load(_G.ConfigSystem.Selected)
    
    if _G.cfgLoadRes then
        _G.ShowNotification("Config '" .. _G.ConfigSystem.Selected .. "' loaded!")
    else
        _G.ShowNotification("Error: " .. _G.cfgLoadMsg)
    end
end)

-- Delete Button
_G.CreateConfigButton("Delete Configuration", 5, function()
    if _G.ConfigSystem.Selected == "" then
        _G.ShowNotification("Select a config first!")
        return
    end
    
    _G.cfgDeletedName = _G.ConfigSystem.Selected
    _G.cfgDelRes, _G.cfgDelMsg = _G.ConfigSystem.Delete(_G.ConfigSystem.Selected)
    
    if _G.cfgDelRes then
        _G.ShowNotification("Config '" .. _G.cfgDeletedName .. "' deleted!")
        _G.ConfigSystem.Selected = ""
        _G.ConfigSystem.UpdateDropdown()
    else
        _G.ShowNotification("Error: " .. _G.cfgDelMsg)
    end
end)

-- Refresh Button
_G.CreateConfigButton("Refresh List", 6, function()
    _G.ConfigSystem.UpdateDropdown()
    _G.ShowNotification("Config list refreshed!")
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- STRAFE SYSTEM (AIR CONTROL)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
_G.StrafeSystem = {}
_G.StrafeSystem.Enabled = false
_G.StrafeSystem.Speed = 1
_G.StrafeSystem.Connection = nil
_G.StrafeSystem.Character = nil
_G.StrafeSystem.Humanoid = nil
_G.StrafeSystem.RootPart = nil
_G.StrafeSystem.IsInAir = false
_G.StrafeSystem.MoveDirection = nil
_G.StrafeSystem.Camera = nil
_G.StrafeSystem.CameraCFrame = nil
_G.StrafeSystem.CameraLookVector = nil
_G.StrafeSystem.CameraRightVector = nil
_G.StrafeSystem.ForwardInput = 0
_G.StrafeSystem.SideInput = 0
_G.StrafeSystem.DesiredDirection = nil
_G.StrafeSystem.CurrentVelocity = nil
_G.StrafeSystem.HorizontalVelocity = nil
_G.StrafeSystem.VerticalVelocity = 0
_G.StrafeSystem.NewVelocity = nil
_G.StrafeSystem.SpeedMultiplier = 1
_G.StrafeSystem.GetCharacter = function()
    _G.StrafeSystem.Character = Player.Character
    if not _G.StrafeSystem.Character then return false end
   
    _G.StrafeSystem.Humanoid = _G.StrafeSystem.Character:FindFirstChildOfClass("Humanoid")
    _G.StrafeSystem.RootPart = _G.StrafeSystem.Character:FindFirstChild("HumanoidRootPart")
   
    if not _G.StrafeSystem.Humanoid then return false end
    if not _G.StrafeSystem.RootPart then return false end
    if _G.StrafeSystem.Humanoid.Health <= 0 then return false end
   
    return true
end
_G.StrafeSystem.CheckIfInAir = function()
    if not _G.StrafeSystem.Humanoid then return false end
   
    _G.StrafeSystem.IsInAir = _G.StrafeSystem.Humanoid.FloorMaterial == Enum.Material.Air
   
    return _G.StrafeSystem.IsInAir
end
_G.StrafeSystem.GetInputDirection = function()
    _G.StrafeSystem.ForwardInput = 0
    _G.StrafeSystem.SideInput = 0
   
    if Services.UIS:IsKeyDown(Enum.KeyCode.W) then
        _G.StrafeSystem.ForwardInput = _G.StrafeSystem.ForwardInput + 1
    end
    if Services.UIS:IsKeyDown(Enum.KeyCode.S) then
        _G.StrafeSystem.ForwardInput = _G.StrafeSystem.ForwardInput - 1
    end
    if Services.UIS:IsKeyDown(Enum.KeyCode.D) then
        _G.StrafeSystem.SideInput = _G.StrafeSystem.SideInput + 1
    end
    if Services.UIS:IsKeyDown(Enum.KeyCode.A) then
        _G.StrafeSystem.SideInput = _G.StrafeSystem.SideInput - 1
    end
end
_G.StrafeSystem.CalculateDesiredDirection = function()
    _G.StrafeSystem.Camera = workspace.CurrentCamera
    if not _G.StrafeSystem.Camera then return Vector3.zero end
   
    _G.StrafeSystem.CameraCFrame = _G.StrafeSystem.Camera.CFrame
    _G.StrafeSystem.CameraLookVector = _G.StrafeSystem.CameraCFrame.LookVector
    _G.StrafeSystem.CameraRightVector = _G.StrafeSystem.CameraCFrame.RightVector
   
    _G.StrafeSystem.DesiredDirection = Vector3.zero
   
    if _G.StrafeSystem.ForwardInput ~= 0 then
        _G.StrafeSystem.DesiredDirection = _G.StrafeSystem.DesiredDirection + (_G.StrafeSystem.CameraLookVector * _G.StrafeSystem.ForwardInput)
    end
   
    if _G.StrafeSystem.SideInput ~= 0 then
        _G.StrafeSystem.DesiredDirection = _G.StrafeSystem.DesiredDirection + (_G.StrafeSystem.CameraRightVector * _G.StrafeSystem.SideInput)
    end
   
    if _G.StrafeSystem.DesiredDirection.Magnitude > 0 then
        _G.StrafeSystem.DesiredDirection = _G.StrafeSystem.DesiredDirection.Unit
    end
   
    return _G.StrafeSystem.DesiredDirection
end
_G.StrafeSystem.ApplyAirControl = function()
    if not _G.StrafeSystem.RootPart then return end
    if not _G.StrafeSystem.RootPart.Parent then return end
   
    _G.StrafeSystem.CurrentVelocity = _G.StrafeSystem.RootPart.AssemblyLinearVelocity
    _G.StrafeSystem.VerticalVelocity = _G.StrafeSystem.CurrentVelocity.Y
   
    _G.StrafeSystem.HorizontalVelocity = Vector3.new(
        _G.StrafeSystem.CurrentVelocity.X,
        0,
        _G.StrafeSystem.CurrentVelocity.Z
    )
   
    _G.StrafeSystem.SpeedMultiplier = _G.StrafeSystem.Speed * 0.05
   
    if _G.StrafeSystem.DesiredDirection.Magnitude > 0 then
        local acceleration = _G.StrafeSystem.DesiredDirection * _G.StrafeSystem.SpeedMultiplier
        _G.StrafeSystem.HorizontalVelocity = _G.StrafeSystem.HorizontalVelocity + acceleration
    end
   
    _G.StrafeSystem.NewVelocity = Vector3.new(
        _G.StrafeSystem.HorizontalVelocity.X,
        _G.StrafeSystem.VerticalVelocity,
        _G.StrafeSystem.HorizontalVelocity.Z
    )
   
    _G.StrafeSystem.RootPart.AssemblyLinearVelocity = _G.StrafeSystem.NewVelocity
end
_G.StrafeSystem.DisableAirFriction = function()
    if not _G.StrafeSystem.Character then return end
    
    for _, part in ipairs(_G.StrafeSystem.Character:GetDescendants()) do
        if part:IsA("BasePart") then
            local oldProps = part.CustomPhysicalProperties
            local density = oldProps and oldProps.Density or 0.7
            
            part.CustomPhysicalProperties = PhysicalProperties.new(density, 0, 0, 0, 1)
            end
    end
end

_G.StrafeSystem.RestoreAirFriction = function()
    if not _G.StrafeSystem.Character then return end
    
    for _, part in ipairs(_G.StrafeSystem.Character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CustomPhysicalProperties = nil
        end
    end
end
_G.StrafeSystem.MainLoop = function()
    if not _G.StrafeSystem.Enabled then return end
   
    if not _G.StrafeSystem.GetCharacter() then return end
   
    if not _G.StrafeSystem.CheckIfInAir() then return end
   
    _G.StrafeSystem.GetInputDirection()
   
    _G.StrafeSystem.DesiredDirection = _G.StrafeSystem.CalculateDesiredDirection()
   
    _G.StrafeSystem.ApplyAirControl()
end
_G.StrafeSystem.Start = function()
    if _G.StrafeSystem.Connection then
        _G.StrafeSystem.Connection:Disconnect()
        _G.StrafeSystem.Connection = nil
    end
   
    _G.StrafeSystem.Enabled = true
   
    _G.StrafeSystem.Connection = Services.RunService.Heartbeat:Connect(_G.StrafeSystem.MainLoop)
   
    -- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð² Ð²Ð¾Ð·Ð´ÑƒÑ…Ðµ Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ðµ
    _G.StrafeSystem.DisableAirFriction()
end
_G.StrafeSystem.Stop = function()
    _G.StrafeSystem.Enabled = false
   
    if _G.StrafeSystem.Connection then
        _G.StrafeSystem.Connection:Disconnect()
        _G.StrafeSystem.Connection = nil
    end
   
    -- Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐµ
    _G.StrafeSystem.RestoreAirFriction()
end
_G.StrafeSystem.Toggle = function(state)
    if state then
        _G.StrafeSystem.Start()
    else
        _G.StrafeSystem.Stop()
    end
end
_G.strafeToggle, _G.strafeToggleCard, _G.strafeToggleSetState = Core.toggle(characterContent, "Strafe", 14, false, function(state)
    CharacterModules.Strafe = CharacterModules.Strafe or {enabled = false, disableFunc = nil}
    CharacterModules.Strafe.enabled = state
    CharacterModules.Strafe.disableFunc = function()
        _G.StrafeSystem.Stop()
    end
   
    _G.StrafeSystem.Toggle(state)
end)
Core.registerModule("Strafe", _G.strafeToggle, characterContent, "Character", "toggle")
_G.strafeSpeedSlider, _G.strafeSpeedLabel = Core.slider(characterContent, "Strafe Speed", 15, 1, 100, 1, function(value)
    _G.StrafeSystem.Speed = value
    if _G.strafeSpeedLabel then
        _G.strafeSpeedLabel.Text = tostring(value)
    end
end)
Core.registerModule("Strafe Speed", _G.strafeSpeedSlider, characterContent, "Character", "slider")
Player.CharacterAdded:Connect(function(newCharacter)
    task.wait(0.8)
   
    if _G.StrafeSystem.Enabled then
        _G.StrafeSystem.Character = nil
        _G.StrafeSystem.Humanoid = nil
        _G.StrafeSystem.RootPart = nil
       
        task.wait(0.2)
       
        if _G.StrafeSystem.GetCharacter() then
            _G.StrafeSystem.Start()
        end
    end
end)
